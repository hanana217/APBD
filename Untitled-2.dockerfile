
 SELECT c.firstname, c.lastname, o.price, p.name AS product_name FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id WHERE p.name LIKE '%product%' AND o.status = 'pending';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.id, p.name, AVG(r.rating) AS avg_rating, COUNT(c.id) AS total_comments FROM products p LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments c ON c.product_id = p.id GROUP BY p.id HAVING total_comments > 5 ORDER BY avg_rating DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE price > (SELECT AVG(price) FROM products);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE id NOT IN (SELECT product_id FROM cart);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT c.id, COUNT(DISTINCT ca.id) FROM clients c JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id WHERE p.price > 500 GROUP BY c.id ORDER BY COUNT(*) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.category, COUNT(*) FROM products p JOIN promotions pr ON pr.product_id = p.id WHERE pr.percentage > 10 GROUP BY p.category ORDER BY COUNT(*) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.brand, AVG(p.price) FROM products p JOIN offers o ON o.product_id = p.id GROUP BY p.brand HAVING AVG(p.price) > 2000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, COUNT(ca.id) FROM products p JOIN cart ca ON ca.product_id = p.id JOIN clients c ON c.id = ca.client_id GROUP BY p.id ORDER BY COUNT(*) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE price > ( SELECT AVG(price) FROM products );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.id, COUNT(DISTINCT ca.product_id) FROM clients c JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id GROUP BY c.id ORDER BY COUNT(*) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.id, MAX(pr.percentage) FROM products p JOIN promotions pr ON pr.product_id = p.id GROUP BY p.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.id, COUNT(DISTINCT ca.id) as cart_items FROM clients c JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id WHERE p.price > 500 GROUP BY c.id ORDER BY COUNT(*) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.brand, AVG(p.price) as avg_price, COUNT(DISTINCT o.id) as order_count FROM products p JOIN cart ca ON ca.product_id = p.id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) WHERE p.quantity > 0 GROUP BY p.brand HAVING COUNT(DISTINCT o.id) > 5 ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, p.name, COUNT(DISTINCT c.id) as unique_buyers FROM products p JOIN cart ca ON ca.product_id = p.id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) JOIN clients c ON o.client_id = c.id WHERE p.price > 1000 GROUP BY p.id ORDER BY unique_buyers DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT MONTH(o.orderdate) as month, COUNT(DISTINCT p.id) as unique_products FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id WHERE YEAR(o.orderdate) = 2024 GROUP BY MONTH(o.orderdate) ORDER BY month;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.id, c.firstname, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) as order_count, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id) as total_spent FROM clients c WHERE (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) > 0 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT a.id, a.username, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) as products_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) as promotions_created FROM admin a ORDER BY products_added DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, p.price, 'Regular' as type FROM products p WHERE NOT EXISTS (SELECT 1 FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate) UNION ALL SELECT p.id, p.name, pr.price, 'On Promotion' as type FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.price, RANK() OVER (ORDER BY p.price DESC) as price_rank, DENSE_RANK() OVER (PARTITION BY p.category ORDER BY p.price DESC) as category_price_rank FROM products p WHERE p.quantity > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.category, p.brand, COUNT(*) as product_count, AVG(p.price) as avg_price FROM products p GROUP BY p.category, p.brand WITH ROLLUP HAVING COUNT(*) > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT c.id, c.firstname, CASE WHEN (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) = 0 THEN 'New' WHEN (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) BETWEEN 1 AND 5 THEN 'Regular' ELSE 'VIP' END as customer_segment, CASE WHEN (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id) > 10000 THEN 'High Value' WHEN (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id) BETWEEN 1000 AND 10000 THEN 'Medium Value' ELSE 'Low Value' END as value_category FROM clients c ORDER BY customer_segment, value_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT c1.id as client1_id, c1.firstname as client1_name, c2.id as client2_id, c2.firstname as client2_name, c1.wilaya as common_wilaya FROM clients c1 JOIN clients c2 ON c1.wilaya = c2.wilaya AND c1.id < c2.id WHERE c1.wilaya IN (SELECT wilaya FROM clients GROUP BY wilaya HAVING COUNT(*) > 1) ORDER BY c1.wilaya;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.category, GROUP_CONCAT(DISTINCT p.brand ORDER BY p.brand SEPARATOR ', ') as brands_in_category, COUNT(DISTINCT p.id) as product_count FROM products p GROUP BY p.category ORDER BY product_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT o.id, o.orderdate, GROUP_CONCAT(DISTINCT p.name ORDER BY p.name SEPARATOR '  ') as products_ordered FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id GROUP BY o.id HAVING COUNT(DISTINCT p.id) > 1 ORDER BY o.orderdate DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT id, name, price FROM products ORDER BY name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT id, name, (SELECT COUNT(*) FROM comments WHERE product_id = products.id) as comment_count FROM products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT c.id as client_id, o.id as order_id, c.firstname, o.orderdate, o.price FROM clients c LEFT JOIN orders o ON c.id = o.client_id UNION SELECT c.id as client_id, o.id as order_id, c.firstname, o.orderdate, o.price FROM orders o LEFT JOIN clients c ON c.id = o.client_id WHERE c.id IS NULL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT c.category, w.name as wilaya, COUNT(p.id) as product_count FROM products c CROSS JOIN wilayas w LEFT JOIN clients cl ON w.id = cl.wilaya LEFT JOIN products p ON c.category = p.category GROUP BY c.category, w.name HAVING product_count > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, p.brand, COUNT(*) as product_count, SUM(p.quantity) as total_quantity, AVG(p.price) as avg_price FROM products p GROUP BY p.category, p.brand WITH ROLLUP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE price < 1000 OR quantity > 50 OR brand = 'Apple';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE price * quantity > 10000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products ORDER BY name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE id NOT IN (SELECT DISTINCT product_id FROM cart);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT category, brand, COUNT(*), AVG(price) FROM products GROUP BY category, brand WITH ROLLUP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT id, name, price, AVG(price) OVER () as overall_avg, RANK() OVER (ORDER BY price DESC) as price_rank FROM products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE name REGEXP 'ProMaxPlusMini';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT id, name, price, (price * 0.2) as tax, (price * 1.2) as price_with_tax, SQRT(price) as sqrt_price, LOG(price) as log_price FROM products WHERE price > 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products WHERE (name LIKE '%Pro%' AND price > 50000) OR (name LIKE '%Max%' AND price > 30000) OR (name LIKE '%Plus%' AND price > 20000) OR (name LIKE '%Mini%' AND price < 10000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT id, name, price, SIN(price/1000) as sin_price, COS(price/1000) as cos_price, TAN(price/1000) as tan_price FROM products WHERE price > 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT c.*, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id), (SELECT SUM(price) FROM orders o WHERE o.client_id = c.id), (SELECT AVG(price) FROM orders o WHERE o.client_id = c.id), (SELECT MAX(orderdate) FROM orders o WHERE o.client_id = c.id) FROM clients c;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT id, name, JSON_EXTRACT(more_details, '$.battery') as battery, JSON_EXTRACT(more_details, '$.screen') as screen, JSON_EXTRACT(more_details, '$.ram') as ram FROM products WHERE JSON_CONTAINS(more_details, '"wireless"') OR JSON_CONTAINS(more_details, '"bluetooth"');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT id, name, price, category, AVG(price) OVER (PARTITION BY category) as category_avg, RANK() OVER (PARTITION BY category ORDER BY price DESC) as rank_in_category, NTILE(4) OVER (PARTITION BY category ORDER BY price) as price_quartile FROM products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT c1.id as id1, c2.id as id2, DATEDIFF(c1.birthday, c2.birthday) as age_difference FROM clients c1 CROSS JOIN clients c2 WHERE c1.id < c2.id ORDER BY ABS(DATEDIFF(c1.birthday, c2.birthday));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products WHERE name REGEXP 'iPhone.*Pro' OR name REGEXP 'Galaxy.*S[0-9]+' OR description LIKE '%latest model%' OR more_details LIKE '%new version%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.*, o.*, p.* FROM clients c LEFT JOIN orders o ON c.id = o.client_id OR c.wilaya = 16 LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id OR p.price > 1000 WHERE c.id < 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT category, GROUP_CONCAT(name ORDER BY price DESC SEPARATOR '  ') as products, COUNT(*) as product_count FROM products GROUP BY category HAVING COUNT(*) > 3;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT id, name, price, category, SUM(price) OVER (PARTITION BY category ORDER BY price ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) as running_total, AVG(price) OVER (PARTITION BY category ORDER BY price ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING) as moving_avg FROM products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT DISTINCT c.firstname, c.lastname, c.email, p.name, p.brand, p.category FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id WHERE p.price > 5000 ORDER BY c.lastname, p.name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.category, p.brand, w.name as wilaya, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as revenue, AVG(o.price) as avg_order_value FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) JOIN clients c ON o.client_id = c.id JOIN wilayas w ON c.wilaya = w.id GROUP BY p.category, p.brand, w.name WITH ROLLUP HAVING order_count > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT * FROM products WHERE description LIKE '%'  (SELECT name FROM products WHERE id = 1)  '%' OR more_details LIKE '%'  (SELECT brand FROM products WHERE id = 2)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT SUBSTRING_INDEX(name, ' ', 1) as first_word, COUNT(*) as count, AVG(price) as avg_price FROM products GROUP BY SUBSTRING_INDEX(name, ' ', 1) HAVING count > 1 ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT c1.id as client1, c2.id as client2, c1.firstname as name1, c2.firstname as name2, COUNT(DISTINCT o1.id) as orders1, COUNT(DISTINCT o2.id) as orders2 FROM clients c1 JOIN clients c2 ON c1.wilaya = c2.wilaya AND c1.id < c2.id LEFT JOIN orders o1 ON c1.id = o1.client_id LEFT JOIN orders o2 ON c2.id = o2.client_id GROUP BY c1.id, c2.id HAVING orders1 > 0 AND orders2 > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT w1.name as wilaya1, w2.name as wilaya2, ABS(w1.delivery_price - w2.delivery_price) as price_difference, COUNT(DISTINCT c1.id) as clients_in_wilaya1, COUNT(DISTINCT c2.id) as clients_in_wilaya2 FROM wilayas w1 CROSS JOIN wilayas w2 LEFT JOIN clients c1 ON w1.id = c1.wilaya LEFT JOIN clients c2 ON w2.id = c2.wilaya WHERE w1.id < w2.id AND ABS(w1.delivery_price - w2.delivery_price) < 200 GROUP BY w1.id, w2.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT c1.id as id1, c2.id as id2, c1.firstname, c1.lastname, c1.email, COUNT(DISTINCT o1.id) as orders1, COUNT(DISTINCT o2.id) as orders2 FROM clients c1 JOIN clients c2 ON (c1.firstname = c2.firstname OR c1.lastname = c2.lastname OR c1.email LIKE CONCAT('%', c2.username, '%')) AND c1.id < c2.id LEFT JOIN orders o1 ON c1.id = o1.client_id LEFT JOIN orders o2 ON c2.id = o2.client_id GROUP BY c1.id, c2.id HAVING orders1 > 0 OR orders2 > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, p.category, p.brand, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as revenue, SUM(o.price) / SUM(SUM(o.price)) OVER (PARTITION BY YEAR(o.orderdate), MONTH(o.orderdate)) * 100 as pct_monthly_revenue, SUM(o.price) / SUM(SUM(o.price)) OVER (PARTITION BY p.category) * 100 as pct_category_revenue FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), p.category, p.brand HAVING order_count > 0 ORDER BY year DESC, month DESC, revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT c.id, c.firstname, GROUP_CONCAT(DISTINCT p.category ORDER BY o.orderdate SEPARATOR ' > ') as purchase_sequence, COUNT(DISTINCT p.category) as unique_categories, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as shopping_period_days FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id GROUP BY c.id HAVING COUNT(DISTINCT o.id) > 1 AND unique_categories > 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p1.category as category1, p2.category as category2, COUNT(DISTINCT o.id) as co_purchase_count, COUNT(DISTINCT CASE WHEN ca1.product_id IS NOT NULL AND ca2.product_id IS NOT NULL THEN o.id END) as together_count FROM products p1 CROSS JOIN products p2 LEFT JOIN cart ca1 ON p1.id = ca1.product_id LEFT JOIN cart ca2 ON p2.id = ca2.product_id AND ca1.client_id = ca2.client_id AND ca1.date_cart = ca2.date_cart LEFT JOIN orders o ON FIND_IN_SET(ca1.id, o.cart_id) AND FIND_IN_SET(ca2.id, o.cart_id) WHERE p1.id < p2.id AND p1.category != p2.category GROUP BY p1.category, p2.category HAVING co_purchase_count > 0 ORDER BY together_count DESC;                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT c.id, c.firstname, MIN(o.orderdate) as first_purchase, MAX(o.orderdate) as last_purchase, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as lifetime_value, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, GROUP_CONCAT(DISTINCT CONCAT(p.category, '(', p.brand, ')') ORDER BY o.orderdate SEPARATOR ' ? ') as journey FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id GROUP BY c.id HAVING total_orders > 1 ORDER BY lifetime_value DESC;                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.id, c.firstname, c.email, MAX(o.orderdate) as last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT o.id) as total_orders, AVG(DATEDIFF(o2.orderdate, o1.orderdate)) as avg_days_between_orders, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'High Risk' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) BETWEEN 60 AND 90 THEN 'Medium Risk' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) BETWEEN 30 AND 60 THEN 'Low Risk' ELSE 'Active' END as churn_risk FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN orders o1 ON c.id = o1.client_id LEFT JOIN orders o2 ON c.id = o2.client_id AND o2.orderdate > o1.orderdate GROUP BY c.id HAVING total_orders > 0 ORDER BY days_since_last_order DESC;                                                                                                                                                                                                                                                                                  
 SELECT p1.name as product1, p2.name as product2, COUNT(DISTINCT o.id) as times_bought_together, COUNT(DISTINCT o1.id) as times_product1_alone, COUNT(DISTINCT o2.id) as times_product2_alone, COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT o1.id), 0) as lift FROM products p1 CROSS JOIN products p2 LEFT JOIN cart ca1 ON p1.id = ca1.product_id LEFT JOIN cart ca2 ON p2.id = ca2.product_id AND ca1.client_id = ca2.client_id AND ca1.date_cart = ca2.date_cart LEFT JOIN orders o ON FIND_IN_SET(ca1.id, o.cart_id) AND FIND_IN_SET(ca2.id, o.cart_id) LEFT JOIN cart ca1_alone ON p1.id = ca1_alone.product_id LEFT JOIN orders o1 ON FIND_IN_SET(ca1_alone.id, o1.cart_id) LEFT JOIN cart ca2_alone ON p2.id = ca2_alone.product_id LEFT JOIN orders o2 ON FIND_IN_SET(ca2_alone.id, o2.cart_id) WHERE p1.id < p2.id AND p1.category != p2.category GROUP BY p1.id, p2.id HAVING times_bought_together > 0 ORDER BY lift DESC;                                                                                                                    
 SELECT o.id, o.client_id, o.price, o.orderdate, o.wilaya_id, COUNT(DISTINCT o2.id) as orders_same_day, SUM(o2.price) as total_same_day, (SELECT AVG(price) FROM orders WHERE client_id = o.client_id) as client_avg, CASE WHEN o.price > (SELECT AVG(price) * 3 FROM orders WHERE client_id = o.client_id) THEN 'High Value Anomaly' WHEN COUNT(DISTINCT o2.id) > 3 THEN 'Multiple Orders' WHEN o.wilaya_id != (SELECT wilaya FROM clients WHERE id = o.client_id) THEN 'Location Mismatch' ELSE 'Normal' END as fraud_flag FROM orders o LEFT JOIN orders o2 ON o.client_id = o2.client_id AND DATE(o.orderdate) = DATE(o2.orderdate) AND o.id != o2.id GROUP BY o.id HAVING fraud_flag != 'Normal' ORDER BY o.price DESC;                                                                                                                                                                                                                                                                                                                                      
 SELECT p.category, p.brand, COUNT(*) as product_count, SUM(p.quantity) as total_stock, SUM(p.price * p.quantity) as stock_value, AVG(p.quantity) as avg_stock_per_product, MIN(p.quantity) as min_stock, MAX(p.quantity) as max_stock, SUM(CASE WHEN p.quantity = 0 THEN 1 ELSE 0 END) as out_of_stock_count, SUM(CASE WHEN p.quantity < 10 THEN 1 ELSE 0 END) as low_stock_count FROM products p GROUP BY p.category, p.brand HAVING total_stock > 0 ORDER BY stock_value DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.price, p.quantity, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id = p.id) as avg_rating, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id = p.id) as comment_count, (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) as favorite_count, (p.price * 0.3 + (SELECT AVG(r.rating) FROM rating r WHERE r.product_id = p.id) * 20 + (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) * 5) as popularity_score, (p.quantity * p.price * 0.01 - (SELECT COUNT(*) FROM comments cm WHERE cm.product_id = p.id) * 0.5) as inventory_score FROM products p ORDER BY popularity_score DESC;                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT p.id, p.name, p.category, p.brand, p.price as current_price, (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category) as category_avg_price, (SELECT MIN(price) FROM products p2 WHERE p2.category = p.category AND p2.brand = p.brand) as brand_min_price, (SELECT MAX(price) FROM products p2 WHERE p2.category = p.category AND p2.brand = p.brand) as brand_max_price, p.price / (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category) * 100 as price_index_percent, CASE WHEN p.price > (SELECT AVG(price) * 1.2 FROM products p2 WHERE p2.category = p.category) THEN 'Premium' WHEN p.price < (SELECT AVG(price) * 0.8 FROM products p2 WHERE p2.category = p.category) THEN 'Budget' ELSE 'Standard' END as price_positioning, (p.price * 0.9) as suggested_sale_price, (p.price * 1.1) as suggested_premium_price FROM products p ORDER BY price_index_percent DESC;                                                                                                                                                    
 SELECT p.id, p.name, p.category, p.brand, p.price as selling_price, p.price * 0.6 as estimated_cost, p.price * 0.4 as estimated_profit_per_unit, p.quantity as current_stock, p.price * p.quantity as potential_revenue, (p.price * 0.4) * p.quantity as potential_profit, (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id) as total_sold, (SELECT SUM(o.price) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id) as actual_revenue, (SELECT SUM(o.price) * 0.4 FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id) as actual_profit, (p.price * p.quantity) / NULLIF((SELECT SUM(o.price) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id), 0) as inventory_to_sales_ratio FROM products p WHERE p.quantity > 0 ORDER BY potential_profit DESC;                                                                                                                            
 SELECT c.id, c.firstname, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) as order_count, (SELECT SUM(price) FROM orders o WHERE o.client_id = c.id) as total_spent, (SELECT AVG(price) FROM orders o WHERE o.client_id = c.id) as avg_order_value FROM clients c ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE description REGEXP '^(iPhoneGalaxyAirPods).*[0-9]{1,2}.*(promaxplus)' OR name REGEXP '.*(wirelessbluetoothbattery).*' OR more_details REGEXP '.*(ramromgbghz).*';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.category, SUM(CASE WHEN p.brand = 'Apple' THEN 1 ELSE 0 END) as Apple, SUM(CASE WHEN p.brand = 'Samsung' THEN 1 ELSE 0 END) as Samsung, SUM(CASE WHEN p.brand = 'Nulaxy' THEN 1 ELSE 0 END) as Nulaxy, SUM(CASE WHEN p.brand = 'Soundcore' THEN 1 ELSE 0 END) as Soundcore, SUM(CASE WHEN p.brand = 'Amalfi' THEN 1 ELSE 0 END) as Amalfi, SUM(CASE WHEN p.brand = 'Belkin' THEN 1 ELSE 0 END) as Belkin, SUM(CASE WHEN p.brand = 'SGNICS' THEN 1 ELSE 0 END) as SGNICS, COUNT(*) as Total, AVG(p.price) as Avg_Price FROM products p GROUP BY p.category ORDER BY Total DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p1.name as product1, p2.name as product2, COUNT(DISTINCT o.id) as times_bought_together, COUNT(DISTINCT o1.id) as times_product1_alone, COUNT(DISTINCT o2.id) as times_product2_alone, COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT o1.id), 0) as confidence_percent FROM products p1 CROSS JOIN products p2 LEFT JOIN cart ca1 ON p1.id = ca1.product_id LEFT JOIN cart ca2 ON p2.id = ca2.product_id AND ca1.client_id = ca2.client_id LEFT JOIN orders o ON FIND_IN_SET(ca1.id, o.cart_id) AND FIND_IN_SET(ca2.id, o.cart_id) LEFT JOIN cart ca1_alone ON p1.id = ca1_alone.product_id LEFT JOIN orders o1 ON FIND_IN_SET(ca1_alone.id, o1.cart_id) LEFT JOIN cart ca2_alone ON p2.id = ca2_alone.product_id LEFT JOIN orders o2 ON FIND_IN_SET(ca2_alone.id, o2.cart_id) WHERE p1.id < p2.id GROUP BY p1.id, p2.id HAVING times_bought_together > 0 ORDER BY confidence_percent DESC;                                                                                                                                                         
 SELECT c.id, c.firstname, c.wilaya, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id AND o.price > 1000) as premium_orders, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) as avg_rating, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) as comments_made, (SELECT GROUP_CONCAT(DISTINCT p.category) FROM orders o2 JOIN cart ca ON FIND_IN_SET(ca.id, o2.cart_id) JOIN products p ON ca.product_id = p.id WHERE o2.client_id = c.id) as categories_bought FROM clients c WHERE (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) > 0 ORDER BY (SELECT SUM(price) FROM orders o WHERE o.client_id = c.id) DESC;                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.id, c.firstname, c.email, c.wilaya, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT ca.id) as cart_activities, COUNT(DISTINCT cm.id) as comments_made, COUNT(DISTINCT r.id) as ratings_given, COUNT(DISTINCT f.id) as favorites_added, (COUNT(DISTINCT o.id) / NULLIF(DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)), 0)) * 30 as monthly_order_frequency, SUM(o.price) / NULLIF(DATEDIFF(CURDATE(), MIN(o.orderdate)), 0) * 30 as monthly_spending_rate, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'Prospect' WHEN COUNT(DISTINCT o.id) = 1 THEN 'One-Time' WHEN COUNT(DISTINCT o.id) BETWEEN 2 AND 5 THEN 'Regular' WHEN COUNT(DISTINCT o.id) BETWEEN 6 AND 10 THEN 'Frequent' ELSE 'VIP' END as customer_segment, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'Active' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'At Risk' ELSE 'Churned' END as activity_status FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN favorites f ON c.id = f.client_id GROUP BY c.id HAVING total_orders > 0 ORDER BY total_spent DESC, customer_lifetime_days DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(NOW(), INTERVAL 30 DAY)) as sales_last_30_days, (SELECT COUNT(DISTINCT ca2.id) FROM cart ca2 WHERE ca2.product_id = p.id AND ca2.date_cart >= DATE_SUB(NOW(), INTERVAL 7 DAY)) as cart_adds_last_7_days, (SELECT COUNT(DISTINCT f.id) FROM favorites f WHERE f.product_id = p.id) as total_favorites, p.quantity / NULLIF((SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(NOW(), INTERVAL 30 DAY)), 0) as months_of_inventory, CASE WHEN p.quantity = 0 THEN 'Out of Stock' WHEN p.quantity < 5 THEN 'Very Low' WHEN p.quantity < 10 THEN 'Low' WHEN p.quantity < 20 THEN 'Medium' ELSE 'High' END as stock_level, CASE WHEN (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(NOW(), INTERVAL 30 DAY)) > 10 THEN 'Fast Moving' WHEN (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(NOW(), INTERVAL 30 DAY)) > 3 THEN 'Medium Moving' ELSE 'Slow Moving' END as velocity, p.price * p.quantity as current_stock_value, (p.price * 0.6) * p.quantity as stock_cost_value, (p.price * 0.4) * p.quantity as potential_profit FROM products p WHERE p.quantity > 0 ORDER BY sales_last_30_days DESC, stock_level; 
 SELECT * FROM products WHERE description LIKE '%'  (SELECT name FROM products WHERE id = 1)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT SUBSTRING_INDEX(name, ' ', 1), COUNT(*) FROM products GROUP BY SUBSTRING_INDEX(name, ' ', 1);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id = p.id) as avg_rating FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT w.id, (SELECT AVG(price) FROM orders o JOIN clients c ON o.client_id = c.id WHERE c.wilaya = w.id) as avg_order_value FROM wilayas w;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE price * 0.8 < 1000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE id NOT IN (SELECT DISTINCT product_id FROM favorites);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products WHERE id NOT IN (SELECT product_id FROM cart WHERE client_id IN (1,2,3));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE more_details LIKE '%'  (SELECT brand FROM products WHERE id = 2)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE name LIKE '%'  (SELECT category FROM products LIMIT 1)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE description LIKE '%'  (SELECT LEFT(name, 3) FROM products WHERE id = 3)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE more_details LIKE '%'  (SELECT CONCAT(brand, ' ', category) FROM products WHERE id = 4)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.category, p.brand, w.name as wilaya, COUNT(DISTINCT o.id) as order_count FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) JOIN clients c ON o.client_id = c.id JOIN wilayas w ON c.wilaya = w.id GROUP BY p.category, p.brand, w.name WITH ROLLUP HAVING order_count > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, p.category, COUNT(DISTINCT o.id) as order_count FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), p.category WITH ROLLUP;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.id, p.name, p.price, RANK() OVER (ORDER BY p.price DESC) as price_rank FROM products p WHERE p.quantity > 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, p.category, p.price, DENSE_RANK() OVER (PARTITION BY p.category ORDER BY p.price DESC) as category_price_rank FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.id, p.name, p.price, NTILE(4) OVER (ORDER BY p.price) as price_quartile FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, p.name, p.price, FIRST_VALUE(p.price) OVER (ORDER BY p.price) as cheapest_price FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.id, p.name, p.price, p.category, FIRST_VALUE(p.name) OVER (PARTITION BY p.category ORDER BY p.price) as cheapest_in_category FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.id, p.name, p.price, SUM(p.price) OVER (ORDER BY p.price ROWS BETWEEN 4 PRECEDING AND CURRENT ROW) as five_product_price_sum FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.id, p.name, p.category, p.price, NTH_VALUE(p.price, 3) OVER (PARTITION BY p.category ORDER BY p.price DESC) as third_highest_in_category FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.id, p.name, p.quantity, p.price, p.quantity * p.price as stock_value, RANK() OVER (ORDER BY p.quantity * p.price DESC) as stock_value_rank FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, p.price, p.category, NTH_VALUE(p.price, 2) OVER (PARTITION BY p.category ORDER BY p.price) as second_cheapest_in_category FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.brand, p.price, FIRST_VALUE(p.name) OVER (PARTITION BY p.brand ORDER BY LENGTH(p.description) DESC) as longest_desc_in_brand FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT c.id, c.firstname, COUNT(DISTINCT p.category) as categories_purchased, RANK() OVER (ORDER BY COUNT(DISTINCT p.category) DESC) as categories_rank FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON ca.product_id = p.id GROUP BY c.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, p.price, p.category, LAST_VALUE(p.name) OVER (PARTITION BY p.category ORDER BY p.quantity ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as lowest_stock_in_category FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%"ram":"8gb"%' OR p.more_details LIKE '%"ram":"8GB"%' THEN '8GB' WHEN p.more_details LIKE '%"ram":"6gb"%' OR p.more_details LIKE '%"ram":"6GB"%' THEN '6GB' WHEN p.more_details LIKE '%"ram":"4gb"%' OR p.more_details LIKE '%"ram":"4GB"%' THEN '4GB' ELSE 'Unknown' END as extracted_ram FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%"screen":"6.1"%' OR p.more_details LIKE '%6.1"%' THEN '6.1"' WHEN p.more_details LIKE '%"screen":"6.7"%' OR p.more_details LIKE '%6.7"%' THEN '6.7"' WHEN p.more_details LIKE '%"screen":"5.8"%' OR p.more_details LIKE '%5.8"%' THEN '5.8"' ELSE 'Unknown' END as extracted_screen FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%"battery":"4000mah"%' OR p.more_details LIKE '%4000mAh%' THEN '4000mAh' WHEN p.more_details LIKE '%"battery":"5000mah"%' OR p.more_details LIKE '%5000mAh%' THEN '5000mAh' WHEN p.more_details LIKE '%"battery":"3000mah"%' OR p.more_details LIKE '%3000mAh%' THEN '3000mAh' ELSE 'Unknown' END as extracted_battery FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%"color":"black"%' OR LOWER(p.more_details) LIKE '%black%' THEN 'Black' WHEN p.more_details LIKE '%"color":"white"%' OR LOWER(p.more_details) LIKE '%white%' THEN 'White' WHEN p.more_details LIKE '%"color":"blue"%' OR LOWER(p.more_details) LIKE '%blue%' THEN 'Blue' ELSE 'Unknown' END as extracted_color FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%"storage":"128gb"%' OR p.more_details LIKE '%128GB%' THEN '128GB' WHEN p.more_details LIKE '%"storage":"256gb"%' OR p.more_details LIKE '%256GB%' THEN '256GB' WHEN p.more_details LIKE '%"storage":"512gb"%' OR p.more_details LIKE '%512GB%' THEN '512GB' ELSE 'Unknown' END as extracted_storage FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, LENGTH(p.more_details) - LENGTH(REPLACE(p.more_details, '"', '')) / 2 as estimated_json_pairs, (LENGTH(p.more_details) - LENGTH(REPLACE(LOWER(p.more_details), ':', ''))) as colon_count FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, REGEXP_REPLACE(p.more_details, '[^{}":,0-9a-zA-Z\\s]', ' ') as cleaned_json_like FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.id, p.name, CASE WHEN p.more_details LIKE '%wireless%' THEN JSON_OBJECT('feature', 'wireless', 'value', 'true') WHEN p.more_details LIKE '%bluetooth%' THEN JSON_OBJECT('feature', 'bluetooth', 'value', 'true') ELSE JSON_OBJECT('feature', 'unknown', 'value', 'false') END as feature_json FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.id, p.name, JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price, 'category', p.category, 'brand', p.brand) as product_object, JSON_LENGTH(JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price, 'category', p.category, 'brand', p.brand)) as object_length FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, p.category, p.brand, JSON_OBJECT('category', p.category, 'brand', p.brand) as classification, JSON_MERGE(JSON_OBJECT('category', p.category), JSON_OBJECT('brand', p.brand), JSON_OBJECT('price', p.price)) as product_classification FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.id, p.name, JSON_EXTRACT(CONCAT('{"name": "', p.name, '", "price": ', p.price, '}'), '$.name') as extracted_name, JSON_EXTRACT(CONCAT('{"name": "', p.name, '", "price": ', p.price, '}'), '$.price') as extracted_price FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.id, p.name, JSON_KEYS(JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price)) as json_keys, JSON_LENGTH(JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price)) as key_count FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT p.id, p.name, p.price, JSON_OBJECT('id', p.id, 'name', p.name) as product_info, JSON_REMOVE(JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price), '$.price') as without_price FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.id, p.name, p.category, JSON_OBJECT('id', p.id, 'name', p.name, 'category', p.category) as product_basic, JSON_REPLACE(JSON_OBJECT('id', p.id, 'name', p.name, 'category', p.category), '$.category', UPPER(p.category)) as with_upper_category FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, JSON_OBJECT('name', p.name, 'price', p.price) as price_info, JSON_SET(JSON_OBJECT('name', p.name, 'price', p.price), '$.currency', 'DZD') as with_currency FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.price, JSON_OBJECT('name', p.name, 'price', p.price) as product_json, JSON_TYPE(JSON_OBJECT('name', p.name, 'price', p.price)) as json_type FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.id, p.name, JSON_DEPTH(JSON_OBJECT('id', p.id, 'name', p.name)) as json_depth, JSON_DEPTH(JSON_OBJECT('product', JSON_OBJECT('id', p.id, 'name', p.name))) as nested_depth FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, JSON_LENGTH(JSON_ARRAY(p.id, p.name, p.price)) as array_length, JSON_LENGTH(JSON_OBJECT('id', p.id, 'name', p.name, 'price', p.price)) as object_length FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.id, p.name, JSON_ARRAY(p.id, p.name, p.price, p.category) as product_array, JSON_ARRAY_APPEND(JSON_ARRAY(p.id, p.name), '$', p.price) as with_price FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.id, p.name, JSON_ARRAY_INSERT(JSON_ARRAY(p.id, p.name, p.price), '$[1]', p.category) as with_category_inserted FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.id, p.name, JSON_EXTRACT(JSON_OBJECT('product', JSON_OBJECT('id', p.id, 'name', p.name)), '$.product.name') as nested_extract FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT STRAIGHT_JOIN p.*, c.* FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON ca.client_id = c.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.* FROM products p USE INDEX (PRIMARY) WHERE p.id > 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT STRAIGHT_JOIN o.*, p.name FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT /*+ MAX_EXECUTION_TIME(1800) */ * FROM products WHERE name LIKE '%Pro%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT /*+ MAX_EXECUTION_TIME(3800) */ p.*, AVG(r.rating) as avg_rating FROM products p LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT SQL_BUFFER_RESULT p.*, c.category_count FROM products p JOIN (SELECT category, COUNT(*) as category_count FROM products GROUP BY category) c ON p.category = c.category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT STRAIGHT_JOIN p.*, COUNT(ca.id) as cart_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id GROUP BY p.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.id, p.name, p.price, JSON_CONTAINS(JSON_ARRAY('smartphone', 'tablet', 'accessory'), JSON_QUOTE(p.category)) as category_in_list FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, p.price, JSON_OBJECT('id', p.id, 'details', JSON_OBJECT('name', p.name, 'price', p.price)) as nested_object FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, p.name, DES_DECRYPT(DES_ENCRYPT(p.name, 'key'), 'key') as name_des_decrypted FROM products p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.id, c.firstname, COUNT(o.id) as order_count, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE o.orderdate BETWEEN '2023-01-01' AND '2024-12-31' GROUP BY c.id, c.firstname HAVING total_spent > 5000 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT a.username as admin_name, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as offers_created FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id WHERE a.role LIKE '%Manager%' GROUP BY a.id, a.username, a.role ORDER BY products_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.category, p.brand, COUNT(DISTINCT r.id) as rating_count, AVG(r.rating) as avg_rating, COUNT(DISTINCT cm.id) as comment_count FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.price BETWEEN 100 AND 1000 GROUP BY p.category, p.brand HAVING rating_count > 10 ORDER BY avg_rating DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT DATE_FORMAT(pr.startdate, '%Y-%m') as promotion_month, COUNT(DISTINCT pr.id) as promotions_started, COUNT(DISTINCT p.id) as unique_products, AVG(pr.percentage) as avg_discount FROM promotions pr JOIN products p ON pr.product_id = p.id WHERE pr.startdate >= '2023-01-01' GROUP BY DATE_FORMAT(pr.startdate, '%Y-%m') ORDER BY promotion_month DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT a.role, COUNT(DISTINCT a.id) as admin_count, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT o.id) as orders_managed, COUNT(DISTINCT cl.id) as claims_handled FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id GROUP BY a.role ORDER BY admin_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT c.id, c.firstname, c.lastname, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) as total_orders, (SELECT SUM(price) FROM orders o WHERE o.client_id = c.id) as total_spent, (SELECT AVG(rating) FROM rating r WHERE r.client_id = c.id) as avg_rating_given FROM clients c WHERE (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) > 2 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.id, p.name, p.price, (SELECT price FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LIMIT 1) as promo_price, (SELECT percentage FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LIMIT 1) as discount_percentage, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id = p.id) as in_cart_count FROM products p WHERE p.quantity > 0 ORDER BY p.price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT a.id, a.username, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) as products_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) as promotions_created, (SELECT COUNT(*) FROM offers o WHERE o.admin_id = a.id) as offers_created, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id) as orders_processed FROM admin a WHERE a.role != '1' ORDER BY products_added + promotions_created DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, (SELECT COUNT(*) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as available_products, (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category) as avg_category_price, (SELECT COUNT(DISTINCT brand) FROM products p2 WHERE p2.category = p.category) as unique_brands FROM products p GROUP BY p.category HAVING available_products > 3 ORDER BY avg_category_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as month, (SELECT COUNT(DISTINCT client_id) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = month) as active_clients, (SELECT SUM(price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = month) as monthly_revenue, (SELECT AVG(price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = month) as avg_order_value FROM orders o GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') HAVING monthly_revenue > 10000 ORDER BY month DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.brand, (SELECT COUNT(*) FROM products p2 WHERE p2.brand = p.brand) as total_products, (SELECT SUM(quantity) FROM products p2 WHERE p2.brand = p.brand) as total_inventory, (SELECT AVG(price) FROM products p2 WHERE p2.brand = p.brand) as avg_brand_price FROM products p GROUP BY p.brand HAVING total_products > 2 ORDER BY total_inventory DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT c.wilaya, (SELECT name FROM wilayas w WHERE w.id = c.wilaya) as wilaya_name, (SELECT COUNT(*) FROM clients c2 WHERE c2.wilaya = c.wilaya) as clients_in_wilaya, (SELECT AVG(DATEDIFF(CURDATE(), birthday)/365) FROM clients c2 WHERE c2.wilaya = c.wilaya) as avg_client_age FROM clients c GROUP BY c.wilaya HAVING clients_in_wilaya > 10 ORDER BY clients_in_wilaya DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT YEAR(c.birthday) as birth_year, (SELECT COUNT(*) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as born_in_year, (SELECT COUNT(DISTINCT wilaya) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as wilayas_covered, (SELECT AVG((SELECT COUNT(*) FROM orders o WHERE o.client_id = c2.id)) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as avg_orders_per_client FROM clients c WHERE c.birthday IS NOT NULL GROUP BY YEAR(c.birthday) HAVING born_in_year > 5 ORDER BY birth_year DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT 'High Value' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) > 5000 UNION ALL SELECT 'Medium Value' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) BETWEEN 1000 AND 5000 UNION ALL SELECT 'Low Value' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) < 1000 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, 'Product' as item_type, p.price as original_price, NULL as discount_price, NULL as discount_percentage FROM products p WHERE p.id NOT IN (SELECT product_id FROM promotions WHERE CURDATE() BETWEEN startdate AND enddate) UNION ALL SELECT p.id, p.name, 'Discounted Product' as item_type, p.price as original_price, pr.price as discount_price, pr.percentage as discount_percentage FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY original_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.category, p.brand, p.name, p.price, RANK() OVER (PARTITION BY p.category ORDER BY p.price DESC) as price_rank_in_category, AVG(p.price) OVER (PARTITION BY p.category) as avg_category_price, COUNT(*) OVER (PARTITION BY p.category) as products_in_category FROM products p WHERE p.quantity > 0 ORDER BY p.category, price_rank_in_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.brand, p.name, p.price, NTILE(4) OVER (ORDER BY p.price) as price_quartile, LAG(p.price, 1) OVER (ORDER BY p.price) as previous_product_price, LEAD(p.price, 1) OVER (ORDER BY p.price) as next_product_price, p.price - LAG(p.price, 1) OVER (ORDER BY p.price) as price_difference FROM products p ORDER BY p.price;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.category FROM products p WHERE p.name LIKE '%pro%' OR p.name LIKE '%max%' OR p.name LIKE '%plus%' OR p.name LIKE '%premium%' ORDER BY p.category, p.name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.price, p.price * 0.2 as tax_amount, p.price * 1.2 as price_with_tax, ROUND(p.price * 0.15, 2) as estimated_profit, p.price / (SELECT AVG(price) FROM products) as price_vs_avg_ratio FROM products p WHERE p.price > (SELECT AVG(price) FROM products) ORDER BY price_vs_avg_ratio DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.price, pr.percentage, p.price * (1 - pr.percentage/100) as discounted_price_calc, pr.price as actual_discounted_price, ABS(p.price * (1 - pr.percentage/100) - pr.price) as price_difference FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY price_difference DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products p WHERE p.price BETWEEN 100 AND 500 AND p.category = 'Electronics' AND p.quantity > 0 AND p.id IN (SELECT product_id FROM cart WHERE date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) ORDER BY p.price, p.name LIMIT 100 OFFSET 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.category, GROUP_CONCAT(DISTINCT p.brand ORDER BY p.brand SEPARATOR ', ') as brands_in_category, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity) as total_inventory_value FROM products p GROUP BY p.category HAVING COUNT(DISTINCT p.brand) > 2 ORDER BY product_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT a.role, a.username, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as offers_created, COUNT(DISTINCT ord.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_handled, COUNT(DISTINCT rt.id) as returns_handled FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id LEFT JOIN orders ord ON a.id = ord.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns rt ON a.id = rt.admin_id GROUP BY a.role, a.username ORDER BY a.role, products_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, p.price, pr.percentage as current_discount, pr.startdate as discount_start, pr.enddate as discount_end, DATEDIFF(pr.enddate, CURDATE()) as days_remaining FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 AND (pr.percentage IS NULL OR pr.percentage < 30) ORDER BY p.price DESC, days_remaining ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.id, p.name, p.quantity as current_stock, COUNT(ca.id) as in_carts, COUNT(o.id) as in_orders_last_30_days, p.quantity - COUNT(o.id) as projected_stock, CASE WHEN p.quantity < 10 THEN 'Low Stock' WHEN p.quantity BETWEEN 10 AND 50 THEN 'Medium Stock' ELSE 'Good Stock' END as stock_status FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) WHERE p.quantity > 0 GROUP BY p.id, p.name, p.quantity HAVING in_orders_last_30_days > 0 ORDER BY projected_stock ASC, in_orders_last_30_days DESC;                                                                                                                                                                                                                                                                                                               
 SELECT MONTH(o.orderdate) as month, YEAR(o.orderdate) as year, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_clients FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 2 YEAR) GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), p.category ORDER BY year DESC, month DESC, total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, p.price as current_price, pr.price as promotion_price, pr.percentage as discount_percentage, AVG(p2.price) OVER (PARTITION BY p.category) as avg_category_price, p.price - AVG(p2.price) OVER (PARTITION BY p.category) as price_difference_from_category_avg, CASE WHEN pr.price IS NOT NULL THEN 'On Promotion' WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.2 THEN 'Overpriced' WHEN p.price < AVG(p2.price) OVER (PARTITION BY p.category) * 0.8 THEN 'Underpriced' ELSE 'Competitively Priced' END as pricing_status FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN products p2 ON p.category = p2.category WHERE p.quantity > 0 GROUP BY p.id, p.name, p.price, pr.price, pr.percentage, p.category ORDER BY price_difference_from_category_avg DESC;                                                                                                                                                                                 
 SELECT p.id, p.name, p.category, COALESCE(AVG(r.rating), 0) as avg_rating, COUNT(DISTINCT r.id) as total_ratings, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) as positive_ratings, COUNT(DISTINCT CASE WHEN r.rating <= 2 THEN r.id END) as negative_ratings, COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) * 100.0 / NULLIF(COUNT(DISTINCT r.id), 0) as satisfaction_rate FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING total_ratings > 10 ORDER BY satisfaction_rate DESC, avg_rating DESC;                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.quantity as current_stock, AVG(daily_sales.daily_quantity) as avg_daily_sales, p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) as days_until_stockout, CASE WHEN p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) <= 7 THEN 'Critical' WHEN p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) <= 14 THEN 'Warning' ELSE 'Safe' END as stockout_risk FROM products p LEFT JOIN ( SELECT ca.product_id, DATE(o.orderdate) as sale_date, COUNT(*) as daily_quantity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND o.status = 'delivered' GROUP BY ca.product_id, DATE(o.orderdate) ) daily_sales ON p.id = daily_sales.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_until_stockout ASC;                                                                                                                                                                                   
 SELECT p.category, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity * p.price) as inventory_value, SUM(o.price) as revenue_last_30_days, COUNT(DISTINCT o.id) as orders_last_30_days, SUM(o.price) / NULLIF(COUNT(DISTINCT p.id), 0) as revenue_per_product, SUM(o.price) * 0.3 as estimated_profit, SUM(o.price) * 0.3 / NULLIF(SUM(p.quantity * p.price), 0) * 100 as roi_percentage FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND o.status = 'delivered' WHERE p.quantity > 0 GROUP BY p.category HAVING revenue_last_30_days > 0 ORDER BY roi_percentage DESC;                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.category, AVG(LENGTH(p.description)) as avg_description_length, AVG(LENGTH(p.more_details)) as avg_details_length, COUNT(DISTINCT p.images) as unique_images_count, COUNT(DISTINCT p.image_display) as unique_display_images, COUNT(DISTINCT CASE WHEN p.description LIKE '%premium%' THEN p.id END) as premium_mentions, COUNT(DISTINCT CASE WHEN p.description LIKE '%new%' THEN p.id END) as new_mentions FROM products p GROUP BY p.category ORDER BY avg_description_length DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT w.id, w.name, w.delivery_price, COUNT(DISTINCT c.id) as client_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, GROUP_CONCAT(DISTINCT p.category ORDER BY p.category SEPARATOR ', ') as popular_categories FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' GROUP BY w.id, w.name, w.delivery_price HAVING order_count > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_tried, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cm.id) as comments_count, COUNT(DISTINCT r.id) as ratings_count, (COUNT(DISTINCT o.id) * 0.2 + COUNT(DISTINCT p.category) * 0.2 + COUNT(DISTINCT f.id) * 0.2 + COUNT(DISTINCT cm.id) * 0.2 + COUNT(DISTINCT r.id) * 0.2) as loyalty_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname HAVING total_orders > 1 ORDER BY loyalty_score DESC;                                                                                                        
 SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products_added, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT ofr.id) as offers_created, SUM(o.price) as revenue_influenced, COUNT(DISTINCT o.id) as orders_influenced, SUM(o.price) / NULLIF(COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id), 0) as roi_per_action FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id WHERE a.role LIKE '%Manager%' GROUP BY a.id, a.username, a.role HAVING revenue_influenced > 0 ORDER BY roi_per_action DESC;                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%excellent%' OR LOWER(cm.comment) LIKE '%great%' OR LOWER(cm.comment) LIKE '%awesome%' OR LOWER(cm.comment) LIKE '%love%' THEN cm.id END) as positive_comments, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%bad%' OR LOWER(cm.comment) LIKE '%poor%' OR LOWER(cm.comment) LIKE '%terrible%' OR LOWER(cm.comment) LIKE '%disappoint%' THEN cm.id END) as negative_comments, (COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%excellent%' OR LOWER(cm.comment) LIKE '%great%' OR LOWER(cm.comment) LIKE '%awesome%' OR LOWER(cm.comment) LIKE '%love%' THEN cm.id END) - COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%bad%' OR LOWER(cm.comment) LIKE '%poor%' OR LOWER(cm.comment) LIKE '%terrible%' OR LOWER(cm.comment) LIKE '%disappoint%' THEN cm.id END)) * 100.0 / NULLIF(COUNT(DISTINCT cm.id), 0) as sentiment_score FROM products p LEFT JOIN comments cm ON p.id = cm.product_id GROUP BY p.id, p.name HAVING total_comments > 5 ORDER BY sentiment_score DESC; 
 SELECT p.category, COUNT(DISTINCT p.id) as total_products, COUNT(DISTINCT p.brand) as brands_count, SUM(p.quantity) as total_inventory, SUM(p.quantity * p.price) as inventory_value, AVG(p.price) as avg_price, MIN(p.price) as min_price, MAX(p.price) as max_price, COUNT(DISTINCT CASE WHEN p.quantity = 0 THEN p.id END) as out_of_stock_count, COUNT(DISTINCT CASE WHEN p.quantity < 10 THEN p.id END) as low_stock_count, COUNT(DISTINCT CASE WHEN p.quantity > 100 THEN p.id END) as high_stock_count FROM products p GROUP BY p.category ORDER BY inventory_value DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cm.id) as comments_count, COALESCE(AVG(r.rating), 0) as avg_rating_given, (LOG10(SUM(o.price) + 1) * 0.25 + (1 - (DATEDIFF(CURDATE(), MAX(o.orderdate)) / 365)) * 0.25 + (COUNT(DISTINCT p.category) / 10.0) * 0.2 + (COUNT(DISTINCT f.id) / 10.0) * 0.15 + (COALESCE(AVG(r.rating), 0) / 5.0) * 0.15) as marketing_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING order_count > 0 ORDER BY marketing_score DESC;          
 SELECT pr.id, p.name, pr.percentage, pr.price as promo_price, p.price as original_price, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) as duration_days, COUNT(DISTINCT ca.id) as times_added_to_cart, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT o.id) * (p.price - pr.price) as revenue_loss, COUNT(DISTINCT o.id) * pr.price as revenue_gained, (COUNT(DISTINCT o.id) * pr.price) - (COUNT(DISTINCT o.id) * (p.price - pr.price)) as net_effect FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY pr.id, p.name, pr.percentage, pr.price, p.price, pr.startdate, pr.enddate HAVING times_ordered > 0 ORDER BY net_effect DESC;                                                                                                                                                                                                                           
 SELECT p1.category as category1, p2.category as category2, COUNT(DISTINCT ca1.client_id) as customers_both_categories, COUNT(DISTINCT CASE WHEN ca1.product_id = p1.id THEN ca1.client_id END) as customers_category1, COUNT(DISTINCT CASE WHEN ca2.product_id = p2.id THEN ca2.client_id END) as customers_category2, COUNT(DISTINCT ca1.client_id) * 100.0 / NULLIF(COUNT(DISTINCT CASE WHEN ca1.product_id = p1.id THEN ca1.client_id END), 0) as cross_sell_rate FROM products p1 JOIN products p2 ON p1.category < p2.category LEFT JOIN cart ca1 ON p1.id = ca1.product_id LEFT JOIN cart ca2 ON p2.id = ca2.product_id AND ca1.client_id = ca2.client_id GROUP BY p1.category, p2.category HAVING customers_both_categories > 10 ORDER BY cross_sell_rate DESC;                                                                                                                                                                                                                                                                                           
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, AVG(DATEDIFF(o2.orderdate, o1.orderdate)) as avg_days_between_orders, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT f.id) as favorites_count, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'Churned' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 30 THEN 'At Risk' ELSE 'Active' END as churn_status, (DATEDIFF(CURDATE(), MAX(o.orderdate)) / 90.0 * 0.4 + (1 - (COUNT(DISTINCT o.id) / 10.0)) * 0.3 + (1 - (COUNT(DISTINCT p.category) / 5.0)) * 0.2 + (1 - (COUNT(DISTINCT f.id) / 5.0)) * 0.1) as churn_probability FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN orders o1 ON c.id = o1.client_id LEFT JOIN orders o2 ON c.id = o2.client_id AND o2.orderdate > o1.orderdate LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING total_orders > 1 ORDER BY churn_probability DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.quantity as current_stock, AVG(daily_sales.sales_quantity) as avg_daily_sales, STDDEV(daily_sales.sales_quantity) as sales_volatility, p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) as days_of_inventory, CASE WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) < 7 THEN 'Reorder Now' WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) < 14 THEN 'Monitor Closely' WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) > 60 THEN 'Excess Stock' ELSE 'Healthy' END as inventory_status, GREATEST(CEILING(AVG(daily_sales.sales_quantity) * 30 - p.quantity), 0) as suggested_reorder_quantity FROM products p LEFT JOIN ( SELECT ca.product_id, DATE(o.orderdate) as sale_date, COUNT(*) as sales_quantity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.status = 'delivered' GROUP BY ca.product_id, DATE(o.orderdate) ) daily_sales ON p.id = daily_sales.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_of_inventory ASC; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as month, w.name as delivery_region, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(w.delivery_price) as avg_delivery_cost, SUM(o.price) / COUNT(DISTINCT o.client_id) as revenue_per_customer, COUNT(DISTINCT p.category) as categories_ordered FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON c.wilaya = w.id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), w.name ORDER BY month DESC, total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.id, p.name, p.category, p.price * p.quantity as inventory_investment, SUM(o.price) as revenue_generated, COUNT(DISTINCT o.id) as times_ordered, SUM(o.price) - (p.price * p.quantity) as gross_profit, (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 as roi_percentage, CASE WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 100 THEN 'Excellent' WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 50 THEN 'Good' WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 0 THEN 'Break-even' ELSE 'Loss' END as performance_category FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' GROUP BY p.id, p.name, p.category, p.price, p.quantity HAVING times_ordered > 0 ORDER BY roi_percentage DESC;                                                                                                          
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as order_frequency, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as category_variety, COUNT(DISTINCT f.id) as favorites_activity, COUNT(DISTINCT cm.id) as engagement_comments, COUNT(DISTINCT r.id) as engagement_ratings, CASE WHEN COUNT(DISTINCT o.id) > 10 AND AVG(o.price) > 500 THEN 'VIP Shoppers' WHEN COUNT(DISTINCT p.category) > 5 THEN 'Variety Seekers' WHEN COUNT(DISTINCT f.id) > 10 THEN 'Collectors' WHEN COUNT(DISTINCT cm.id) > 5 OR COUNT(DISTINCT r.id) > 10 THEN 'Engaged Reviewers' WHEN COUNT(DISTINCT o.id) = 1 THEN 'One-time Buyers' ELSE 'Regular Shoppers' END as behavioral_segment FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname HAVING order_frequency > 0 ORDER BY order_frequency DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price as current_price, AVG(p2.price) OVER (PARTITION BY p.category) as category_avg_price, AVG(p3.price) OVER (PARTITION BY p.brand) as brand_avg_price, COUNT(DISTINCT ca.id) as cart_additions_last_week, COUNT(DISTINCT o.id) as purchases_last_month, COALESCE(AVG(r.rating), 0) as avg_rating, CASE WHEN COUNT(DISTINCT ca.id) = 0 AND COUNT(DISTINCT o.id) = 0 THEN 'Consider Price Reduction' WHEN COUNT(DISTINCT ca.id) > 10 AND COUNT(DISTINCT o.id) < 5 THEN 'Consider Bundle Offer' WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.3 THEN 'Price Higher Than Category Average' WHEN p.price < AVG(p2.price) OVER (PARTITION BY p.category) * 0.7 THEN 'Price Lower Than Category Average' ELSE 'Price Optimized' END as pricing_recommendation, CASE WHEN COUNT(DISTINCT ca.id) = 0 AND COUNT(DISTINCT o.id) = 0 THEN p.price * 0.9 WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.3 THEN AVG(p2.price) OVER (PARTITION BY p.category) * 1.1 ELSE p.price END as suggested_price FROM products p LEFT JOIN products p2 ON p.category = p2.category LEFT JOIN products p3 ON p.brand = p3.brand LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price ORDER BY purchases_last_month DESC; 
 SELECT p.category, MONTH(o.orderdate) as order_month, YEAR(o.orderdate) as order_year, COUNT(DISTINCT o.id) as monthly_orders, SUM(o.price) as monthly_revenue, AVG(o.price) as avg_order_value, LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as orders_same_month_last_year, LAG(SUM(o.price), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as revenue_same_month_last_year, COUNT(DISTINCT o.id) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 0) as order_growth_yoy, SUM(o.price) * 100.0 / NULLIF(LAG(SUM(o.price), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 0) as revenue_growth_yoy FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 24 MONTH) AND o.status = 'delivered' GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING monthly_orders > 0 ORDER BY p.category, order_year DESC, order_month DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price as selling_price, p.price * 0.6 as estimated_cost, p.price * 0.4 as estimated_profit, p.quantity as current_inventory, p.price * p.quantity as inventory_value, COUNT(DISTINCT ca.id) as in_carts, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT f.id) as in_favorites, COALESCE(AVG(r.rating), 0) as customer_rating, (COUNT(DISTINCT o.id) * p.price * 0.4) - (p.price * p.quantity * 0.1) as net_profit_estimate, (COUNT(DISTINCT o.id) * p.price * 0.4) * 100.0 / NULLIF(p.price * p.quantity * 0.1, 0) as roi_percentage FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING times_ordered > 0 ORDER BY net_profit_estimate DESC;                                                          
 SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT ofr.id) as offers_created, COUNT(DISTINCT o.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_resolved, COUNT(DISTINCT rt.id) as returns_processed, COUNT(DISTINCT i.id) as messages_sent, (COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id) + COUNT(DISTINCT o.id) + COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) + COUNT(DISTINCT i.id)) as total_actions, SUM(o.price) as revenue_influenced, SUM(o.price) / NULLIF((COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id) + COUNT(DISTINCT o.id) + COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) + COUNT(DISTINCT i.id)), 0) as revenue_per_action FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns rt ON a.id = rt.admin_id LEFT JOIN inbox i ON a.id = i.admin_id GROUP BY a.id, a.username, a.role ORDER BY total_actions DESC; 
 SELECT c.id as client_id, c.firstname, c.lastname, p.id as product_id, p.name as product_name, COUNT(DISTINCT o.id) as times_purchased, MAX(o.orderdate) as last_purchase_date, AVG(r.rating) as avg_rating_by_client, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_purchase, CASE WHEN COUNT(DISTINCT o.id) >= 3 THEN 'Frequent Buyer' WHEN COUNT(DISTINCT o.id) = 2 THEN 'Repeat Buyer' ELSE 'One-time Buyer' END as purchase_frequency FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id AND p.id = r.product_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, p.id, p.name HAVING times_purchased > 0 ORDER BY times_purchased DESC, days_since_last_purchase;                                                                                                                                                                                                                        
 SELECT p.category, p.brand, AVG(p.price) as avg_price, STDDEV(p.price) as price_volatility, MIN(p.price) as min_price, MAX(p.price) as max_price, (MAX(p.price) - MIN(p.price)) / AVG(p.price) * 100 as price_range_percentage, COUNT(DISTINCT pr.id) as active_promotions, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT CASE WHEN pr.percentage > 30 THEN pr.id END) as deep_discounts_count FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 GROUP BY p.category, p.brand HAVING COUNT(DISTINCT p.id) > 2 ORDER BY price_volatility DESC;                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, c.lastname, p1.category as first_category, p2.category as second_category, COUNT(DISTINCT o1.id) as orders_first_category, COUNT(DISTINCT o2.id) as orders_second_category, AVG(o1.price) as avg_spent_first_category, AVG(o2.price) as avg_spent_second_category, DATEDIFF(MIN(o2.orderdate), MAX(o1.orderdate)) as days_between_categories, CASE WHEN AVG(o2.price) > AVG(o1.price) * 1.5 THEN 'Upgrade' WHEN AVG(o2.price) < AVG(o1.price) * 0.5 THEN 'Downgrade' ELSE 'Lateral Move' END as migration_type FROM clients c JOIN orders o1 ON c.id = o1.client_id JOIN cart ca1 ON FIND_IN_SET(ca1.id, o1.cart_id) > 0 JOIN products p1 ON ca1.product_id = p1.id JOIN orders o2 ON c.id = o2.client_id AND o2.orderdate > o1.orderdate JOIN cart ca2 ON FIND_IN_SET(ca2.id, o2.cart_id) > 0 JOIN products p2 ON ca2.product_id = p2.id WHERE o1.status = 'delivered' AND o2.status = 'delivered' AND p1.category != p2.category AND o2.orderdate = ( SELECT MIN(o3.orderdate) FROM orders o3 JOIN cart ca3 ON FIND_IN_SET(ca3.id, o3.cart_id) > 0 JOIN products p3 ON ca3.product_id = p3.id WHERE o3.client_id = c.id AND o3.orderdate > o1.orderdate AND p3.category != p1.category ) GROUP BY c.id, c.firstname, c.lastname, p1.category, p2.category HAVING orders_first_category > 0 AND orders_second_category > 0 ORDER BY days_between_categories; 
 SELECT o.id as order_id, o.orderdate, o.price as order_total, COUNT(DISTINCT ca.product_id) as unique_products, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT p.brand) as unique_brands, AVG(p.price) as avg_product_price, MAX(p.price) as max_product_price, MIN(p.price) as min_product_price, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as discounted_items_count, (COUNT(DISTINCT ca.product_id) * 0.3 + COUNT(DISTINCT p.category) * 0.3 + COUNT(DISTINCT p.brand) * 0.2 + (MAX(p.price) - MIN(p.price)) / NULLIF(AVG(p.price), 0) * 0.2) as order_complexity_score FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE o.status = 'delivered' GROUP BY o.id, o.orderdate, o.price HAVING unique_products > 1 ORDER BY order_complexity_score DESC;                                                                                                                                                                
 SELECT w.id, w.name as wilaya_name, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, COUNT(DISTINCT p.category) as categories_available, COUNT(DISTINCT p.brand) as brands_available, COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) as market_share_percentage, COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT c.id), 0) as penetration_rate, CASE WHEN COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) > 10 THEN 'High Saturation' WHEN COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) > 5 THEN 'Medium Saturation' ELSE 'Low Saturation' END as saturation_level FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id GROUP BY w.id, w.name ORDER BY market_share_percentage DESC;                                                                                                                                                
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as online_orders, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as high_value_orders, COUNT(DISTINCT ca.id) as cart_activities, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT cm.id) as comments_posted, COUNT(DISTINCT r.id) as ratings_given, COUNT(DISTINCT cl.id) as claims_filed, (COUNT(DISTINCT o.id) * 0.25 + COUNT(DISTINCT ca.id) * 0.15 + COUNT(DISTINCT f.id) * 0.15 + COUNT(DISTINCT cm.id) * 0.15 + COUNT(DISTINCT r.id) * 0.15 + COUNT(DISTINCT cl.id) * 0.15) as multi_channel_engagement_score, CASE WHEN COUNT(DISTINCT o.id) > 0 AND COUNT(DISTINCT ca.id) > 0 AND COUNT(DISTINCT f.id) > 0 THEN 'Full Engagement' WHEN COUNT(DISTINCT o.id) > 0 AND COUNT(DISTINCT ca.id) > 0 THEN 'High Engagement' WHEN COUNT(DISTINCT o.id) > 0 THEN 'Moderate Engagement' ELSE 'Low Engagement' END as engagement_level FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id GROUP BY c.id, c.firstname, c.lastname ORDER BY multi_channel_engagement_score DESC; 
 SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, CASE WHEN p.more_details LIKE \'%\"screen\":\"6.1\"%\' OR p.more_details LIKE \'%6.1\"%\' THEN \'6.1\"\' WHEN p.more_details LIKE \'%\"screen\":\"6.7\"%\' OR p.more_details LIKE \'%6.7\"%\' THEN \'6.7\"\' WHEN p.more_details LIKE \'%\"screen\":\"5.8\"%\' OR p.more_details LIKE \'%5.8\"%\' THEN \'5.8\"\' ELSE \'Unknown\' END as extracted_screen FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, CASE WHEN p.more_details LIKE \'%\"battery\":\"4000mah\"%\' OR p.more_details LIKE \'%4000mAh%\' THEN \'4000mAh\' WHEN p.more_details LIKE \'%\"battery\":\"5000mah\"%\' OR p.more_details LIKE \'%5000mAh%\' THEN \'5000mAh\' WHEN p.more_details LIKE \'%\"battery\":\"3000mah\"%\' OR p.more_details LIKE \'%3000mAh%\' THEN \'3000mAh\' ELSE \'Unknown\' END as extracted_battery FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, CASE WHEN p.more_details LIKE \'%\"color\":\"black\"%\' OR LOWER(p.more_details) LIKE \'%black%\' THEN \'Black\' WHEN p.more_details LIKE \'%\"color\":\"white\"%\' OR LOWER(p.more_details) LIKE \'%white%\' THEN \'White\' WHEN p.more_details LIKE \'%\"color\":\"blue\"%\' OR LOWER(p.more_details) LIKE \'%blue%\' THEN \'Blue\' ELSE \'Unknown\' END as extracted_color FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, CASE WHEN p.more_details LIKE \'%\"storage\":\"128gb\"%\' OR p.more_details LIKE \'%128GB%\' THEN \'128GB\' WHEN p.more_details LIKE \'%\"storage\":\"256gb\"%\' OR p.more_details LIKE \'%256GB%\' THEN \'256GB\' WHEN p.more_details LIKE \'%\"storage\":\"512gb\"%\' OR p.more_details LIKE \'%512GB%\' THEN \'512GB\' ELSE \'Unknown\' END as extracted_storage FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, LENGTH(p.more_details) - LENGTH(REPLACE(p.more_details, \'\"\', \'\')) / 2 as estimated_json_pairs, (LENGTH(p.more_details) - LENGTH(REPLACE(LOWER(p.more_details), \':\', \'\'))) as colon_count FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, REGEXP_REPLACE(p.more_details, \'[^{}\":,0-9a-zA-Z\\\\s]\', \' \') as cleaned_json_like FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, CASE WHEN p.more_details LIKE \'%wireless%\' THEN JSON_OBJECT(\'feature\', \'wireless\', \'value\', \'true\') WHEN p.more_details LIKE \'%bluetooth%\' THEN JSON_OBJECT(\'feature\', \'bluetooth\', \'value\', \'true\') ELSE JSON_OBJECT(\'feature\', \'unknown\', \'value\', \'false\') END as feature_json FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price, \'category\', p.category, \'brand\', p.brand) as product_object, JSON_LENGTH(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price, \'category\', p.category, \'brand\', p.brand)) as object_length FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, p.brand, JSON_OBJECT(\'category\', p.category, \'brand\', p.brand) as classification, JSON_MERGE(JSON_OBJECT(\'category\', p.category), JSON_OBJECT(\'brand\', p.brand), JSON_OBJECT(\'price\', p.price)) as product_classification FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_EXTRACT(CONCAT(\'{\"name\": \"\', p.name, \'\", \"price\": \', p.price, \'}\'), \'$.name\') as extracted_name, JSON_EXTRACT(CONCAT(\'{\"name\": \"\', p.name, \'\", \"price\": \', p.price, \'}\'), \'$.price\') as extracted_price FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_KEYS(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price)) as json_keys, JSON_LENGTH(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price)) as key_count FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, JSON_OBJECT(\'id\', p.id, \'name\', p.name) as product_info, JSON_REMOVE(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price), \'$.price\') as without_price FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'category\', p.category) as product_basic, JSON_REPLACE(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'category\', p.category), \'$.category\', UPPER(p.category)) as with_upper_category FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_OBJECT(\'name\', p.name, \'price\', p.price) as price_info, JSON_SET(JSON_OBJECT(\'name\', p.name, \'price\', p.price), \'$.currency\', \'DZD\') as with_currency FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, JSON_OBJECT(\'name\', p.name, \'price\', p.price) as product_json, JSON_TYPE(JSON_OBJECT(\'name\', p.name, \'price\', p.price)) as json_type FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_DEPTH(JSON_OBJECT(\'id\', p.id, \'name\', p.name)) as json_depth, JSON_DEPTH(JSON_OBJECT(\'product\', JSON_OBJECT(\'id\', p.id, \'name\', p.name))) as nested_depth FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_LENGTH(JSON_ARRAY(p.id, p.name, p.price)) as array_length, JSON_LENGTH(JSON_OBJECT(\'id\', p.id, \'name\', p.name, \'price\', p.price)) as object_length FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_ARRAY(p.id, p.name, p.price, p.category) as product_array, JSON_ARRAY_APPEND(JSON_ARRAY(p.id, p.name), \'$\', p.price) as with_price FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_ARRAY_INSERT(JSON_ARRAY(p.id, p.name, p.price), \'$[1]\', p.category) as with_category_inserted FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, JSON_EXTRACT(JSON_OBJECT(\'product\', JSON_OBJECT(\'id\', p.id, \'name\', p.name)), \'$.product.name\') as nested_extract FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT STRAIGHT_JOIN p.*, c.* FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON ca.client_id = c.id;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.* FROM products p USE INDEX (PRIMARY) WHERE p.id > 10;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT STRAIGHT_JOIN o.*, p.name FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON ca.product_id = p.id;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT /*+ MAX_EXECUTION_TIME(1800) */ * FROM products WHERE name LIKE \'%Pro%\';' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT /*+ MAX_EXECUTION_TIME(3800) */ p.*, AVG(r.rating) as avg_rating FROM products p LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.id;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT SQL_BUFFER_RESULT p.*, c.category_count FROM products p JOIN (SELECT category, COUNT(*) as category_count FROM products GROUP BY category) c ON p.category = c.category;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT STRAIGHT_JOIN p.*, COUNT(ca.id) as cart_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id GROUP BY p.id;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, JSON_CONTAINS(JSON_ARRAY(\'smartphone\', \'tablet\', \'accessory\'), JSON_QUOTE(p.category)) as category_in_list FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, JSON_OBJECT(\'id\', p.id, \'details\', JSON_OBJECT(\'name\', p.name, \'price\', p.price)) as nested_object FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, DES_DECRYPT(DES_ENCRYPT(p.name, \'key\'), \'key\') as name_des_decrypted FROM products p;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, COUNT(o.id) as order_count, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON o.cart_id LIKE CONCAT(\'%\', ca.id, \'%\') WHERE o.orderdate BETWEEN \'2023-01-01\' AND \'2024-12-31\' GROUP BY c.id, c.firstname HAVING total_spent > 5000 ORDER BY total_spent DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.username as admin_name, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as offers_created FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id WHERE a.role LIKE \'%Manager%\' GROUP BY a.id, a.username, a.role ORDER BY products_managed DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, p.brand, COUNT(DISTINCT r.id) as rating_count, AVG(r.rating) as avg_rating, COUNT(DISTINCT cm.id) as comment_count FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.price BETWEEN 100 AND 1000 GROUP BY p.category, p.brand HAVING rating_count > 10 ORDER BY avg_rating DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT DATE_FORMAT(pr.startdate, \'%Y-%m\') as promotion_month, COUNT(DISTINCT pr.id) as promotions_started, COUNT(DISTINCT p.id) as unique_products, AVG(pr.percentage) as avg_discount FROM promotions pr JOIN products p ON pr.product_id = p.id WHERE pr.startdate >= \'2023-01-01\' GROUP BY DATE_FORMAT(pr.startdate, \'%Y-%m\') ORDER BY promotion_month DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.role, COUNT(DISTINCT a.id) as admin_count, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT o.id) as orders_managed, COUNT(DISTINCT cl.id) as claims_handled FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id GROUP BY a.role ORDER BY admin_count DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) as total_orders, (SELECT SUM(price) FROM orders o WHERE o.client_id = c.id) as total_spent, (SELECT AVG(rating) FROM rating r WHERE r.client_id = c.id) as avg_rating_given FROM clients c WHERE (SELECT COUNT(*) FROM orders o WHERE o.client_id = c.id) > 2 ORDER BY total_spent DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, (SELECT price FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LIMIT 1) as promo_price, (SELECT percentage FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LIMIT 1) as discount_percentage, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id = p.id) as in_cart_count FROM products p WHERE p.quantity > 0 ORDER BY p.price DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.id, a.username, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) as products_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) as promotions_created, (SELECT COUNT(*) FROM offers o WHERE o.admin_id = a.id) as offers_created, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id) as orders_processed FROM admin a WHERE a.role != \'1\' ORDER BY products_added + promotions_created DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, (SELECT COUNT(*) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as available_products, (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category) as avg_category_price, (SELECT COUNT(DISTINCT brand) FROM products p2 WHERE p2.category = p.category) as unique_brands FROM products p GROUP BY p.category HAVING available_products > 3 ORDER BY avg_category_price DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT DATE_FORMAT(o.orderdate, \'%Y-%m\') as month, (SELECT COUNT(DISTINCT client_id) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, \'%Y-%m\') = month) as active_clients, (SELECT SUM(price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, \'%Y-%m\') = month) as monthly_revenue, (SELECT AVG(price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, \'%Y-%m\') = month) as avg_order_value FROM orders o GROUP BY DATE_FORMAT(o.orderdate, \'%Y-%m\') HAVING monthly_revenue > 10000 ORDER BY month DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.brand, (SELECT COUNT(*) FROM products p2 WHERE p2.brand = p.brand) as total_products, (SELECT SUM(quantity) FROM products p2 WHERE p2.brand = p.brand) as total_inventory, (SELECT AVG(price) FROM products p2 WHERE p2.brand = p.brand) as avg_brand_price FROM products p GROUP BY p.brand HAVING total_products > 2 ORDER BY total_inventory DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.wilaya, (SELECT name FROM wilayas w WHERE w.id = c.wilaya) as wilaya_name, (SELECT COUNT(*) FROM clients c2 WHERE c2.wilaya = c.wilaya) as clients_in_wilaya, (SELECT AVG(DATEDIFF(CURDATE(), birthday)/365) FROM clients c2 WHERE c2.wilaya = c.wilaya) as avg_client_age FROM clients c GROUP BY c.wilaya HAVING clients_in_wilaya > 10 ORDER BY clients_in_wilaya DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT YEAR(c.birthday) as birth_year, (SELECT COUNT(*) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as born_in_year, (SELECT COUNT(DISTINCT wilaya) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as wilayas_covered, (SELECT AVG((SELECT COUNT(*) FROM orders o WHERE o.client_id = c2.id)) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as avg_orders_per_client FROM clients c WHERE c.birthday IS NOT NULL GROUP BY YEAR(c.birthday) HAVING born_in_year > 5 ORDER BY birth_year DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT \'High Value\' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) > 5000 UNION ALL SELECT \'Medium Value\' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) BETWEEN 1000 AND 5000 UNION ALL SELECT \'Low Value\' as client_category, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname HAVING SUM(o.price) < 1000 ORDER BY total_spent DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, \'Product\' as item_type, p.price as original_price, NULL as discount_price, NULL as discount_percentage FROM products p WHERE p.id NOT IN (SELECT product_id FROM promotions WHERE CURDATE() BETWEEN startdate AND enddate) UNION ALL SELECT p.id, p.name, \'Discounted Product\' as item_type, p.price as original_price, pr.price as discount_price, pr.percentage as discount_percentage FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY original_price DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, p.brand, p.name, p.price, RANK() OVER (PARTITION BY p.category ORDER BY p.price DESC) as price_rank_in_category, AVG(p.price) OVER (PARTITION BY p.category) as avg_category_price, COUNT(*) OVER (PARTITION BY p.category) as products_in_category FROM products p WHERE p.quantity > 0 ORDER BY p.category, price_rank_in_category;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.brand, p.name, p.price, NTILE(4) OVER (ORDER BY p.price) as price_quartile, LAG(p.price, 1) OVER (ORDER BY p.price) as previous_product_price, LEAD(p.price, 1) OVER (ORDER BY p.price) as next_product_price, p.price - LAG(p.price, 1) OVER (ORDER BY p.price) as price_difference FROM products p ORDER BY p.price;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category FROM products p WHERE p.name LIKE \'%pro%\' OR p.name LIKE \'%max%\' OR p.name LIKE \'%plus%\' OR p.name LIKE \'%premium%\' ORDER BY p.category, p.name;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'WITH MonthlySales AS ( SELECT DATE_FORMAT(o.orderdate, \'%Y-%m\') as month, SUM(o.price) as monthly_revenue, COUNT(DISTINCT o.client_id) as active_clients, COUNT(o.id) as order_count FROM orders o WHERE o.status != \'cancelled\' GROUP BY DATE_FORMAT(o.orderdate, \'%Y-%m\') ), ProductPerformance AS ( SELECT p.category, COUNT(DISTINCT o.id) as times_ordered, SUM(o.price) as revenue_generated, AVG(r.rating) as avg_rating FROM products p LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.category ) SELECT ms.month, ms.monthly_revenue, ms.active_clients, pp.category, pp.times_ordered, pp.revenue_generated FROM MonthlySales ms CROSS JOIN ProductPerformance pp WHERE ms.monthly_revenue > 5000 ORDER BY ms.month DESC, pp.revenue_generated DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, p.price * 0.2 as tax_amount, p.price * 1.2 as price_with_tax, ROUND(p.price * 0.15, 2) as estimated_profit, p.price / (SELECT AVG(price) FROM products) as price_vs_avg_ratio FROM products p WHERE p.price > (SELECT AVG(price) FROM products) ORDER BY price_vs_avg_ratio DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, pr.percentage, p.price * (1 - pr.percentage/100) as discounted_price_calc, pr.price as actual_discounted_price, ABS(p.price * (1 - pr.percentage/100) - pr.price) as price_difference FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY price_difference DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT * FROM products p WHERE p.price BETWEEN 100 AND 500 AND p.category = \'Electronics\' AND p.quantity > 0 AND p.id IN (SELECT product_id FROM cart WHERE date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) ORDER BY p.price, p.name LIMIT 100 OFFSET 0;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, GROUP_CONCAT(DISTINCT p.brand ORDER BY p.brand SEPARATOR \', \') as brands_in_category, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity) as total_inventory_value FROM products p GROUP BY p.category HAVING COUNT(DISTINCT p.brand) > 2 ORDER BY product_count DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.role, a.username, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as offers_created, COUNT(DISTINCT ord.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_handled, COUNT(DISTINCT rt.id) as returns_handled FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id LEFT JOIN orders ord ON a.id = ord.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns rt ON a.id = rt.admin_id GROUP BY a.role, a.username ORDER BY a.role, products_managed DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price, pr.percentage as current_discount, pr.startdate as discount_start, pr.enddate as discount_end, DATEDIFF(pr.enddate, CURDATE()) as days_remaining FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 AND (pr.percentage IS NULL OR pr.percentage < 30) ORDER BY p.price DESC, days_remaining ASC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.quantity as current_stock, COUNT(ca.id) as in_carts, COUNT(o.id) as in_orders_last_30_days, p.quantity - COUNT(o.id) as projected_stock, CASE WHEN p.quantity < 10 THEN \'Low Stock\' WHEN p.quantity BETWEEN 10 AND 50 THEN \'Medium Stock\' ELSE \'Good Stock\' END as stock_status FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) WHERE p.quantity > 0 GROUP BY p.id, p.name, p.quantity HAVING in_orders_last_30_days > 0 ORDER BY projected_stock ASC, in_orders_last_30_days DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT MONTH(o.orderdate) as month, YEAR(o.orderdate) as year, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_clients FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 2 YEAR) GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), p.category ORDER BY year DESC, month DESC, total_revenue DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.price as current_price, pr.price as promotion_price, pr.percentage as discount_percentage, AVG(p2.price) OVER (PARTITION BY p.category) as avg_category_price, p.price - AVG(p2.price) OVER (PARTITION BY p.category) as price_difference_from_category_avg, CASE WHEN pr.price IS NOT NULL THEN \'On Promotion\' WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.2 THEN \'Overpriced\' WHEN p.price < AVG(p2.price) OVER (PARTITION BY p.category) * 0.8 THEN \'Underpriced\' ELSE \'Competitively Priced\' END as pricing_status FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN products p2 ON p.category = p2.category WHERE p.quantity > 0 GROUP BY p.id, p.name, p.price, pr.price, pr.percentage, p.category ORDER BY price_difference_from_category_avg DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, COALESCE(AVG(r.rating), 0) as avg_rating, COUNT(DISTINCT r.id) as total_ratings, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) as positive_ratings, COUNT(DISTINCT CASE WHEN r.rating <= 2 THEN r.id END) as negative_ratings, COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) * 100.0 / NULLIF(COUNT(DISTINCT r.id), 0) as satisfaction_rate FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING total_ratings > 10 ORDER BY satisfaction_rate DESC, avg_rating DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.quantity as current_stock, AVG(daily_sales.daily_quantity) as avg_daily_sales, p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) as days_until_stockout, CASE WHEN p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) <= 7 THEN \'Critical\' WHEN p.quantity / NULLIF(AVG(daily_sales.daily_quantity), 0) <= 14 THEN \'Warning\' ELSE \'Safe\' END as stockout_risk FROM products p LEFT JOIN ( SELECT ca.product_id, DATE(o.orderdate) as sale_date, COUNT(*) as daily_quantity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND o.status = \'delivered\' GROUP BY ca.product_id, DATE(o.orderdate) ) daily_sales ON p.id = daily_sales.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_until_stockout ASC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity * p.price) as inventory_value, SUM(o.price) as revenue_last_30_days, COUNT(DISTINCT o.id) as orders_last_30_days, SUM(o.price) / NULLIF(COUNT(DISTINCT p.id), 0) as revenue_per_product, SUM(o.price) * 0.3 as estimated_profit, SUM(o.price) * 0.3 / NULLIF(SUM(p.quantity * p.price), 0) * 100 as roi_percentage FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND o.status = \'delivered\' WHERE p.quantity > 0 GROUP BY p.category HAVING revenue_last_30_days > 0 ORDER BY roi_percentage DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, AVG(LENGTH(p.description)) as avg_description_length, AVG(LENGTH(p.more_details)) as avg_details_length, COUNT(DISTINCT p.images) as unique_images_count, COUNT(DISTINCT p.image_display) as unique_display_images, COUNT(DISTINCT CASE WHEN p.description LIKE \'%premium%\' THEN p.id END) as premium_mentions, COUNT(DISTINCT CASE WHEN p.description LIKE \'%new%\' THEN p.id END) as new_mentions FROM products p GROUP BY p.category ORDER BY avg_description_length DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT w.id, w.name, w.delivery_price, COUNT(DISTINCT c.id) as client_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, GROUP_CONCAT(DISTINCT p.category ORDER BY p.category SEPARATOR \', \') as popular_categories FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id WHERE o.status = \'delivered\' GROUP BY w.id, w.name, w.delivery_price HAVING order_count > 0 ORDER BY total_revenue DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_tried, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cm.id) as comments_count, COUNT(DISTINCT r.id) as ratings_count, (COUNT(DISTINCT o.id) * 0.2 + COUNT(DISTINCT p.category) * 0.2 + COUNT(DISTINCT f.id) * 0.2 + COUNT(DISTINCT cm.id) * 0.2 + COUNT(DISTINCT r.id) * 0.2) as loyalty_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = \'delivered\' GROUP BY c.id, c.firstname, c.lastname HAVING total_orders > 1 ORDER BY loyalty_score DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products_added, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT ofr.id) as offers_created, SUM(o.price) as revenue_influenced, COUNT(DISTINCT o.id) as orders_influenced, SUM(o.price) / NULLIF(COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id), 0) as roi_per_action FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id WHERE a.role LIKE \'%Manager%\' GROUP BY a.id, a.username, a.role HAVING revenue_influenced > 0 ORDER BY roi_per_action DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE \'%excellent%\' OR LOWER(cm.comment) LIKE \'%great%\' OR LOWER(cm.comment) LIKE \'%awesome%\' OR LOWER(cm.comment) LIKE \'%love%\' THEN cm.id END) as positive_comments, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE \'%bad%\' OR LOWER(cm.comment) LIKE \'%poor%\' OR LOWER(cm.comment) LIKE \'%terrible%\' OR LOWER(cm.comment) LIKE \'%disappoint%\' THEN cm.id END) as negative_comments, (COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE \'%excellent%\' OR LOWER(cm.comment) LIKE \'%great%\' OR LOWER(cm.comment) LIKE \'%awesome%\' OR LOWER(cm.comment) LIKE \'%love%\' THEN cm.id END) - COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE \'%bad%\' OR LOWER(cm.comment) LIKE \'%poor%\' OR LOWER(cm.comment) LIKE \'%terrible%\' OR LOWER(cm.comment) LIKE \'%disappoint%\' THEN cm.id END)) * 100.0 / NULLIF(COUNT(DISTINCT cm.id), 0) as sentiment_score FROM products p LEFT JOIN comments cm ON p.id = cm.product_id GROUP BY p.id, p.name HAVING total_comments > 5 ORDER BY sentiment_score DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, COUNT(DISTINCT p.id) as total_products, COUNT(DISTINCT p.brand) as brands_count, SUM(p.quantity) as total_inventory, SUM(p.quantity * p.price) as inventory_value, AVG(p.price) as avg_price, MIN(p.price) as min_price, MAX(p.price) as max_price, COUNT(DISTINCT CASE WHEN p.quantity = 0 THEN p.id END) as out_of_stock_count, COUNT(DISTINCT CASE WHEN p.quantity < 10 THEN p.id END) as low_stock_count, COUNT(DISTINCT CASE WHEN p.quantity > 100 THEN p.id END) as high_stock_count FROM products p GROUP BY p.category ORDER BY inventory_value DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cm.id) as comments_count, COALESCE(AVG(r.rating), 0) as avg_rating_given, (LOG10(SUM(o.price) + 1) * 0.25 + (1 - (DATEDIFF(CURDATE(), MAX(o.orderdate)) / 365)) * 0.25 + (COUNT(DISTINCT p.category) / 10.0) * 0.2 + (COUNT(DISTINCT f.id) / 10.0) * 0.15 + (COALESCE(AVG(r.rating), 0) / 5.0) * 0.15) as marketing_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = \'delivered\' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING order_count > 0 ORDER BY marketing_score DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT pr.id, p.name, pr.percentage, pr.price as promo_price, p.price as original_price, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) as duration_days, COUNT(DISTINCT ca.id) as times_added_to_cart, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT o.id) * (p.price - pr.price) as revenue_loss, COUNT(DISTINCT o.id) * pr.price as revenue_gained, (COUNT(DISTINCT o.id) * pr.price) - (COUNT(DISTINCT o.id) * (p.price - pr.price)) as net_effect FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY pr.id, p.name, pr.percentage, pr.price, p.price, pr.startdate, pr.enddate HAVING times_ordered > 0 ORDER BY net_effect DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p1.category as category1, p2.category as category2, COUNT(DISTINCT ca1.client_id) as customers_both_categories, COUNT(DISTINCT CASE WHEN ca1.product_id = p1.id THEN ca1.client_id END) as customers_category1, COUNT(DISTINCT CASE WHEN ca2.product_id = p2.id THEN ca2.client_id END) as customers_category2, COUNT(DISTINCT ca1.client_id) * 100.0 / NULLIF(COUNT(DISTINCT CASE WHEN ca1.product_id = p1.id THEN ca1.client_id END), 0) as cross_sell_rate FROM products p1 JOIN products p2 ON p1.category < p2.category LEFT JOIN cart ca1 ON p1.id = ca1.product_id LEFT JOIN cart ca2 ON p2.id = ca2.product_id AND ca1.client_id = ca2.client_id GROUP BY p1.category, p2.category HAVING customers_both_categories > 10 ORDER BY cross_sell_rate DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, AVG(DATEDIFF(o2.orderdate, o1.orderdate)) as avg_days_between_orders, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT f.id) as favorites_count, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN \'Churned\' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 30 THEN \'At Risk\' ELSE \'Active\' END as churn_status, (DATEDIFF(CURDATE(), MAX(o.orderdate)) / 90.0 * 0.4 + (1 - (COUNT(DISTINCT o.id) / 10.0)) * 0.3 + (1 - (COUNT(DISTINCT p.category) / 5.0)) * 0.2 + (1 - (COUNT(DISTINCT f.id) / 5.0)) * 0.1) as churn_probability FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN orders o1 ON c.id = o1.client_id LEFT JOIN orders o2 ON c.id = o2.client_id AND o2.orderdate > o1.orderdate LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id WHERE o.status = \'delivered\' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING total_orders > 1 ORDER BY churn_probability DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, p.brand, p.quantity as current_stock, AVG(daily_sales.sales_quantity) as avg_daily_sales, STDDEV(daily_sales.sales_quantity) as sales_volatility, p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) as days_of_inventory, CASE WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) < 7 THEN \'Reorder Now\' WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) < 14 THEN \'Monitor Closely\' WHEN p.quantity / NULLIF(AVG(daily_sales.sales_quantity), 0) > 60 THEN \'Excess Stock\' ELSE \'Healthy\' END as inventory_status, GREATEST(CEILING(AVG(daily_sales.sales_quantity) * 30 - p.quantity), 0) as suggested_reorder_quantity FROM products p LEFT JOIN ( SELECT ca.product_id, DATE(o.orderdate) as sale_date, COUNT(*) as sales_quantity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.status = \'delivered\' GROUP BY ca.product_id, DATE(o.orderdate) ) daily_sales ON p.id = daily_sales.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_of_inventory ASC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT DATE_FORMAT(o.orderdate, \'%Y-%m\') as month, w.name as delivery_region, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(w.delivery_price) as avg_delivery_cost, SUM(o.price) / COUNT(DISTINCT o.client_id) as revenue_per_customer, COUNT(DISTINCT p.category) as categories_ordered FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON c.wilaya = w.id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.status = \'delivered\' GROUP BY DATE_FORMAT(o.orderdate, \'%Y-%m\'), w.name ORDER BY month DESC, total_revenue DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, p.price * p.quantity as inventory_investment, SUM(o.price) as revenue_generated, COUNT(DISTINCT o.id) as times_ordered, SUM(o.price) - (p.price * p.quantity) as gross_profit, (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 as roi_percentage, CASE WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 100 THEN \'Excellent\' WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 50 THEN \'Good\' WHEN (SUM(o.price) - (p.price * p.quantity)) / NULLIF(p.price * p.quantity, 0) * 100 > 0 THEN \'Break-even\' ELSE \'Loss\' END as performance_category FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = \'delivered\' GROUP BY p.id, p.name, p.category, p.price, p.quantity HAVING times_ordered > 0 ORDER BY roi_percentage DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as order_frequency, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as category_variety, COUNT(DISTINCT f.id) as favorites_activity, COUNT(DISTINCT cm.id) as engagement_comments, COUNT(DISTINCT r.id) as engagement_ratings, CASE WHEN COUNT(DISTINCT o.id) > 10 AND AVG(o.price) > 500 THEN \'VIP Shoppers\' WHEN COUNT(DISTINCT p.category) > 5 THEN \'Variety Seekers\' WHEN COUNT(DISTINCT f.id) > 10 THEN \'Collectors\' WHEN COUNT(DISTINCT cm.id) > 5 OR COUNT(DISTINCT r.id) > 10 THEN \'Engaged Reviewers\' WHEN COUNT(DISTINCT o.id) = 1 THEN \'One-time Buyers\' ELSE \'Regular Shoppers\' END as behavioral_segment FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id WHERE o.status = \'delivered\' GROUP BY c.id, c.firstname, c.lastname HAVING order_frequency > 0 ORDER BY order_frequency DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, p.brand, p.price as current_price, AVG(p2.price) OVER (PARTITION BY p.category) as category_avg_price, AVG(p3.price) OVER (PARTITION BY p.brand) as brand_avg_price, COUNT(DISTINCT ca.id) as cart_additions_last_week, COUNT(DISTINCT o.id) as purchases_last_month, COALESCE(AVG(r.rating), 0) as avg_rating, CASE WHEN COUNT(DISTINCT ca.id) = 0 AND COUNT(DISTINCT o.id) = 0 THEN \'Consider Price Reduction\' WHEN COUNT(DISTINCT ca.id) > 10 AND COUNT(DISTINCT o.id) < 5 THEN \'Consider Bundle Offer\' WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.3 THEN \'Price Higher Than Category Average\' WHEN p.price < AVG(p2.price) OVER (PARTITION BY p.category) * 0.7 THEN \'Price Lower Than Category Average\' ELSE \'Price Optimized\' END as pricing_recommendation, CASE WHEN COUNT(DISTINCT ca.id) = 0 AND COUNT(DISTINCT o.id) = 0 THEN p.price * 0.9 WHEN p.price > AVG(p2.price) OVER (PARTITION BY p.category) * 1.3 THEN AVG(p2.price) OVER (PARTITION BY p.category) * 1.1 ELSE p.price END as suggested_price FROM products p LEFT JOIN products p2 ON p.category = p2.category LEFT JOIN products p3 ON p.brand = p3.brand LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price ORDER BY purchases_last_month DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, MONTH(o.orderdate) as order_month, YEAR(o.orderdate) as order_year, COUNT(DISTINCT o.id) as monthly_orders, SUM(o.price) as monthly_revenue, AVG(o.price) as avg_order_value, LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as orders_same_month_last_year, LAG(SUM(o.price), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as revenue_same_month_last_year, COUNT(DISTINCT o.id) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 0) as order_growth_yoy, SUM(o.price) * 100.0 / NULLIF(LAG(SUM(o.price), 12) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 0) as revenue_growth_yoy FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 24 MONTH) AND o.status = \'delivered\' GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING monthly_orders > 0 ORDER BY p.category, order_year DESC, order_month DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.id, p.name, p.category, p.brand, p.price as selling_price, p.price * 0.6 as estimated_cost, p.price * 0.4 as estimated_profit, p.quantity as current_inventory, p.price * p.quantity as inventory_value, COUNT(DISTINCT ca.id) as in_carts, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT f.id) as in_favorites, COALESCE(AVG(r.rating), 0) as customer_rating, (COUNT(DISTINCT o.id) * p.price * 0.4) - (p.price * p.quantity * 0.1) as net_profit_estimate, (COUNT(DISTINCT o.id) * p.price * 0.4) * 100.0 / NULLIF(p.price * p.quantity * 0.1, 0) as roi_percentage FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(p.id, (SELECT GROUP_CONCAT(product_id) FROM cart WHERE id = o.cart_id)) > 0 LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING times_ordered > 0 ORDER BY net_profit_estimate DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT ofr.id) as offers_created, COUNT(DISTINCT o.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_resolved, COUNT(DISTINCT rt.id) as returns_processed, COUNT(DISTINCT i.id) as messages_sent, (COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id) + COUNT(DISTINCT o.id) + COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) + COUNT(DISTINCT i.id)) as total_actions, SUM(o.price) as revenue_influenced, SUM(o.price) / NULLIF((COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id) + COUNT(DISTINCT o.id) + COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) + COUNT(DISTINCT i.id)), 0) as revenue_per_action FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns rt ON a.id = rt.admin_id LEFT JOIN inbox i ON a.id = i.admin_id GROUP BY a.id, a.username, a.role ORDER BY total_actions DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'WITH PerformanceMetrics AS ( SELECT DATE_FORMAT(o.orderdate, \'%Y-%m\') as month, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, COUNT(DISTINCT o.client_id) as unique_customers, AVG(o.price) as avg_order_value, COUNT(DISTINCT cl.id) as claims_count, COUNT(DISTINCT rt.id) as returns_count, SUM(w.delivery_price) as total_delivery_cost, COUNT(DISTINCT p.id) as unique_products_sold, COUNT(DISTINCT p.category) as categories_sold FROM orders o LEFT JOIN clients c ON o.client_id = c.id LEFT JOIN wilayas w ON c.wilaya = w.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id WHERE o.status = \'delivered\' GROUP BY DATE_FORMAT(o.orderdate, \'%Y-%m\') ), GrowthMetrics AS ( SELECT *, LAG(order_count, 1) OVER (ORDER BY month) as prev_month_orders, LAG(total_revenue, 1) OVER (ORDER BY month) as prev_month_revenue, LAG(unique_customers, 1) OVER (ORDER BY month) as prev_month_customers, order_count * 100.0 / NULLIF(LAG(order_count, 1) OVER (ORDER BY month), 0) - 100 as order_growth_rate, total_revenue * 100.0 / NULLIF(LAG(total_revenue, 1) OVER (ORDER BY month), 0) - 100 as revenue_growth_rate, unique_customers * 100.0 / NULLIF(LAG(unique_customers, 1) OVER (ORDER BY month), 0) - 100 as customer_growth_rate, claims_count * 100.0 / NULLIF(order_count, 0) as claim_rate, returns_count * 100.0 / NULLIF(order_count, 0) as return_rate, total_delivery_cost * 100.0 / NULLIF(total_revenue, 0) as delivery_cost_rate FROM PerformanceMetrics ) SELECT month, order_count, total_revenue, unique_customers, avg_order_value, order_growth_rate, revenue_growth_rate, customer_growth_rate, claim_rate, return_rate, delivery_cost_rate, CASE WHEN revenue_growth_rate > 20 THEN \'Excellent Growth\' WHEN revenue_growth_rate > 10 THEN \'Good Growth\' WHEN revenue_growth_rate > 0 THEN \'Moderate Growth\' WHEN revenue_growth_rate > -10 THEN \'Decline\' ELSE \'Significant Decline\' END as growth_category, CASE WHEN claim_rate < 1 AND return_rate < 1 THEN \'Excellent Quality\' WHEN claim_rate < 3 AND return_rate < 3 THEN \'Good Quality\' WHEN claim_rate < 5 AND return_rate < 5 THEN \'Acceptable Quality\' ELSE \'Needs Improvement\' END as quality_category FROM GrowthMetrics WHERE prev_month_orders IS NOT NULL ORDER BY month DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id as client_id, c.firstname, c.lastname, p.id as product_id, p.name as product_name, COUNT(DISTINCT o.id) as times_purchased, MAX(o.orderdate) as last_purchase_date, AVG(r.rating) as avg_rating_by_client, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_purchase, CASE WHEN COUNT(DISTINCT o.id) >= 3 THEN \'Frequent Buyer\' WHEN COUNT(DISTINCT o.id) = 2 THEN \'Repeat Buyer\' ELSE \'One-time Buyer\' END as purchase_frequency FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id AND p.id = r.product_id WHERE o.status = \'delivered\' GROUP BY c.id, c.firstname, c.lastname, p.id, p.name HAVING times_purchased > 0 ORDER BY times_purchased DESC, days_since_last_purchase;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT p.category, p.brand, AVG(p.price) as avg_price, STDDEV(p.price) as price_volatility, MIN(p.price) as min_price, MAX(p.price) as max_price, (MAX(p.price) - MIN(p.price)) / AVG(p.price) * 100 as price_range_percentage, COUNT(DISTINCT pr.id) as active_promotions, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT CASE WHEN pr.percentage > 30 THEN pr.id END) as deep_discounts_count FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 GROUP BY p.category, p.brand HAVING COUNT(DISTINCT p.id) > 2 ORDER BY price_volatility DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, p1.category as first_category, p2.category as second_category, COUNT(DISTINCT o1.id) as orders_first_category, COUNT(DISTINCT o2.id) as orders_second_category, AVG(o1.price) as avg_spent_first_category, AVG(o2.price) as avg_spent_second_category, DATEDIFF(MIN(o2.orderdate), MAX(o1.orderdate)) as days_between_categories, CASE WHEN AVG(o2.price) > AVG(o1.price) * 1.5 THEN \'Upgrade\' WHEN AVG(o2.price) < AVG(o1.price) * 0.5 THEN \'Downgrade\' ELSE \'Lateral Move\' END as migration_type FROM clients c JOIN orders o1 ON c.id = o1.client_id JOIN cart ca1 ON FIND_IN_SET(ca1.id, o1.cart_id) > 0 JOIN products p1 ON ca1.product_id = p1.id JOIN orders o2 ON c.id = o2.client_id AND o2.orderdate > o1.orderdate JOIN cart ca2 ON FIND_IN_SET(ca2.id, o2.cart_id) > 0 JOIN products p2 ON ca2.product_id = p2.id WHERE o1.status = \'delivered\' AND o2.status = \'delivered\' AND p1.category != p2.category AND o2.orderdate = ( SELECT MIN(o3.orderdate) FROM orders o3 JOIN cart ca3 ON FIND_IN_SET(ca3.id, o3.cart_id) > 0 JOIN products p3 ON ca3.product_id = p3.id WHERE o3.client_id = c.id AND o3.orderdate > o1.orderdate AND p3.category != p1.category ) GROUP BY c.id, c.firstname, c.lastname, p1.category, p2.category HAVING orders_first_category > 0 AND orders_second_category > 0 ORDER BY days_between_categories;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT o.id as order_id, o.orderdate, o.price as order_total, COUNT(DISTINCT ca.product_id) as unique_products, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT p.brand) as unique_brands, AVG(p.price) as avg_product_price, MAX(p.price) as max_product_price, MIN(p.price) as min_product_price, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as discounted_items_count, (COUNT(DISTINCT ca.product_id) * 0.3 + COUNT(DISTINCT p.category) * 0.3 + COUNT(DISTINCT p.brand) * 0.2 + (MAX(p.price) - MIN(p.price)) / NULLIF(AVG(p.price), 0) * 0.2) as order_complexity_score FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE o.status = \'delivered\' GROUP BY o.id, o.orderdate, o.price HAVING unique_products > 1 ORDER BY order_complexity_score DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT w.id, w.name as wilaya_name, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, COUNT(DISTINCT p.category) as categories_available, COUNT(DISTINCT p.brand) as brands_available, COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) as market_share_percentage, COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT c.id), 0) as penetration_rate, CASE WHEN COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) > 10 THEN \'High Saturation\' WHEN COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) > 5 THEN \'Medium Saturation\' ELSE \'Low Saturation\' END as saturation_level FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id GROUP BY w.id, w.name ORDER BY market_share_percentage DESC;' LIMIT 1; SELECT 1 FROM dataset_ml WHERE sql_text = 'SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as online_orders, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as high_value_orders, COUNT(DISTINCT ca.id) as cart_activities, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT cm.id) as comments_posted, COUNT(DISTINCT r.id) as ratings_given, COUNT(DISTINCT cl.id) as claims_filed, (COUNT(DISTINCT o.id) * 0.25 + COUNT(DISTINCT ca.id) * 0.15 + COUNT(DISTINCT f.id) * 0.15 + COUNT(DISTINCT cm.id) * 0.15 + COUNT(DISTINCT r.id) * 0.15 + COUNT(DISTINCT cl.id) * 0.15) as multi_channel_engagement_score, CASE WHEN COUNT(DISTINCT o.id) > 0 AND COUNT(DISTINCT ca.id) > 0 AND COUNT(DISTINCT f.id) > 0 THEN \'Full Engagement\' WHEN COUNT(DISTINCT o.id) > 0 AND COUNT(DISTINCT ca.id) > 0 THEN \'High Engagement\' WHEN COUNT(DISTINCT o.id) > 0 THEN \'Moderate Engagement\' ELSE \'Low Engagement\' END as engagement_level FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id GROUP BY c.id, c.firstname, c.lastname ORDER BY multi_channel_engagement_score DESC;' LIMIT 1; SELECT 'Product' as data_type, COUNT(DISTINCT p.id) as total_records, AVG(LENGTH(p.name)) as avg_name_length, AVG(LENGTH(p.description)) as avg_description_length, AVG(LENGTH(p.more_details)) as avg_details_length, COUNT(DISTINCT p.images) as unique_images, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT p.brand) as unique_brands, SUM(CASE WHEN p.description IS NOT NULL AND p.description != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as description_completeness, SUM(CASE WHEN p.images IS NOT NULL AND p.images != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as images_completeness FROM products p UNION ALL SELECT 'Client' as data_type, COUNT(DISTINCT c.id) as total_records, AVG(LENGTH(CONCAT(c.firstname, ' ', c.lastname))) as avg_name_length, NULL as avg_description_length, NULL as avg_details_length, NULL as unique_images, COUNT(DISTINCT c.wilaya) as unique_wilayas, NULL as unique_brands, SUM(CASE WHEN c.email IS NOT NULL AND c.email LIKE '%@%.%' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as email_completeness, SUM(CASE WHEN c.phone_number IS NOT NULL AND c.phone_number != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as phone_completeness FROM clients c UNION ALL SELECT 'Order' as data_type, COUNT(DISTINCT o.id) as total_records, NULL as avg_name_length, AVG(LENGTH(o.full_address)) as avg_address_length, NULL as avg_details_length, NULL as unique_images, COUNT(DISTINCT o.wilaya_id) as unique_wilayas, NULL as unique_brands, SUM(CASE WHEN o.full_address IS NOT NULL AND o.full_address != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as address_completeness, SUM(CASE WHEN o.code IS NOT NULL AND LENGTH(o.code) = 6 THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as code_completeness FROM orders o; 
 SELECT CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 18 AND 25 THEN '18-25' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 26 AND 35 THEN '26-35' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 36 AND 45 THEN '36-45' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 46 AND 55 THEN '46-55' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) > 55 THEN '55+' ELSE 'Unknown' END as age_group, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT c.id) as unique_customers, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_added FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id WHERE o.status = 'delivered' GROUP BY age_group ORDER BY CASE age_group WHEN '18-25' THEN 1 WHEN '26-35' THEN 2 WHEN '36-45' THEN 3 WHEN '46-55' THEN 4 WHEN '55+' THEN 5 ELSE 6 END; 
 SELECT p.id, p.name, p.category, p.brand, p.price as selling_price, ROUND(p.price * 0.6, 2) as estimated_cost, ROUND(p.price * 0.4, 2) as estimated_profit_margin, p.quantity as current_stock, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT o.id) * p.price as total_revenue_generated, COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2) as total_profit_estimated, COUNT(DISTINCT c.id) as unique_customers, COUNT(DISTINCT f.id) as favorites_count, COALESCE(AVG(r.rating), 0) as avg_rating, COUNT(DISTINCT cm.id) as review_count, (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) / NULLIF(p.quantity, 0) as profit_per_unit_inventory FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' LEFT JOIN clients c ON o.client_id = c.id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING times_ordered > 0 ORDER BY total_profit_estimated DESC LIMIT 50; 
 SELECT DAYNAME(o.orderdate) as day_of_week, DAYOFWEEK(o.orderdate) as day_number, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_ordered, COUNT(DISTINCT p.brand) as brands_ordered, AVG(TIMESTAMPDIFF(HOUR, o.orderdate, o.deliveredDate)) as avg_delivery_hours, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 0 AND 6 THEN o.id END) as midnight_to_6am_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 7 AND 12 THEN o.id END) as morning_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 13 AND 18 THEN o.id END) as afternoon_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 19 AND 23 THEN o.id END) as evening_orders FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate) ORDER BY day_number; 
 SELECT p1.id as product1_id, p1.name as product1_name, p1.category as product1_category, p2.id as product2_id, p2.name as product2_name, p2.category as product2_category, COUNT(DISTINCT o.id) as times_bought_together, COUNT(DISTINCT c.id) as unique_customers_both, AVG(p1.price + p2.price) as avg_combined_price, COUNT(DISTINCT CASE WHEN p1.category = p2.category THEN o.id END) as same_category_orders, COUNT(DISTINCT CASE WHEN p1.category != p2.category THEN o.id END) as cross_category_orders, COUNT(DISTINCT o.id) * 100.0 / ( SELECT COUNT(DISTINCT o2.id) FROM orders o2 JOIN cart ca ON FIND_IN_SET(ca.id, o2.cart_id) > 0 WHERE ca.product_id = p1.id ) as association_strength_percentage FROM orders o JOIN cart ca1 ON FIND_IN_SET(ca1.id, o.cart_id) > 0 JOIN cart ca2 ON FIND_IN_SET(ca2.id, o.cart_id) > 0 JOIN products p1 ON ca1.product_id = p1.id JOIN products p2 ON ca2.product_id = p2.id JOIN clients c ON o.client_id = c.id WHERE p1.id < p2.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY p1.id, p1.name, p1.category, p2.id, p2.name, p2.category HAVING times_bought_together >= 5 ORDER BY times_bought_together DESC LIMIT 100; 
 SELECT w.id, w.name as wilaya_name, w.delivery_price, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.id) * 1.0 / NULLIF(COUNT(DISTINCT c.id), 0) as orders_per_client, SUM(o.price) * 1.0 / NULLIF(COUNT(DISTINCT c.id), 0) as revenue_per_client, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT cl.id) as claims_filed, COUNT(DISTINCT rt.id) as returns_filed, (SUM(o.price) - (COUNT(DISTINCT o.id) * w.delivery_price)) as net_revenue_after_delivery, RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, RANK() OVER (ORDER BY COUNT(DISTINCT c.id) DESC) as client_count_rank FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id GROUP BY w.id, w.name, w.delivery_price HAVING total_orders > 0 ORDER BY revenue_per_client DESC; 
 SELECT p.category, MONTH(o.orderdate) as month, MONTHNAME(o.orderdate) as month_name, COUNT(DISTINCT o.id) as monthly_orders, SUM(o.price) as monthly_revenue, COUNT(DISTINCT o.client_id) as monthly_customers, AVG(o.price) as avg_monthly_order_value, COUNT(DISTINCT p.brand) as brands_ordered, SUM(o.price) * 100.0 / SUM(SUM(o.price)) OVER (PARTITION BY p.category) as category_monthly_share, RANK() OVER (PARTITION BY p.category ORDER BY SUM(o.price) DESC) as revenue_rank_in_category, LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY MONTH(o.orderdate)) as prev_month_orders, COUNT(DISTINCT o.id) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY MONTH(o.orderdate)), 0) - 100 as order_growth_rate FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY p.category, MONTH(o.orderdate), MONTHNAME(o.orderdate) HAVING monthly_orders >= 10 ORDER BY p.category, month; 
 SELECT DATE(ca.date_cart) as cart_date, COUNT(DISTINCT ca.id) as carts_created, COUNT(DISTINCT o.id) as carts_converted, COUNT(DISTINCT ca.id) - COUNT(DISTINCT o.id) as carts_abandoned, (COUNT(DISTINCT ca.id) - COUNT(DISTINCT o.id)) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0) as abandonment_rate, AVG(TIMESTAMPDIFF(HOUR, ca.date_cart, o.orderdate)) as avg_conversion_time_hours, COUNT(DISTINCT ca.client_id) as unique_cart_users, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) as carts_with_promotions, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) as carts_with_offers, SUM(p.price) as total_cart_value, AVG(p.price) as avg_cart_value FROM cart ca LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY DATE(ca.date_cart) ORDER BY cart_date DESC;                                                                                                                           
 SELECT w.id as wilaya_id, w.name as wilaya_name, p.brand, COUNT(DISTINCT o.id) as orders_for_brand, SUM(o.price) as revenue_for_brand, COUNT(DISTINCT c.id) as customers_for_brand, COUNT(DISTINCT p.id) as products_from_brand, AVG(p.price) as avg_brand_price_in_wilaya, COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER (PARTITION BY w.id) as brand_share_in_wilaya, COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER (PARTITION BY p.brand) as wilaya_share_for_brand, RANK() OVER (PARTITION BY w.id ORDER BY COUNT(DISTINCT o.id) DESC) as brand_rank_in_wilaya FROM wilayas w JOIN clients c ON w.id = c.wilaya JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY w.id, w.name, p.brand HAVING orders_for_brand >= 5 ORDER BY w.name, orders_for_brand DESC;                                                                                      
 SELECT p.id, p.name, p.category, p.brand, p.price, COUNT(DISTINCT r.id) as total_ratings, AVG(r.rating) as avg_rating, STDDEV(r.rating) as rating_std_dev, COUNT(DISTINCT CASE WHEN r.rating = 5 THEN r.id END) as five_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 4 THEN r.id END) as four_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 3 THEN r.id END) as three_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 2 THEN r.id END) as two_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 1 THEN r.id END) as one_star_ratings, COUNT(DISTINCT cm.id) as total_reviews, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%excellent%' OR LOWER(cm.comment) LIKE '%great%' OR LOWER(cm.comment) LIKE '%awesome%' THEN cm.id END) as positive_reviews, COUNT(DISTINCT CASE WHEN LOWER(cm.comment) LIKE '%poor%' OR LOWER(cm.comment) LIKE '%bad%' OR LOWER(cm.comment) LIKE '%terrible%' THEN cm.id END) as negative_reviews, COUNT(DISTINCT o.id) as total_orders, COUNT(DISTINCT cl.id) as total_claims, COUNT(DISTINCT rt.id) as total_returns, (AVG(r.rating) * 0.4 + (COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) * 100.0 / NULLIF(COUNT(DISTINCT r.id), 0) * 0.3) + (1 - (COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id)) * 1.0 / NULLIF(COUNT(DISTINCT o.id), 0) * 0.3)) as satisfaction_score FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN claims cl ON o.id = cl.order_id AND cl.product_id = p.id LEFT JOIN returns rt ON o.id = rt.order_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price HAVING total_ratings >= 10 ORDER BY satisfaction_score DESC LIMIT 100; 
 SELECT HOUR(o.orderdate) as hour_of_day, CASE WHEN HOUR(o.orderdate) BETWEEN 0 AND 6 THEN 'Night (0-6)' WHEN HOUR(o.orderdate) BETWEEN 7 AND 12 THEN 'Morning (7-12)' WHEN HOUR(o.orderdate) BETWEEN 13 AND 18 THEN 'Afternoon (13-18)' WHEN HOUR(o.orderdate) BETWEEN 19 AND 23 THEN 'Evening (19-23)' END as time_period, COUNT(DISTINCT o.id) as orders_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_ordered, COUNT(DISTINCT p.brand) as brands_ordered, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, COUNT(DISTINCT CASE WHEN ofr.id IS NOT NULL THEN o.id END) as offer_orders, COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER () as percentage_of_total_orders FROM orders o LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers ofr ON ca.offer_id = ofr.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY HOUR(o.orderdate) ORDER BY hour_of_day; 
 SELECT c.id as client_id, c.firstname, c.lastname, p.brand, COUNT(DISTINCT o.id) as orders_for_brand, SUM(o.price) as spent_on_brand, COUNT(DISTINCT p.id) as different_products_from_brand, MIN(o.orderdate) as first_purchase_date_brand, MAX(o.orderdate) as last_purchase_date_brand, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as loyalty_period_days, COUNT(DISTINCT o.id) * 1.0 / NULLIF(DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)), 1) * 30 as purchases_per_month, COUNT(DISTINCT o.id) * 100.0 / ( SELECT COUNT(DISTINCT o2.id) FROM orders o2 WHERE o2.client_id = c.id ) as brand_share_of_total_orders, CASE WHEN COUNT(DISTINCT o.id) >= 10 AND DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) > 180 THEN 'Highly Loyal' WHEN COUNT(DISTINCT o.id) >= 5 AND DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) > 90 THEN 'Loyal' WHEN COUNT(DISTINCT o.id) >= 3 THEN 'Regular' WHEN COUNT(DISTINCT o.id) = 2 THEN 'Occasional' ELSE 'One-time' END as brand_loyalty_level, AVG(r.rating) as avg_rating_for_brand, COUNT(DISTINCT f.id) as brand_favorites FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id AND p.id = r.product_id LEFT JOIN favorites f ON c.id = f.client_id AND p.id = f.product_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, p.brand HAVING orders_for_brand >= 2 ORDER BY spent_on_brand DESC LIMIT 200; 
 SELECT p.category, YEAR(o.orderdate) as order_year, MONTH(o.orderdate) as order_month, COUNT(DISTINCT p.id) as unique_products_sold, AVG(p.price) as avg_product_price, MIN(p.price) as min_product_price, MAX(p.price) as max_product_price, STDDEV(p.price) as price_std_dev, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN p.id END) as discounted_products_count, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as price_change_from_previous_month, (AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate))) * 100.0 / NULLIF(LAG(AVG(p.price), 1) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 0) as price_change_percentage FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 24 MONTH) GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING total_orders >= 10 ORDER BY p.category, order_year DESC, order_month DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, COUNT(DISTINCT o.id) as total_sales, SUM(o.price) as total_revenue, COUNT(DISTINCT c.id) as unique_buyers, COUNT(DISTINCT f.id) as favorites_count, COALESCE(AVG(r.rating), 0) as avg_rating, COUNT(DISTINCT cm.id) as reviews_count, COUNT(DISTINCT cl.id) as claims_count, COUNT(DISTINCT rt.id) as returns_count, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_sale, p.quantity * p.price as inventory_value, (COUNT(DISTINCT o.id) * p.price) as potential_revenue_if_sold, (p.quantity * p.price) - (COUNT(DISTINCT o.id) * p.price) as unsold_inventory_value, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'No Sales' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'Inactive' WHEN COUNT(DISTINCT o.id) * 1.0 / NULLIF(p.quantity, 0) < 0.1 THEN 'Slow Moving' WHEN COALESCE(AVG(r.rating), 0) < 2.5 THEN 'Low Rated' WHEN COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) > COUNT(DISTINCT o.id) * 0.1 THEN 'High Return Rate' ELSE 'Underperforming' END as underperformance_reason, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'Consider Removal' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'Discount Heavily' WHEN COUNT(DISTINCT o.id) * 1.0 / NULLIF(p.quantity, 0) < 0.1 THEN 'Bundle with Popular Items' WHEN COALESCE(AVG(r.rating), 0) < 2.5 THEN 'Improve Product or Description' WHEN COUNT(DISTINCT cl.id) + COUNT(DISTINCT rt.id) > COUNT(DISTINCT o.id) * 0.1 THEN 'Quality Check Needed' ELSE 'Marketing Push Needed' END as recommended_action FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' LEFT JOIN clients c ON o.client_id = c.id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN claims cl ON o.id = cl.order_id AND cl.product_id = p.id LEFT JOIN returns rt ON o.id = rt.order_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING total_sales < 5 OR DATEDIFF(CURDATE(), MAX(o.orderdate)) > 60 OR COALESCE(AVG(r.rating), 0) < 3 ORDER BY unsold_inventory_value DESC LIMIT 100; 
 SELECT p.category, MONTH(o.orderdate) as month, MONTHNAME(o.orderdate) as month_name, COUNT(DISTINCT o.id) as monthly_orders, SUM(o.price) as monthly_revenue, COUNT(DISTINCT o.client_id) as monthly_customers, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.brand) as brands_sold, COUNT(DISTINCT p.id) as products_sold, SUM(o.price) * 100.0 / SUM(SUM(o.price)) OVER (PARTITION BY p.category) as category_monthly_share, RANK() OVER (PARTITION BY MONTH(o.orderdate) ORDER BY SUM(o.price) DESC) as month_category_rank, LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY MONTH(o.orderdate)) as same_month_last_year_orders, COUNT(DISTINCT o.id) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 12) OVER (PARTITION BY p.category ORDER BY MONTH(o.orderdate)), 0) - 100 as yoy_order_growth FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 24 MONTH) GROUP BY p.category, MONTH(o.orderdate), MONTHNAME(o.orderdate) HAVING monthly_orders >= 10 ORDER BY p.category, month; 
 SELECT c.id as client_id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, COUNT(DISTINCT p.category) as unique_categories_purchased, GROUP_CONCAT(DISTINCT p.category ORDER BY p.category SEPARATOR ', ') as category_list, COUNT(DISTINCT p.brand) as unique_brands_purchased, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as shopping_period_days, COUNT(DISTINCT CASE WHEN p.category = 'Electronics' THEN o.id END) as electronics_orders, COUNT(DISTINCT CASE WHEN p.category = 'Fashion' THEN o.id END) as fashion_orders, COUNT(DISTINCT CASE WHEN p.category = 'Home' THEN o.id END) as home_orders, COUNT(DISTINCT CASE WHEN p.category = 'Beauty' THEN o.id END) as beauty_orders, COUNT(DISTINCT CASE WHEN p.category = 'Sports' THEN o.id END) as sports_orders, CASE WHEN COUNT(DISTINCT p.category) >= 5 THEN 'Highly Diversified' WHEN COUNT(DISTINCT p.category) >= 3 THEN 'Moderately Diversified' WHEN COUNT(DISTINCT p.category) = 2 THEN 'Limited Diversification' ELSE 'Single Category' END as diversification_level, (COUNT(DISTINCT p.category) * 0.4 + COUNT(DISTINCT p.brand) * 0.3 + (SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0) / 100) * 0.3) as cross_category_score FROM clients c JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON ca.product_id = p.id GROUP BY c.id, c.firstname, c.lastname HAVING total_orders >= 3 ORDER BY cross_category_score DESC LIMIT 200; 
 SELECT p.brand, YEAR(o.orderdate) as order_year, QUARTER(o.orderdate) as order_quarter, COUNT(DISTINCT p.id) as products_sold, AVG(p.price) as avg_price, MIN(p.price) as min_price, MAX(p.price) as max_price, STDDEV(p.price) as price_std_dev, COUNT(DISTINCT o.id) as orders_count, SUM(o.price) as total_revenue, COUNT(DISTINCT c.id) as unique_customers, AVG(o.price) as avg_order_value, COUNT(DISTINCT pr.id) as promotions_count, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT CASE WHEN pr.percentage > 20 THEN pr.id END) as deep_discount_promotions, AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.brand ORDER BY YEAR(o.orderdate), QUARTER(o.orderdate)) as price_change_from_previous_quarter, (AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.brand ORDER BY YEAR(o.orderdate), QUARTER(o.orderdate))) * 100.0 / NULLIF(LAG(AVG(p.price), 1) OVER (PARTITION BY p.brand ORDER BY YEAR(o.orderdate), QUARTER(o.orderdate)), 0) as price_change_percentage, CASE WHEN (AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.brand ORDER BY YEAR(o.orderdate), QUARTER(o.orderdate))) > 0 THEN 'Price Increase' WHEN (AVG(p.price) - LAG(AVG(p.price), 1) OVER (PARTITION BY p.brand ORDER BY YEAR(o.orderdate), QUARTER(o.orderdate))) < 0 THEN 'Price Decrease' ELSE 'Price Stable' END as price_trend FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN clients c ON o.client_id = c.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 24 MONTH) GROUP BY p.brand, YEAR(o.orderdate), QUARTER(o.orderdate) HAVING orders_count >= 10 ORDER BY p.brand, order_year DESC, order_quarter DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price as selling_price, ROUND(p.price * 0.6, 2) as estimated_cost, ROUND(p.price * 0.4, 2) as estimated_profit_margin, p.quantity as current_stock, COUNT(DISTINCT o.id) as total_sales, COUNT(DISTINCT c.id) as unique_customers, SUM(o.price) as total_revenue, COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2) as total_estimated_profit, COUNT(DISTINCT f.id) as favorites_count, COALESCE(AVG(r.rating), 0) as avg_rating, COUNT(DISTINCT cm.id) as reviews_count, COUNT(DISTINCT cl.id) as claims_count, COUNT(DISTINCT rt.id) as returns_count, COUNT(DISTINCT pr.id) as promotions_used, AVG(pr.percentage) as avg_discount_used, (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) - (COUNT(DISTINCT cl.id) * p.price * 0.5 + COUNT(DISTINCT rt.id) * p.price * 0.3) as net_profit_after_returns, (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) * 100.0 / NULLIF(p.quantity * ROUND(p.price * 0.6, 2), 0) as return_on_inventory_investment, CASE WHEN (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) - (COUNT(DISTINCT cl.id) * p.price * 0.5 + COUNT(DISTINCT rt.id) * p.price * 0.3) > 10000 THEN 'Highly Profitable' WHEN (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) - (COUNT(DISTINCT cl.id) * p.price * 0.5 + COUNT(DISTINCT rt.id) * p.price * 0.3) > 5000 THEN 'Profitable' WHEN (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) - (COUNT(DISTINCT cl.id) * p.price * 0.5 + COUNT(DISTINCT rt.id) * p.price * 0.3) > 1000 THEN 'Moderately Profitable' WHEN (COUNT(DISTINCT o.id) * ROUND(p.price * 0.4, 2)) - (COUNT(DISTINCT cl.id) * p.price * 0.5 + COUNT(DISTINCT rt.id) * p.price * 0.3) > 0 THEN 'Marginally Profitable' ELSE 'Unprofitable' END as profitability_category FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' LEFT JOIN clients c ON o.client_id = c.id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN claims cl ON o.id = cl.order_id AND cl.product_id = p.id LEFT JOIN returns rt ON o.id = rt.order_id LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING total_sales >= 5 ORDER BY net_profit_after_returns DESC LIMIT 100; 
 SELECT CASE WHEN YEAR(c.birthday) BETWEEN 1946 AND 1964 THEN 'Baby Boomers' WHEN YEAR(c.birthday) BETWEEN 1965 AND 1980 THEN 'Generation X' WHEN YEAR(c.birthday) BETWEEN 1981 AND 1996 THEN 'Millennials' WHEN YEAR(c.birthday) BETWEEN 1997 AND 2012 THEN 'Generation Z' ELSE 'Other' END as generation, COUNT(DISTINCT c.id) as total_customers, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT CASE WHEN p.category = 'Electronics' THEN o.id END) as electronics_orders, COUNT(DISTINCT CASE WHEN p.category = 'Fashion' THEN o.id END) as fashion_orders, COUNT(DISTINCT CASE WHEN p.category = 'Home' THEN o.id END) as home_orders, COUNT(DISTINCT CASE WHEN p.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_time, COUNT(DISTINCT cl.id) as claims_filed, COUNT(DISTINCT rt.id) as returns_filed, SUM(o.price) * 1.0 / COUNT(DISTINCT c.id) as revenue_per_customer, COUNT(DISTINCT o.id) * 1.0 / COUNT(DISTINCT c.id) as orders_per_customer, CASE WHEN AVG(HOUR(o.orderdate)) BETWEEN 0 AND 6 THEN 'Night Shoppers' WHEN AVG(HOUR(o.orderdate)) BETWEEN 7 AND 12 THEN 'Morning Shoppers' WHEN AVG(HOUR(o.orderdate)) BETWEEN 13 AND 18 THEN 'Afternoon Shoppers' WHEN AVG(HOUR(o.orderdate)) BETWEEN 19 AND 23 THEN 'Evening Shoppers' END as preferred_shopping_time FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns rt ON c.id = rt.client_id WHERE c.birthday IS NOT NULL GROUP BY CASE WHEN YEAR(c.birthday) BETWEEN 1946 AND 1964 THEN 'Baby Boomers' WHEN YEAR(c.birthday) BETWEEN 1965 AND 1980 THEN 'Generation X' WHEN YEAR(c.birthday) BETWEEN 1981 AND 1996 THEN 'Millennials' WHEN YEAR(c.birthday) BETWEEN 1997 AND 2012 THEN 'Generation Z' ELSE 'Other' END HAVING total_orders >= 10 ORDER BY total_spent DESC; 
 SELECT w.id, w.name as wilaya_name, w.delivery_price, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, COUNT(DISTINCT p.brand) as brands_ordered, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT CASE WHEN o.price < 100 THEN o.id END) as budget_orders, SUM(w.delivery_price) as total_delivery_costs, SUM(o.price) - SUM(w.delivery_price) as net_revenue, SUM(o.price) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered') as revenue_share_percentage, COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(*) FROM clients) as client_share_percentage, RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, RANK() OVER (ORDER BY COUNT(DISTINCT c.id) DESC) as client_rank, RANK() OVER (ORDER BY AVG(o.price) DESC) as avg_order_value_rank, CASE WHEN SUM(o.price) > 100000 THEN 'Tier 1' WHEN SUM(o.price) > 50000 THEN 'Tier 2' WHEN SUM(o.price) > 10000 THEN 'Tier 3' ELSE 'Tier 4' END as revenue_tier FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id GROUP BY w.id, w.name, w.delivery_price HAVING total_orders > 0 ORDER BY total_revenue DESC; 
 SELECT CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 18 AND 25 THEN '18-25' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 26 AND 35 THEN '26-35' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 36 AND 45 THEN '36-45' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 46 AND 55 THEN '46-55' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) > 55 THEN '55+' ELSE 'Unknown' END as age_group, COUNT(DISTINCT c.id) as total_customers, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT cl.id) as claims_filed, COUNT(DISTINCT rt.id) as returns_filed, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_time, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 0 AND 6 THEN o.id END) as night_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 7 AND 12 THEN o.id END) as morning_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 13 AND 18 THEN o.id END) as afternoon_orders, COUNT(DISTINCT CASE WHEN HOUR(o.orderdate) BETWEEN 19 AND 23 THEN o.id END) as evening_orders, COUNT(DISTINCT CASE WHEN p.category = 'Electronics' THEN o.id END) as electronics_orders, COUNT(DISTINCT CASE WHEN p.category = 'Fashion' THEN o.id END) as fashion_orders, COUNT(DISTINCT CASE WHEN p.category = 'Home' THEN o.id END) as home_orders, COUNT(DISTINCT CASE WHEN p.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, SUM(o.price) * 1.0 / COUNT(DISTINCT c.id) as revenue_per_customer, COUNT(DISTINCT o.id) * 1.0 / COUNT(DISTINCT c.id) as orders_per_customer FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns rt ON c.id = rt.client_id LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE c.birthday IS NOT NULL GROUP BY CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 18 AND 25 THEN '18-25' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 26 AND 35 THEN '26-35' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 36 AND 45 THEN '36-45' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 46 AND 55 THEN '46-55' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) > 55 THEN '55+' ELSE 'Unknown' END HAVING total_orders >= 10 ORDER BY CASE age_group WHEN '18-25' THEN 1 WHEN '26-35' THEN 2 WHEN '36-45' THEN 3 WHEN '46-55' THEN 4 WHEN '55+' THEN 5 ELSE 6 END; 
 SELECT DAYNAME(o.orderdate) as day_of_week, DAYOFWEEK(o.orderdate) as day_number, HOUR(o.orderdate) as hour_of_day, COUNT(DISTINCT o.id) as orders_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_ordered, COUNT(DISTINCT p.brand) as brands_ordered, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT CASE WHEN o.price > 1000 THEN o.id END) as premium_orders, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, COUNT(DISTINCT CASE WHEN ofr.id IS NOT NULL THEN o.id END) as offer_orders, COUNT(DISTINCT cl.id) as claims_count, COUNT(DISTINCT rt.id) as returns_count, COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER (PARTITION BY DAYNAME(o.orderdate)) as hour_share_of_day, COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER (PARTITION BY HOUR(o.orderdate)) as day_share_of_hour, RANK() OVER (PARTITION BY DAYNAME(o.orderdate) ORDER BY COUNT(DISTINCT o.id) DESC) as hour_rank_by_day, RANK() OVER (PARTITION BY HOUR(o.orderdate) ORDER BY COUNT(DISTINCT o.id) DESC) as day_rank_by_hour, CASE WHEN COUNT(DISTINCT o.id) >= 20 THEN 'Peak Hour' WHEN COUNT(DISTINCT o.id) >= 10 THEN 'Busy Hour' WHEN COUNT(DISTINCT o.id) >= 5 THEN 'Moderate Hour' WHEN COUNT(DISTINCT o.id) >= 1 THEN 'Quiet Hour' ELSE 'Dead Hour' END as traffic_level FROM orders o LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers ofr ON ca.offer_id = ofr.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate), HOUR(o.orderdate) HAVING orders_count >= 1 ORDER BY day_number, hour_of_day; 
 SELECT 'Overall System Performance' as metric_category, 'Total Customers' as metric_name, COUNT(DISTINCT c.id) as metric_value, NULL as previous_value, NULL as growth_percentage FROM clients c UNION ALL SELECT 'Overall System Performance', 'Total Orders', COUNT(DISTINCT o.id), NULL, NULL FROM orders o WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Total Revenue', SUM(o.price), NULL, NULL FROM orders o WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Average Order Value', AVG(o.price), NULL, NULL FROM orders o WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Total Products', COUNT(DISTINCT p.id), NULL, NULL FROM products p WHERE p.quantity > 0 UNION ALL SELECT 'Overall System Performance', 'Total Categories', COUNT(DISTINCT p.category), NULL, NULL FROM products p UNION ALL SELECT 'Overall System Performance', 'Total Brands', COUNT(DISTINCT p.brand), NULL, NULL FROM products p UNION ALL SELECT 'Overall System Performance', 'Total Wilayas Served', COUNT(DISTINCT w.id), NULL, NULL FROM wilayas w UNION ALL SELECT 'Overall System Performance', 'Average Delivery Time (Days)', AVG(DATEDIFF(o.deliveredDate, o.orderdate)), NULL, NULL FROM orders o WHERE o.status = 'delivered' AND o.deliveredDate IS NOT NULL UNION ALL SELECT 'Overall System Performance', 'Claim Rate', COUNT(DISTINCT cl.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), NULL, NULL FROM orders o LEFT JOIN claims cl ON o.id = cl.order_id WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Return Rate', COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), NULL, NULL FROM orders o LEFT JOIN returns rt ON o.id = rt.order_id WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Customer Satisfaction Score', AVG(r.rating), NULL, NULL FROM rating r UNION ALL SELECT 'Overall System Performance', 'Cart Abandonment Rate', (COUNT(DISTINCT ca.id) - COUNT(DISTINCT o.id)) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), NULL, NULL FROM cart ca LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) UNION ALL SELECT 'Overall System Performance', 'Repeat Customer Rate', COUNT(DISTINCT CASE WHEN order_count >= 2 THEN client_id END) * 100.0 / NULLIF(COUNT(DISTINCT client_id), 0), NULL, NULL FROM ( SELECT o.client_id, COUNT(DISTINCT o.id) as order_count FROM orders o WHERE o.status = 'delivered' GROUP BY o.client_id ) customer_orders UNION ALL SELECT 'Overall System Performance', 'Average Customer Lifetime Value', AVG(total_spent), NULL, NULL FROM ( SELECT o.client_id, SUM(o.price) as total_spent FROM orders o WHERE o.status = 'delivered' GROUP BY o.client_id ) customer_spending UNION ALL SELECT 'Overall System Performance', 'Inventory Turnover Ratio', SUM(sold_quantity) * 1.0 / NULLIF(SUM(current_quantity), 0), NULL, NULL FROM ( SELECT p.id, p.quantity as current_quantity, COUNT(DISTINCT o.id) as sold_quantity FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' GROUP BY p.id, p.quantity ) inventory_analysis UNION ALL SELECT 'Overall System Performance', 'Gross Margin Percentage', (SUM(o.price) - (SUM(o.price) * 0.6)) * 100.0 / NULLIF(SUM(o.price), 0), NULL, NULL FROM orders o WHERE o.status = 'delivered' UNION ALL SELECT 'Overall System Performance', 'Order Fulfillment Rate', COUNT(DISTINCT CASE WHEN o.status = 'delivered' THEN o.id END) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), NULL, NULL FROM orders o UNION ALL SELECT 'Overall System Performance', 'Customer Retention Rate (90 days)', COUNT(DISTINCT CASE WHEN last_order_date >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) THEN client_id END) * 100.0 / NULLIF(COUNT(DISTINCT client_id), 0), NULL, NULL FROM ( SELECT o.client_id, MAX(o.orderdate) as last_order_date FROM orders o WHERE o.status = 'delivered' GROUP BY o.client_id ) customer_last_orders ORDER BY metric_category, CASE metric_name WHEN 'Total Customers' THEN 1 WHEN 'Total Orders' THEN 2 WHEN 'Total Revenue' THEN 3 WHEN 'Average Order Value' THEN 4 WHEN 'Total Products' THEN 5 WHEN 'Total Categories' THEN 6 WHEN 'Total Brands' THEN 7 WHEN 'Total Wilayas Served' THEN 8 WHEN 'Average Delivery Time (Days)' THEN 9 WHEN 'Claim Rate' THEN 10 WHEN 'Return Rate' THEN 11 WHEN 'Customer Satisfaction Score' THEN 12 WHEN 'Cart Abandonment Rate' THEN 13 WHEN 'Repeat Customer Rate' THEN 14 WHEN 'Average Customer Lifetime Value' THEN 15 WHEN 'Inventory Turnover Ratio' THEN 16 WHEN 'Gross Margin Percentage' THEN 17 WHEN 'Order Fulfillment Rate' THEN 18 WHEN 'Customer Retention Rate (90 days)' THEN 19 ELSE 20 END; 
 SELECT p.id, p.name, p.category, COUNT(DISTINCT ca.client_id) as in_carts, COUNT(DISTINCT f.client_id) as favorites, AVG(ra.rating) as avg_rating, COUNT(DISTINCT cm.id) as comment_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating ra ON p.id = ra.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.price > 100 AND p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING COUNT(DISTINCT ca.client_id) > 2 OR COUNT(DISTINCT f.client_id) > 1 ORDER BY avg_rating DESC, favorites DESC, in_carts DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT pr.product_id, p.name, pr.percentage, pr.price as promo_price, COUNT(DISTINCT ca.client_id) as in_carts, COUNT(DISTINCT f.client_id) as in_favorites FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN favorites f ON pr.id = f.promotion_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY pr.id, pr.product_id, p.name, pr.percentage, pr.price HAVING COUNT(DISTINCT ca.client_id) > 0 OR COUNT(DISTINCT f.client_id) > 0 ORDER BY pr.percentage DESC, in_carts DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT a.id, a.username, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id) as products_managed, (SELECT COUNT(*) FROM promotions WHERE admin_id = a.id) as promotions_created, (SELECT COUNT(*) FROM offers WHERE admin_id = a.id) as offers_created FROM admin a ORDER BY (products_managed + promotions_created + offers_created) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, p.brand, AVG(p.price) as original_avg_price, AVG(pr.price) as promo_avg_price, AVG(pr.percentage) as avg_discount, COUNT(DISTINCT pr.id) as promo_count FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 GROUP BY p.category, p.brand HAVING COUNT(DISTINCT pr.id) > 0 ORDER BY p.category, avg_discount DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT c.id, c.firstname, c.lastname, GROUP_CONCAT(DISTINCT p.category ORDER BY p.category) as categories_bought, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT p.id) as unique_products FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') JOIN products p ON ca.product_id = p.id WHERE YEAR(o.orderdate) = 2024 GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 2 ORDER BY unique_categories DESC, unique_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.category, COUNT(DISTINCT ca.client_id) as in_cart_count, COUNT(DISTINCT f.client_id) as favorite_count, RANK() OVER (ORDER BY COUNT(DISTINCT ca.client_id) DESC) as cart_rank, RANK() OVER (ORDER BY COUNT(DISTINCT f.client_id) DESC) as favorite_rank, (RANK() OVER (ORDER BY COUNT(DISTINCT ca.client_id) DESC) + RANK() OVER (ORDER BY COUNT(DISTINCT f.client_id) DESC)) / 2 as combined_rank FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category ORDER BY combined_rank;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT pr.id, p.name, pr.percentage, pr.price as promo_price, p.price as original_price, ROUND((p.price - pr.price) / p.price * 100, 2) as actual_discount, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) as duration_days, COUNT(DISTINCT ca.id) as times_added_to_cart, COUNT(DISTINCT f.id) as times_favorited FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN favorites f ON pr.id = f.promotion_id WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY pr.id, p.name, pr.percentage, pr.price, p.price, pr.startdate, pr.enddate HAVING ROUND((p.price - pr.price) / p.price * 100, 2) > pr.percentage - 5 ORDER BY actual_discount DESC;                                                                                                                                                                                                                                                                                                                         
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT ca.id) as total_cart_items, COUNT(DISTINCT ca.product_id) as unique_products, COUNT(DISTINCT ca.promotion_id) as promotion_items, COUNT(DISTINCT ca.offer_id) as offer_items, SUM(CASE WHEN ca.product_id IS NOT NULL THEN p.price WHEN ca.promotion_id IS NOT NULL THEN pr.price WHEN ca.offer_id IS NOT NULL THEN o.price ELSE 0 END) as cart_total_value, AVG(DATEDIFF(CURDATE(), ca.date_cart)) as avg_days_in_cart FROM clients c LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers o ON ca.offer_id = o.id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY cart_total_value DESC;                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, p.category, p.price, COUNT(DISTINCT ca.client_id) as unique_clients_cart, COUNT(DISTINCT f.client_id) as unique_clients_favorite, COUNT(DISTINCT cm.client_id) as unique_clients_commented, COUNT(DISTINCT ra.client_id) as unique_clients_rated, (COUNT(DISTINCT ca.client_id) * 3 + COUNT(DISTINCT f.client_id) * 5 + COUNT(DISTINCT cm.client_id) * 2 + COUNT(DISTINCT ra.client_id) * 4) as engagement_score FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating ra ON p.id = ra.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price HAVING engagement_score > 0 ORDER BY engagement_score DESC;                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, c.lastname, GROUP_CONCAT(DISTINCT p.category ORDER BY p.category SEPARATOR ', ') as categories_in_cart, COUNT(DISTINCT p.category) as unique_categories, AVG(p.price) as avg_product_price_in_cart, MAX(p.price) as max_product_price_in_cart, MIN(p.price) as min_product_price_in_cart FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT p.category) >= 2 ORDER BY unique_categories DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT DAYNAME(ca.date_cart) as day_of_week, COUNT(DISTINCT ca.client_id) as unique_clients, COUNT(ca.id) as cart_additions, AVG(CASE WHEN ca.product_id IS NOT NULL THEN p.price WHEN ca.promotion_id IS NOT NULL THEN pr.price WHEN ca.offer_id IS NOT NULL THEN o.price END) as avg_item_price, SUM(CASE WHEN ca.product_id IS NOT NULL THEN p.price WHEN ca.promotion_id IS NOT NULL THEN pr.price WHEN ca.offer_id IS NOT NULL THEN o.price END) as total_cart_value FROM cart ca LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers o ON ca.offer_id = o.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DAYNAME(ca.date_cart), DAYOFWEEK(ca.date_cart) ORDER BY DAYOFWEEK(ca.date_cart);                                                                                                                                                                                                                                                                             
 SELECT HOUR(ca.date_cart) as hour_of_day, COUNT(DISTINCT ca.client_id) as unique_clients, COUNT(ca.id) as cart_additions, COUNT(DISTINCT CASE WHEN ca.product_id IS NOT NULL THEN p.category END) as unique_categories, AVG(CASE WHEN ca.product_id IS NOT NULL THEN p.price END) as avg_product_price FROM cart ca LEFT JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) GROUP BY HOUR(ca.date_cart) ORDER BY hour_of_day;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order, MAX(o.orderdate) as last_order, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT w.id) as wilayas_ordered_from FROM clients c JOIN orders o ON c.id = o.client_id JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') JOIN wilayas w ON o.wilaya_id = w.id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING COUNT(DISTINCT o.id) > 2 ORDER BY total_spent DESC LIMIT 50;                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.id, p.name, p.category, p.brand, p.price, COUNT(DISTINCT ca.client_id) as in_cart_count, COUNT(DISTINCT f.client_id) as favorite_count, COUNT(DISTINCT cm.id) as comment_count, AVG(ra.rating) as avg_rating, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as revenue_generated, ROUND(COUNT(DISTINCT o.id) * 100.0 / (SELECT COUNT(*) FROM orders), 2) as market_share_percentage FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating ra ON p.id = ra.product_id LEFT JOIN orders o ON ca.id = o.cart_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price HAVING COUNT(DISTINCT o.id) > 0 ORDER BY revenue_generated DESC LIMIT 100;                                                                                                                                                                                                                                                                    
 SELECT YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, COUNT(DISTINCT o.client_id) as unique_clients, COUNT(o.id) as order_count, SUM(o.price) as revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_sold, COUNT(DISTINCT w.id) as wilayas_served, SUM(w.delivery_price) as delivery_charges, ROUND(AVG(DATEDIFF(o.deliveredDate, o.orderdate)), 2) as avg_delivery_days FROM orders o JOIN wilayas w ON o.wilaya_id = w.id JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') WHERE o.status = 'delivered' GROUP BY YEAR(o.orderdate), MONTH(o.orderdate) ORDER BY year DESC, month DESC;                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT c.id, c.firstname, c.lastname, c.email, c.phone_number, c.wilaya, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_purchase, MAX(o.orderdate) as last_purchase, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, AVG(ra.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as comments_written, COUNT(DISTINCT f.id) as favorites_added FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN rating ra ON c.id = ra.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id GROUP BY c.id, c.firstname, c.lastname, c.email, c.phone_number, c.wilaya HAVING COUNT(DISTINCT o.id) > 0 ORDER BY days_since_last_order, total_spent DESC LIMIT 200;                                                                                                        
 SELECT c.age_group, COUNT(DISTINCT c.id) as clients_in_group, COUNT(DISTINCT o.id) as orders_count, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, AVG(ra.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as comments_written, COUNT(DISTINCT f.id) as favorites_added FROM ( SELECT id, firstname, lastname, CASE WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) < 20 THEN 'Under 20' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 20 AND 30 THEN '20-30' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 31 AND 40 THEN '31-40' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 41 AND 50 THEN '41-50' ELSE 'Over 50' END as age_group FROM clients ) c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN rating ra ON c.id = ra.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id GROUP BY c.age_group ORDER BY FIELD(c.age_group, 'Under 20', '20-30', '31-40', '41-50', 'Over 50'); 
 SELECT p.id, p.name, p.category, COUNT(DISTINCT ca.client_id) as cart_additions, COUNT(DISTINCT f.client_id) as favorite_additions, COUNT(DISTINCT o.id) as successful_orders, COUNT(DISTINCT cl.id) as associated_claims, COUNT(DISTINCT rt.id) as associated_returns, AVG(ra.rating) as customer_satisfaction, COUNT(DISTINCT cm.id) as feedback_count, ROUND((COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.client_id)), 2) as cart_to_order_conversion_rate, ROUND((COUNT(DISTINCT cl.id) * 100.0 / COUNT(DISTINCT o.id)), 2) as claim_rate FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN orders o ON ca.id = o.cart_id AND o.status = 'delivered' LEFT JOIN claims cl ON p.id = cl.product_id LEFT JOIN returns rt ON cl.order_id = rt.order_id LEFT JOIN rating ra ON p.id = ra.product_id LEFT JOIN comments cm ON p.id = cm.product_id GROUP BY p.id, p.name, p.category HAVING COUNT(DISTINCT ca.client_id) > 0 ORDER BY cart_to_order_conversion_rate DESC, customer_satisfaction DESC; 
 SELECT products.*, SUM(description) OVER (PARTITION BY brand) as window_agg, NTILE(4) OVER (ORDER BY price) as window_func FROM products ORDER BY window_agg DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT COUNT(admin_id), more_details FROM products WHERE products.id > 'pending' AND products.image_display < 'pending' GROUP BY images, more_details HAVING VARIANCE(id) <= 64 ORDER BY quantity, more_details DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT COUNT(admin_id) as count_admin_id, STDDEV(category) as stddev_category, AVG(brand) as avg_brand, AVG(admin_id) as avg_admin_id, name FROM products JOIN cart ON products.id = cart.product_id JOIN admin ON admin.id = products.admin_id GROUP BY name ORDER BY stddev_category DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT products.*, MIN(images) OVER (PARTITION BY admin_id) as window_agg, ROW_NUMBER() OVER (ORDER BY quantity) as window_func FROM products ORDER BY window_agg DESC LIMIT 70;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT name, quantity, (SELECT STDDEV(email) FROM admin WHERE admin.username = products.quantity) as sub_value FROM products WHERE products.id IN (SELECT id FROM products WHERE price <= 12);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT MIN(quantity) as min_quantity, SUM(id) as sum_id, image_display FROM products GROUP BY image_display;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT products.*, COUNT(more_details) OVER (PARTITION BY image_display) as window_agg, NTILE(4) OVER (ORDER BY more_details) as window_func FROM products JOIN cart ON products.id = cart.product_id JOIN admin ON admin.id = products.admin_id ORDER BY window_agg DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT more_details, price, (SELECT MAX(return_id) FROM inbox WHERE inbox.text = products.category) as sub_value FROM products WHERE products.id IN (SELECT id FROM products WHERE id != 59);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT category, description, (SELECT SUM(id) FROM wilayas WHERE wilayas.id = products.category) as sub_value FROM products WHERE products.id IN (SELECT id FROM products WHERE description != 37);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT category, admin_id, brand FROM products JOIN admin ON admin.id = products.admin_id WHERE admin.role > 'cancelled' GROUP BY price, quantity ORDER BY admin_id, price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.category, p.brand, p.price, COUNT(DISTINCT ca.client_id) as in_cart_count, COUNT(DISTINCT f.client_id) as favorite_count, COUNT(DISTINCT cm.id) as comment_count, AVG(r.rating) as avg_rating, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as revenue_generated, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT rt.id) as return_count, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.client_id), 2) as conversion_rate FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN orders o ON ca.id = o.cart_id LEFT JOIN claims cl ON p.id = cl.product_id LEFT JOIN returns rt ON cl.order_id = rt.order_id WHERE p.quantity > 0 AND p.price BETWEEN 50 AND 5000 GROUP BY p.id, p.name, p.category, p.brand, p.price HAVING COUNT(DISTINCT ca.client_id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY revenue_generated DESC, avg_rating DESC, conversion_rate DESC LIMIT 100; 
 SELECT w.id, w.name, w.delivery_price, COUNT(DISTINCT c.id) as resident_clients, COUNT(DISTINCT o.client_id) as ordering_clients, COUNT(o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT p.category) as categories_ordered, SUM(w.delivery_price) as total_delivery_income, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT rt.id) as return_count, ROUND(COUNT(DISTINCT cl.id) * 100.0 / COUNT(o.id), 2) as claim_rate, ROUND(COUNT(DISTINCT o.client_id) * 100.0 / COUNT(DISTINCT c.id), 2) as client_conversion_rate FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id GROUP BY w.id, w.name, w.delivery_price HAVING COUNT(o.id) > 0 ORDER BY total_revenue DESC, client_conversion_rate DESC, avg_delivery_days ASC; 
 SELECT YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, DAY(o.orderdate) as day, DAYNAME(o.orderdate) as day_name, COUNT(DISTINCT o.client_id) as unique_clients, COUNT(o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_sold, COUNT(DISTINCT w.id) as wilayas_served, SUM(w.delivery_price) as delivery_charges, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_days, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT rt.id) as return_count, ROUND(COUNT(DISTINCT cl.id) * 100.0 / COUNT(o.id), 2) as daily_claim_rate FROM orders o JOIN wilayas w ON o.wilaya_id = w.id JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id WHERE o.status = 'delivered' AND YEAR(o.orderdate) >= YEAR(CURDATE()) - 2 GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), DAY(o.orderdate), DAYNAME(o.orderdate) HAVING COUNT(o.id) > 0 ORDER BY year DESC, month DESC, day DESC, total_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, c.email, c.phone_number, c.wilaya, c.birthday, TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) as age, CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 20 THEN 'Teen' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 20 AND 30 THEN '20-30' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 31 AND 40 THEN '31-40' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 41 AND 50 THEN '41-50' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 51 AND 60 THEN '51-60' ELSE '60+' END as age_group, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_purchase_date, MAX(o.orderdate) as last_purchase_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT w.id) as wilayas_ordered_to, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as comments_written, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT cl.id) as claims_made, COUNT(DISTINCT rt.id) as returns_made, COUNT(DISTINCT ca.id) as cart_items_added, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_experience, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id), 2) as cart_to_order_rate FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns rt ON c.id = rt.client_id LEFT JOIN cart ca ON c.id = ca.client_id GROUP BY c.id, c.firstname, c.lastname, c.email, c.phone_number, c.wilaya, c.birthday HAVING COUNT(DISTINCT o.id) > 0 ORDER BY total_spent DESC, days_since_last_order ASC LIMIT 200; 
 SELECT DAYOFWEEK(o.orderdate) as day_number, DAYNAME(o.orderdate) as day_name, HOUR(o.orderdate) as hour_of_day, COUNT(DISTINCT o.client_id) as unique_clients, COUNT(o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, COUNT(DISTINCT w.id) as wilayas_served, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_time, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT rt.id) as return_count, ROUND(COUNT(o.id) * 100.0 / (SELECT COUNT(*) FROM orders WHERE YEAR(orderdate) = YEAR(o.orderdate)), 2) as percentage_of_yearly_orders, ROUND(AVG(o.price) / (SELECT AVG(price) FROM orders WHERE YEAR(orderdate) = YEAR(o.orderdate)) * 100, 2) as avg_order_percentage FROM orders o JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id WHERE YEAR(o.orderdate) = YEAR(CURDATE()) - 1 AND o.status = 'delivered' GROUP BY DAYOFWEEK(o.orderdate), DAYNAME(o.orderdate), HOUR(o.orderdate) HAVING COUNT(o.id) > 0 ORDER BY day_number, hour_of_day, total_revenue DESC; 
 SELECT p.brand, COUNT(DISTINCT p.id) as product_count, COUNT(DISTINCT p.category) as categories_covered, AVG(p.price) as avg_price, SUM(p.quantity) as total_stock_value, COUNT(DISTINCT pr.id) as active_promotions, COUNT(DISTINCT ca.client_id) as interested_clients, COUNT(DISTINCT f.client_id) as favoriting_clients, COUNT(DISTINCT o.id) as successful_orders, SUM(o.price) as total_revenue, AVG(r.rating) as brand_rating, COUNT(DISTINCT cm.id) as total_reviews, COUNT(DISTINCT cl.id) as total_claims, COUNT(DISTINCT rt.id) as total_returns, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.client_id), 2) as conversion_rate, ROUND(COUNT(DISTINCT cl.id) * 100.0 / COUNT(DISTINCT o.id), 2) as claim_rate, ROUND(AVG(DATEDIFF(o.deliveredDate, o.orderdate)), 2) as avg_delivery_speed, RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, RANK() OVER (ORDER BY AVG(r.rating) DESC) as rating_rank, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as popularity_rank FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN orders o ON ca.id = o.cart_id AND o.status = 'delivered' LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN claims cl ON p.id = cl.product_id LEFT JOIN returns rt ON cl.order_id = rt.order_id WHERE p.quantity > 0 GROUP BY p.brand HAVING COUNT(DISTINCT p.id) > 0 ORDER BY total_revenue DESC, brand_rating DESC, conversion_rate DESC; 
 SELECT QUARTER(o.orderdate) as quarter, MONTH(o.orderdate) as month, MONTHNAME(o.orderdate) as month_name, COUNT(DISTINCT o.client_id) as new_customers, COUNT(DISTINCT o2.client_id) as returning_customers, COUNT(o.id) as total_orders, SUM(o.price) as quarterly_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT w.id) as wilayas_reached, SUM(w.delivery_price) as delivery_income, COUNT(DISTINCT cl.id) as quarterly_claims, COUNT(DISTINCT rt.id) as quarterly_returns, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_period, ROUND(COUNT(DISTINCT o2.client_id) * 100.0 / COUNT(DISTINCT o.client_id), 2) as customer_retention_rate, ROUND(SUM(o.price) / LAG(SUM(o.price)) OVER (ORDER BY QUARTER(o.orderdate)) * 100 - 100, 2) as revenue_growth_percentage FROM orders o JOIN wilayas w ON o.wilaya_id = w.id JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN orders o2 ON o.client_id = o2.client_id AND QUARTER(o.orderdate) > QUARTER(o2.orderdate) AND YEAR(o.orderdate) = YEAR(o2.orderdate) LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id WHERE YEAR(o.orderdate) = YEAR(CURDATE()) - 1 AND o.status = 'delivered' GROUP BY QUARTER(o.orderdate), MONTH(o.orderdate), MONTHNAME(o.orderdate) HAVING COUNT(o.id) > 0 ORDER BY quarter, month; 
 SELECT quantity, image_display, (SELECT COUNT(promotion_id) FROM favorites WHERE favorites.product_id = products.quantity) as sub_value FROM products WHERE products.id IN (SELECT id FROM products WHERE images NOT LIKE 98);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT c.age_segment, COUNT(DISTINCT c.client_id) as segment_size, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as segment_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as preferred_categories, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as feedback_count, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cl.id) as claims_count, COUNT(DISTINCT rt.id) as returns_count, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as patience_level, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.client_id), 2) as order_frequency, ROUND(SUM(o.price) / COUNT(DISTINCT c.client_id), 2) as revenue_per_customer FROM ( SELECT id as client_id, CASE WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) < 20 THEN 'Under 20' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 20 AND 30 THEN '20-30' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 31 AND 40 THEN '31-40' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 41 AND 50 THEN '41-50' WHEN TIMESTAMPDIFF(YEAR, birthday, CURDATE()) BETWEEN 51 AND 60 THEN '51-60' ELSE '60+' END as age_segment FROM clients ) c LEFT JOIN orders o ON c.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN rating r ON c.client_id = r.client_id LEFT JOIN comments cm ON c.client_id = cm.client_id LEFT JOIN favorites f ON c.client_id = f.client_id LEFT JOIN claims cl ON c.client_id = cl.client_id LEFT JOIN returns rt ON c.client_id = rt.client_id GROUP BY c.age_segment ORDER BY FIELD(c.age_segment, 'Under 20', '20-30', '31-40', '41-50', '51-60', '60+'), segment_revenue DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity, CASE WHEN p.quantity = 0 THEN 'Out of Stock' WHEN p.quantity <= 5 THEN 'Critical' WHEN p.quantity <= 20 THEN 'Low' WHEN p.quantity <= 50 THEN 'Medium' ELSE 'High' END as stock_level, CASE WHEN p.price < 100 THEN 'Budget' WHEN p.price BETWEEN 100 AND 300 THEN 'Economy' WHEN p.price BETWEEN 301 AND 700 THEN 'Standard' WHEN p.price BETWEEN 701 AND 1500 THEN 'Premium' ELSE 'Luxury' END as price_segment, COUNT(DISTINCT ca.client_id) as cart_presence, COUNT(DISTINCT f.client_id) as favorite_status, COUNT(DISTINCT o.id) as order_frequency, SUM(o.price) as revenue_contribution, AVG(r.rating) as customer_satisfaction, COUNT(DISTINCT cm.id) as review_volume, COUNT(DISTINCT cl.id) as issue_count, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.client_id), 2) as conversion_efficiency, ROUND(COUNT(DISTINCT cl.id) * 100.0 / COUNT(DISTINCT o.id), 2) as problem_rate, DENSE_RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, DENSE_RANK() OVER (ORDER BY AVG(r.rating) DESC) as satisfaction_rank, DENSE_RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as popularity_rank FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN orders o ON ca.id = o.cart_id AND o.status = 'delivered' LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN claims cl ON p.id = cl.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING COUNT(DISTINCT o.id) > 0 ORDER BY revenue_contribution DESC, customer_satisfaction DESC, conversion_efficiency DESC LIMIT 150; 
 SELECT w.region_classification, COUNT(DISTINCT w.wilaya_id) as wilayas_in_region, SUM(w.resident_count) as total_residents, SUM(w.ordering_residents) as total_customers, SUM(w.order_count) as regional_orders, SUM(w.total_revenue) as regional_revenue, AVG(w.avg_order_value) as regional_avg_order, AVG(w.avg_delivery_time) as regional_delivery_speed, SUM(w.claim_count) as regional_claims, SUM(w.return_count) as regional_returns, ROUND(SUM(w.ordering_residents) * 100.0 / SUM(w.resident_count), 2) as regional_conversion_rate, ROUND(SUM(w.claim_count) * 100.0 / SUM(w.order_count), 2) as regional_claim_rate, ROUND(SUM(w.total_revenue) / SUM(w.resident_count), 2) as revenue_per_resident FROM ( SELECT w.id as wilaya_id, w.name, w.delivery_price, CASE WHEN w.delivery_price < 200 THEN 'Low Cost' WHEN w.delivery_price BETWEEN 200 AND 400 THEN 'Medium Cost' ELSE 'High Cost' END as region_classification, COUNT(DISTINCT c.id) as resident_count, COUNT(DISTINCT o.client_id) as ordering_residents, COUNT(o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_time, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT rt.id) as return_count FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id AND o.status = 'delivered' LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id GROUP BY w.id, w.name, w.delivery_price ) w GROUP BY w.region_classification ORDER BY regional_revenue DESC, regional_conversion_rate DESC; 
 SELECT a.admin_performance_tier, COUNT(DISTINCT a.admin_id) as admins_in_tier, SUM(a.products_managed) as total_products_managed, SUM(a.promotions_created) as total_promotions, SUM(a.offers_created) as total_offers, SUM(a.orders_processed) as total_orders_handled, SUM(a.claims_resolved) as total_claims_resolved, SUM(a.returns_processed) as total_returns_processed, AVG(a.response_length_avg) as avg_response_quality, AVG(a.delivery_speed_avg) as avg_delivery_speed, AVG(a.customer_satisfaction_avg) as avg_customer_satisfaction, SUM(a.revenue_generated) as total_revenue_contribution, ROUND(SUM(a.claims_resolved) * 100.0 / SUM(a.orders_processed), 2) as problem_resolution_rate, ROUND(SUM(a.revenue_generated) / COUNT(DISTINCT a.admin_id), 2) as revenue_per_admin FROM ( SELECT a.id as admin_id, a.username, a.role, CASE WHEN COUNT(DISTINCT p.id) > 100 THEN 'High Performer' WHEN COUNT(DISTINCT p.id) > 50 THEN 'Medium Performer' ELSE 'Low Performer' END as admin_performance_tier, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as offers_created, COUNT(DISTINCT ord.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_resolved, COUNT(DISTINCT rt.id) as returns_processed, AVG(LENGTH(cl.response)) as response_length_avg, AVG(DATEDIFF(ord.deliveredDate, ord.orderdate)) as delivery_speed_avg, AVG(r.rating) as customer_satisfaction_avg, SUM(ord.price) as revenue_generated FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id LEFT JOIN orders ord ON a.id = ord.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns rt ON a.id = rt.admin_id LEFT JOIN rating r ON ord.client_id = r.client_id GROUP BY a.id, a.username, a.role ) a GROUP BY a.admin_performance_tier ORDER BY total_revenue_contribution DESC, avg_customer_satisfaction DESC; 
 SELECT t.time_period, t.period_name, COUNT(DISTINCT o.client_id) as active_customers, COUNT(o.id) as transaction_count, SUM(o.price) as period_revenue, AVG(o.price) as avg_transaction_value, COUNT(DISTINCT p.category) as categories_touched, COUNT(DISTINCT w.id) as regions_covered, SUM(w.delivery_price) as shipping_costs, COUNT(DISTINCT cl.id) as service_issues, COUNT(DISTINCT rt.id) as return_requests, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as fulfillment_speed, ROUND(COUNT(DISTINCT o2.client_id) * 100.0 / COUNT(DISTINCT o.client_id), 2) as repeat_customer_rate, ROUND(SUM(o.price) / LAG(SUM(o.price)) OVER (ORDER BY t.time_period) * 100 - 100, 2) as revenue_momentum FROM ( SELECT 1 as time_period, 'Morning (6-12)' as period_name, 6 as start_hour, 12 as end_hour UNION ALL SELECT 2, 'Afternoon (12-18)', 12, 18 UNION ALL SELECT 3, 'Evening (18-24)', 18, 24 UNION ALL SELECT 4, 'Night (0-6)', 0, 6 ) t LEFT JOIN orders o ON HOUR(o.orderdate) BETWEEN t.start_hour AND t.end_hour AND YEAR(o.orderdate) = YEAR(CURDATE()) - 1 AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id LEFT JOIN orders o2 ON o.client_id = o2.client_id AND HOUR(o2.orderdate) BETWEEN t.start_hour AND t.end_hour AND o2.id != o.id GROUP BY t.time_period, t.period_name, t.start_hour, t.end_hour ORDER BY t.time_period; 
 SELECT c.customer_loyalty_tier, COUNT(DISTINCT c.client_id) as customers_in_tier, SUM(c.order_count) as total_orders, SUM(c.total_spent) as tier_revenue, AVG(c.avg_order_value) as tier_avg_order, AVG(c.days_since_last_order) as tier_engagement_gap, AVG(c.cart_to_order_rate) as tier_conversion_rate, AVG(c.customer_satisfaction) as tier_satisfaction, SUM(c.claims_made) as tier_issues, SUM(c.returns_made) as tier_returns, AVG(c.delivery_experience) as tier_delivery_quality, COUNT(DISTINCT c2.client_id) as upgraded_customers, ROUND(SUM(c.total_spent) / COUNT(DISTINCT c.client_id), 2) as revenue_per_customer, ROUND(COUNT(DISTINCT c2.client_id) * 100.0 / COUNT(DISTINCT c.client_id), 2) as tier_upgrade_rate FROM ( SELECT c.id as client_id, CASE WHEN COUNT(DISTINCT o.id) >= 10 THEN 'Platinum' WHEN COUNT(DISTINCT o.id) >= 5 THEN 'Gold' WHEN COUNT(DISTINCT o.id) >= 2 THEN 'Silver' ELSE 'Bronze' END as customer_loyalty_tier, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_explored, AVG(r.rating) as customer_satisfaction, COUNT(DISTINCT cl.id) as claims_made, COUNT(DISTINCT rt.id) as returns_made, COUNT(DISTINCT ca.id) as cart_interactions, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as delivery_experience, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id), 2) as cart_to_order_rate FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns rt ON c.id = rt.client_id LEFT JOIN cart ca ON c.id = ca.client_id GROUP BY c.id HAVING COUNT(DISTINCT o.id) > 0 ) c LEFT JOIN ( SELECT client_id, CASE WHEN COUNT(DISTINCT o.id) >= 10 THEN 'Platinum' WHEN COUNT(DISTINCT o.id) >= 5 THEN 'Gold' WHEN COUNT(DISTINCT o.id) >= 2 THEN 'Silver' ELSE 'Bronze' END as next_tier FROM orders o WHERE o.status = 'delivered' GROUP BY client_id ) c2 ON c.client_id = c2.client_id AND FIELD(c.customer_loyalty_tier, 'Bronze', 'Silver', 'Gold', 'Platinum') < FIELD(c2.next_tier, 'Bronze', 'Silver', 'Gold', 'Platinum') GROUP BY c.customer_loyalty_tier ORDER BY FIELD(c.customer_loyalty_tier, 'Platinum', 'Gold', 'Silver', 'Bronze'), tier_revenue DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id = p.id) as cart_appearances, (SELECT COUNT(DISTINCT client_id) FROM cart ca WHERE ca.product_id = p.id) as unique_cart_clients, (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) as favorite_count, (SELECT COUNT(DISTINCT client_id) FROM favorites f WHERE f.product_id = p.id) as unique_favorite_clients, (SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.status = 'delivered') as purchase_count, (SELECT SUM(o.price) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.status = 'delivered') as revenue_generated, (SELECT AVG(rating) FROM rating r WHERE r.product_id = p.id) as customer_rating, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id = p.id) as review_count, (SELECT COUNT(*) FROM claims cl WHERE cl.product_id = p.id) as issue_reports, (SELECT AVG(LENGTH(comment)) FROM comments cm WHERE cm.product_id = p.id) as avg_review_length, (SELECT COUNT(*) FROM returns rt JOIN claims cl ON rt.order_id = cl.order_id WHERE cl.product_id = p.id) as return_count, ROUND((SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.status = 'delivered') * 100.0 / (SELECT COUNT(*) FROM cart ca WHERE ca.product_id = p.id), 2) as conversion_rate, ROUND((SELECT COUNT(*) FROM claims cl WHERE cl.product_id = p.id) * 100.0 / (SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.status = 'delivered'), 2) as problem_rate FROM products p WHERE p.quantity > 0 AND (SELECT COUNT(*) FROM cart ca WHERE ca.product_id = p.id) > 0 ORDER BY revenue_generated DESC, customer_rating DESC, conversion_rate DESC LIMIT 200; 
 SELECT w.id, w.name, w.delivery_price, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id) as resident_count, (SELECT COUNT(DISTINCT client_id) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') as ordering_residents, (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') as order_volume, (SELECT SUM(price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') as regional_revenue, (SELECT AVG(price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') as avg_order_value, (SELECT AVG(DATEDIFF(deliveredDate, orderdate)) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') as avg_delivery_speed, (SELECT COUNT(*) FROM claims cl JOIN orders o ON cl.order_id = o.id WHERE o.wilaya_id = w.id) as claim_count, (SELECT COUNT(*) FROM returns rt JOIN orders o ON rt.order_id = o.id WHERE o.wilaya_id = w.id) as return_count, (SELECT COUNT(DISTINCT p.category) FROM orders o JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') WHERE o.wilaya_id = w.id AND o.status = 'delivered') as categories_ordered, ROUND((SELECT COUNT(DISTINCT client_id) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') * 100.0 / (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id), 2) as market_penetration, ROUND((SELECT COUNT(*) FROM claims cl JOIN orders o ON cl.order_id = o.id WHERE o.wilaya_id = w.id) * 100.0 / (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered'), 2) as regional_claim_rate FROM wilayas w WHERE (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') > 0 ORDER BY regional_revenue DESC, market_penetration DESC, avg_delivery_speed ASC; 
 SELECT a.id, a.username, a.role, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) as products_managed, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) as promotions_created, (SELECT COUNT(*) FROM offers o WHERE o.admin_id = a.id) as offers_created, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') as orders_processed, (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id) as claims_resolved, (SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id) as returns_processed, (SELECT COUNT(*) FROM inbox ib WHERE ib.admin_id = a.id) as messages_sent, (SELECT SUM(price) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') as revenue_contribution, (SELECT AVG(LENGTH(response)) FROM claims cl WHERE cl.admin_id = a.id) as avg_claim_response_quality, (SELECT AVG(DATEDIFF(deliveredDate, orderdate)) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') as avg_processing_speed, (SELECT AVG(rating) FROM rating r JOIN orders o ON r.client_id = o.client_id WHERE o.admin_id = a.id) as customer_satisfaction_score, ROUND((SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id AND cl.response IS NOT NULL) * 100.0 / (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id), 2) as claim_resolution_rate, ROUND((SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') * 100.0 / (SELECT COUNT(*) FROM orders o), 2) as order_handling_share FROM admin a WHERE (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) > 0 OR (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) > 0 OR (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id) > 0 ORDER BY revenue_contribution DESC, products_managed DESC, customer_satisfaction_score DESC; 
 SELECT p.category, (SELECT COUNT(*) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as active_products, (SELECT COUNT(DISTINCT brand) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as unique_brands, (SELECT AVG(price) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as avg_category_price, (SELECT MIN(price) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as min_category_price, (SELECT MAX(price) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as max_category_price, (SELECT SUM(quantity) FROM products p2 WHERE p2.category = p.category) as total_inventory, (SELECT COUNT(*) FROM promotions pr JOIN products p2 ON pr.product_id = p2.id WHERE p2.category = p.category AND CURDATE() BETWEEN pr.startdate AND pr.enddate) as active_promotions, (SELECT COUNT(DISTINCT ca.client_id) FROM cart ca JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category) as interested_clients, (SELECT COUNT(DISTINCT f.client_id) FROM favorites f JOIN products p2 ON f.product_id = p2.id WHERE p2.category = p.category) as favoriting_clients, (SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category AND o.status = 'delivered') as category_sales, (SELECT SUM(o.price) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category AND o.status = 'delivered') as category_revenue, (SELECT AVG(r.rating) FROM rating r JOIN products p2 ON r.product_id = p2.id WHERE p2.category = p.category) as category_rating, (SELECT COUNT(*) FROM comments cm JOIN products p2 ON cm.product_id = p2.id WHERE p2.category = p.category) as category_reviews, (SELECT COUNT(*) FROM claims cl JOIN products p2 ON cl.product_id = p2.id WHERE p2.category = p.category) as category_issues, ROUND((SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category AND o.status = 'delivered') * 100.0 / (SELECT COUNT(DISTINCT ca.client_id) FROM cart ca JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category), 2) as category_conversion_rate, ROUND((SELECT COUNT(*) FROM claims cl JOIN products p2 ON cl.product_id = p2.id WHERE p2.category = p.category) * 100.0 / (SELECT COUNT(*) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category AND o.status = 'delivered'), 2) as category_problem_rate FROM products p WHERE p.quantity > 0 GROUP BY p.category HAVING (SELECT COUNT(*) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) > 0 ORDER BY category_revenue DESC, category_rating DESC, active_products DESC; 
 SELECT orders.*, MAX(order_file) OVER (PARTITION BY claim_id) as window_agg, ROW_NUMBER() OVER (ORDER BY wilaya_id) as window_func FROM orders JOIN admin ON admin.id = orders.admin_id WHERE orders.code > '%pending%' ORDER BY window_agg DESC LIMIT 45;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00') as hour_slot, COUNT(DISTINCT o.client_id) as active_clients_hourly, COUNT(o.id) as orders_per_hour, SUM(o.price) as hourly_revenue, AVG(o.price) as avg_order_per_hour, COUNT(DISTINCT p.category) as categories_per_hour, COUNT(DISTINCT w.id) as wilayas_per_hour, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as delivery_speed_hourly, COUNT(DISTINCT cl.id) as claims_per_hour, COUNT(DISTINCT rt.id) as returns_per_hour, ROUND(COUNT(DISTINCT cl.id) * 100.0 / COUNT(o.id), 2) as claim_rate_hourly, ROUND(COUNT(DISTINCT rt.id) * 100.0 / COUNT(o.id), 2) as return_rate_hourly, SUM(w.delivery_price) as delivery_costs_hourly, ROUND(SUM(o.price) - SUM(w.delivery_price), 2) as net_revenue_hourly, ROUND((SUM(o.price) - SUM(w.delivery_price)) / SUM(o.price) * 100, 2) as margin_percentage_hourly, COUNT(DISTINCT ca.id) as cart_activities_hourly, COUNT(DISTINCT f.id) as favorites_added_hourly, COUNT(DISTINCT cm.id) as comments_posted_hourly, COUNT(DISTINCT r.id) as ratings_given_hourly, AVG(r.rating) as avg_rating_hourly, HOUR(o.orderdate) as hour_of_day, CASE WHEN HOUR(o.orderdate) BETWEEN 0 AND 5 THEN 'Night' WHEN HOUR(o.orderdate) BETWEEN 6 AND 11 THEN 'Morning' WHEN HOUR(o.orderdate) BETWEEN 12 AND 17 THEN 'Afternoon' ELSE 'Evening' END as time_segment, DAYNAME(o.orderdate) as day_name, WEEKDAY(o.orderdate) as weekday_number, CASE WHEN WEEKDAY(o.orderdate) < 5 THEN 'Weekday' ELSE 'Weekend' END as day_type, MONTH(o.orderdate) as month_number, QUARTER(o.orderdate) as quarter_number, YEAR(o.orderdate) as year_number, CONCAT(YEAR(o.orderdate), '-W', WEEK(o.orderdate)) as week_identifier, RANK() OVER (PARTITION BY HOUR(o.orderdate) ORDER BY SUM(o.price) DESC) as revenue_rank_per_hour, DENSE_RANK() OVER (PARTITION BY DAYNAME(o.orderdate) ORDER BY COUNT(o.id) DESC) as volume_rank_per_day, LAG(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00')) as previous_hour_revenue, LEAD(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00')) as next_hour_revenue, ROUND((SUM(o.price) - LAG(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00'))) / LAG(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00')) * 100, 2) as hourly_growth_rate, SUM(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00') ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) as last_24h_revenue, AVG(SUM(o.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00') ROWS BETWEEN 167 PRECEDING AND CURRENT ROW) as last_week_avg_hourly, SUM(COUNT(o.id)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00') ROWS BETWEEN 23 PRECEDING AND CURRENT ROW) as last_24h_orders, PERCENT_RANK() OVER (ORDER BY SUM(o.price)) as revenue_percentile, CUME_DIST() OVER (ORDER BY COUNT(o.id)) as volume_cumulative_dist, NTILE(100) OVER (ORDER BY SUM(o.price) DESC) as revenue_percentile_group, STDDEV(SUM(o.price)) OVER (PARTITION BY HOUR(o.orderdate)) as hour_revenue_stddev, AVG(SUM(o.price)) OVER (PARTITION BY HOUR(o.orderdate)) as avg_hour_revenue, ROUND(SUM(o.price) / AVG(SUM(o.price)) OVER (PARTITION BY HOUR(o.orderdate)) * 100, 2) as vs_hour_avg_percentage FROM orders o JOIN wilayas w ON o.wilaya_id = w.id JOIN products p ON o.cart_id LIKE CONCAT('%', p.id, '%') LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns rt ON o.id = rt.order_id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN favorites f ON ca.product_id = f.product_id LEFT JOIN comments cm ON ca.product_id = cm.product_id LEFT JOIN rating r ON ca.product_id = r.product_id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m-%d %H:00:00'), HOUR(o.orderdate), DAYNAME(o.orderdate), WEEKDAY(o.orderdate), MONTH(o.orderdate), QUARTER(o.orderdate), YEAR(o.orderdate) HAVING COUNT(o.id) > 0 ORDER BY hour_slot DESC LIMIT 1000; 
 SELECT p.id, p.name, COUNT(ca.id) FROM products p JOIN cart ca ON ca.product_id = p.id JOIN clients c ON c.id = ca.client_id WHERE p.price > 500 GROUP BY p.id ORDER BY COUNT(ca.id) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.id, p.name, COUNT(DISTINCT ca.id) AS cart_count, COUNT(DISTINCT f.id) AS fav_count, AVG(r.rating) AS avg_rating, SUM(o.price) AS revenue FROM products p JOIN cart ca       ON ca.product_id = p.id JOIN clients c     ON c.id = ca.client_id JOIN orders o      ON o.client_id = c.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id WHERE p.price > 300 AND o.price > 500 AND YEAR(o.orderdate) >= 2021 GROUP BY p.id, p.name HAVING COUNT(DISTINCT ca.id) > 5 AND AVG(r.rating) < 4 ORDER BY revenue DESC, cart_count DESC, fav_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON ca.client_id = c.id LEFT JOIN promotions p ON ca.promotion_id = p.id WHERE YEAR(o.orderdate) >= 2023 AND o.price > 100 GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT o.id) > 2 AND SUM(o.price) > 500 ORDER BY total_spent DESC, total_orders DESC LIMIT 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.id, p.name, p.category, p.brand, AVG(r.rating) as avg_rating, COUNT(DISTINCT cm.id) as total_comments FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN promotions pr ON p.id = pr.product_id WHERE p.price BETWEEN 100 AND 1000 AND p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand HAVING AVG(r.rating) > 3.5 AND COUNT(DISTINCT cm.id) > 5 ORDER BY avg_rating DESC, total_comments DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, COUNT(DISTINCT ca.id) as times_in_cart, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT f.id) as times_favorited FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON ca.client_id = o.client_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.price > 100 AND p.quantity > 0 GROUP BY p.id, p.name HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY times_ordered DESC, times_in_cart DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.*, (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) as favorite_count, (SELECT AVG(rating) FROM rating r WHERE r.product_id = p.id) as avg_rating, (SELECT COUNT(*) FROM comments c WHERE c.product_id = p.id) as comment_count, (SELECT price FROM promotions pr WHERE pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LIMIT 1) as promo_price FROM products p WHERE p.quantity > 0 ORDER BY favorite_count DESC, avg_rating DESC LIMIT 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.id, p.name, p.category, p.price, COUNT(DISTINCT ca.id) as cart_count, COUNT(DISTINCT f.id) as favorite_count, ROW_NUMBER() OVER (PARTITION BY p.category ORDER BY p.price DESC) as price_rank_in_category, RANK() OVER (ORDER BY COUNT(DISTINCT ca.id) DESC) as cart_popularity_rank, DENSE_RANK() OVER (PARTITION BY p.brand ORDER BY p.price) as price_rank_in_brand FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price, p.brand ORDER BY cart_count DESC, favorite_count DESC LIMIT 150;                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.id, p.name, p.category, CASE WHEN p.price < 100 THEN 'Budget' WHEN p.price BETWEEN 100 AND 500 THEN 'Mid-range' WHEN p.price BETWEEN 501 AND 1000 THEN 'Premium' ELSE 'Luxury' END as price_category, CASE WHEN p.quantity = 0 THEN 'Out of Stock' WHEN p.quantity <= 10 THEN 'Low Stock' WHEN p.quantity <= 50 THEN 'Medium Stock' ELSE 'High Stock' END as stock_status, COUNT(DISTINCT ca.id) as in_cart_count, COUNT(DISTINCT f.id) as favorite_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.price > 0 GROUP BY p.id, p.name, p.category, p.price, p.quantity ORDER BY price_category, stock_status, in_cart_count DESC LIMIT 250;                                                                                                                                                                                                                                                                                                                                          
 SELECT p.id, p.name, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN ca.id END) as cart_last_7_days, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN ca.id END) as cart_last_30_days, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) THEN ca.id END) as cart_last_90_days, COUNT(DISTINCT f.id) as total_favorites, AVG(r.rating) as avg_rating FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY cart_last_7_days DESC, cart_last_30_days DESC LIMIT 200;                                                                                                                                                                                                                                                                                                               
 SELECT DATE_FORMAT(pr.startdate, '%Y-%m') as promotion_month, COUNT(DISTINCT pr.id) as promotions_count, COUNT(DISTINCT p.id) as unique_products, AVG(pr.percentage) as avg_discount, SUM(p.price * pr.percentage / 100) as total_discount_value, COUNT(DISTINCT ca.id) as times_added_to_cart FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id WHERE pr.startdate >= '2023-01-01' GROUP BY DATE_FORMAT(pr.startdate, '%Y-%m') HAVING COUNT(DISTINCT pr.id) > 0 ORDER BY promotion_month DESC LIMIT 24;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, COUNT(DISTINCT ca.id) as times_in_cart, COUNT(DISTINCT o.id) as times_ordered, COUNT(DISTINCT f.id) as times_favorited, AVG(r.rating) as average_rating, COUNT(DISTINCT cm.id) as total_comments, (COUNT(DISTINCT ca.id) * 1.0 + COUNT(DISTINCT f.id) * 0.5 + AVG(r.rating) * 10) as engagement_score FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT f.id) > 0 ORDER BY engagement_score DESC, times_in_cart DESC LIMIT 300;                                                                                                                                                                                 
 SELECT p.id, p.name, COUNT(DISTINCT ca.id) AS cart_count, COUNT(DISTINCT f.id) AS fav_count, COUNT(DISTINCT cm.id) AS comment_count, AVG(r.rating) AS avg_rating, SUM(o.price) AS revenue FROM products p JOIN cart ca ON ca.product_id = p.id JOIN clients c ON c.id = ca.client_id JOIN orders o ON o.client_id = c.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN promotions pr ON pr.id = r.promotion_id WHERE p.price > 300 AND o.price > 600 AND YEAR(o.orderdate) >= 2021 AND (pr.percentage >= 5 OR pr.id IS NULL) GROUP BY p.id, p.name HAVING COUNT(DISTINCT ca.id) > 5 AND AVG(r.rating) < 4 ORDER BY revenue DESC, cart_count DESC, fav_count DESC;                                                                                                                                                                                                                                                                                               
 SELECT w.id, w.name, COUNT(DISTINCT c.id) AS clients_count, COUNT(DISTINCT o.id) AS orders_count, SUM(o.price) AS revenue, AVG(pr.percentage) AS avg_discount FROM wilayas w JOIN orders o      ON o.wilaya_id = w.id JOIN clients c     ON c.id = o.client_id JOIN cart ca       ON ca.client_id = c.id JOIN products p    ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id WHERE o.price > 800 AND p.price > 600 AND MONTH(o.orderdate) IN (1,2,3,4,5,6) GROUP BY w.id, w.name HAVING revenue > 5000 ORDER BY revenue DESC, avg_discount DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT pr.id, pr.percentage, COUNT(DISTINCT ca.id) AS cart_usage, COUNT(DISTINCT o.id) AS orders_count, SUM(o.price) AS revenue, AVG(r.rating) AS avg_rating FROM promotions pr JOIN products p    ON p.id = pr.product_id JOIN cart ca       ON ca.promotion_id = pr.id JOIN clients c     ON c.id = ca.client_id JOIN orders o      ON o.client_id = c.id LEFT JOIN rating r ON r.product_id = p.id WHERE pr.percentage > 15 AND o.price > 500 AND YEAR(o.orderdate) >= 2022 GROUP BY pr.id, pr.percentage HAVING cart_usage > 3 ORDER BY revenue DESC, avg_rating ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.id, c.firstname, w.name, COUNT(DISTINCT o.id) AS total_orders, SUM(o.price) AS total_spent, AVG(p.price) AS avg_price, COUNT(DISTINCT cm.id) AS comments, AVG(r.rating) AS avg_rating FROM clients c JOIN orders o ON o.client_id = c.id JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id WHERE YEAR(o.orderdate) BETWEEN 2018 AND 2025 AND p.price > 300 AND o.price > 600 AND (pr.percentage > 5 OR pr.id IS NULL) GROUP BY c.id, w.name HAVING total_orders > 3 AND total_spent > 2000 ORDER BY total_spent DESC, avg_rating DESC;                                                                                                                                                                                                                                                                                                          
 SELECT p.id, p.name, COUNT(DISTINCT ca.id) AS cart_count, COUNT(DISTINCT f.id) AS favorites, COUNT(DISTINCT cm.id) AS comments, AVG(r.rating) AS avg_rating, SUM(o.price) AS revenue FROM products p JOIN cart ca ON ca.product_id = p.id JOIN clients c ON c.id = ca.client_id JOIN orders o ON o.client_id = c.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN promotions pr ON pr.id = ca.promotion_id LEFT JOIN wilayas w ON w.id = o.wilaya_id WHERE p.price > 200 AND o.price > 500 AND YEAR(o.orderdate) >= 2020 GROUP BY p.id, p.name HAVING cart_count > 5 AND avg_rating < 4 ORDER BY revenue DESC, cart_count DESC;                                                                                                                                                                                                                                                                                                                                 
 SELECT p.category, PERCENTILE_CONT(0.25) WITHIN GROUP (ORDER BY p.price) OVER (PARTITION BY p.category) as q1_price, PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY p.price) OVER (PARTITION BY p.category) as median_price, PERCENTILE_CONT(0.75) WITHIN GROUP (ORDER BY p.price) OVER (PARTITION BY p.category) as q3_price, AVG(p.price) OVER (PARTITION BY p.category) as avg_price, STDDEV(p.price) OVER (PARTITION BY p.category) as price_stddev, COUNT(p.id) OVER (PARTITION BY p.category) as products_in_category FROM products p WHERE p.quantity > 0 GROUP BY p.category, p.price, p.id ORDER BY p.category, p.price LIMIT 500;                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.id, p.name, COUNT(DISTINCT CASE WHEN r.rating = 5 THEN r.id END) as five_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 4 THEN r.id END) as four_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 3 THEN r.id END) as three_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 2 THEN r.id END) as two_star_ratings, COUNT(DISTINCT CASE WHEN r.rating = 1 THEN r.id END) as one_star_ratings, COUNT(DISTINCT r.id) as total_ratings, AVG(r.rating) as average_rating, (COUNT(DISTINCT CASE WHEN r.rating >= 4 THEN r.id END) * 100.0 / NULLIF(COUNT(DISTINCT r.id), 0)) as positive_rating_percentage FROM products p LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.id, p.name HAVING COUNT(DISTINCT r.id) > 0 ORDER BY average_rating DESC, total_ratings DESC LIMIT 200;                                                                                                                                                                                                                                              
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as lifetime_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as unique_categories_purchased, COUNT(DISTINCT f.id) as favorites_count FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id GROUP BY c.id, c.firstname, c.lastname, c.email HAVING COUNT(DISTINCT o.id) > 0 ORDER BY lifetime_value DESC, total_orders DESC LIMIT 500;                                                                                                                                                                                                                                                                           
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, CASE WHEN SUM(o.price) >= 5000 THEN 'Platinum' WHEN SUM(o.price) >= 2000 THEN 'Gold' WHEN SUM(o.price) >= 500 THEN 'Silver' WHEN SUM(o.price) > 0 THEN 'Bronze' ELSE 'New' END as loyalty_tier, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT f.id) as products_favorited, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_purchase FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT o.id) > 0 ORDER BY total_spent DESC, order_count DESC LIMIT 400;                                                                                                                                                                                                                  
 SELECT pr.id, p.name as product_name, pr.price as promo_price, pr.percentage, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) as promotion_duration, COUNT(DISTINCT ca.id) as times_added_with_promo, COUNT(DISTINCT o.id) as orders_with_promo, (p.price - pr.price) * COUNT(DISTINCT o.id) as total_discount_given, AVG(r.rating) as product_rating_during_promo FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN rating r ON p.id = r.product_id AND r.id BETWEEN pr.startdate AND pr.enddate WHERE pr.enddate >= CURDATE() OR pr.startdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY pr.id, p.name, pr.price, pr.percentage, pr.startdate, pr.enddate, p.price ORDER BY pr.startdate DESC, times_added_with_promo DESC LIMIT 200;                                                                                                                                                           
 SELECT p.category, COUNT(DISTINCT pr.id) as total_promotions, AVG(pr.percentage) as avg_discount_percentage, MIN(pr.percentage) as min_discount, MAX(pr.percentage) as max_discount, COUNT(DISTINCT CASE WHEN CURDATE() BETWEEN pr.startdate AND pr.enddate THEN pr.id END) as active_promotions, SUM(CASE WHEN o.id IS NOT NULL THEN o.price ELSE 0 END) as revenue_from_promoted_products, COUNT(DISTINCT ca.id) as cart_additions_during_promotions FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' WHERE p.quantity > 0 GROUP BY p.category HAVING COUNT(DISTINCT pr.id) > 0 ORDER BY total_promotions DESC, avg_discount_percentage DESC LIMIT 50;                                                                                                                                                                                                                                                                 
 SELECT DATE_FORMAT(pr.startdate, '%Y-%m') as month, COUNT(DISTINCT pr.id) as promotions_started, COUNT(DISTINCT p.category) as categories_promoted, AVG(pr.percentage) as avg_discount, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as resulting_orders, SUM(o.price) as revenue_from_promotions FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' WHERE pr.startdate >= '2023-01-01' GROUP BY DATE_FORMAT(pr.startdate, '%Y-%m') ORDER BY month DESC LIMIT 24;                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.id, p.name, COUNT(DISTINCT pr.id) as total_promotions, MIN(pr.percentage) as smallest_discount, MAX(pr.percentage) as largest_discount, AVG(pr.percentage) as avg_discount_percentage, SUM(CASE WHEN CURDATE() BETWEEN pr.startdate AND pr.enddate THEN 1 ELSE 0 END) as currently_promoted, COUNT(DISTINCT ca.id) as total_cart_additions_during_promos, AVG(r.rating) as avg_rating_during_promotions FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN rating r ON p.id = r.product_id AND r.id BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 GROUP BY p.id, p.name HAVING COUNT(DISTINCT pr.id) > 0 ORDER BY total_promotions DESC, avg_discount_percentage DESC LIMIT 150;                                                                                                                                                                                                                                                                                         
 SELECT c.id as client_id, c.firstname, c.lastname, c.email, c.wilaya, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as lifetime_value, COUNT(DISTINCT ca.id) as cart_activities, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT cm.id) as comments_made, COUNT(DISTINCT r.id) as ratings_given, COUNT(DISTINCT cl.id) as claims_filed, COUNT(DISTINCT ret.id) as returns_made, COUNT(DISTINCT i.id) as inbox_messages, AVG(o.price) as avg_order_value, MAX(o.orderdate) as last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, (COUNT(DISTINCT o.id) * 10 + COUNT(DISTINCT f.id) * 2 + COUNT(DISTINCT cm.id) * 3 + COUNT(DISTINCT r.id) * 1 + (SUM(o.price) / 100)) as engagement_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id LEFT JOIN inbox i ON c.id = i.client_id GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya HAVING COUNT(DISTINCT o.id) > 0 ORDER BY engagement_score DESC, lifetime_value DESC LIMIT 500; 
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity, CASE WHEN p.quantity = 0 THEN 'Rupture' WHEN p.quantity < 10 THEN 'Stock critique' WHEN p.quantity < 50 THEN 'Stock faible' ELSE 'Stock suffisant' END AS statut_stock, COUNT(DISTINCT ca.id) AS ajouts_panier_30j, COUNT(DISTINCT o.id) AS ventes_30j, AVG(r.rating) AS note_moyenne, (p.quantity * p.price) AS valeur_stock FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY p.quantity ASC, ajouts_panier_30j DESC LIMIT 200;                                                                                                                                                                                                       
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as month_year, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as monthly_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT c.id) as active_clients, COUNT(DISTINCT w.id) as active_wilayas, COUNT(DISTINCT p.id) as unique_products_sold, COUNT(DISTINCT pr.id) as promotions_active, COUNT(DISTINCT ofr.id) as offers_active, COUNT(DISTINCT cl.id) as claims_filed, COUNT(DISTINCT ret.id) as returns_made, SUM(w.delivery_price) as total_delivery_costs, SUM(o.price) - SUM(w.delivery_price) as net_revenue, (SUM(o.price) - SUM(w.delivery_price)) / NULLIF(COUNT(DISTINCT o.id), 0) as profit_per_order, LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) as prev_month_revenue, ((SUM(o.price) - LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0)) as revenue_growth_pct FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN offers ofr ON ca.offer_id = ofr.id AND CURDATE() BETWEEN ofr.startdate AND ofr.enddate LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns ret ON o.id = ret.order_id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY month_year DESC LIMIT 24; 
 SELECT p.category, SUM(p.quantity) AS total_stock_categorie, COUNT(DISTINCT p.id) AS produits_categorie, AVG(p.price) AS prix_moyen_categorie, SUM(p.quantity * p.price) AS valeur_stock_categorie, COUNT(DISTINCT ca.id) AS ajouts_panier_30j, COUNT(DISTINCT o.id) AS ventes_30j, (COUNT(DISTINCT o.id) * 100.0 / NULLIF(SUM(p.quantity), 0)) AS taux_rotation FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) WHERE p.quantity > 0 GROUP BY p.category HAVING COUNT(DISTINCT p.id) > 2 ORDER BY taux_rotation DESC, valeur_stock_categorie DESC LIMIT 50;                                                                                                                                                                                                                                                                                                                         
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS mois, p.category, SUM(CASE WHEN ca.product_id IS NOT NULL THEN 1 ELSE 0 END) AS quantite_vendue, SUM(o.price) AS chiffre_affaires_categorie, AVG(o.price) AS panier_moyen_categorie, COUNT(DISTINCT c.id) AS clients_uniques_categorie FROM orders o JOIN clients c ON o.client_id = c.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) AND o.status = 'delivered' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING SUM(CASE WHEN ca.product_id IS NOT NULL THEN 1 ELSE 0 END) > 0 ORDER BY mois DESC, chiffre_affaires_categorie DESC LIMIT 200;                                                                                                                                                                                                                                                                                                                                
 SELECT w.id as wilaya_id, w.name as wilaya_name, w.delivery_price, COUNT(DISTINCT c.id) as registered_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) as avg_delivery_time, COUNT(DISTINCT p.category) as unique_categories_ordered, COUNT(DISTINCT pr.id) as promotions_used, COUNT(DISTINCT cl.id) as claims_from_wilaya, COUNT(DISTINCT ret.id) as returns_from_wilaya, SUM(o.price) - (COUNT(DISTINCT o.id) * w.delivery_price) as net_revenue_from_wilaya, RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as order_volume_rank, RANK() OVER (ORDER BY AVG(DATEDIFF(o.deliveredDate, o.orderdate))) as delivery_speed_rank FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns ret ON o.id = ret.order_id GROUP BY w.id, w.name, w.delivery_price HAVING COUNT(DISTINCT o.id) > 0 ORDER BY total_revenue DESC, total_orders DESC LIMIT 58; 
 SELECT p.id, p.name, p.quantity AS stock_actuel, (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS ventes_90j, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS note_moyenne, (SELECT COUNT(DISTINCT id) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS interet_30j, CASE WHEN p.quantity = 0 THEN 0 WHEN (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) = 0 THEN 999 ELSE p.quantity / (SELECT COUNT(DISTINCT o.id) FROM orders o JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') WHERE ca.product_id = p.id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) END AS jours_couverture_stock FROM products p WHERE p.quantity > 0 ORDER BY jours_couverture_stock ASC, stock_actuel ASC LIMIT 300;          
 SELECT p.id, p.name, p.category, COUNT(DISTINCT cm.id) AS total_commentaires, COUNT(DISTINCT r.id) AS total_notes, AVG(r.rating) AS note_moyenne, COUNT(DISTINCT CASE WHEN r.rating = 5 THEN r.id END) AS notes_5_etoiles, COUNT(DISTINCT CASE WHEN r.rating = 4 THEN r.id END) AS notes_4_etoiles, COUNT(DISTINCT CASE WHEN r.rating = 3 THEN r.id END) AS notes_3_etoiles, COUNT(DISTINCT CASE WHEN r.rating = 2 THEN r.id END) AS notes_2_etoiles, COUNT(DISTINCT CASE WHEN r.rating = 1 THEN r.id END) AS notes_1_etoile, MIN(cm.date) AS premier_commentaire, MAX(cm.date) AS dernier_commentaire, COUNT(DISTINCT c.id) AS clients_commentants FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN clients c ON cm.client_id = c.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING COUNT(DISTINCT cm.id) > 0 OR COUNT(DISTINCT r.id) > 0 ORDER BY note_moyenne DESC, total_commentaires DESC LIMIT 250;                                                                        
 SELECT a.id as admin_id, a.username, a.role, CASE a.role WHEN '1' THEN 'Super Admin' WHEN '2' THEN 'Client Service Manager' WHEN '3' THEN 'Marketing Service Manager' ELSE 'Unknown' END as role_name, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT ofr.id) as offers_created, COUNT(DISTINCT o.id) as orders_processed, COUNT(DISTINCT cl.id) as claims_handled, COUNT(DISTINCT ret.id) as returns_processed, COUNT(DISTINCT i.id) as inbox_messages_sent, AVG(DATEDIFF(cl.response, cl.id)) as avg_claim_response_time, AVG(DATEDIFF(ret.response, ret.date)) as avg_return_response_time, (COUNT(DISTINCT p.id) * 5 + COUNT(DISTINCT pr.id) * 3 + COUNT(DISTINCT o.id) * 2 + COUNT(DISTINCT cl.id) * 1 + COUNT(DISTINCT ret.id) * 1) as admin_activity_score FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns ret ON a.id = ret.admin_id LEFT JOIN inbox i ON a.id = i.admin_id GROUP BY a.id, a.username, a.role ORDER BY admin_activity_score DESC, products_managed DESC LIMIT 100; 
 SELECT w.id, w.name AS wilaya, w.delivery_price AS prix_livraison, COUNT(DISTINCT c.id) AS clients_inscrits, COUNT(DISTINCT o.id) AS commandes_traitees, SUM(o.price) AS chiffre_affaires_total, AVG(o.price) AS panier_moyen_wilaya, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS delai_livraison_moyen, COUNT(DISTINCT p.category) AS categories_achetees, COUNT(DISTINCT cl.id) AS reclamations_wilaya, COUNT(DISTINCT ret.id) AS retours_wilaya, (SUM(o.price) - (COUNT(DISTINCT o.id) * w.delivery_price)) AS marge_nette_wilaya, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_revenu, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_volume, RANK() OVER (ORDER BY AVG(DATEDIFF(o.deliveredDate, o.orderdate))) AS rang_delai FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN claims cl ON o.id = cl.order_id LEFT JOIN returns ret ON o.id = ret.order_id GROUP BY w.id, w.name, w.delivery_price HAVING COUNT(DISTINCT o.id) > 0 ORDER BY chiffre_affaires_total DESC, commandes_traitees DESC LIMIT 58; 
 SELECT a.username, p.name AS produit_ger, p.category AS categorie_produit, p.quantity AS stock_actuel, p.price AS prix_produit, COUNT(DISTINCT ca.id) AS ajouts_panier_30j, COUNT(DISTINCT o.id) AS ventes_30j, AVG(r.rating) AS note_moyenne_produit, COUNT(DISTINCT cm.id) AS commentaires_produit, (COUNT(DISTINCT o.id) * p.price) AS chiffre_affaires_30j, RANK() OVER (PARTITION BY a.username ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_produit_par_admin FROM admin a JOIN products p ON a.id = p.admin_id LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY a.username, p.name, p.category, p.quantity, p.price HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY a.username, ventes_30j DESC LIMIT 300;                                          
 SELECT pr.id AS promotion_id, p.name AS produit, pr.price AS prix_promotion, pr.percentage AS pourcentage_reduction, pr.startdate AS debut_promotion, pr.enddate AS fin_promotion, DATEDIFF(pr.enddate, pr.startdate) AS duree_promotion_jours, COUNT(DISTINCT ca.id) AS ajouts_panier_promotion, COUNT(DISTINCT o.id) AS ventes_promotion, SUM(o.price) AS chiffre_affaires_promotion, AVG(o.price) AS panier_moyen_promotion, COUNT(DISTINCT c.id) AS clients_promotion, (COUNT(DISTINCT o.id) * (p.price - pr.price)) AS montant_reduction_total, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_popularite_promotion FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN clients c ON ca.client_id = c.id WHERE pr.enddate >= CURDATE() OR pr.startdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY pr.id, p.name, pr.price, pr.percentage, pr.startdate, pr.enddate, p.price ORDER BY ventes_promotion DESC, chiffre_affaires_promotion DESC LIMIT 200; 
 SELECT DATE_FORMAT(pr.startdate, '%Y-%m') AS mois_lancement, COUNT(DISTINCT pr.id) AS promotions_lancees, COUNT(DISTINCT p.category) AS categories_couvertes, AVG(pr.percentage) AS reduction_moyenne, MIN(pr.percentage) AS reduction_minimale, MAX(pr.percentage) AS reduction_maximale, COUNT(DISTINCT ca.id) AS ajouts_panier_promotions, COUNT(DISTINCT o.id) AS ventes_promotions, SUM(o.price) AS chiffre_affaires_promotions, AVG(DATEDIFF(o.orderdate, pr.startdate)) AS delai_achat_moyen, LAG(COUNT(DISTINCT pr.id), 1) OVER (ORDER BY DATE_FORMAT(pr.startdate, '%Y-%m')) AS promotions_mois_precedent, ((COUNT(DISTINCT pr.id) - LAG(COUNT(DISTINCT pr.id), 1) OVER (ORDER BY DATE_FORMAT(pr.startdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT pr.id), 1) OVER (ORDER BY DATE_FORMAT(pr.startdate, '%Y-%m')), 0)) AS croissance_promotions FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' WHERE pr.startdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(pr.startdate, '%Y-%m') ORDER BY mois_lancement DESC LIMIT 24; 
 SELECT p.category AS categorie, COUNT(DISTINCT pr.id) AS promotions_categorie, AVG(pr.percentage) AS reduction_moyenne_categorie, COUNT(DISTINCT ca.id) AS ajouts_panier_promotion_categorie, COUNT(DISTINCT o.id) AS ventes_promotion_categorie, SUM(o.price) AS chiffre_affaires_promotion_categorie, AVG(p.price - pr.price) AS economie_moyenne_client, (COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT pr.id), 0)) AS taux_conversion_promotion_categorie, RANK() OVER (ORDER BY COUNT(DISTINCT pr.id) DESC) AS rang_promotions_categorie FROM products p JOIN promotions pr ON p.id = pr.product_id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' WHERE p.quantity > 0 GROUP BY p.category HAVING COUNT(DISTINCT pr.id) > 0 ORDER BY promotions_categorie DESC, chiffre_affaires_promotion_categorie DESC LIMIT 50;                                                                                                                                                       
 SELECT ofr.id AS offre_id, ofr.name AS nom_offre, ofr.price AS prix_offre, ofr.startdate AS debut_offre, ofr.enddate AS fin_offre, DATEDIFF(ofr.enddate, ofr.startdate) AS duree_offre_jours, COUNT(DISTINCT ca.id) AS ajouts_panier_offre, COUNT(DISTINCT o.id) AS ventes_offre, SUM(o.price) AS chiffre_affaires_offre, COUNT(DISTINCT c.id) AS clients_offre, AVG(o.price) AS panier_moyen_offre, COUNT(DISTINCT p.id) AS produits_inclus, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_popularite_offre FROM offers ofr LEFT JOIN cart ca ON ofr.id = ca.offer_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN clients c ON ca.client_id = c.id LEFT JOIN products p ON ca.product_id = p.id WHERE ofr.enddate >= CURDATE() OR ofr.startdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY ofr.id, ofr.name, ofr.price, ofr.startdate, ofr.enddate ORDER BY ventes_offre DESC, chiffre_affaires_offre DESC LIMIT 100;                                                                                
 SELECT c.id, c.firstname, c.lastname, c.email, c.wilaya, w.name AS nom_wilaya, c.birthday AS date_naissance, FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) AS age, COUNT(DISTINCT o.id) AS total_commandes, SUM(o.price) AS chiffre_affaires_total, MIN(o.orderdate) AS premiere_commande, MAX(o.orderdate) AS derniere_commande, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS jours_depuis_derniere_commande, AVG(o.price) AS panier_moyen, COUNT(DISTINCT p.category) AS categories_achetees, COUNT(DISTINCT f.id) AS produits_favoris, COUNT(DISTINCT cm.id) AS commentaires_publies, AVG(r.rating) AS note_moyenne_donnee, COUNT(DISTINCT cl.id) AS reclamations_deposees, COUNT(DISTINCT ret.id) AS retours_effectues, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'Prospect' WHEN COUNT(DISTINCT o.id) = 1 THEN 'Nouveau client' WHEN COUNT(DISTINCT o.id) BETWEEN 2 AND 5 THEN 'Client regulier' WHEN COUNT(DISTINCT o.id) BETWEEN 6 AND 10 THEN 'Client fidele' ELSE 'Client VIP' END AS segment_client FROM clients c JOIN wilayas w ON c.wilaya = w.id LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya, w.name, c.birthday ORDER BY chiffre_affaires_total DESC, total_commandes DESC LIMIT 500; 
 SELECT c.wilaya, w.name AS nom_wilaya, FLOOR(AVG(DATEDIFF(CURDATE(), c.birthday) / 365.25)) AS age_moyen_wilaya, COUNT(DISTINCT c.id) AS total_clients_wilaya, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN c.id END) AS clients_actifs_wilaya, COUNT(DISTINCT o.id) AS total_commandes_wilaya, SUM(o.price) AS chiffre_affaires_wilaya, AVG(o.price) AS panier_moyen_wilaya, COUNT(DISTINCT p.category) AS categories_achetees_wilaya, AVG(r.rating) AS satisfaction_moyenne_wilaya, COUNT(DISTINCT cl.id) AS reclamations_wilaya, COUNT(DISTINCT ret.id) AS retours_wilaya, (COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN c.id END) * 100.0 / NULLIF(COUNT(DISTINCT c.id), 0)) AS taux_activation_wilaya, (COUNT(DISTINCT cl.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) AS taux_reclamation_wilaya FROM clients c JOIN wilayas w ON c.wilaya = w.id LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id GROUP BY c.wilaya, w.name HAVING COUNT(DISTINCT c.id) > 0 ORDER BY taux_activation_wilaya DESC, chiffre_affaires_wilaya DESC LIMIT 58; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS mois, FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25 / 10) * 10 AS tranche_age, COUNT(DISTINCT c.id) AS nouveaux_clients_mois, COUNT(DISTINCT o.id) AS commandes_tranche_age_mois, SUM(o.price) AS chiffre_affaires_tranche_age_mois, AVG(o.price) AS panier_moyen_tranche_age_mois, COUNT(DISTINCT p.category) AS categories_achetees_tranche_age, AVG(r.rating) AS satisfaction_tranche_age, RANK() OVER (PARTITION BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY SUM(o.price) DESC) AS rang_tranche_age_mois FROM clients c JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) AND c.birthday IS NOT NULL GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25 / 10) HAVING COUNT(DISTINCT o.id) > 0 ORDER BY mois DESC, chiffre_affaires_tranche_age_mois DESC LIMIT 200; 
 SELECT p.id, p.name AS produit, p.category AS categorie, p.price AS prix_vente, p.quantity AS stock, (p.quantity * p.price) AS valeur_stock, COUNT(DISTINCT ca.id) AS ajouts_panier_30j, COUNT(DISTINCT o.id) AS ventes_30j, SUM(o.price) AS chiffre_affaires_30j, AVG(o.price) AS panier_moyen_30j, AVG(r.rating) AS satisfaction_moyenne, COUNT(DISTINCT cm.id) AS commentaires_30j, COUNT(DISTINCT f.id) AS favoris_30j, (COUNT(DISTINCT o.id) * p.price * 0.3) AS marge_estimee_30j, (COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0)) AS taux_conversion_30j, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_ventes, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_chiffre_affaires, RANK() OVER (ORDER BY (COUNT(DISTINCT o.id) * p.price * 0.3) DESC) AS rang_marge FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id AND cm.date >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN favorites f ON p.id = f.product_id AND f.id >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price, p.quantity HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY marge_estimee_30j DESC, chiffre_affaires_30j DESC LIMIT 300; 
 SELECT p.category AS categorie, COUNT(DISTINCT p.id) AS produits_categorie, SUM(p.quantity) AS stock_total_categorie, SUM(p.quantity * p.price) AS valeur_stock_categorie, COUNT(DISTINCT ca.id) AS ajouts_panier_30j_categorie, COUNT(DISTINCT o.id) AS ventes_30j_categorie, SUM(o.price) AS chiffre_affaires_30j_categorie, AVG(o.price) AS panier_moyen_30j_categorie, AVG(r.rating) AS satisfaction_moyenne_categorie, (COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0)) AS taux_conversion_30j_categorie, (SUM(o.price) * 0.3) AS marge_estimee_30j_categorie, (SUM(o.price) * 0.3 * 12 / NULLIF(SUM(p.quantity * p.price), 0)) AS rotation_stock_annuelle_estimee, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_chiffre_affaires_categorie, RANK() OVER (ORDER BY (SUM(o.price) * 0.3) DESC) AS rang_marge_categorie FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY p.category HAVING COUNT(DISTINCT p.id) > 0 ORDER BY marge_estimee_30j_categorie DESC, chiffre_affaires_30j_categorie DESC LIMIT 50; 
 SELECT CASE WHEN p.price <= 100 THEN 'Economique (<=100)' WHEN p.price <= 500 THEN 'Moyen (101-500)' WHEN p.price <= 1000 THEN 'Premium (501-1000)' ELSE 'Luxe (>1000)' END AS gamme_prix, COUNT(DISTINCT p.id) AS produits_gamme, SUM(p.quantity) AS stock_total_gamme, AVG(p.price) AS prix_moyen_gamme, COUNT(DISTINCT ca.id) AS ajouts_panier_30j_gamme, COUNT(DISTINCT o.id) AS ventes_30j_gamme, SUM(o.price) AS chiffre_affaires_30j_gamme, AVG(o.price) AS panier_moyen_30j_gamme, AVG(r.rating) AS satisfaction_moyenne_gamme, (COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0)) AS taux_conversion_30j_gamme, (SUM(o.price) * CASE WHEN p.price <= 100 THEN 0.2 WHEN p.price <= 500 THEN 0.3 WHEN p.price <= 1000 THEN 0.4 ELSE 0.5 END) AS marge_estimee_30j_gamme, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_chiffre_affaires_gamme, RANK() OVER (ORDER BY (SUM(o.price) * CASE WHEN p.price <= 100 THEN 0.2 WHEN p.price <= 500 THEN 0.3 WHEN p.price <= 1000 THEN 0.4 ELSE 0.5 END) DESC) AS rang_marge_gamme FROM products p LEFT JOIN cart ca ON p.id = ca.product_id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN rating r ON p.id = r.product_id WHERE p.quantity > 0 GROUP BY CASE WHEN p.price <= 100 THEN 'Economique (<=100)' WHEN p.price <= 500 THEN 'Moyen (101-500)' WHEN p.price <= 1000 THEN 'Premium (501-1000)' ELSE 'Luxe (>1000)' END HAVING COUNT(DISTINCT p.id) > 0 ORDER BY marge_estimee_30j_gamme DESC, chiffre_affaires_30j_gamme DESC LIMIT 10; 
 SELECT c.id AS client_id, c.firstname, c.lastname, c.email, c.wilaya, COUNT(DISTINCT o.id) AS total_commandes, SUM(o.price) AS chiffre_affaires_total, AVG(o.price) AS panier_moyen, COUNT(DISTINCT f.id) AS produits_favoris, COUNT(DISTINCT cm.id) AS commentaires_publies, AVG(r.rating) AS note_moyenne_donnee, COUNT(DISTINCT ca.id) AS ajouts_panier, COUNT(DISTINCT cl.id) AS reclamations_deposees, COUNT(DISTINCT ret.id) AS retours_effectues, COUNT(DISTINCT i.id) AS messages_envoyes, COUNT(DISTINCT pr.id) AS promotions_utilisees, COUNT(DISTINCT ofr.id) AS offres_utilisees, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS jours_depuis_derniere_commande, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'Prospect' WHEN COUNT(DISTINCT o.id) = 1 THEN 'Nouveau client' WHEN COUNT(DISTINCT o.id) BETWEEN 2 AND 5 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'Client actif regulier' WHEN COUNT(DISTINCT o.id) BETWEEN 2 AND 5 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'Client regulier inactif' WHEN COUNT(DISTINCT o.id) > 5 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 60 THEN 'Client fidele actif' WHEN COUNT(DISTINCT o.id) > 5 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) > 60 THEN 'Client fidele inactif' ELSE 'Autre' END AS segment_client_complet, (COUNT(DISTINCT o.id) * 10 + COUNT(DISTINCT f.id) * 2 + COUNT(DISTINCT cm.id) * 3 + COUNT(DISTINCT r.id) * 1 + (SUM(o.price) / 100) - COUNT(DISTINCT cl.id) * 5 - COUNT(DISTINCT ret.id) * 8) AS score_engagement_client FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id LEFT JOIN inbox i ON c.id = i.client_id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers ofr ON ca.offer_id = ofr.id GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya ORDER BY score_engagement_client DESC, chiffre_affaires_total DESC LIMIT 500; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS mois, COUNT(DISTINCT o.id) AS total_commandes_mois, SUM(o.price) AS chiffre_affaires_mois, AVG(o.price) AS panier_moyen_mois, COUNT(DISTINCT c.id) AS clients_actifs_mois, COUNT(DISTINCT w.id) AS wilayas_actives_mois, COUNT(DISTINCT p.id) AS produits_vendus_mois, COUNT(DISTINCT p.category) AS categories_vendues_mois, COUNT(DISTINCT pr.id) AS promotions_utilisees_mois, COUNT(DISTINCT ofr.id) AS offres_utilisees_mois, COUNT(DISTINCT f.id) AS favoris_ajoutes_mois, COUNT(DISTINCT cm.id) AS commentaires_publies_mois, COUNT(DISTINCT r.id) AS notes_donnees_mois, COUNT(DISTINCT cl.id) AS reclamations_deposees_mois, COUNT(DISTINCT ret.id) AS retours_effectues_mois, COUNT(DISTINCT i.id) AS messages_envoyes_mois, SUM(w.delivery_price) AS frais_livraison_mois, SUM(o.price) - SUM(w.delivery_price) AS marge_nette_mois, (COUNT(DISTINCT o.id) * 0.5 + COUNT(DISTINCT c.id) * 0.3 + COUNT(DISTINCT p.category) * 0.2 + (SUM(o.price) / 1000) - COUNT(DISTINCT cl.id) * 0.5 - COUNT(DISTINCT ret.id) * 0.8) AS score_performance_mois, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_chiffre_affaires_mois, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_volume_mois FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id LEFT JOIN offers ofr ON ca.offer_id = ofr.id LEFT JOIN favorites f ON p.id = f.product_id AND DATE_FORMAT(f.id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') LEFT JOIN comments cm ON p.id = cm.product_id AND DATE_FORMAT(cm.date, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') LEFT JOIN rating r ON p.id = r.product_id AND DATE_FORMAT(r.id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') LEFT JOIN claims cl ON o.id = cl.order_id AND DATE_FORMAT(cl.id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') LEFT JOIN returns ret ON o.id = ret.order_id AND DATE_FORMAT(ret.date, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') LEFT JOIN inbox i ON c.id = i.client_id AND DATE_FORMAT(i.date, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) AND o.status = 'delivered' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY mois DESC LIMIT 24; 
 SELECT w.name AS wilaya, COUNT(DISTINCT c.id) AS total_clients_wilaya, COUNT(DISTINCT o.id) AS total_commandes_wilaya, SUM(o.price) AS chiffre_affaires_total_wilaya, AVG(o.price) AS panier_moyen_wilaya, COUNT(DISTINCT p.category) AS categories_vendues_wilaya, COUNT(DISTINCT f.id) AS favoris_wilaya, COUNT(DISTINCT cm.id) AS commentaires_wilaya, AVG(r.rating) AS satisfaction_moyenne_wilaya, COUNT(DISTINCT cl.id) AS reclamations_wilaya, COUNT(DISTINCT ret.id) AS retours_wilaya, COUNT(DISTINCT i.id) AS messages_wilaya, w.delivery_price AS frais_livraison_wilaya, SUM(o.price) - (COUNT(DISTINCT o.id) * w.delivery_price) AS marge_nette_wilaya, (COUNT(DISTINCT o.id) * 0.4 + COUNT(DISTINCT c.id) * 0.2 + COUNT(DISTINCT p.category) * 0.1 + (SUM(o.price) / 5000) - COUNT(DISTINCT cl.id) * 0.3 - COUNT(DISTINCT ret.id) * 0.5) AS score_performance_wilaya, RANK() OVER (ORDER BY SUM(o.price) DESC) AS rang_chiffre_affaires_wilaya, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS rang_volume_wilaya, RANK() OVER (ORDER BY AVG(r.rating) DESC) AS rang_satisfaction_wilaya FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id LEFT JOIN inbox i ON c.id = i.client_id GROUP BY w.name, w.delivery_price HAVING COUNT(DISTINCT o.id) > 0 ORDER BY score_performance_wilaya DESC, chiffre_affaires_total_wilaya DESC LIMIT 58; 
 SELECT a.username AS administrateur, a.role, COUNT(DISTINCT p.id) AS produits_geres, COUNT(DISTINCT pr.id) AS promotions_creees, COUNT(DISTINCT ofr.id) AS offres_creees, COUNT(DISTINCT o.id) AS commandes_traitees, COUNT(DISTINCT cl.id) AS reclamations_traitees, COUNT(DISTINCT ret.id) AS retours_traites, COUNT(DISTINCT i.id) AS messages_envoyes, AVG(DATEDIFF(cl.response, cl.id)) AS delai_reponse_reclamations_moyen, AVG(DATEDIFF(ret.response, ret.date)) AS delai_traitement_retours_moyen, COUNT(DISTINCT c.id) AS clients_traites, COUNT(DISTINCT p2.category) AS categories_geres, (COUNT(DISTINCT p.id) * 3 + COUNT(DISTINCT pr.id) * 2 + COUNT(DISTINCT ofr.id) * 2 + COUNT(DISTINCT o.id) * 1 + COUNT(DISTINCT cl.id) * 1 + COUNT(DISTINCT ret.id) * 1 + COUNT(DISTINCT i.id) * 0.5) AS score_productivite_admin, RANK() OVER (ORDER BY (COUNT(DISTINCT p.id) + COUNT(DISTINCT pr.id) + COUNT(DISTINCT ofr.id)) DESC) AS rang_creation, RANK() OVER (ORDER BY (COUNT(DISTINCT o.id) + COUNT(DISTINCT cl.id) + COUNT(DISTINCT ret.id)) DESC) AS rang_traitement FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers ofr ON a.id = ofr.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns ret ON a.id = ret.admin_id LEFT JOIN inbox i ON a.id = i.admin_id LEFT JOIN clients c ON o.client_id = c.id OR cl.client_id = c.id OR ret.client_id = c.id LEFT JOIN products p2 ON p.id = p2.id OR pr.product_id = p2.id GROUP BY a.username, a.role HAVING COUNT(DISTINCT p.id) > 0 OR COUNT(DISTINCT pr.id) > 0 OR COUNT(DISTINCT ofr.id) > 0 OR COUNT(DISTINCT o.id) > 0 OR COUNT(DISTINCT cl.id) > 0 OR COUNT(DISTINCT ret.id) > 0 ORDER BY score_productivite_admin DESC, produits_geres DESC LIMIT 50; 
 SELECT CASE WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 25 THEN '18-24' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 35 THEN '25-34' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 45 THEN '35-44' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 55 THEN '45-54' ELSE '55+' END AS age_group, COUNT(DISTINCT c.id) AS customer_count, COUNT(DISTINCT o.id) AS order_count, SUM(o.price) AS total_revenue, AVG(o.price) AS avg_order_value, COUNT(DISTINCT p.category) AS categories_purchased, AVG(r.rating) AS avg_rating_given, COUNT(DISTINCT f.id) AS favorites_added, COUNT(DISTINCT cm.id) AS comments_posted, COUNT(DISTINCT cl.id) AS claims_filed, COUNT(DISTINCT ret.id) AS returns_made, (COUNT(DISTINCT o.id) * 1.0 / COUNT(DISTINCT c.id)) AS orders_per_customer, (SUM(o.price) / COUNT(DISTINCT c.id)) AS revenue_per_customer, RANK() OVER (ORDER BY SUM(o.price) DESC) AS revenue_rank, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS order_volume_rank FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN comments cm ON c.id = cm.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id WHERE c.birthday IS NOT NULL GROUP BY CASE WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 25 THEN '18-24' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 35 THEN '25-34' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 45 THEN '35-44' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 55 THEN '45-54' ELSE '55+' END HAVING customer_count > 0 ORDER BY total_revenue DESC LIMIT 10; 
 SELECT w.name AS wilaya, w.delivery_price, COUNT(DISTINCT c.id) AS customer_count, COUNT(DISTINCT o.id) AS order_count, SUM(o.price) AS total_revenue, AVG(o.price) AS avg_order_value, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS avg_delivery_time, COUNT(DISTINCT p.category) AS categories_purchased, AVG(r.rating) AS avg_satisfaction, COUNT(DISTINCT cl.id) AS claims_count, COUNT(DISTINCT ret.id) AS returns_count, SUM(o.price) - (COUNT(DISTINCT o.id) * w.delivery_price) AS net_revenue, (COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id)) AS order_rate, (COUNT(DISTINCT cl.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) AS claim_rate, RANK() OVER (ORDER BY SUM(o.price) DESC) AS revenue_rank, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) AS order_volume_rank, RANK() OVER (ORDER BY AVG(DATEDIFF(o.deliveredDate, o.orderdate))) AS delivery_speed_rank FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id GROUP BY w.name, w.delivery_price HAVING order_count > 0 ORDER BY net_revenue DESC, total_revenue DESC LIMIT 58; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS month, COUNT(DISTINCT o.id) AS order_count, SUM(o.price) AS total_revenue, AVG(o.price) AS avg_order_value, COUNT(DISTINCT c.id) AS unique_customers, COUNT(DISTINCT w.id) AS unique_wilayas, SUM(w.delivery_price) AS total_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS net_revenue, (SELECT COUNT(*) FROM promotions pr WHERE DATE_FORMAT(pr.startdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS promotions_active, (SELECT COUNT(*) FROM offers ofr WHERE DATE_FORMAT(ofr.startdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS offers_active, (SELECT COUNT(*) FROM claims cl WHERE DATE_FORMAT(cl.id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS claims_filed, (SELECT COUNT(*) FROM returns ret WHERE DATE_FORMAT(ret.date, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS returns_made, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) AS prev_month_orders, LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) AS prev_month_revenue, ((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0)) AS order_growth_pct, ((SUM(o.price) - LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0)) AS revenue_growth_pct FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 18 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY month DESC LIMIT 18; 
 SELECT 'Weekly Performance' AS metric_type, YEARWEEK(o.orderdate, 3) AS week_number, COUNT(DISTINCT o.id) AS weekly_orders, SUM(o.price) AS weekly_revenue, AVG(o.price) AS weekly_avg_order_value, COUNT(DISTINCT c.id) AS weekly_customers, COUNT(DISTINCT w.id) AS weekly_wilayas, COUNT(DISTINCT p.category) AS weekly_categories, SUM(w.delivery_price) AS weekly_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS weekly_net_revenue, (SELECT COUNT(*) FROM cart WHERE YEARWEEK(date_cart, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_cart_additions, (SELECT COUNT(*) FROM favorites WHERE YEARWEEK(id, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_favorites, (SELECT COUNT(*) FROM comments WHERE YEARWEEK(date, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_comments, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)) AS prev_week_orders, LAG(SUM(o.price), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)) AS prev_week_revenue FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 WEEK) GROUP BY YEARWEEK(o.orderdate, 3) ORDER BY week_number DESC LIMIT 12; 
 SELECT 'Monthly Performance' AS metric_type, DATE_FORMAT(o.orderdate, '%Y-%m') AS month, COUNT(DISTINCT o.id) AS monthly_orders, SUM(o.price) AS monthly_revenue, AVG(o.price) AS monthly_avg_order_value, COUNT(DISTINCT c.id) AS monthly_customers, COUNT(DISTINCT w.id) AS monthly_wilayas, COUNT(DISTINCT p.category) AS monthly_categories, COUNT(DISTINCT p.brand) AS monthly_brands, SUM(w.delivery_price) AS monthly_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS monthly_net_revenue, (SELECT COUNT(*) FROM cart WHERE DATE_FORMAT(date_cart, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_cart_additions, (SELECT COUNT(*) FROM favorites WHERE DATE_FORMAT(id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_favorites, (SELECT COUNT(*) FROM comments WHERE DATE_FORMAT(date, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_comments, (SELECT COUNT(*) FROM rating WHERE DATE_FORMAT(id, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_ratings, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) AS prev_month_orders, LAG(SUM(o.price), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) AS prev_month_revenue, ((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0)) AS order_growth_pct FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY month DESC LIMIT 12; 
 SELECT 'Quarterly Performance' AS metric_type, CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate)) AS quarter, COUNT(DISTINCT o.id) AS quarterly_orders, SUM(o.price) AS quarterly_revenue, AVG(o.price) AS quarterly_avg_order_value, COUNT(DISTINCT c.id) AS quarterly_customers, COUNT(DISTINCT w.id) AS quarterly_wilayas, COUNT(DISTINCT p.category) AS quarterly_categories, COUNT(DISTINCT p.brand) AS quarterly_brands, SUM(w.delivery_price) AS quarterly_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS quarterly_net_revenue, (SELECT COUNT(*) FROM cart WHERE CONCAT(YEAR(date_cart), '-Q', QUARTER(date_cart)) = CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))) AS quarterly_cart_additions, (SELECT COUNT(*) FROM favorites WHERE CONCAT(YEAR(id), '-Q', QUARTER(id)) = CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))) AS quarterly_favorites, (SELECT COUNT(*) FROM comments WHERE CONCAT(YEAR(date), '-Q', QUARTER(date)) = CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))) AS quarterly_comments, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))) AS prev_quarter_orders, LAG(SUM(o.price), 1) OVER (ORDER BY CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))) AS prev_quarter_revenue, ((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate)))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate))), 0)) AS order_growth_pct FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id LEFT JOIN cart ca ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 8 QUARTER) GROUP BY CONCAT(YEAR(o.orderdate), '-Q', QUARTER(o.orderdate)) ORDER BY quarter DESC LIMIT 8; 
 SELECT DATE(o.orderdate) AS transaction_date, COUNT(DISTINCT o.id) AS daily_transactions, SUM(o.price) AS daily_transaction_volume, AVG(o.price) AS avg_transaction_value, COUNT(DISTINCT c.id) AS daily_unique_customers, COUNT(DISTINCT w.id) AS daily_wilayas_served, SUM(w.delivery_price) AS daily_delivery_revenue, (SELECT COUNT(DISTINCT product_id) FROM cart ca JOIN orders o2 ON ca.client_id = o2.client_id WHERE DATE(o2.orderdate) = DATE(o.orderdate)) AS daily_unique_products_sold, (SELECT COUNT(*) FROM cart WHERE DATE(date_cart) = DATE(o.orderdate)) AS daily_cart_activities, (SELECT COUNT(*) FROM favorites WHERE DATE(id) = DATE(o.orderdate)) AS daily_favorites_added, (SELECT COUNT(*) FROM comments WHERE DATE(date) = DATE(o.orderdate)) AS daily_comments_posted, (SELECT COUNT(*) FROM rating WHERE DATE(id) = DATE(o.orderdate)) AS daily_ratings_given, (SELECT COUNT(*) FROM claims WHERE DATE(id) = DATE(o.orderdate)) AS daily_claims_filed, (SELECT COUNT(*) FROM returns WHERE DATE(date) = DATE(o.orderdate)) AS daily_returns_made, SUM(o.price) - SUM(w.delivery_price) AS daily_net_transaction_value, ROUND((COUNT(DISTINCT o.id) * 100.0 / NULLIF((SELECT COUNT(*) FROM cart WHERE DATE(date_cart) = DATE(o.orderdate)), 0)), 2) AS daily_conversion_rate FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.status = 'delivered' GROUP BY DATE(o.orderdate) ORDER BY transaction_date DESC LIMIT 60; 
 SELECT HOUR(o.orderdate) AS transaction_hour, DAYNAME(o.orderdate) AS transaction_day, COUNT(DISTINCT o.id) AS hourly_transactions, SUM(o.price) AS hourly_transaction_volume, AVG(o.price) AS avg_hourly_transaction_value, COUNT(DISTINCT c.id) AS hourly_unique_customers, COUNT(DISTINCT w.id) AS hourly_wilayas_served, (SELECT COUNT(*) FROM cart WHERE HOUR(date_cart) = HOUR(o.orderdate) AND DAYNAME(date_cart) = DAYNAME(o.orderdate)) AS hourly_cart_activities, (SELECT COUNT(*) FROM favorites WHERE HOUR(id) = HOUR(o.orderdate) AND DAYNAME(id) = DAYNAME(o.orderdate)) AS hourly_favorites_added, (SELECT AVG(DATEDIFF(o2.deliveredDate, o2.orderdate)) FROM orders o2 WHERE HOUR(o2.orderdate) = HOUR(o.orderdate) AND DAYNAME(o2.orderdate) = DAYNAME(o.orderdate)) AS avg_hourly_delivery_time, ROUND((COUNT(DISTINCT o.id) * 100.0 / NULLIF((SELECT COUNT(*) FROM cart WHERE HOUR(date_cart) = HOUR(o.orderdate) AND DAYNAME(date_cart) = DAYNAME(o.orderdate)), 0)), 2) AS hourly_conversion_rate, RANK() OVER (ORDER BY SUM(o.price) DESC) AS revenue_rank_by_hour_day FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND o.status = 'delivered' GROUP BY HOUR(o.orderdate), DAYNAME(o.orderdate) ORDER BY FIELD(transaction_day, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'), transaction_hour; 
 SELECT c.id AS customer_id, c.firstname, c.lastname, c.email, c.wilaya, w.name AS wilaya_name, COUNT(DISTINCT o.id) AS total_transactions, SUM(o.price) AS total_transaction_value, AVG(o.price) AS avg_transaction_value, MIN(o.orderdate) AS first_transaction_date, MAX(o.orderdate) AS last_transaction_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_transaction, COUNT(DISTINCT DATE(o.orderdate)) AS unique_transaction_days, COUNT(DISTINCT HOUR(o.orderdate)) AS unique_transaction_hours, COUNT(DISTINCT DAYNAME(o.orderdate)) AS unique_transaction_days_of_week, COUNT(DISTINCT MONTH(o.orderdate)) AS unique_transaction_months, COUNT(DISTINCT w2.id) AS unique_delivery_wilayas, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS total_cart_interactions, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS total_favorites, (SELECT COUNT(*) FROM comments WHERE client_id = c.id) AS total_comments, (SELECT AVG(rating) FROM rating WHERE client_id = c.id) AS avg_rating_given, (SELECT COUNT(*) FROM claims WHERE client_id = c.id) AS total_claims, (SELECT COUNT(*) FROM returns WHERE client_id = c.id) AS total_returns, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 0 ELSE SUM(o.price) / COUNT(DISTINCT o.id) END AS customer_lifetime_value_per_transaction, ROUND((COUNT(DISTINCT o.id) * 100.0 / NULLIF((SELECT COUNT(*) FROM cart WHERE client_id = c.id), 0)), 2) AS personal_conversion_rate FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id LEFT JOIN wilayas w2 ON o.wilaya_id = w2.id GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya, w.name HAVING COUNT(DISTINCT o.id) > 0 ORDER BY total_transaction_value DESC LIMIT 1000; 
 SELECT p.id AS product_id, p.name AS product_name, p.category, p.brand, p.price AS current_price, p.quantity AS current_stock, COUNT(DISTINCT ca.id) AS total_transaction_interactions, COUNT(DISTINCT o.id) AS successful_transactions, SUM(o.price) AS total_transaction_revenue, AVG(o.price) AS avg_transaction_revenue_per_sale, COUNT(DISTINCT c.id) AS unique_transacting_customers, COUNT(DISTINCT DATE(o.orderdate)) AS unique_transaction_days, MIN(o.orderdate) AS first_transaction_date, MAX(o.orderdate) AS last_transaction_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_transaction, COUNT(DISTINCT w.id) AS unique_transaction_wilayas, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorite_interactions, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comment_interactions, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS avg_rating_from_transactions, (SELECT COUNT(*) FROM claims WHERE product_id = p.id) AS total_claim_transactions, (SELECT COUNT(*) FROM returns WHERE product_id = p.id) AS total_return_transactions, ROUND((COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0)), 2) AS transaction_conversion_rate, ROUND((SELECT COUNT(*) FROM claims WHERE product_id = p.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), 2) AS transaction_claim_rate FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.status = 'delivered' LEFT JOIN clients c ON o.client_id = c.id LEFT JOIN wilayas w ON o.wilaya_id = w.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY total_transaction_revenue DESC, successful_transactions DESC LIMIT 500; 
 SELECT age_group, COUNT(*) AS client_count, AVG(purchase_count) AS avg_purchases_per_client, AVG(total_purchases) AS avg_spending_per_client, AVG(avg_purchase_value) AS avg_purchase_value, AVG(cart_interactions) AS avg_cart_interactions, AVG(favorite_interactions) AS avg_favorite_interactions, AVG(comment_interactions) AS avg_comment_interactions, AVG(rating_interactions) AS avg_rating_interactions, AVG(avg_rating_given) AS avg_rating_score, AVG(claim_interactions) AS avg_claim_interactions, AVG(return_interactions) AS avg_return_interactions, AVG(message_interactions) AS avg_message_interactions, AVG(days_since_last_purchase) AS avg_days_since_last_purchase, AVG(unique_categories_purchased) AS avg_unique_categories, AVG(unique_brands_purchased) AS avg_unique_brands, AVG(purchase_days_variety) AS avg_purchase_days_variety, AVG(purchase_hours_variety) AS avg_purchase_hours_variety, SUM(total_purchases) AS total_spending_age_group, SUM(purchase_count) AS total_purchases_age_group, ROUND(SUM(total_purchases) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered'), 2) AS spending_share_percentage, ROUND(AVG(engagement_score), 2) AS avg_engagement_score FROM ( SELECT c.id, CASE WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 25 THEN '18-24' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 35 THEN '25-34' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 45 THEN '35-44' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 55 THEN '45-54' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 65 THEN '55-64' ELSE '65+' END AS age_group, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') AS purchase_count, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS total_purchases, (SELECT AVG(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS avg_purchase_value, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS cart_interactions, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS favorite_interactions, (SELECT COUNT(*) FROM comments WHERE client_id = c.id) AS comment_interactions, (SELECT COUNT(*) FROM rating WHERE client_id = c.id) AS rating_interactions, (SELECT AVG(rating) FROM rating WHERE client_id = c.id) AS avg_rating_given, (SELECT COUNT(*) FROM claims WHERE client_id = c.id) AS claim_interactions, (SELECT COUNT(*) FROM returns WHERE client_id = c.id) AS return_interactions, (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) AS message_interactions, DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) AS days_since_last_purchase, (SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_categories_purchased, (SELECT COUNT(DISTINCT brand) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_brands_purchased, (SELECT COUNT(DISTINCT DAYNAME(orderdate)) FROM orders WHERE client_id = c.id) AS purchase_days_variety, (SELECT COUNT(DISTINCT HOUR(orderdate)) FROM orders WHERE client_id = c.id) AS purchase_hours_variety, ROUND(((SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') * 0.3 + ((SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') / 1000) * 0.2 + ((SELECT COUNT(*) FROM cart WHERE client_id = c.id) * 0.1) + ((SELECT COUNT(*) FROM favorites WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM comments WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM rating WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') * 0.1) + (CASE WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 30 THEN 0.15 ELSE 0 END)), 2) AS engagement_score FROM clients c WHERE c.birthday IS NOT NULL ) AS client_behavior GROUP BY age_group ORDER BY total_spending_age_group DESC; 
 SELECT purchase_frequency_segment, COUNT(*) AS client_count, AVG(total_purchases) AS avg_spending_per_client, AVG(purchase_count) AS avg_purchases_per_client, AVG(avg_purchase_value) AS avg_purchase_value, AVG(days_since_last_purchase) AS avg_days_since_last_purchase, AVG(unique_categories_purchased) AS avg_unique_categories, AVG(unique_brands_purchased) AS avg_unique_brands, SUM(total_purchases) AS segment_total_spending, SUM(purchase_count) AS segment_total_purchases, ROUND(AVG(engagement_score), 2) AS avg_engagement_score, ROUND(SUM(total_purchases) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered'), 2) AS spending_share_percentage, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients), 2) AS client_share_percentage FROM ( SELECT c.id, CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) = 0 THEN 'Non-Purchaser' WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) = 1 THEN 'One-Time Buyer' WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) BETWEEN 2 AND 5 THEN 'Occasional Buyer' WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) BETWEEN 6 AND 10 THEN 'Regular Buyer' WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) BETWEEN 11 AND 20 THEN 'Frequent Buyer' ELSE 'Loyal Buyer' END AS purchase_frequency_segment, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') AS purchase_count, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS total_purchases, (SELECT AVG(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS avg_purchase_value, DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) AS days_since_last_purchase, (SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_categories_purchased, (SELECT COUNT(DISTINCT brand) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_brands_purchased, ROUND(((SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') * 0.3 + ((SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') / 1000) * 0.2 + ((SELECT COUNT(*) FROM cart WHERE client_id = c.id) * 0.1) + ((SELECT COUNT(*) FROM favorites WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM comments WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM rating WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') * 0.1) + (CASE WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 30 THEN 0.15 ELSE 0 END)), 2) AS engagement_score FROM clients c ) AS frequency_segments GROUP BY purchase_frequency_segment ORDER BY CASE WHEN purchase_frequency_segment = 'Loyal Buyer' THEN 1 WHEN purchase_frequency_segment = 'Frequent Buyer' THEN 2 WHEN purchase_frequency_segment = 'Regular Buyer' THEN 3 WHEN purchase_frequency_segment = 'Occasional Buyer' THEN 4 WHEN purchase_frequency_segment = 'One-Time Buyer' THEN 5 WHEN purchase_frequency_segment = 'Non-Purchaser' THEN 6 ELSE 7 END; 
 SELECT recency_segment, COUNT(*) AS client_count, AVG(total_purchases) AS avg_spending_per_client, AVG(purchase_count) AS avg_purchases_per_client, AVG(days_since_last_purchase) AS avg_days_since_last_purchase, AVG(unique_categories_purchased) AS avg_unique_categories, AVG(unique_brands_purchased) AS avg_unique_brands, SUM(total_purchases) AS segment_total_spending, SUM(purchase_count) AS segment_total_purchases, ROUND(AVG(engagement_score), 2) AS avg_engagement_score, ROUND(SUM(total_purchases) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered'), 2) AS spending_share_percentage, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients), 2) AS client_share_percentage FROM ( SELECT c.id, CASE WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 7 THEN 'Active (7 days)' WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 30 THEN 'Recent (30 days)' WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 90 THEN 'Semi-Active (90 days)' WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 180 THEN 'Inactive (180 days)' WHEN (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id) IS NULL THEN 'Never Purchased' ELSE 'Dormant' END AS recency_segment, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') AS purchase_count, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS total_purchases, DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) AS days_since_last_purchase, (SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_categories_purchased, (SELECT COUNT(DISTINCT brand) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_brands_purchased, ROUND(((SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') * 0.3 + ((SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') / 1000) * 0.2 + ((SELECT COUNT(*) FROM cart WHERE client_id = c.id) * 0.1) + ((SELECT COUNT(*) FROM favorites WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM comments WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM rating WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') * 0.1) + (CASE WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 30 THEN 0.15 ELSE 0 END)), 2) AS engagement_score FROM clients c ) AS recency_segments GROUP BY recency_segment ORDER BY CASE WHEN recency_segment = 'Active (7 days)' THEN 1 WHEN recency_segment = 'Recent (30 days)' THEN 2 WHEN recency_segment = 'Semi-Active (90 days)' THEN 3 WHEN recency_segment = 'Inactive (180 days)' THEN 4 WHEN recency_segment = 'Dormant' THEN 5 WHEN recency_segment = 'Never Purchased' THEN 6 ELSE 7 END; 
 SELECT spending_segment, COUNT(*) AS client_count, AVG(total_purchases) AS avg_spending_per_client, AVG(purchase_count) AS avg_purchases_per_client, AVG(avg_purchase_value) AS avg_purchase_value, AVG(days_since_last_purchase) AS avg_days_since_last_purchase, AVG(unique_categories_purchased) AS avg_unique_categories, AVG(unique_brands_purchased) AS avg_unique_brands, SUM(total_purchases) AS segment_total_spending, SUM(purchase_count) AS segment_total_purchases, ROUND(AVG(engagement_score), 2) AS avg_engagement_score, ROUND(SUM(total_purchases) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered'), 2) AS spending_share_percentage, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients), 2) AS client_share_percentage FROM ( SELECT c.id, CASE WHEN (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') <= 1000 THEN 'Low Spender' WHEN (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') <= 5000 THEN 'Medium Spender' WHEN (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') <= 10000 THEN 'High Spender' WHEN (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') <= 25000 THEN 'Premium Spender' ELSE 'Elite Spender' END AS spending_segment, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') AS purchase_count, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS total_purchases, (SELECT AVG(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS avg_purchase_value, DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) AS days_since_last_purchase, (SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_categories_purchased, (SELECT COUNT(DISTINCT brand) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') AS unique_brands_purchased, ROUND(((SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') * 0.3 + ((SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') / 1000) * 0.2 + ((SELECT COUNT(*) FROM cart WHERE client_id = c.id) * 0.1) + ((SELECT COUNT(*) FROM favorites WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM comments WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(*) FROM rating WHERE client_id = c.id) * 0.05) + ((SELECT COUNT(DISTINCT category) FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON ca.client_id = o.client_id WHERE o.client_id = c.id AND o.status = 'delivered') * 0.1) + (CASE WHEN DATEDIFF(CURDATE(), (SELECT MAX(orderdate) FROM orders WHERE client_id = c.id)) <= 30 THEN 0.15 ELSE 0 END)), 2) AS engagement_score FROM clients c ) AS spending_segments GROUP BY spending_segment ORDER BY CASE WHEN spending_segment = 'Elite Spender' THEN 1 WHEN spending_segment = 'Premium Spender' THEN 2 WHEN spending_segment = 'High Spender' THEN 3 WHEN spending_segment = 'Medium Spender' THEN 4 WHEN spending_segment = 'Low Spender' THEN 5 ELSE 6 END; 
 SELECT 'Client Journey Stages' AS analysis_type, CASE WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Cart Only' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions = 1 THEN 'One-Time Buyer' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions BETWEEN 2 AND 5 THEN 'Repeat Buyer' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions > 5 THEN 'Loyal Buyer' WHEN first_favorite_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Favorites Only' WHEN first_comment_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Comments Only' WHEN first_rating_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Ratings Only' WHEN first_cart_interaction IS NULL AND first_order_interaction IS NOT NULL THEN 'Direct Buyer' ELSE 'Mixed Interactions' END AS journey_stage, COUNT(*) AS client_count, AVG(total_cart_interactions) AS avg_cart_interactions, AVG(total_favorite_interactions) AS avg_favorite_interactions, AVG(total_comment_interactions) AS avg_comment_interactions, AVG(total_rating_interactions) AS avg_rating_interactions, AVG(total_order_interactions) AS avg_order_interactions, AVG(total_claim_interactions) AS avg_claim_interactions, AVG(total_return_interactions) AS avg_return_interactions, AVG(total_message_interactions) AS avg_message_interactions, AVG(days_to_first_conversion) AS avg_days_to_first_conversion, AVG(cart_to_order_conversion_rate) AS avg_cart_to_order_conversion, AVG(favorite_to_order_conversion_rate) AS avg_favorite_to_order_conversion, AVG(comment_to_order_conversion_rate) AS avg_comment_to_order_conversion, AVG(rating_to_order_conversion_rate) AS avg_rating_to_order_conversion, SUM(total_order_interactions) AS stage_total_orders, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients), 2) AS client_percentage FROM ( SELECT c.id, (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id) AS first_cart_interaction, (SELECT MIN(orderdate) FROM orders WHERE client_id = c.id) AS first_order_interaction, (SELECT MIN(id) FROM favorites WHERE client_id = c.id) AS first_favorite_interaction, (SELECT MIN(date) FROM comments WHERE client_id = c.id) AS first_comment_interaction, (SELECT MIN(id) FROM rating WHERE client_id = c.id) AS first_rating_interaction, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS total_cart_interactions, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS total_favorite_interactions, (SELECT COUNT(*) FROM comments WHERE client_id = c.id) AS total_comment_interactions, (SELECT COUNT(*) FROM rating WHERE client_id = c.id) AS total_rating_interactions, (SELECT COUNT(*) FROM orders WHERE client_id = c.id) AS total_order_interactions, (SELECT COUNT(*) FROM claims WHERE client_id = c.id) AS total_claim_interactions, (SELECT COUNT(*) FROM returns WHERE client_id = c.id) AS total_return_interactions, (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) AS total_message_interactions, CASE WHEN (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id) IS NOT NULL AND (SELECT MIN(orderdate) FROM orders WHERE client_id = c.id) IS NOT NULL THEN DATEDIFF((SELECT MIN(orderdate) FROM orders WHERE client_id = c.id), (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id)) ELSE NULL END AS days_to_first_conversion, CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM cart WHERE client_id = c.id), 2) ELSE 0 END AS cart_to_order_conversion_rate, CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM favorites WHERE client_id = c.id), 2) ELSE 0 END AS favorite_to_order_conversion_rate, CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM comments WHERE client_id = c.id), 2) ELSE 0 END AS comment_to_order_conversion_rate, CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM rating WHERE client_id = c.id), 2) ELSE 0 END AS rating_to_order_conversion_rate FROM clients c ) AS journey_data GROUP BY CASE WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Cart Only' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions = 1 THEN 'One-Time Buyer' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions BETWEEN 2 AND 5 THEN 'Repeat Buyer' WHEN first_cart_interaction IS NOT NULL AND first_order_interaction IS NOT NULL AND total_order_interactions > 5 THEN 'Loyal Buyer' WHEN first_favorite_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Favorites Only' WHEN first_comment_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Comments Only' WHEN first_rating_interaction IS NOT NULL AND first_order_interaction IS NULL THEN 'Ratings Only' WHEN first_cart_interaction IS NULL AND first_order_interaction IS NOT NULL THEN 'Direct Buyer' ELSE 'Mixed Interactions' END ORDER BY client_count DESC; 
 SELECT 'Time-Based Journey Analysis' AS analysis_type, CASE WHEN days_to_first_conversion <= 1 THEN 'Same Day' WHEN days_to_first_conversion <= 3 THEN '1-3 Days' WHEN days_to_first_conversion <= 7 THEN '4-7 Days' WHEN days_to_first_conversion <= 14 THEN '8-14 Days' WHEN days_to_first_conversion <= 30 THEN '15-30 Days' WHEN days_to_first_conversion <= 90 THEN '31-90 Days' WHEN days_to_first_conversion > 90 THEN '90+ Days' ELSE 'No Conversion' END AS time_to_conversion_bucket, COUNT(*) AS client_count, AVG(days_to_first_conversion) AS avg_days_to_conversion, MIN(days_to_first_conversion) AS min_days_to_conversion, MAX(days_to_first_conversion) AS max_days_to_conversion, AVG(total_cart_interactions) AS avg_cart_interactions, AVG(total_favorite_interactions) AS avg_favorite_interactions, AVG(total_order_interactions) AS avg_order_interactions, AVG(cart_to_order_conversion_rate) AS avg_conversion_rate, SUM(total_order_interactions) AS total_orders_in_bucket, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients WHERE days_to_first_conversion IS NOT NULL), 2) AS percentage_of_converting_clients FROM ( SELECT c.id, CASE WHEN (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id) IS NOT NULL AND (SELECT MIN(orderdate) FROM orders WHERE client_id = c.id) IS NOT NULL THEN DATEDIFF((SELECT MIN(orderdate) FROM orders WHERE client_id = c.id), (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id)) ELSE NULL END AS days_to_first_conversion, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS total_cart_interactions, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS total_favorite_interactions, (SELECT COUNT(*) FROM orders WHERE client_id = c.id) AS total_order_interactions, CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM cart WHERE client_id = c.id), 2) ELSE 0 END AS cart_to_order_conversion_rate FROM clients c WHERE (SELECT MIN(date_cart) FROM cart WHERE client_id = c.id) IS NOT NULL AND (SELECT MIN(orderdate) FROM orders WHERE client_id = c.id) IS NOT NULL ) AS conversion_data WHERE days_to_first_conversion IS NOT NULL GROUP BY CASE WHEN days_to_first_conversion <= 1 THEN 'Same Day' WHEN days_to_first_conversion <= 3 THEN '1-3 Days' WHEN days_to_first_conversion <= 7 THEN '4-7 Days' WHEN days_to_first_conversion <= 14 THEN '8-14 Days' WHEN days_to_first_conversion <= 30 THEN '15-30 Days' WHEN days_to_first_conversion <= 90 THEN '31-90 Days' WHEN days_to_first_conversion > 90 THEN '90+ Days' ELSE 'No Conversion' END ORDER BY CASE WHEN time_to_conversion_bucket = 'Same Day' THEN 1 WHEN time_to_conversion_bucket = '1-3 Days' THEN 2 WHEN time_to_conversion_bucket = '4-7 Days' THEN 3 WHEN time_to_conversion_bucket = '8-14 Days' THEN 4 WHEN time_to_conversion_bucket = '15-30 Days' THEN 5 WHEN time_to_conversion_bucket = '31-90 Days' THEN 6 WHEN time_to_conversion_bucket = '90+ Days' THEN 7 ELSE 8 END; 
 SELECT 'Multi-Channel Journey Analysis' AS analysis_type, channel_count_bucket, COUNT(*) AS client_count, AVG(total_interactions) AS avg_total_interactions, AVG(total_order_interactions) AS avg_orders_per_client, AVG(total_spent) AS avg_spent_per_client, AVG(cart_to_order_conversion_rate) AS avg_conversion_rate, SUM(total_order_interactions) AS total_orders, SUM(total_spent) AS total_spent_in_bucket, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM clients), 2) AS client_percentage FROM ( SELECT c.id, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS cart_count, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS favorite_count, (SELECT COUNT(*) FROM comments WHERE client_id = c.id) AS comment_count, (SELECT COUNT(*) FROM rating WHERE client_id = c.id) AS rating_count, (SELECT COUNT(*) FROM orders WHERE client_id = c.id) AS order_count, (SELECT COUNT(*) FROM claims WHERE client_id = c.id) AS claim_count, (SELECT COUNT(*) FROM returns WHERE client_id = c.id) AS return_count, (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) AS message_count, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) + (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) + (SELECT COUNT(*) FROM comments WHERE client_id = c.id) + (SELECT COUNT(*) FROM rating WHERE client_id = c.id) + (SELECT COUNT(*) FROM orders WHERE client_id = c.id) + (SELECT COUNT(*) FROM claims WHERE client_id = c.id) + (SELECT COUNT(*) FROM returns WHERE client_id = c.id) + (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) AS total_interactions, (SELECT COUNT(*) FROM orders WHERE client_id = c.id) AS total_order_interactions, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND status = 'delivered') AS total_spent, CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 AND (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN ROUND((SELECT COUNT(*) FROM orders WHERE client_id = c.id) * 100.0 / (SELECT COUNT(*) FROM cart WHERE client_id = c.id), 2) ELSE 0 END AS cart_to_order_conversion_rate, CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM claims WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM returns WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END AS channel_count, CASE WHEN CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM claims WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM returns WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END = 1 THEN '1 Channel' WHEN CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM claims WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM returns WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END = 2 THEN '2 Channels' WHEN CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM claims WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM returns WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END = 3 THEN '3 Channels' WHEN CASE WHEN (SELECT COUNT(*) FROM cart WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM comments WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM rating WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM orders WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM claims WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM returns WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END + CASE WHEN (SELECT COUNT(*) FROM inbox WHERE client_id = c.id) > 0 THEN 1 ELSE 0 END >= 4 THEN '4+ Channels' ELSE 'No Channels' END AS channel_count_bucket FROM clients c ) AS multi_channel_data GROUP BY channel_count_bucket ORDER BY CASE WHEN channel_count_bucket = '1 Channel' THEN 1 WHEN channel_count_bucket = '2 Channels' THEN 2 WHEN channel_count_bucket = '3 Channels' THEN 3 WHEN channel_count_bucket = '4+ Channels' THEN 4 ELSE 5 END; 
 SELECT 'Operational Performance Overview' AS analysis_type, DATE(o.orderdate) AS operation_date, COUNT(DISTINCT o.id) AS daily_orders, SUM(o.price) AS daily_revenue, AVG(o.price) AS avg_order_value, COUNT(DISTINCT c.id) AS daily_customers, COUNT(DISTINCT w.id) AS daily_wilayas, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS avg_delivery_time_days, SUM(w.delivery_price) AS daily_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS daily_net_revenue, (SELECT COUNT(*) FROM cart WHERE DATE(date_cart) = DATE(o.orderdate)) AS daily_cart_activities, (SELECT COUNT(*) FROM claims WHERE DATE(id) = DATE(o.orderdate)) AS daily_claims, (SELECT COUNT(*) FROM returns WHERE DATE(date) = DATE(o.orderdate)) AS daily_returns, (SELECT COUNT(*) FROM inbox WHERE DATE(date) = DATE(o.orderdate)) AS daily_messages, (SELECT COUNT(*) FROM comments WHERE DATE(date) = DATE(o.orderdate)) AS daily_comments, (SELECT COUNT(*) FROM rating WHERE DATE(id) = DATE(o.orderdate)) AS daily_ratings, ROUND((COUNT(DISTINCT o.id) * 100.0) / NULLIF((SELECT COUNT(*) FROM cart WHERE DATE(date_cart) = DATE(o.orderdate)), 0), 2) AS daily_conversion_rate, ROUND(((SELECT COUNT(*) FROM claims WHERE DATE(id) = DATE(o.orderdate)) * 100.0) / NULLIF(COUNT(DISTINCT o.id), 0), 2) AS daily_claim_rate, ROUND(((SELECT COUNT(*) FROM returns WHERE DATE(date) = DATE(o.orderdate)) * 100.0) / NULLIF(COUNT(DISTINCT o.id), 0), 2) AS daily_return_rate, CASE WHEN AVG(DATEDIFF(o.deliveredDate, o.orderdate)) <= 2 THEN 'Excellent' WHEN AVG(DATEDIFF(o.deliveredDate, o.orderdate)) <= 4 THEN 'Good' WHEN AVG(DATEDIFF(o.deliveredDate, o.orderdate)) <= 7 THEN 'Average' ELSE 'Poor' END AS delivery_performance_rating FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) GROUP BY DATE(o.orderdate) ORDER BY operation_date DESC LIMIT 60; 
 SELECT 'Weekly Operational Performance' AS analysis_type, YEARWEEK(o.orderdate, 3) AS week_number, COUNT(DISTINCT o.id) AS weekly_orders, SUM(o.price) AS weekly_revenue, AVG(o.price) AS avg_weekly_order_value, COUNT(DISTINCT c.id) AS weekly_customers, COUNT(DISTINCT w.id) AS weekly_wilayas, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS avg_weekly_delivery_time, SUM(w.delivery_price) AS weekly_delivery_costs, SUM(o.price) - SUM(w.delivery_price) AS weekly_net_revenue, (SELECT COUNT(*) FROM cart WHERE YEARWEEK(date_cart, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_cart_activities, (SELECT COUNT(*) FROM claims WHERE YEARWEEK(id, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_claims, (SELECT COUNT(*) FROM returns WHERE YEARWEEK(date, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_returns, (SELECT COUNT(*) FROM inbox WHERE YEARWEEK(date, 3) = YEARWEEK(o.orderdate, 3)) AS weekly_messages, ROUND((COUNT(DISTINCT o.id) * 100.0) / NULLIF((SELECT COUNT(*) FROM cart WHERE YEARWEEK(date_cart, 3) = YEARWEEK(o.orderdate, 3)), 0), 2) AS weekly_conversion_rate, ROUND(((SELECT COUNT(*) FROM claims WHERE YEARWEEK(id, 3) = YEARWEEK(o.orderdate, 3)) * 100.0) / NULLIF(COUNT(DISTINCT o.id), 0), 2) AS weekly_claim_rate, ROUND(((SELECT COUNT(*) FROM returns WHERE YEARWEEK(date, 3) = YEARWEEK(o.orderdate, 3)) * 100.0) / NULLIF(COUNT(DISTINCT o.id), 0), 2) AS weekly_return_rate, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)) AS prev_week_orders, LAG(SUM(o.price), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)) AS prev_week_revenue, ((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3))) * 100.0) / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)), 0) AS order_growth_pct, ((SUM(o.price) - LAG(SUM(o.price), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3))) * 100.0) / NULLIF(LAG(SUM(o.price), 1) OVER (ORDER BY YEARWEEK(o.orderdate, 3)), 0) AS revenue_growth_pct FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 WEEK) GROUP BY YEARWEEK(o.orderdate, 3) ORDER BY week_number DESC LIMIT 12; 
 SELECT p.id, p.name, COUNT(cm.id) AS comment_count, AVG(r.rating) AS avg_rating FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.id ORDER BY comment_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, COUNT(DISTINCT ca.product_id) AS unique_products FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id WHERE p.category = 'Electronics' GROUP BY c.id ORDER BY unique_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT c.id, SUM(ca.initial_price) AS total_cart_value FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id WHERE p.quantity < 10 GROUP BY c.id ORDER BY total_cart_value DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.name, p.brand, MAX(ca.initial_price) AS max_cart_price FROM products p JOIN cart ca ON p.id = ca.product_id WHERE p.price BETWEEN 500 AND 1500 GROUP BY p.id ORDER BY max_cart_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT c.firstname, c.lastname, SUM(p.price * p.quantity) AS potential_revenue FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id GROUP BY c.id ORDER BY potential_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.name, COUNT(DISTINCT c.wilaya) AS wilaya_reach FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON c.id = ca.client_id GROUP BY p.name ORDER BY wilaya_reach DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.category, COUNT(DISTINCT p.id) AS product_count, AVG(p.price) AS avg_price FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE pr.percentage > 15 AND pr.enddate >= CURDATE() GROUP BY p.category ORDER BY product_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT a.username, a.role, COUNT(DISTINCT p.id) AS products_managed, COUNT(DISTINCT o.id) AS orders_managed FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id GROUP BY a.id, a.username, a.role ORDER BY products_managed DESC, orders_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.name, p.price, COUNT(ca.id) AS times_added_to_cart FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON c.id = ca.client_id WHERE c.email LIKE '%@%.%' GROUP BY p.id ORDER BY times_added_to_cart DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.wilaya, COUNT(DISTINCT p.category) AS category_diversity FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id GROUP BY c.wilaya ORDER BY category_diversity DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT c.id, MIN(ca.date_cart) AS first_cart_date, MAX(ca.date_cart) AS last_cart_date FROM clients c JOIN cart ca ON c.id = ca.client_id GROUP BY c.id HAVING DATEDIFF(MAX(ca.date_cart), MIN(ca.date_cart)) > 90 ORDER BY first_cart_date ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.brand, COUNT(DISTINCT p.id) AS total_products, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) AS products_on_promotion FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND pr.enddate >= CURDATE() WHERE p.quantity > 0 GROUP BY p.brand ORDER BY products_on_promotion DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.name, p.price, pr.percentage, (p.price * (100 - pr.percentage) / 100) AS discounted_price, COUNT(DISTINCT ca.id) AS times_in_cart FROM products p JOIN promotions pr ON p.id = pr.product_id LEFT JOIN cart ca ON p.id = ca.product_id WHERE pr.startdate <= CURDATE() AND pr.enddate >= CURDATE() GROUP BY p.id, p.name, p.price, pr.percentage ORDER BY times_in_cart DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.category, COUNT(DISTINCT c.id) AS unique_customers FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON c.id = ca.client_id WHERE MONTH(ca.date_cart) IN (11, 12) GROUP BY p.category ORDER BY unique_customers DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT c.username, COUNT(DISTINCT p.brand) AS brands_explored FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id GROUP BY c.username HAVING COUNT(DISTINCT p.brand) >= 3 ORDER BY brands_explored DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, AVG(p.quantity) AS avg_stock FROM products p JOIN cart ca ON p.id = ca.product_id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 3 MONTH) GROUP BY p.id ORDER BY avg_stock ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.brand, p.category, AVG(p.price) AS avg_price FROM products p JOIN cart ca ON p.id = ca.product_id GROUP BY p.brand, p.category HAVING AVG(p.price) > 500 ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.name, pr.percentage, COUNT(ca.id) AS cart_adds FROM products p JOIN promotions pr ON p.id = pr.product_id JOIN cart ca ON pr.id = ca.promotion_id WHERE pr.percentage > 30 GROUP BY p.id, pr.id ORDER BY cart_adds DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, p.name, COUNT(ca.id) AS times_in_cart FROM products p JOIN cart ca ON p.id = ca.product_id WHERE p.quantity > 0 GROUP BY p.id ORDER BY times_in_cart DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT pr.percentage, AVG(pr.price) AS avg_promo_price, COUNT(pr.id) AS promo_count FROM promotions pr JOIN products p ON p.id = pr.product_id WHERE pr.enddate >= CURDATE() GROUP BY pr.percentage ORDER BY avg_promo_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.email, COUNT(ca.id) AS promo_cart_items FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN promotions pr ON pr.id = ca.promotion_id WHERE pr.startdate <= CURDATE() AND pr.enddate >= CURDATE() GROUP BY c.email ORDER BY promo_cart_items DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT pr.id, p.category, AVG(p.price - pr.price) AS avg_savings FROM promotions pr JOIN products p ON p.id = pr.product_id GROUP BY pr.id ORDER BY avg_savings DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT w.name AS wilaya, w.delivery_price, COUNT(DISTINCT c.id) AS total_clients, COUNT(DISTINCT o.id) AS total_orders, AVG(o.price) AS avg_order_value FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id GROUP BY w.id, w.name, w.delivery_price ORDER BY total_orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.name, p.price, p.quantity, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS in_carts, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS in_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS avg_rating FROM products p WHERE p.quantity < 50 ORDER BY (p.price * p.quantity) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT c.id, c.username, COUNT(DISTINCT o.id) AS offers_explored FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN offers o ON o.id = ca.offer_id GROUP BY c.id HAVING COUNT(DISTINCT o.id) >= 2 ORDER BY offers_explored DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.brand, COUNT(DISTINCT pr.id) AS active_promotions FROM products p JOIN promotions pr ON p.id = pr.product_id WHERE pr.enddate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY p.brand ORDER BY active_promotions DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT c.wilaya, AVG(pr.percentage) AS avg_discount_used FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.wilaya ORDER BY avg_discount_used DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT pr.product_id, p.name, COUNT(ca.client_id) AS clients_attracted FROM promotions pr JOIN products p ON p.id = pr.product_id JOIN cart ca ON pr.id = ca.promotion_id WHERE pr.percentage >= 25 GROUP BY pr.product_id ORDER BY clients_attracted DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT o.name, AVG(o.price) AS avg_offer_price FROM offers o JOIN cart ca ON o.id = ca.offer_id JOIN clients c ON c.id = ca.client_id WHERE c.wilaya BETWEEN 1 AND 20 GROUP BY o.name ORDER BY avg_offer_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.brand, COUNT(DISTINCT p.category) AS categories_covered FROM products p GROUP BY p.brand HAVING COUNT(DISTINCT p.category) > 1 ORDER BY categories_covered DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.firstname, c.lastname, COUNT(DISTINCT o.id) AS successful_orders, COUNT(DISTINCT cl.id) AS claims_filed, COUNT(DISTINCT rt.id) AS returns_requested FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns rt ON c.id = rt.client_id GROUP BY c.id, c.firstname, c.lastname HAVING successful_orders > 2 ORDER BY successful_orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS month_year, COUNT(DISTINCT o.client_id) AS unique_clients, COUNT(o.id) AS total_orders, SUM(o.price) AS total_revenue, SUM(w.delivery_price) AS total_delivery_cost FROM orders o JOIN wilayas w ON o.wilaya_id = w.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY month_year DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.admin_id, AVG(p.price) AS avg_product_price FROM products p GROUP BY p.admin_id ORDER BY avg_product_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.category, COUNT(DISTINCT p.id) AS products_count, SUM(p.quantity) AS total_stock, MIN(p.price) AS min_price, MAX(p.price) AS max_price, AVG(p.price) AS avg_price FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%') GROUP BY p.category HAVING total_stock > 100 ORDER BY products_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS full_name, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'delivered') AS delivered_orders, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND status = 'pending') AS pending_orders, (SELECT SUM(price) FROM orders WHERE client_id = c.id) AS total_spent FROM clients c HAVING total_spent > 1000 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT c.id, c.firstname, SUM(p.price - pr.price) AS total_savings FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN promotions pr ON pr.id = ca.promotion_id JOIN products p ON p.id = pr.product_id GROUP BY c.id ORDER BY total_savings DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT pr.product_id, p.name, pr.percentage, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) AS promotion_days, COUNT(DISTINCT ca.id) AS added_to_cart_during_promo FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON pr.product_id = ca.product_id AND ca.date_cart BETWEEN pr.startdate AND pr.enddate WHERE pr.enddate >= CURDATE() GROUP BY pr.id, pr.product_id, p.name, pr.percentage, pr.startdate, pr.enddate ORDER BY promotion_days DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT c.email, COUNT(DISTINCT ca.offer_id) AS unique_offers FROM clients c JOIN cart ca ON c.id = ca.client_id WHERE ca.offer_id IS NOT NULL GROUP BY c.email ORDER BY unique_offers DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.category, COUNT(p.id) AS total_products, COUNT(DISTINCT p.brand) AS unique_brands FROM products p WHERE p.quantity > 0 GROUP BY p.category ORDER BY total_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, p.name, (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) AS fav_count, (SELECT COUNT(*) FROM comments c WHERE c.product_id = p.id) AS comment_count FROM products p ORDER BY (fav_count + comment_count) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.brand, p.category, MAX(pr.percentage) AS max_discount FROM products p JOIN promotions pr ON p.id = pr.product_id GROUP BY p.brand, p.category ORDER BY max_discount DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT w.id, w.name, (SELECT COUNT(*) FROM clients WHERE wilaya = w.id) AS registered_clients, (SELECT COUNT(*) FROM orders WHERE wilaya_id = w.id) AS total_orders, (SELECT AVG(price) FROM orders WHERE wilaya_id = w.id) AS avg_order_value FROM wilayas w ORDER BY total_orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT pr.startdate, COUNT(pr.id) AS promotions_started FROM promotions pr JOIN products p ON p.id = pr.product_id WHERE p.quantity > 0 GROUP BY pr.startdate ORDER BY promotions_started DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.name, COUNT(DISTINCT pr.admin_id) AS admins_managing FROM products p JOIN promotions pr ON p.id = pr.product_id GROUP BY p.name ORDER BY admins_managing DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT w.name AS wilaya, COUNT(DISTINCT c.id) AS clients_from_wilaya, COUNT(DISTINCT o.id) AS orders_to_wilaya, AVG(w.delivery_price) AS avg_delivery_cost, SUM(o.price) AS total_revenue_from_wilaya FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id GROUP BY w.id, w.name HAVING total_revenue_from_wilaya > 5000 ORDER BY total_revenue_from_wilaya DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT a.username, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id) AS products_added, (SELECT COUNT(*) FROM promotions WHERE admin_id = a.id) AS promotions_created, (SELECT COUNT(*) FROM orders WHERE admin_id = a.id) AS orders_managed, (SELECT COUNT(*) FROM claims WHERE admin_id = a.id) AS claims_handled FROM admin a ORDER BY products_added DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT a.username, a.role, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.price > (SELECT AVG(price) FROM products)) AS above_avg_products, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.price <= (SELECT AVG(price) FROM products)) AS below_avg_products FROM admin a ORDER BY above_avg_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT pr.product_id, p.name, pr.percentage, pr.startdate, pr.enddate, (SELECT COUNT(*) FROM cart WHERE promotion_id = pr.id) AS added_with_promo, (SELECT COUNT(*) FROM favorites WHERE promotion_id = pr.id) AS favorited_with_promo FROM promotions pr JOIN products p ON pr.product_id = p.id WHERE pr.enddate >= CURDATE() ORDER BY pr.percentage DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT p.brand, SUM(p.quantity) AS in_stock, (SELECT SUM(ca.initial_price) FROM cart ca JOIN orders o ON ca.client_id = o.client_id WHERE ca.product_id IN (SELECT id FROM products WHERE brand = p.brand) AND o.status = 'delivered') AS total_revenue FROM products p GROUP BY p.brand ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT w.name AS wilaya, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND YEAR(c.birthday) >= 1990) AS young_clients_count, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS avg_client_age, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND YEAR(o.orderdate) = 2024) AS current_year_revenue FROM wilayas w ORDER BY young_clients_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as month, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') as active_clients, (SELECT SUM(o2.price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.price > 500) as premium_revenue, (SELECT AVG(o2.price) FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) as avg_order_value FROM orders o WHERE o.orderdate >= '2023-01-01' GROUP BY month HAVING active_clients > 10 AND premium_revenue > 10000 ORDER BY month DESC LIMIT 24;                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.admin_id, COUNT(DISTINCT p.category) AS categories_managed, COUNT(DISTINCT p.brand) AS brands_managed FROM products p GROUP BY p.admin_id ORDER BY categories_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.name, p.brand, p.category, p.price, (SELECT username FROM admin WHERE id = p.admin_id) AS added_by_admin, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS recent_cart_additions, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_rating FROM products p WHERE p.price BETWEEN 100 AND 1000 AND p.quantity > 0 ORDER BY recent_cart_additions DESC, product_rating DESC LIMIT 50;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT a.role, COUNT(DISTINCT a.id) AS number_of_admins, SUM((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS total_products_managed, AVG((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS avg_products_per_admin, STDDEV((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS stddev_products FROM admin a GROUP BY a.role HAVING total_products_managed > 0 ORDER BY total_products_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.category, p.brand, COUNT(DISTINCT p.id) AS number_of_products, MIN(p.price) AS lowest_price, MAX(p.price) AS highest_price, AVG(p.price) AS average_price, SUM(p.quantity) AS total_inventory, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category AND brand = p.brand)) AS total_favorites FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role = '1' OR role LIKE '%Admin%') GROUP BY p.category, p.brand HAVING number_of_products >= 2 ORDER BY total_inventory DESC, number_of_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT o.id, c.firstname, c.lastname, o.price, w.name AS wilaya FROM orders o JOIN clients c ON o.client_id = c.id JOIN wilayas w ON o.wilaya_id = w.id WHERE o.status = 'pending' ORDER BY o.orderdate DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.category, (SELECT COUNT(DISTINCT p2.id) FROM products p2 WHERE p2.category = p.category AND p2.price > (SELECT AVG(price) FROM products)) as above_avg_price_count, (SELECT AVG(p2.price) FROM products p2 WHERE p2.category = p.category) as category_avg_price, (SELECT SUM(p2.quantity) FROM products p2 WHERE p2.category = p.category) as total_stock, (SELECT COUNT(DISTINCT ca.client_id) FROM cart ca INNER JOIN products p2 ON ca.product_id = p2.id WHERE p2.category = p.category) as unique_buyers FROM products p GROUP BY p.category HAVING total_stock > 100 AND unique_buyers > 5 ORDER BY category_avg_price DESC LIMIT 20;                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT w.id, w.name, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE price > 1000)) as premium_clients, (SELECT AVG(o.price) FROM orders o INNER JOIN clients c ON o.client_id = c.id WHERE c.wilaya = w.id AND o.status = 'delivered') as avg_delivered_order_value, (SELECT COUNT(DISTINCT o.id) FROM orders o INNER JOIN clients c ON o.client_id = c.id WHERE c.wilaya = w.id AND o.status = 'pending') as pending_orders FROM wilayas w WHERE w.id IN (SELECT wilaya FROM clients GROUP BY wilaya HAVING COUNT(*) > 20) ORDER BY premium_clients DESC, w.name LIMIT 35;                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT ca.product_id, p.name, COUNT(ca.id) AS times_added_to_cart, AVG(ca.initial_price) AS avg_price_in_cart FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.product_id IS NOT NULL GROUP BY ca.product_id ORDER BY times_added_to_cart DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT w.name, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id AND YEAR(c.birthday) > 1990) as young_clients FROM wilayas w ORDER BY young_clients DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT p.category, (SELECT MAX(price) FROM products p2 WHERE p2.category = p.category) as max_price FROM products p GROUP BY p.category ORDER BY max_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.brand, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id IN (SELECT id FROM products p2 WHERE p2.brand = p.brand)) as cart_adds FROM products p GROUP BY p.brand ORDER BY cart_adds DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT a.role, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'pending') as pending_orders FROM admin a ORDER BY pending_orders DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT a.username, a.email, a.role, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.category = 'Electronics' AND p.price > 500) AS premium_electronics, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.category = 'Clothing' AND p.price > 100) AS premium_clothing, (SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id) AS average_product_price FROM admin a ORDER BY (premium_electronics + premium_clothing) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT ca.client_id, COUNT(DISTINCT DATE(ca.date_cart)) AS active_cart_days, AVG(ca.initial_price) AS avg_cart_item_price FROM cart ca GROUP BY ca.client_id ORDER BY active_cart_days DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT w.name AS wilaya, w.delivery_price, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id AND YEAR(c.birthday) >= 1995) AS gen_z_clients, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id AND YEAR(c.birthday) BETWEEN 1980 AND 1994) AS millennial_clients, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id AND YEAR(c.birthday) < 1980) AS older_clients, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS total_delivered_revenue FROM wilayas w ORDER BY total_delivered_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT a.id, a.username, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id) AS products_managed, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id) AS orders_managed, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id) AS promotions_created FROM admin a ORDER BY products_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_quarter_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS recent_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites FROM clients c HAVING current_quarter_spending > 0 OR recent_cart_activity > 0 ORDER BY current_quarter_spending DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.name, p.category, p.brand, p.price, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS total_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (p.price * p.quantity) AS inventory_value FROM products p WHERE p.quantity > 0 AND (SELECT AVG(rating) FROM rating WHERE product_id = p.id) >= 4.0 ORDER BY inventory_value DESC LIMIT 75;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT a.username AS admin_username, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Electronics') AS electronics_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Clothing') AS clothing_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Home') AS home_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Sports') AS sports_products FROM admin a ORDER BY electronics_products + clothing_products + home_products + sports_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT c.id, c.firstname, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id) AS cart_items, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS favorites, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS comments FROM clients c ORDER BY cart_items DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS client_wilaya, (SELECT COUNT(DISTINCT o.id) FROM orders o WHERE o.client_id = c.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS recent_delivered_orders, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS recent_spending, (SELECT COUNT(DISTINCT ca.id) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS recent_cart_additions FROM clients c JOIN wilayas w ON c.wilaya = w.id HAVING recent_delivered_orders > 0 OR recent_cart_additions > 0 ORDER BY recent_spending DESC;                                                                                                                                                                                                                                                                                                                          
 SELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS client_name, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND MONTH(orderdate) = 1) AS jan_orders, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND MONTH(orderdate) = 2) AS feb_orders, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND MONTH(orderdate) = 3) AS mar_orders, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND MONTH(orderdate) = 4) AS apr_orders, (SELECT COUNT(*) FROM orders WHERE client_id = c.id AND MONTH(orderdate) = 5) AS may_orders FROM clients c HAVING jan_orders > 0 OR feb_orders > 0 OR mar_orders > 0 OR apr_orders > 0 OR may_orders > 0 ORDER BY (jan_orders + feb_orders + mar_orders + apr_orders + may_orders) DESC;                                                                                                                                                                                                                                                                                                                   
 SELECT p.category, COUNT(DISTINCT p.brand) AS unique_brands, COUNT(DISTINCT p.id) AS total_products, AVG(p.price) AS average_price_category, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock_category, (SELECT SUM(quantity) FROM products) AS overall_total_stock FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%') GROUP BY p.category HAVING total_products > 5 ORDER BY total_stock_category DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT a.role, COUNT(DISTINCT a.id) AS admin_count, AVG((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS avg_products_per_admin, AVG((SELECT COUNT(*) FROM orders WHERE admin_id = a.id)) AS avg_orders_per_admin, AVG((SELECT COUNT(*) FROM promotions WHERE admin_id = a.id)) AS avg_promotions_per_admin FROM admin a GROUP BY a.role ORDER BY admin_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT w.name AS wilaya, COUNT(DISTINCT c.id) AS clients_registered, COUNT(DISTINCT o.id) AS orders_placed, SUM(o.price) AS total_revenue, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS avg_delivery_days FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id WHERE o.status = 'delivered' GROUP BY w.id, w.name HAVING orders_placed > 10 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.name, p.price, p.quantity, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS favorite_count, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS cart_count, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS avg_rating FROM products p WHERE p.quantity < 20 AND p.price > 50 ORDER BY favorite_count DESC, cart_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.category, p.brand, COUNT(DISTINCT cm.id) AS comment_count, COUNT(DISTINCT r.id) AS rating_count, COUNT(DISTINCT f.id) AS favorite_count, COUNT(DISTINCT ca.id) AS cart_count FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN cart ca ON p.id = ca.product_id GROUP BY p.id ORDER BY p.price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_managed, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions FROM admin a ORDER BY total_inventory_value_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.category, COUNT(DISTINCT p.id) AS products_in_category, SUM(p.quantity) AS total_stock, AVG(p.price) AS avg_price, MIN(p.price) AS min_price, MAX(p.price) AS max_price FROM products p GROUP BY p.category HAVING products_in_category > 10 ORDER BY total_stock DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue FROM wilayas w ORDER BY yearly_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_month_spent, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 1 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))) AS previous_month_spent, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) AS last_week_cart_activity FROM clients c HAVING current_month_spent > 0 OR previous_month_spent > 0 ORDER BY (COALESCE(current_month_spent, 0) + COALESCE(previous_month_spent, 0)) DESC;                                                                                                                                                                                                                                                                                                         
 SELECT p.name, p.brand, p.category, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS total_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS customer_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_reviews FROM products p WHERE p.quantity > 0 AND p.price > 50 AND (SELECT AVG(rating) FROM rating WHERE product_id = p.id) IS NOT NULL ORDER BY inventory_value DESC, customer_rating DESC LIMIT 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT 'High Value' as segment, c.id, c.firstname, c.lastname, SUM(o.price) as total_spent FROM clients c INNER JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname HAVING SUM(o.price) > 5000 UNION ALL SELECT 'Frequent Buyer' as segment, c.id, c.firstname, c.lastname, COUNT(o.id) as order_count FROM clients c INNER JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 UNION ALL SELECT 'Recent Active' as segment, c.id, c.firstname, c.lastname, MAX(o.orderdate) as last_order FROM clients c INNER JOIN orders o ON c.id = o.client_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY c.id, c.firstname, c.lastname ORDER BY segment, total_spent DESC LIMIT 45;                                                                                                                                                                                                                                                                                          
 SELECT c.id, c.firstname, c.lastname, o.orderdate, o.price, FIRST_VALUE(o.price) OVER (PARTITION BY c.id ORDER BY o.orderdate) as first_order_value, LAST_VALUE(o.price) OVER (PARTITION BY c.id ORDER BY o.orderdate ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_order_value, NTH_VALUE(o.price, 2) OVER (PARTITION BY c.id ORDER BY o.orderdate) as second_order_value, MAX(o.price) OVER (PARTITION BY c.id) as max_order_value, MIN(o.price) OVER (PARTITION BY c.id) as min_order_value FROM clients c INNER JOIN orders o ON c.id = o.client_id WHERE c.id IN (SELECT client_id FROM orders GROUP BY client_id HAVING COUNT(*) >= 3) ORDER BY c.id, o.orderdate LIMIT 60;                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, p.category, GROUP_CONCAT(DISTINCT ct.client_id ORDER BY ct.client_id SEPARATOR ', ') as client_ids_in_cart, COUNT(DISTINCT ct.client_id) as unique_cart_clients, GROUP_CONCAT( DISTINCT CONCAT(c.firstname, ' ', c.lastname) ORDER BY c.lastname, c.firstname SEPARATOR '; ' ) as client_names_in_cart FROM products p LEFT JOIN cart ct ON p.id = ct.product_id LEFT JOIN clients c ON ct.client_id = c.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING COUNT(DISTINCT ct.client_id) >= 2 ORDER BY unique_cart_clients DESC LIMIT 25;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT c.id, c.firstname, c.lastname, c.email, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'Active (<30 days)' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'Warm (31-90 days)' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 180 THEN 'Cold (91-180 days)' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 365 THEN 'Dormant (181-365 days)' ELSE 'Lost (>365 days)' END as recency_segment, CASE WHEN COUNT(o.id) >= 10 THEN 'VIP (10+ orders)' WHEN COUNT(o.id) >= 5 THEN 'Frequent (5-9 orders)' WHEN COUNT(o.id) >= 2 THEN 'Regular (2-4 orders)' WHEN COUNT(o.id) = 1 THEN 'One-time' ELSE 'Never ordered' END as frequency_segment, CASE WHEN SUM(o.price) >= 5000 THEN 'Whale (>5000)' WHEN SUM(o.price) >= 1000 THEN 'High Value (1000-5000)' WHEN SUM(o.price) >= 100 THEN 'Medium Value (100-999)' WHEN SUM(o.price) > 0 THEN 'Low Value (<100)' ELSE 'No spend' END as monetary_segment, CONCAT( CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'A' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'B' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 180 THEN 'C' ELSE 'D' END, CASE WHEN COUNT(o.id) >= 5 THEN '1' WHEN COUNT(o.id) >= 2 THEN '2' WHEN COUNT(o.id) = 1 THEN '3' ELSE '4' END, CASE WHEN SUM(o.price) >= 1000 THEN '1' WHEN SUM(o.price) >= 100 THEN '2' WHEN SUM(o.price) > 0 THEN '3' ELSE '4' END ) as rfm_score FROM clients c LEFT JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname, c.email ORDER BY rfm_score LIMIT 50; 
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_in_role, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS avg_products_per_admin, STDDEV((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS stddev_products_per_admin, SUM((SELECT SUM(p.quantity) FROM products p WHERE p.admin_id = a.id)) AS total_stock_managed, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS avg_price_of_managed_products FROM admin a GROUP BY a.role HAVING avg_products_per_admin IS NOT NULL ORDER BY total_stock_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT DAYOFWEEK(ca.date_cart) AS day_number, DAYNAME(ca.date_cart) AS day_name, HOUR(ca.date_cart) AS hour_of_day, COUNT(DISTINCT ca.id) AS cart_additions_per_hour, COUNT(DISTINCT ca.client_id) AS unique_shoppers_per_hour, AVG(p.price) AS avg_product_price, SUM(p.price) AS total_cart_value_per_hour FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) GROUP BY DAYOFWEEK(ca.date_cart), DAYNAME(ca.date_cart), HOUR(ca.date_cart) HAVING cart_additions_per_hour > 5 ORDER BY day_number, hour_of_day;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT c.id, CONCAT(c.firstname, ' ', c.lastname) AS customer_name, c.email, c.phone_number, w.name AS location, COUNT(DISTINCT o.id) AS total_orders, SUM(o.price) AS total_spent, AVG(o.price) AS average_order_value, MIN(o.orderdate) AS first_order_date, MAX(o.orderdate) AS last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_order, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS favorite_items_count FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN wilayas w ON c.wilaya = w.id WHERE o.status = 'delivered' OR o.id IS NULL GROUP BY c.id, c.firstname, c.lastname, c.email, c.phone_number, w.name HAVING total_orders > 0 ORDER BY total_spent DESC LIMIT 150;                                                                                                                                                                                                                                                                                                                         
 SELECT of.id, of.name, of.price offer_price, COUNT(DISTINCT ca.id) cart_additions, COUNT(DISTINCT o.id) orders_containing_offer FROM offers of LEFT JOIN cart ca ON ca.offer_id = of.id LEFT JOIN orders o ON FIND_IN_SET(of.id, REPLACE(o.cart_id, ' ', '')) > 0 WHERE of.startdate <= CURDATE() AND of.enddate >= CURDATE() AND of.price BETWEEN 100 AND 1000 GROUP BY of.id HAVING cart_additions > 2 OR orders_containing_offer > 1 ORDER BY of.price DESC, cart_additions DESC LIMIT 30;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT category) FROM products WHERE admin_id = a.id) AS categories_managed, (SELECT COUNT(DISTINCT brand) FROM products WHERE admin_id = a.id) AS brands_managed, (SELECT AVG(price) FROM products WHERE admin_id = a.id) AS avg_product_price FROM admin a ORDER BY categories_managed DESC, brands_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.category, p.brand, CASE WHEN p.price < 50 THEN 'Budget' WHEN p.price BETWEEN 50 AND 200 THEN 'Mid-range' WHEN p.price BETWEEN 201 AND 500 THEN 'Premium' ELSE 'Luxury' END as price_segment, COUNT(*) as product_count, AVG(p.price) as avg_price, SUM(p.quantity) as total_stock, COUNT(DISTINCT ct.client_id) as unique_interested_clients, COUNT(DISTINCT f.client_id) as unique_favoriting_clients, COUNT(DISTINCT cm.client_id) as unique_commenting_clients, ROUND(COUNT(DISTINCT f.client_id) * 100.0 / NULLIF(COUNT(DISTINCT ct.client_id), 0), 2) as interest_to_favorite_rate FROM products p LEFT JOIN cart ct ON p.id = ct.product_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN comments cm ON p.id = cm.product_id WHERE p.quantity > 0 GROUP BY p.category, p.brand, CASE WHEN p.price < 50 THEN 'Budget' WHEN p.price BETWEEN 50 AND 200 THEN 'Mid-range' WHEN p.price BETWEEN 201 AND 500 THEN 'Premium' ELSE 'Luxury' END HAVING product_count >= 3 AND unique_interested_clients >= 5 ORDER BY p.category, p.brand, avg_price DESC LIMIT 40; 
 SELECT p.category, COUNT(p.id) AS product_count, AVG(p.price) AS avg_price FROM products p GROUP BY p.category HAVING AVG(p.price) > ( SELECT AVG(price) FROM products ) AND COUNT(p.id) > 5 ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT c.id, c.firstname, COUNT(o.id) AS order_count, SUM(o.price) AS total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id HAVING SUM(o.price) > ( SELECT AVG(total_spent) FROM ( SELECT SUM(price) AS total_spent FROM orders GROUP BY client_id ) AS avg_table ) AND COUNT(o.id) >= 3 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT 'High Value' AS category, c.id, c.firstname, SUM(o.price) AS total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id HAVING SUM(o.price) > 5000 UNION SELECT 'Medium Value' AS category, c.id, c.firstname, SUM(o.price) AS total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id HAVING SUM(o.price) BETWEEN 1000 AND 5000 UNION SELECT 'Low Value' AS category, c.id, c.firstname, SUM(o.price) AS total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id HAVING SUM(o.price) < 1000 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT p.category, p.brand, COUNT(DISTINCT r.id) as return_count, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT o.id) as total_orders, ROUND(COUNT(DISTINCT r.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), 2) as return_rate, ROUND(COUNT(DISTINCT cl.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), 2) as claim_rate, AVG(CASE WHEN r.id IS NOT NULL THEN DATEDIFF(r.response IS NOT NULL, r.id) END) as avg_return_resolution_days, AVG(CASE WHEN cl.id IS NOT NULL THEN DATEDIFF(cl.response IS NOT NULL, cl.id) END) as avg_claim_resolution_days, GROUP_CONCAT(DISTINCT LEFT(r.reason, 50)) as common_return_reasons FROM products p LEFT JOIN cart ct ON p.id = ct.product_id LEFT JOIN orders o ON ct.client_id = o.client_id LEFT JOIN returns r ON o.id = r.order_id LEFT JOIN claims cl ON o.id = cl.order_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY p.category, p.brand HAVING total_orders >= 10 AND (return_count > 0 OR claim_count > 0) ORDER BY return_rate DESC, claim_rate DESC LIMIT 30;                
 SELECT p.brand, p.category, COUNT(DISTINCT p.id) AS product_count, AVG(p.price) AS avg_price, SUM(p.quantity) AS total_stock, (SELECT COUNT(*) FROM favorites WHERE product_id IN (SELECT id FROM products WHERE brand = p.brand AND category = p.category)) AS total_favorites FROM products p GROUP BY p.brand, p.category HAVING product_count > 2 ORDER BY total_favorites DESC; SELECT p.category, p.brand, COUNT(DISTINCT p.id) product_count, AVG(p.price) avg_price, SUM(p.quantity) total_quantity, COUNT(DISTINCT ca.id) cart_occurrences, COUNT(DISTINCT f.id) favorite_count FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN promotions pr ON pr.product_id = p.id WHERE p.quantity > 0 AND p.price BETWEEN 50 AND 1000 GROUP BY p.category, p.brand HAVING product_count > 2 AND total_quantity > 50 ORDER BY avg_price DESC, cart_occurrences DESC LIMIT 20;                                                                                                                      
 SELECT w.name AS wilaya, (SELECT COUNT(*) FROM clients WHERE wilaya = w.id) AS registered_clients, (SELECT COUNT(*) FROM orders WHERE wilaya_id = w.id) AS total_orders, (SELECT AVG(price) FROM orders WHERE wilaya_id = w.id) AS avg_order_value, (SELECT SUM(price) FROM orders WHERE wilaya_id = w.id) AS total_revenue FROM wilayas w ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT MONTH(o.orderdate) AS month, COUNT(DISTINCT o.client_id) AS unique_customers, COUNT(o.id) AS total_orders, SUM(o.price) AS monthly_revenue, AVG(o.price) AS avg_order_value FROM orders o WHERE YEAR(o.orderdate) = 2024 GROUP BY MONTH(o.orderdate) ORDER BY month; SELECT p.id, p.name, 'Product' AS type, p.price FROM products p WHERE p.price > 100 UNION ALL SELECT pr.product_id, (SELECT name FROM products WHERE id = pr.product_id), 'Promotion' AS type, pr.price FROM promotions pr WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate ORDER BY price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT a.username, a.email, a.role, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.category = 'Electronics' AND p.price > 1000) AS high_end_electronics, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.category = 'Clothing' AND p.price > 200) AS premium_clothing, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.category = 'Home' AND p.price > 500) AS premium_home_goods, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id) AS average_price_of_added_products FROM admin a ORDER BY total_inventory_value_added DESC;                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, p.category, p.price, AVG(p.price) OVER(PARTITION BY p.category) AS category_avg_price, p.price - AVG(p.price) OVER(PARTITION BY p.category) AS price_difference_from_avg, RANK() OVER(PARTITION BY p.category ORDER BY p.price DESC) AS price_rank_in_category FROM products p ORDER BY p.category, p.price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT w.name AS wilaya, w.delivery_price, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id) AS registered_clients, (SELECT COUNT(DISTINCT o.client_id) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS active_buyers, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS average_order_value, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS last_90_days_revenue, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id) AS highest_order_value FROM wilayas w ORDER BY last_90_days_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                    
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_orders_category, SUM(o.price) AS monthly_revenue_category, AVG(o.price) AS avg_order_value_category, COUNT(DISTINCT o.client_id) AS monthly_unique_customers_category, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_orders_category > 2 ORDER BY sales_month DESC, monthly_revenue_category DESC; SELECT p.name, p.category, p.brand, p.price, (SELECT username FROM admin WHERE id = p.admin_id) AS added_by, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS in_cart, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS in_favorites FROM products p WHERE p.price > (SELECT AVG(price) FROM products WHERE category = p.category) ORDER BY p.price DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_quarter_spent, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 3 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 3 MONTH))) AS previous_quarter_spent, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 14 DAY)) AS last_two_weeks_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorite_items FROM clients c HAVING current_quarter_spent > 0 OR previous_quarter_spent > 0 ORDER BY (COALESCE(current_quarter_spent, 0) + COALESCE(previous_quarter_spent, 0)) DESC;                                                                                                                                                                                          
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS month, o.client_id, SUM(o.price) AS monthly_spent, SUM(SUM(o.price)) OVER(PARTITION BY o.client_id ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) AS cumulative_spent, AVG(SUM(o.price)) OVER(PARTITION BY o.client_id) AS avg_monthly_spent FROM orders o GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), o.client_id ORDER BY o.client_id, month; WITH WilayaPerformance AS ( SELECT w.id AS wilaya_id, w.name AS wilaya_name, w.delivery_price, COUNT(DISTINCT c.id) AS total_clients, COUNT(DISTINCT CASE WHEN c.id IN (SELECT client_id FROM orders WHERE status = 'delivered') THEN c.id END) AS active_clients, COUNT(DISTINCT o.id) AS total_orders, SUM(o.price) AS total_revenue, AVG(o.price) AS avg_order_value, AVG(DATEDIFF(o.deliveredDate, o.orderdate)) AS avg_delivery_time, COUNT(DISTINCT p.category) AS categories_ordered, COUNT(DISTINCT p.brand) AS brands_ordered FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id AND o.status = 'delivered' LEFT JOIN cart ca ON o.cart_id = ca.id LEFT JOIN products p ON ca.product_id = p.id GROUP BY w.id, w.name, w.delivery_price ), WilayaRankings AS ( SELECT *, ROW_NUMBER() OVER (ORDER BY total_revenue DESC) AS revenue_rank, ROW_NUMBER() OVER (ORDER BY total_orders DESC) AS orders_rank, ROW_NUMBER() OVER (ORDER BY avg_order_value DESC) AS avg_order_value_rank, ROW_NUMBER() OVER (ORDER BY avg_delivery_time) AS delivery_speed_rank, ROW_NUMBER() OVER (ORDER BY active_clients DESC) AS active_clients_rank, total_revenue / NULLIF(total_clients, 0) AS revenue_per_client, total_orders / NULLIF(total_clients, 0) AS orders_per_client FROM WilayaPerformance ) SELECT wr.*, CASE WHEN wr.revenue_rank <= 5 THEN 'Tier 1' WHEN wr.revenue_rank <= 15 THEN 'Tier 2' WHEN wr.revenue_rank <= 30 THEN 'Tier 3' ELSE 'Tier 4' END AS wilaya_tier, ROUND((wr.total_revenue * 0.3 + wr.total_orders * 0.2 + wr.avg_order_value * 0.15 + (100 - wr.avg_delivery_time) * 0.15 + wr.active_clients * 0.2), 2) AS performance_score, (SELECT GROUP_CONCAT(DISTINCT p.category ORDER BY p.category SEPARATOR ', ') FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.wilaya_id = wr.wilaya_id AND o.status = 'delivered' GROUP BY o.wilaya_id) AS popular_categories FROM WilayaRankings wr ORDER BY performance_score DESC; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS total_inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS recent_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS average_product_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_product_reviews, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions_count FROM products p WHERE p.quantity > 0 AND p.price > 100 ORDER BY total_inventory_value DESC, recent_cart_additions DESC LIMIT 120;                                                                                                                                                                                                                                                                                                                 
 SELECT a.role, a.username, (SELECT COUNT(*) FROM products WHERE admin_id = a.id) AS products_added, (SELECT COUNT(*) FROM promotions WHERE admin_id = a.id) AS promotions_created, (SELECT COUNT(*) FROM offers WHERE admin_id = a.id) AS offers_created, (SELECT COUNT(*) FROM orders WHERE admin_id = a.id) AS orders_managed FROM admin a ORDER BY products_added + promotions_created + offers_created DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.id, p.name, p.brand, p.category, COUNT(DISTINCT o.client_id) AS unique_buyers, COUNT(DISTINCT f.client_id) AS unique_favoriters, COUNT(DISTINCT cm.client_id) AS unique_commenters, AVG(r.rating) AS avg_rating, COUNT(DISTINCT CASE WHEN o.status = 'delivered' THEN o.id END) AS delivered_orders, SUM(CASE WHEN o.status = 'delivered' THEN o.price ELSE 0 END) AS delivered_revenue FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON ca.client_id = o.client_id LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.id HAVING COUNT(DISTINCT o.client_id) > 0 ORDER BY delivered_revenue DESC;                                                                                                                                                                                                                                                                                                                           
 SELECT p.category, p.brand, COUNT(DISTINCT ca.client_id) as unique_buyers, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as promo_count, AVG(p.price) as avg_original_price FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN promotions pr ON pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN favorites f ON f.product_id = p.id WHERE p.quantity > 5 GROUP BY p.category, p.brand HAVING unique_buyers > 10 ORDER BY unique_buyers DESC, avg_original_price;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT a.role, COUNT(DISTINCT a.id) AS number_of_admins, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, VARIANCE((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS variance_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_managed, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_managed_products FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_managed DESC;                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.category, (SELECT AVG(p2.price) FROM products p2 WHERE p2.category = p.category AND p2.quantity > 0) as avg_price FROM products p GROUP BY p.category ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 3 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour;                                                                                                                                                                                    
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS client_wilaya, w.delivery_price AS wilaya_delivery_cost, COUNT(DISTINCT o.id) AS total_completed_orders, SUM(o.price) AS total_spent_all_time, AVG(o.price) AS average_order_value, MIN(o.orderdate) AS first_purchase_date, MAX(o.orderdate) AS last_purchase_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_purchase, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) AS last_week_cart_activity FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id GROUP BY c.id, c.firstname, c.lastname, c.email, w.name, w.delivery_price HAVING total_completed_orders > 1 ORDER BY total_spent_all_time DESC LIMIT 200;                                                                                                                                                                                                                                 
 SELECT p.name, COUNT(o.id) AS times_ordered, COUNT(ca.id) AS times_in_cart, AVG(r.rating) AS avg_rating FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.name ORDER BY times_ordered DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, COUNT(DISTINCT p.brand) AS number_of_brands, COUNT(DISTINCT p.id) AS total_products_in_category, AVG(p.price) AS average_category_price, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock_in_category, (SELECT SUM(quantity) FROM products) AS overall_total_stock, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category)) AS category_favorite_count, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id IN (SELECT id FROM products WHERE category = p.category)) AS average_category_rating FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%') GROUP BY p.category HAVING total_products_in_category > 3 ORDER BY category_favorite_count DESC, total_stock_in_category DESC;                                                                                                                                                                                                                    
 SELECT a.id, (SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id AND p.quantity < 20) as low_stock_items FROM admin a ORDER BY low_stock_items DESC LIMIT 10; SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_in_hour, SUM(o.price) AS revenue_in_hour, AVG(o.price) AS average_order_value_hour, COUNT(DISTINCT o.client_id) AS unique_customers_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hour_average, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_in_hour > 1 ORDER BY order_date DESC, order_hour;                                                                                                                                                
 SELECT YEAR(c.birthday) as birth_year, (SELECT COUNT(*) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year AND c2.id IN (SELECT client_id FROM orders)) as ordering_clients FROM clients c GROUP BY birth_year ORDER BY ordering_clients DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.brand, (SELECT COUNT(DISTINCT p2.category) FROM products p2 WHERE p2.brand = p.brand) as categories_covered FROM products p GROUP BY p.brand ORDER BY categories_covered DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT o.status, (SELECT COUNT(*) FROM orders o2 WHERE o2.status = o.status AND o2.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) as last_7_days FROM orders o GROUP BY o.status ORDER BY last_7_days DESC; SELECT c.username, SUM(o.price) AS total_spent, COUNT(cl.id) AS claims, COUNT(ret.id) AS returns FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id GROUP BY c.username ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT pr.percentage, (SELECT COUNT(DISTINCT ca.client_id) FROM cart ca WHERE ca.promotion_id = pr.id) as unique_clients FROM promotions pr ORDER BY unique_clients DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, (SELECT COUNT(DISTINCT ca.product_id) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) as recent_cart_items FROM clients c ORDER BY recent_cart_items DESC LIMIT 15;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.id, (SELECT COUNT(DISTINCT cm.client_id) FROM comments cm WHERE cm.product_id = p.id) as unique_commenters FROM products p ORDER BY unique_commenters DESC LIMIT 20;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT w.id, (SELECT MIN(c.birthday) FROM clients c WHERE c.wilaya = w.id) as oldest_client_birthday FROM wilayas w ORDER BY oldest_client_birthday LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT w.id, w.name, w.delivery_price, COUNT(DISTINCT c.id) as client_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.wilaya_id = w.id AND o.status = 'delivered' WHERE w.delivery_price > 200 GROUP BY w.id HAVING order_count > 5 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.category, COUNT(DISTINCT c.id) AS customers, SUM(o.price) AS revenue, AVG(r.rating) AS avg_rating FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON c.id = ca.client_id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.category ORDER BY revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT 'Active_Clients' as segment_type, c.id, c.firstname, c.lastname, COUNT(o.id) as order_count FROM clients c INNER JOIN orders o ON c.id = o.client_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 2 UNION SELECT 'High_Value' as segment_type, c.id, c.firstname, c.lastname, SUM(o.price) as total_spent FROM clients c INNER JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname HAVING SUM(o.price) >= 5000 UNION SELECT 'Frequent_Buyers' as segment_type, c.id, c.firstname, c.lastname, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as activity_period_days FROM clients c INNER JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(o.id) >= 5 AND DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) <= 365 ORDER BY segment_type, order_count DESC LIMIT 45;                                                                                                                                                     
 SELECT w.name AS wilaya, COUNT(DISTINCT c.id) AS clients, COUNT(o.id) AS orders, SUM(o.price) AS total_revenue FROM wilayas w JOIN orders o ON w.id = o.wilaya_id JOIN clients c ON c.id = o.client_id GROUP BY w.name ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT a.username AS admin, COUNT(DISTINCT p.id) AS products_managed, COUNT(DISTINCT pr.id) AS promotions_created FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id GROUP BY a.username ORDER BY products_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT a.id, (SELECT MIN(p.name) FROM products p WHERE p.admin_id = a.id) as first_product_name FROM admin a ORDER BY first_product_name LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT YEAR(c.birthday) as birth_year, (SELECT MAX(c2.birthday) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as latest_birthday FROM clients c GROUP BY birth_year ORDER BY latest_birthday DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.name, SUM(o.price) AS revenue, COUNT(f.id) AS favorites, COUNT(cl.id) AS claims FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN claims cl ON p.id = cl.product_id GROUP BY p.name ORDER BY revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT w.name AS wilaya, COUNT(DISTINCT c.id) AS clients_count, COUNT(DISTINCT o.id) AS orders_count, SUM(o.price) AS total_revenue, AVG(w.delivery_price) AS delivery_price FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON w.id = o.wilaya_id GROUP BY w.id, w.name HAVING clients_count > 5 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT c.wilaya, AVG(o.price) AS avg_order, COUNT(DISTINCT ca.product_id) AS products_browsed, COUNT(i.id) AS messages FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN inbox i ON c.id = i.client_id GROUP BY c.wilaya ORDER BY avg_order DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS currently_active_promotions, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS currently_active_offers FROM admin a ORDER BY total_inventory_value_added DESC;                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.brand, SUM(ca.initial_price) AS cart_value, COUNT(f.id) AS favorites, AVG(p.price) AS avg_price FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id GROUP BY p.brand ORDER BY cart_value DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.firstname, c.lastname, COUNT(DISTINCT p.category) AS categories_explored FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN products p ON p.id = ca.product_id GROUP BY c.id HAVING COUNT(DISTINCT p.category) > 3 ORDER BY categories_explored DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.name, COUNT(cl.id) AS claims, COUNT(ret.id) AS returns, AVG(r.rating) AS avg_rating FROM products p LEFT JOIN claims cl ON p.id = cl.product_id LEFT JOIN orders o ON o.id = cl.order_id LEFT JOIN returns ret ON ret.order_id = o.id LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.name ORDER BY claims DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age_wilaya, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers_count, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY)) AS last_6_months_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY)) AS average_order_value_6_months FROM wilayas w ORDER BY last_6_months_revenue DESC;                                                                                                                                                                                                                                                                                                                 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_month_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 1 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))) AS previous_month_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 2 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 2 MONTH))) AS two_months_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_month_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count FROM clients c HAVING current_month_spending > 0 OR previous_month_spending > 0 OR two_months_ago_spending > 0 ORDER BY (COALESCE(current_month_spending, 0) + COALESCE(previous_month_spending, 0) + COALESCE(two_months_ago_spending, 0)) DESC; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) AS last_week_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers FROM products p WHERE p.quantity > 0 AND p.price > 50 ORDER BY inventory_value DESC, last_week_cart_additions DESC LIMIT 150;                                                                                                                                 
 SELECT a.username, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND price > 100) AS expensive_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND price <= 100) AS affordable_products, (SELECT AVG(price) FROM products WHERE admin_id = a.id) AS avg_product_price FROM admin a ORDER BY expensive_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_per_role, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, STDDEV_SAMP((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS std_dev_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_added, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_added_products, MAX((SELECT MAX(p.price) FROM products p WHERE p.admin_id = a.id)) AS max_price_of_added_products FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_added DESC;                                                                                                                                                                                                                                                                             
 SELECT YEAR(ca.date_cart) AS year, MONTH(ca.date_cart) AS month, DAY(ca.date_cart) AS day, HOUR(ca.date_cart) AS hour, COUNT(DISTINCT ca.id) AS cart_additions_per_hour, COUNT(DISTINCT ca.client_id) AS unique_shoppers_per_hour, AVG(p.price) AS average_product_price_cart, SUM(p.price) AS total_cart_value_per_hour, (SELECT AVG(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_average_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING cart_additions_per_hour > 2 ORDER BY year DESC, month DESC, day DESC, hour; 
 SELECT c.firstname, c.lastname, c.email, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_order, COUNT(o.id) AS total_orders, SUM(o.price) AS total_spent FROM clients c LEFT JOIN orders o ON c.id = o.client_id WHERE o.orderdate IS NOT NULL GROUP BY c.id, c.firstname, c.lastname, c.email HAVING days_since_last_order > 30 ORDER BY days_since_last_order DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.category, COUNT(DISTINCT p.brand) AS number_of_brands_in_category, COUNT(DISTINCT p.id) AS total_products_in_category, AVG(p.price) AS average_price_in_category, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock_in_category, (SELECT SUM(quantity) FROM products) AS overall_total_stock, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category)) AS category_favorites_count, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id IN (SELECT id FROM products WHERE category = p.category)) AS average_rating_in_category, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id IN (SELECT id FROM products WHERE category = p.category)) AS total_comments_in_category FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%') GROUP BY p.category HAVING total_products_in_category > 2 ORDER BY category_favorites_count DESC, total_stock_in_category DESC;                                                 
 SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_per_hour, SUM(o.price) AS revenue_per_hour, AVG(o.price) AS average_order_value_per_hour, COUNT(DISTINCT o.client_id) AS unique_customers_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hourly_average, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_per_hour, (SELECT SUM(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_revenue_per_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 120 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_per_hour > 0 ORDER BY order_date DESC, order_hour;                                                                                                                       
 SELECT w.id, w.name, (SELECT COUNT(*) FROM clients c WHERE c.wilaya = w.id) as total_clients, (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id) as total_orders, (SELECT SUM(price) FROM orders o WHERE o.wilaya_id = w.id) as total_revenue, (SELECT AVG(price) FROM orders o WHERE o.wilaya_id = w.id) as avg_order_value FROM wilayas w WHERE (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id) > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT 'High Value' as client_type, c.id, c.firstname, SUM(o.price) as total_spent FROM clients c JOIN orders o ON o.client_id = c.id GROUP BY c.id HAVING SUM(o.price) > 5000 UNION ALL SELECT 'Frequent Buyer' as client_type, c.id, c.firstname, COUNT(o.id) as order_count FROM clients c JOIN orders o ON o.client_id = c.id GROUP BY c.id HAVING COUNT(o.id) > 10 UNION ALL SELECT 'Product Reviewer' as client_type, c.id, c.firstname, COUNT(cm.id) as review_count FROM clients c JOIN comments cm ON cm.client_id = c.id GROUP BY c.id HAVING COUNT(cm.id) > 5 ORDER BY client_type, total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.brand, COUNT(DISTINCT p.id) AS models_count, AVG(p.price) AS avg_price, SUM(p.quantity) AS total_stock, (SELECT COUNT(*) FROM favorites WHERE product_id IN (SELECT id FROM products WHERE brand = p.brand)) AS brand_favorites FROM products p GROUP BY p.brand HAVING models_count > 3 ORDER BY brand_favorites DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT p.name, p.category, p.brand, p.price, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS cart_count, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS favorite_count, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS avg_rating FROM products p WHERE p.quantity > 0 ORDER BY (cart_count + favorite_count) DESC LIMIT 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions_count, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS active_offers_count, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS delivered_orders_managed FROM admin a ORDER BY total_inventory_value_added DESC;                                                                                                                                                                                                                                                                                                
 SELECT p.category, AVG(p.price) AS avg_category_price, (SELECT AVG(price) FROM products) AS overall_avg_price, COUNT(DISTINCT p.id) AS products_in_category, SUM(p.quantity) AS total_stock FROM products p GROUP BY p.category HAVING avg_category_price > (SELECT AVG(price) FROM products) ORDER BY avg_category_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS average_yearly_order_value, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS highest_order_value FROM wilayas w ORDER BY yearly_revenue DESC;                                                                                                                                                                                                                              
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_category_orders, SUM(o.price) AS monthly_category_revenue, AVG(o.price) AS average_category_order_value, COUNT(DISTINCT o.client_id) AS monthly_category_unique_customers, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue_monthly, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_unique_customers_monthly FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_category_orders > 0 ORDER BY sales_month DESC, monthly_category_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_quarter_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 3 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 3 MONTH))) AS previous_quarter_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 6 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 6 MONTH))) AS two_quarters_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_month_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count FROM clients c HAVING current_quarter_spending > 0 OR previous_quarter_spending > 0 OR two_quarters_ago_spending > 0 ORDER BY (COALESCE(current_quarter_spending, 0) + COALESCE(previous_quarter_spending, 0) + COALESCE(two_quarters_ago_spending, 0)) DESC; 
 SELECT p.category, (SELECT MAX(p2.quantity) FROM products p2 WHERE p2.category = p.category) as max_stock FROM products p GROUP BY p.category ORDER BY max_stock DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.id, (SELECT MIN(r.rating) FROM rating r WHERE r.product_id = p.id) as min_rating FROM products p ORDER BY min_rating LIMIT 20;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT w.id, (SELECT MAX(c.birthday) FROM clients c WHERE c.wilaya = w.id) as youngest_client_birthday FROM wilayas w ORDER BY youngest_client_birthday DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT YEAR(c.birthday) as birth_year, (SELECT MIN(c2.birthday) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year) as earliest_birthday FROM clients c GROUP BY birth_year ORDER BY earliest_birthday LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 3 DAY)) AS last_3_days_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating >= 4) AS positive_ratings_count FROM products p WHERE p.quantity > 0 AND p.price > 25 ORDER BY inventory_value DESC, last_3_days_cart_additions DESC LIMIT 200;                            
 SELECT a.role, (SELECT COUNT(DISTINCT a2.id) FROM admin a2 WHERE a2.role = a.role AND a2.id IN (SELECT admin_id FROM products)) as admins_with_products FROM admin a GROUP BY a.role ORDER BY admins_with_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT p.id, (SELECT COUNT(DISTINCT r.client_id) FROM rating r WHERE r.product_id = p.id AND r.rating <= 2) as low_ratings FROM products p ORDER BY low_ratings DESC LIMIT 20;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT w.id, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id NOT IN (SELECT client_id FROM orders)) as non_ordering_clients FROM wilayas w ORDER BY non_ordering_clients DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT category) FROM products WHERE admin_id = a.id) AS categories_managed, (SELECT COUNT(DISTINCT client_id) FROM orders WHERE admin_id = a.id) AS customers_served, (SELECT AVG(price) FROM orders WHERE admin_id = a.id) AS avg_order_value_managed FROM admin a ORDER BY categories_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT a.id, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id AND p.quantity = 0) as out_of_stock_categories FROM admin a ORDER BY out_of_stock_categories DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT YEAR(c.birthday) as birth_year, (SELECT COUNT(DISTINCT c2.id) FROM clients c2 WHERE YEAR(c2.birthday) = birth_year AND c2.id IN (SELECT client_id FROM cart)) as cart_users FROM clients c GROUP BY birth_year ORDER BY cart_users DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT pr.id, (SELECT COUNT(DISTINCT ca.id) FROM cart ca WHERE ca.promotion_id = pr.id AND ca.date_cart <= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) as week_old_carts FROM promotions pr ORDER BY week_old_carts DESC LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers, (SELECT SUM(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_value FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 1 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour; 
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS wilaya_location, w.delivery_price AS delivery_cost, COUNT(DISTINCT o.id) AS lifetime_completed_orders, SUM(o.price) AS lifetime_total_spent, AVG(o.price) AS lifetime_average_order_value, MIN(o.orderdate) AS first_order_date, MAX(o.orderdate) AS most_recent_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_order, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 14 DAY)) AS last_two_weeks_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorite_items, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id GROUP BY c.id, c.firstname, c.lastname, c.email, w.name, w.delivery_price HAVING lifetime_completed_orders > 0 ORDER BY lifetime_total_spent DESC LIMIT 300; 
 SELECT a.username, a.email, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Electronics') AS electronics_count, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Clothing') AS clothing_count, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND category = 'Home') AS home_count FROM admin a ORDER BY electronics_count + clothing_count + home_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, COUNT(DISTINCT p.brand) AS unique_brands_in_category, COUNT(DISTINCT p.id) AS total_products_in_category, AVG(p.price) AS average_price_in_category, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock_in_category, (SELECT SUM(quantity) FROM products) AS overall_total_stock, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category)) AS category_favorites_count, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id IN (SELECT id FROM products WHERE category = p.category)) AS average_rating_in_category, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id IN (SELECT id FROM products WHERE category = p.category)) AS total_comments_in_category, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id IN (SELECT id FROM products WHERE category = p.category) AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS recent_cart_additions_category FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Service%' OR role LIKE '%Manager%') GROUP BY p.category HAVING total_products_in_category > 1 ORDER BY recent_cart_additions_category DESC, category_favorites_count DESC; 
 SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_per_hour, SUM(o.price) AS revenue_per_hour, AVG(o.price) AS average_order_value_per_hour, COUNT(DISTINCT o.client_id) AS unique_customers_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hourly_average_value, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_per_hour, (SELECT SUM(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_revenue_per_hour, (SELECT COUNT(DISTINCT client_id) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_unique_customers_per_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 150 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_per_hour > 0 ORDER BY order_date DESC, order_hour; 
 SELECT w.name AS wilaya, (SELECT COUNT(*) FROM clients WHERE wilaya = w.id AND birthday >= '1990-01-01') AS young_clients, (SELECT COUNT(*) FROM clients WHERE wilaya = w.id AND birthday < '1990-01-01') AS older_clients, (SELECT AVG(DATEDIFF(CURDATE(), birthday)/365) FROM clients WHERE wilaya = w.id) AS avg_age FROM wilayas w ORDER BY young_clients DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions_count, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS active_offers_count, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS delivered_orders_managed, (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id) AS claims_handled, (SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id) AS returns_processed FROM admin a ORDER BY total_inventory_value_added DESC;                                                                                                                                  
 SELECT * FROM `phpmyadmin`.`pma__bookmark` WHERE ( `user` = '' OR `user` = 'root' ) AND dbase = 'pos' ORDER BY label ASC; SELECT TABLE_NAME FROM information_schema.VIEWS WHERE TABLE_SCHEMA = 'pos' AND TABLE_NAME = 'dataset_ml'; SELECT *, `TABLE_SCHEMA`       AS `Db`, `TABLE_NAME`         AS `Name`, `TABLE_TYPE`         AS `TABLE_TYPE`, `ENGINE`             AS `Engine`, `ENGINE`             AS `Type`, `VERSION`            AS `Version`, `ROW_FORMAT`         AS `Row_format`, `TABLE_ROWS`         AS `Rows`, `AVG_ROW_LENGTH`     AS `Avg_row_length`, `DATA_LENGTH`        AS `Data_length`, `MAX_DATA_LENGTH`    AS `Max_data_length`, `INDEX_LENGTH`       AS `Index_length`, `DATA_FREE`          AS `Data_free`, `AUTO_INCREMENT`     AS `Auto_increment`, `CREATE_TIME`        AS `Create_time`, `UPDATE_TIME`        AS `Update_time`, `CHECK_TIME`         AS `Check_time`, `TABLE_COLLATION`    AS `Collation`, `CHECKSUM`           AS `Checksum`, `CREATE_OPTIONS`     AS `Create_options`, `TABLE_COMMENT`      AS `Comment` FROM `information_schema`.`TABLES` t WHERE `TABLE_SCHEMA`  IN ('pos') AND t.`TABLE_NAME`  = 'dataset_ml' ORDER BY Name ASC; SELECT 1 FROM mysql.user LIMIT 1; SELECT 1 FROM (SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`COLUMN_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`TABLE_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`SCHEMA_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`USER_PRIVILEGES`) t WHERE `IS_GRANTABLE` = 'YES' AND '''root''@''localhost''' LIKE `GRANTEE` LIMIT 1; SELECT `PRIVILEGE_TYPE` FROM `INFORMATION_SCHEMA`.`USER_PRIVILEGES` WHERE GRANTEE='''root''@''localhost''' AND PRIVILEGE_TYPE='TRIGGER'; SELECT `SCHEMA_NAME` FROM `INFORMATION_SCHEMA`.`SCHEMATA`, (SELECT DB_first_level FROM ( SELECT DISTINCT SUBSTRING_INDEX(SCHEMA_NAME, '_', 1) DB_first_level FROM INFORMATION_SCHEMA.SCHEMATA WHERE TRUE ) t ORDER BY DB_first_level ASC LIMIT 0, 100) t2 WHERE TRUE AND 1 = LOCATE(CONCAT(DB_first_level, '_'), CONCAT(SCHEMA_NAME, '_')) ORDER BY SCHEMA_NAME ASC; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`='pos' AND `TABLE_TYPE` IN('BASE TABLE', 'SYSTEM VERSIONED'); SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`='pos' AND `TABLE_TYPE` NOT IN('BASE TABLE', 'SYSTEM VERSIONED'); SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`ROUTINES` WHERE `ROUTINE_SCHEMA` ='pos' AND `ROUTINE_TYPE`='FUNCTION'; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`ROUTINES` WHERE `ROUTINE_SCHEMA` ='pos'AND `ROUTINE_TYPE`='PROCEDURE'; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`EVENTS` WHERE `EVENT_SCHEMA` ='pos'; SELECT `TABLE_NAME` AS `name` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`='pos' AND `TABLE_TYPE` IN('BASE TABLE', 'SYSTEM VERSIONED') ORDER BY `TABLE_NAME` ASC LIMIT 0, 50; SELECT COUNT(*) FROM ( SELECT DISTINCT SUBSTRING_INDEX(SCHEMA_NAME, '_', 1) DB_first_level FROM INFORMATION_SCHEMA.SCHEMATA WHERE TRUE ) t; SELECT COUNT(*) FROM ( SELECT DISTINCT SUBSTRING_INDEX(SCHEMA_NAME, '_', 1) DB_first_level FROM INFORMATION_SCHEMA.SCHEMATA WHERE TRUE ) t; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`ROUTINES` WHERE `ROUTINE_SCHEMA` ='pos'AND `ROUTINE_TYPE`='PROCEDURE'; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`ROUTINES` WHERE `ROUTINE_SCHEMA` ='pos'AND `ROUTINE_TYPE`='PROCEDURE'; SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`='pos' AND `TABLE_TYPE` IN('BASE TABLE', 'SYSTEM VERSIONED'); SELECT COUNT(*) FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA`='pos' AND `TABLE_TYPE` IN('BASE TABLE', 'SYSTEM VERSIONED'); SELECT 1 FROM mysql.user LIMIT 1; SELECT 1 FROM (SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`COLUMN_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`TABLE_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`SCHEMA_PRIVILEGES` UNION SELECT `GRANTEE`, `IS_GRANTABLE` FROM `INFORMATION_SCHEMA`.`USER_PRIVILEGES`) t WHERE `IS_GRANTABLE` = 'YES' AND '''root''@''localhost''' LIKE `GRANTEE` LIMIT 1; SELECT p.name, p.brand, p.category, p.price, (SELECT username FROM admin WHERE id = p.admin_id) AS added_by, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS in_carts, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS in_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS avg_rating FROM products p WHERE p.price > 200 ORDER BY p.price DESC; 
 SELECT c.id, c.firstname, c.lastname, c.email, c.wilaya, TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) as age, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as lifetime_value, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT f.product_id) as favorite_items, COUNT(DISTINCT cm.id) as comments_made, AVG(r.rating) as avg_rating_given FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id WHERE c.birthday IS NOT NULL GROUP BY c.id HAVING total_orders > 0 ORDER BY lifetime_value DESC LIMIT 50;                                                                                                                                                                                                       
 SELECT c.id, c.firstname, c.lastname, COUNT(o.id) as order_count, SUM(o.price) as total_spent, RANK() OVER (ORDER BY SUM(o.price) DESC) as spending_rank, DENSE_RANK() OVER (ORDER BY COUNT(o.id) DESC) as frequency_rank, AVG(o.price) OVER (PARTITION BY c.wilaya) as avg_wilaya_spending, SUM(o.price) OVER (PARTITION BY MONTH(o.orderdate)) as monthly_total FROM clients c JOIN orders o ON o.client_id = c.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 1 YEAR) GROUP BY c.id, c.firstname, c.lastname, c.wilaya, MONTH(o.orderdate) HAVING order_count > 0 ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT pr.id, p.name, pr.percentage, COUNT(ca.id) AS cart_adds, COUNT(o.id) AS purchases FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON pr.id = ca.promotion_id LEFT JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') GROUP BY pr.id ORDER BY purchases DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT a.username, a.role, COUNT(DISTINCT p.id) AS products, COUNT(DISTINCT pr.id) AS promotions, COUNT(DISTINCT o.id) AS orders FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers o ON a.id = o.admin_id GROUP BY a.id ORDER BY products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT a.role, COUNT(DISTINCT a.id) AS admin_count, SUM((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS avg_products_per_admin, MAX((SELECT COUNT(*) FROM products WHERE admin_id = a.id)) AS max_products_by_admin FROM admin a GROUP BY a.role ORDER BY total_products_added DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) AS total_orders, SUM(o.price) AS total_spent, AVG(o.price) AS avg_order_value, MAX(o.orderdate) AS last_order_date FROM clients c LEFT JOIN orders o ON c.id = o.client_id GROUP BY c.id, c.firstname, c.lastname, c.email HAVING total_orders > 0 ORDER BY total_spent DESC LIMIT 100;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT c.id, c.email, COUNT(o.id) AS orders, SUM(o.price) AS spent, COUNT(cl.id) + COUNT(ret.id) AS issues FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN claims cl ON c.id = cl.client_id LEFT JOIN returns ret ON c.id = ret.client_id GROUP BY c.id ORDER BY issues DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.category, p.brand, COUNT(r.id) AS ratings, AVG(r.rating) AS avg_rating, COUNT(cm.id) AS comments FROM products p LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN comments cm ON p.id = cm.product_id GROUP BY p.category, p.brand ORDER BY ratings DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.category, p.brand, p.name, p.price, ROW_NUMBER() OVER (PARTITION BY p.category ORDER BY p.price DESC) as price_rank_in_category, AVG(p.price) OVER (PARTITION BY p.category) as avg_category_price, COUNT(ca.id) OVER (PARTITION BY p.category) as total_cart_additions_category, RANK() OVER (ORDER BY COUNT(f.id) DESC) as favorites_rank FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.category, p.brand, p.name, p.price ORDER BY p.category, price_rank_in_category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT c.username, COUNT(DISTINCT p.brand) AS brands_purchased, COUNT(DISTINCT p.category) AS categories_purchased FROM clients c JOIN orders o ON c.id = o.client_id JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id GROUP BY c.username ORDER BY brands_purchased DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers_count, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS average_yearly_order_value, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS highest_order_value, (SELECT MIN(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.price > 0) AS lowest_positive_order_value FROM wilayas w ORDER BY yearly_revenue DESC;                                                                                
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_category_orders, SUM(o.price) AS monthly_category_revenue, AVG(o.price) AS average_category_order_value, COUNT(DISTINCT o.client_id) AS monthly_category_unique_customers, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue_monthly, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_unique_customers_monthly, (SELECT COUNT(*) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'pending') AS pending_category_orders_monthly FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_category_orders > 0 ORDER BY sales_month DESC, monthly_category_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_year_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE()) - 1) AS previous_year_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE()) - 2) AS two_years_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 60 DAY)) AS last_60_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given FROM clients c HAVING current_year_spending > 0 OR previous_year_spending > 0 OR two_years_ago_spending > 0 ORDER BY (COALESCE(current_year_spending, 0) + COALESCE(previous_year_spending, 0) + COALESCE(two_years_ago_spending, 0)) DESC; 
 SELECT 'DATA_QUALITY_ASSESSMENT' as assessment_type, TABLE_NAME, COLUMN_NAME, DATA_TYPE, COUNT(*) as total_rows, SUM(CASE WHEN column_value IS NULL THEN 1 ELSE 0 END) as null_count, ROUND(SUM(CASE WHEN column_value IS NULL THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as null_percentage, COUNT(DISTINCT column_value) as distinct_values, MIN(column_value) as min_value, MAX(column_value) as max_value, AVG( CASE WHEN DATA_TYPE IN ('int', 'decimal', 'float', 'double') THEN CAST(column_value AS DECIMAL(20,4)) ELSE NULL END ) as avg_numeric_value, STDDEV( CASE WHEN DATA_TYPE IN ('int', 'decimal', 'float', 'double') THEN CAST(column_value AS DECIMAL(20,4)) ELSE NULL END ) as stddev_numeric_value, CASE WHEN SUM(CASE WHEN column_value IS NULL THEN 1 ELSE 0 END) * 100.0 / COUNT(*) > 50 THEN 'HIGH_NULL_RATE_WARNING' WHEN COUNT(DISTINCT column_value) = 1 THEN 'LOW_CARDINALITY_WARNING' WHEN DATA_TYPE LIKE '%char%' AND MAX(LENGTH(column_value)) > 1000 THEN 'LONG_TEXT_WARNING' ELSE 'DATA_QUALITY_OK' END as quality_assessment FROM ( SELECT 'clients' as TABLE_NAME, 'email' as COLUMN_NAME, 'varchar' as DATA_TYPE, email as column_value FROM clients UNION ALL SELECT 'clients', 'phone_number', 'varchar', phone_number FROM clients UNION ALL SELECT 'products', 'price', 'double', CAST(price AS CHAR) FROM products UNION ALL SELECT 'orders', 'price', 'double', CAST(price AS CHAR) FROM orders ) data_sample GROUP BY TABLE_NAME, COLUMN_NAME, DATA_TYPE HAVING total_rows >= 10 ORDER BY null_percentage DESC, total_rows DESC LIMIT 20; 
 SELECT p.name, COUNT(DISTINCT c.wilaya) AS wilaya_reach, SUM(o.price) AS total_revenue FROM products p JOIN cart ca ON p.id = ca.product_id JOIN clients c ON c.id = ca.client_id LEFT JOIN orders o ON o.client_id = c.id GROUP BY p.name ORDER BY wilaya_reach DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT pr.percentage, COUNT(DISTINCT p.category) AS categories_covered, AVG(p.price) AS avg_product_price FROM promotions pr JOIN products p ON p.id = pr.product_id WHERE pr.enddate >= CURDATE() GROUP BY pr.percentage ORDER BY categories_covered DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT a.username, COUNT(DISTINCT o.client_id) AS clients_served, SUM(o.price) AS revenue_managed FROM admin a JOIN orders o ON a.id = o.admin_id GROUP BY a.username ORDER BY revenue_managed DESC; WITH client_features AS ( SELECT c.id as client_id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT ct.id) as cart_interactions, (COUNT(DISTINCT o.id) - MIN(COUNT(DISTINCT o.id)) OVER ()) * 1.0 / NULLIF(MAX(COUNT(DISTINCT o.id)) OVER () - MIN(COUNT(DISTINCT o.id)) OVER (), 0) as norm_orders, (SUM(o.price) - MIN(SUM(o.price)) OVER ()) * 1.0 / NULLIF(MAX(SUM(o.price)) OVER () - MIN(SUM(o.price)) OVER (), 0) as norm_spent, (DATEDIFF(CURDATE(), MAX(o.orderdate)) - MIN(DATEDIFF(CURDATE(), MAX(o.orderdate))) OVER ()) * 1.0 / NULLIF(MAX(DATEDIFF(CURDATE(), MAX(o.orderdate))) OVER () - MIN(DATEDIFF(CURDATE(), MAX(o.orderdate))) OVER (), 0) as norm_recency FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ct ON c.id = ct.client_id LEFT JOIN products p ON ct.product_id = p.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY) GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT o.id) >= 1 ), cluster_centroids AS ( SELECT 'VIP' as cluster_name, 0.8 as centroid_orders, 0.9 as centroid_spent, 0.1 as centroid_recency UNION ALL SELECT 'LOYAL', 0.6, 0.5, 0.2 UNION ALL SELECT 'AT_RISK', 0.3, 0.4, 0.8 UNION ALL SELECT 'NEW', 0.1, 0.1, 0.1 ), client_clusters AS ( SELECT cf.client_id, cf.firstname, cf.lastname, cf.total_orders, cf.total_spent, cf.days_since_last_order, cc.cluster_name, SQRT( POWER(cf.norm_orders - cc.centroid_orders, 2) + POWER(cf.norm_spent - cc.centroid_spent, 2) + POWER(cf.norm_recency - cc.centroid_recency, 2) ) as distance_to_centroid, ROW_NUMBER() OVER (PARTITION BY cf.client_id ORDER BY SQRT( POWER(cf.norm_orders - cc.centroid_orders, 2) + POWER(cf.norm_spent - cc.centroid_spent, 2) + POWER(cf.norm_recency - cc.centroid_recency, 2) ) ) as cluster_rank FROM client_features cf CROSS JOIN cluster_centroids cc WHERE cf.total_orders >= 1 ), cluster_summary AS ( SELECT cluster_name, COUNT(*) as client_count, ROUND(AVG(total_orders), 1) as avg_orders, ROUND(AVG(total_spent), 2) as avg_spent, ROUND(AVG(days_since_last_order), 1) as avg_days_since_last, ROUND(MIN(distance_to_centroid), 3) as min_distance, ROUND(AVG(distance_to_centroid), 3) as avg_distance, ROUND(MAX(distance_to_centroid), 3) as max_distance, ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 1) as cluster_percentage FROM client_clusters WHERE cluster_rank = 1 GROUP BY cluster_name ) SELECT cluster_name, client_count, CONCAT(FORMAT(cluster_percentage, 1), '%') as segment_size, avg_orders, CONCAT('$', FORMAT(avg_spent, 2)) as avg_lifetime_value, avg_days_since_last, ROUND(avg_distance, 3) as avg_cluster_cohesion, CASE WHEN cluster_name = 'VIP' THEN 'FOCUS_RETENTION_AND_UPSELL' WHEN cluster_name = 'LOYAL' THEN 'ENCOURAGE_REPEAT_PURCHASES' WHEN cluster_name = 'AT_RISK' THEN 'REACTIVATION_CAMPAIGNS' WHEN cluster_name = 'NEW' THEN 'ONBOARDING_AND_EDUCATION' END as recommended_action FROM cluster_summary ORDER BY avg_spent DESC LIMIT 10; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 1 DAY)) AS last_24h_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating >= 4) AS positive_ratings_count, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating <= 2) AS negative_ratings_count FROM products p WHERE p.quantity > 0 AND p.price > 10 ORDER BY inventory_value DESC, last_24h_cart_additions DESC LIMIT 250; 
 SELECT a.username, a.role, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND price > 500) AS premium_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND price BETWEEN 100 AND 500) AS midrange_products, (SELECT COUNT(*) FROM products WHERE admin_id = a.id AND price < 100) AS budget_products FROM admin a ORDER BY premium_products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_in_role, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, STDDEV_SAMP((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS std_dev_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_added, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_added_products, MAX((SELECT MAX(p.price) FROM products p WHERE p.admin_id = a.id)) AS max_price_of_added_products, MIN((SELECT MIN(p.price) FROM products p WHERE p.admin_id = a.id)) AS min_price_of_added_products, SUM((SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id)) AS total_promotions_created, SUM((SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS delivered_orders_managed FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_added DESC; 
 SELECT c.email, COUNT(DISTINCT o.wilaya_id) AS delivery_locations, SUM(o.price) AS total_spent FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.email HAVING COUNT(DISTINCT o.wilaya_id) > 1 ORDER BY delivery_locations DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.name, p.quantity, COUNT(ca.id) AS demand, (p.quantity / COUNT(ca.id)) AS stock_to_demand_ratio FROM products p LEFT JOIN cart ca ON p.id = ca.product_id WHERE p.quantity > 0 GROUP BY p.id ORDER BY stock_to_demand_ratio ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers, (SELECT SUM(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_value, (SELECT COUNT(DISTINCT ca2.id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_additions FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 0 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour; 
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS client_wilaya, w.delivery_price, COUNT(DISTINCT o.id) AS total_completed_orders, SUM(o.price) AS total_amount_spent, AVG(o.price) AS average_order_value, MIN(o.orderdate) AS first_purchase_date, MAX(o.orderdate) AS last_purchase_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_purchase, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 21 DAY)) AS last_3_weeks_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorite_items, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given, (SELECT COUNT(*) FROM claims cl WHERE cl.client_id = c.id) AS total_claims_filed, (SELECT COUNT(*) FROM returns rt WHERE rt.client_id = c.id) AS total_returns_requested FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id GROUP BY c.id, c.firstname, c.lastname, c.email, w.name, w.delivery_price HAVING total_completed_orders > 0 ORDER BY total_amount_spent DESC LIMIT 400; 
 SELECT p.category, COUNT(DISTINCT p.brand) AS number_of_brands, COUNT(DISTINCT p.id) AS total_products, AVG(p.price) AS average_price, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock, (SELECT SUM(quantity) FROM products) AS overall_total_stock, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category)) AS category_favorites, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id IN (SELECT id FROM products WHERE category = p.category)) AS average_category_rating, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id IN (SELECT id FROM products WHERE category = p.category)) AS total_category_comments, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id IN (SELECT id FROM products WHERE category = p.category) AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 45 DAY)) AS recent_category_cart_additions, (SELECT COUNT(*) FROM promotions pr WHERE pr.product_id IN (SELECT id FROM products WHERE category = p.category) AND pr.enddate >= CURDATE()) AS active_category_promotions FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%' OR role LIKE '%Service%') GROUP BY p.category HAVING total_products > 0 ORDER BY recent_category_cart_additions DESC, category_favorites DESC; 
 SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_per_hour, SUM(o.price) AS revenue_per_hour, AVG(o.price) AS average_order_value_per_hour, COUNT(DISTINCT o.client_id) AS unique_customers_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hourly_average_value, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_per_hour, (SELECT SUM(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_revenue_per_hour, (SELECT COUNT(DISTINCT client_id) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_unique_customers_per_hour, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'pending') AS pending_orders_per_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_per_hour > 0 ORDER BY order_date DESC, order_hour; 
 SELECT pr.id as promotion_id, p.name as product_name, p.price as original_price, pr.price as promo_price, pr.percentage as discount_percentage, pr.startdate, pr.enddate, DATEDIFF(pr.enddate, pr.startdate) as duration_days, COUNT(DISTINCT ca.id) as times_added_to_cart, COUNT(DISTINCT f.id) as times_favorited, COUNT(DISTINCT o.id) as times_purchased_with_promo, SUM(o.price) as revenue_from_promo FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN favorites f ON f.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY pr.id, p.name, p.price, pr.price, pr.percentage, pr.startdate, pr.enddate HAVING times_added_to_cart > 0 ORDER BY discount_percentage DESC, times_purchased_with_promo DESC;                                                                                                                                                                                               
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions_count, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS active_offers_count, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS delivered_orders_managed, (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id) AS claims_handled, (SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id) AS returns_processed, (SELECT COUNT(*) FROM inbox i WHERE i.admin_id = a.id AND i.status = 'unread') AS unread_messages FROM admin a ORDER BY total_inventory_value_added DESC;                               
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers_count, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS average_yearly_order_value, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS highest_order_value, (SELECT MIN(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.price > 0) AS lowest_positive_order_value, (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_30_days_orders FROM wilayas w ORDER BY yearly_revenue DESC; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_category_orders, SUM(o.price) AS monthly_category_revenue, AVG(o.price) AS average_category_order_value, COUNT(DISTINCT o.client_id) AS monthly_category_unique_customers, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue_monthly, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_unique_customers_monthly, (SELECT COUNT(*) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'pending') AS pending_category_orders_monthly, (SELECT AVG(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_average_order_value_monthly FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_category_orders > 0 ORDER BY sales_month DESC, monthly_category_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_month_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 1 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))) AS previous_month_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 2 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 2 MONTH))) AS two_months_ago_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND MONTH(o.orderdate) = MONTH(DATE_SUB(CURDATE(), INTERVAL 3 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 3 MONTH))) AS three_months_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS last_90_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left FROM clients c HAVING current_month_spending > 0 OR previous_month_spending > 0 OR two_months_ago_spending > 0 OR three_months_ago_spending > 0 ORDER BY (COALESCE(current_month_spending, 0) + COALESCE(previous_month_spending, 0) + COALESCE(two_months_ago_spending, 0) + COALESCE(three_months_ago_spending, 0)) DESC; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY)) AS last_week_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating >= 4) AS positive_ratings_count, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating <= 2) AS negative_ratings_count, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS all_time_cart_additions FROM products p WHERE p.quantity > 0 AND p.price > 5 ORDER BY inventory_value DESC, last_week_cart_additions DESC LIMIT 300; 
 SELECT HOUR(o.orderdate) as hour_of_day, DAYNAME(o.orderdate) as day_of_week, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_clients, COUNT(DISTINCT p.category) as categories_ordered, AVG(w.delivery_price) as avg_delivery_cost FROM orders o JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY HOUR(o.orderdate), DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate) ORDER BY DAYOFWEEK(o.orderdate), hour_of_day;                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT c.wilaya, w.name as wilaya_name, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as category_revenue, COUNT(DISTINCT c.id) as unique_clients, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.id) as unique_products_sold, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT c.id), 0), 2) as revenue_per_client FROM orders o JOIN clients c ON c.id = o.client_id JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY c.wilaya, w.name, p.category HAVING order_count > 0 AND category_revenue > 0 ORDER BY c.wilaya, category_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT acquisition_month, COUNT(DISTINCT client_id) as acquired_clients, COUNT(DISTINCT CASE WHEN month_diff = 1 THEN client_id END) as retained_month_1, COUNT(DISTINCT CASE WHEN month_diff = 2 THEN client_id END) as retained_month_2, COUNT(DISTINCT CASE WHEN month_diff = 3 THEN client_id END) as retained_month_3, ROUND(COUNT(DISTINCT CASE WHEN month_diff = 1 THEN client_id END) * 100.0 / COUNT(DISTINCT client_id), 2) as retention_rate_month_1, ROUND(COUNT(DISTINCT CASE WHEN month_diff = 2 THEN client_id END) * 100.0 / COUNT(DISTINCT client_id), 2) as retention_rate_month_2, ROUND(COUNT(DISTINCT CASE WHEN month_diff = 3 THEN client_id END) * 100.0 / COUNT(DISTINCT client_id), 2) as retention_rate_month_3 FROM ( SELECT c.id as client_id, DATE_FORMAT(MIN(o.orderdate), '%Y-%m') as acquisition_month, TIMESTAMPDIFF(MONTH, MIN(o.orderdate), o2.orderdate) as month_diff FROM clients c JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate AND TIMESTAMPDIFF(MONTH, o.orderdate, o2.orderdate) BETWEEN 0 AND 3 GROUP BY c.id, o2.orderdate ) as client_retention WHERE acquisition_month >= '2024-01-01' GROUP BY acquisition_month ORDER BY acquisition_month DESC; 
 SELECT c.id as client_id, c.firstname, c.lastname, COUNT(DISTINCT ca.id) as total_carts, AVG(DATEDIFF(ca.date_cart, IFNULL(( SELECT MAX(ca2.date_cart) FROM cart ca2 WHERE ca2.client_id = c.id AND ca2.date_cart < ca.date_cart ), ca.date_cart))) as avg_days_between_carts, COUNT(DISTINCT ca.product_id) as unique_products_carted, SUM(p.price) as total_cart_value, AVG(p.price) as avg_product_price_in_cart, COUNT(DISTINCT p.category) as unique_categories_carted, MAX(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as has_promotional_items, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN ca.id END) as recent_carts FROM clients c JOIN cart ca ON ca.client_id = c.id JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id, c.firstname, c.lastname HAVING total_carts > 1 ORDER BY total_carts DESC;                                                                                                                                                   
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_in_role, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, STDDEV_SAMP((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS std_dev_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_added, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_added_products, MAX((SELECT MAX(p.price) FROM products p WHERE p.admin_id = a.id)) AS max_price_of_added_products, MIN((SELECT MIN(p.price) FROM products p WHERE p.admin_id = a.id)) AS min_price_of_added_products, SUM((SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id)) AS total_promotions_created, SUM((SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS delivered_orders_managed, SUM((SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id)) AS claims_handled, SUM((SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id)) AS returns_processed FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_added DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND YEAR(orderdate) = 2024) AS spent_2024, (SELECT SUM(price) FROM orders WHERE client_id = c.id AND YEAR(orderdate) = 2023) AS spent_2023, (SELECT COUNT(*) FROM cart WHERE client_id = c.id) AS cart_items, (SELECT COUNT(*) FROM favorites WHERE client_id = c.id) AS favorite_items FROM clients c HAVING COALESCE(spent_2024, 0) + COALESCE(spent_2023, 0) > 500 ORDER BY (COALESCE(spent_2024, 0) + COALESCE(spent_2023, 0)) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT a.username, COUNT(DISTINCT p.category) AS product_categories, COUNT(pr.id) AS promotions_created FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id GROUP BY a.username ORDER BY product_categories DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT o.id as order_id, o.orderdate, o.price, o.status, c.firstname, c.lastname, w.name as wilaya, o.price / NULLIF(( SELECT AVG(o2.price) FROM orders o2 WHERE o2.wilaya_id = o.wilaya_id AND o2.orderdate BETWEEN DATE_SUB(o.orderdate, INTERVAL 30 DAY) AND DATE_ADD(o.orderdate, INTERVAL 30 DAY) ), 0) as price_vs_wilaya_avg, o.price / NULLIF(( SELECT AVG(o2.price) FROM orders o2 WHERE o2.client_id = o.client_id ), 0) as price_vs_client_avg, CASE WHEN o.price > 3 * ( SELECT AVG(o2.price) FROM orders o2 WHERE o2.wilaya_id = o.wilaya_id ) THEN 'High Outlier' WHEN o.price < 0.3 * ( SELECT AVG(o2.price) FROM orders o2 WHERE o2.wilaya_id = o.wilaya_id ) THEN 'Low Outlier' ELSE 'Normal' END as outlier_status FROM orders o JOIN clients c ON c.id = o.client_id JOIN wilayas w ON w.id = o.wilaya_id WHERE o.orderdate >= '2024-01-01' HAVING outlier_status != 'Normal' ORDER BY o.price DESC;                                                                                                                                          
 SELECT p.name, COUNT(DISTINCT o.client_id) AS buyers, AVG(o.price) AS avg_purchase_price FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON o.client_id = ca.client_id GROUP BY p.name ORDER BY buyers DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers, (SELECT SUM(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_value, (SELECT COUNT(DISTINCT ca2.id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_additions, (SELECT COUNT(DISTINCT p2.category) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_categories_shopped FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 0 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour; 
 SELECT c.username, COUNT(DISTINCT pr.product_id) AS promo_products_explored, AVG(pr.percentage) AS avg_discount_explored FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.username ORDER BY promo_products_explored DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS client_wilaya, w.delivery_price, COUNT(DISTINCT o.id) AS lifetime_orders, SUM(o.price) AS lifetime_spending, AVG(o.price) AS average_order_value, MIN(o.orderdate) AS first_order_date, MAX(o.orderdate) AS last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_order, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_30_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given, (SELECT COUNT(*) FROM claims cl WHERE cl.client_id = c.id) AS total_claims_filed, (SELECT COUNT(*) FROM returns rt WHERE rt.client_id = c.id) AS total_returns_requested, (SELECT COUNT(DISTINCT p.category) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p ON ca2.product_id = p.id WHERE o2.client_id = c.id) AS distinct_categories_purchased FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id GROUP BY c.id, c.firstname, c.lastname, c.email, w.name, w.delivery_price HAVING lifetime_orders > 0 ORDER BY lifetime_spending DESC LIMIT 500; 
 SELECT p.category, COUNT(DISTINCT p.brand) AS unique_brands, COUNT(DISTINCT p.id) AS total_products, AVG(p.price) AS average_price, (SELECT AVG(price) FROM products) AS overall_average_price, SUM(p.quantity) AS total_stock, (SELECT SUM(quantity) FROM products) AS overall_total_stock, (SELECT COUNT(*) FROM favorites f WHERE f.product_id IN (SELECT id FROM products WHERE category = p.category)) AS category_favorites, (SELECT AVG(r.rating) FROM rating r WHERE r.product_id IN (SELECT id FROM products WHERE category = p.category)) AS average_category_rating, (SELECT COUNT(*) FROM comments cm WHERE cm.product_id IN (SELECT id FROM products WHERE category = p.category)) AS total_category_comments, (SELECT COUNT(*) FROM cart ca WHERE ca.product_id IN (SELECT id FROM products WHERE category = p.category) AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 60 DAY)) AS recent_category_cart_additions, (SELECT COUNT(*) FROM promotions pr WHERE pr.product_id IN (SELECT id FROM products WHERE category = p.category) AND pr.enddate >= CURDATE()) AS active_category_promotions, (SELECT COUNT(*) FROM offers of WHERE of.product_id LIKE CONCAT('%,', (SELECT id FROM products WHERE category = p.category LIMIT 1), ',%') OR of.product_id LIKE CONCAT((SELECT id FROM products WHERE category = p.category LIMIT 1), ',%') OR of.product_id LIKE CONCAT('%,', (SELECT id FROM products WHERE category = p.category LIMIT 1)) OR of.product_id = (SELECT id FROM products WHERE category = p.category LIMIT 1)) AS category_in_offers FROM products p WHERE p.admin_id IN (SELECT id FROM admin WHERE role LIKE '%Manager%' OR role LIKE '%Service%' OR role LIKE '%Admin%') GROUP BY p.category HAVING total_products > 0 ORDER BY recent_category_cart_additions DESC, category_favorites DESC; 
 SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_per_hour, SUM(o.price) AS revenue_per_hour, AVG(o.price) AS average_order_value_per_hour, COUNT(DISTINCT o.client_id) AS unique_customers_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hourly_average_value, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_per_hour, (SELECT SUM(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_revenue_per_hour, (SELECT COUNT(DISTINCT client_id) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_unique_customers_per_hour, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'pending') AS pending_orders_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_average_order_value_per_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_per_hour > 0 ORDER BY order_date DESC, order_hour; 
 SELECT p.category, COUNT(DISTINCT ca.client_id) AS cart_users, COUNT(DISTINCT o.client_id) AS buyers FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') GROUP BY p.category ORDER BY buyers DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT c.username, COUNT(DISTINCT pr.id) AS promotions_used, AVG(pr.percentage) AS avg_discount FROM clients c JOIN cart ca ON c.id = ca.client_id JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.username ORDER BY promotions_used DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions_count, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS active_offers_count, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS delivered_orders_managed, (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id) AS claims_handled, (SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id) AS returns_processed, (SELECT COUNT(*) FROM inbox i WHERE i.admin_id = a.id AND i.status = 'unread') AS unread_messages, (SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS average_delivery_time_managed FROM admin a ORDER BY total_inventory_value_added DESC; 
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers_count, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS average_yearly_order_value, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS highest_order_value, (SELECT MIN(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.price > 0) AS lowest_positive_order_value, (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_30_days_orders, (SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS average_delivery_time_90_days FROM wilayas w ORDER BY yearly_revenue DESC; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_category_orders, SUM(o.price) AS monthly_category_revenue, AVG(o.price) AS average_category_order_value, COUNT(DISTINCT o.client_id) AS monthly_category_unique_customers, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue_monthly, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_unique_customers_monthly, (SELECT COUNT(*) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'pending') AS pending_category_orders_monthly, (SELECT AVG(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_average_order_value_monthly, (SELECT COUNT(DISTINCT p2.brand) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_brands_purchased FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_category_orders > 0 ORDER BY sales_month DESC, monthly_category_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(CURDATE()) AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_quarter_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 3 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 3 MONTH))) AS previous_quarter_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 6 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 6 MONTH))) AS two_quarters_ago_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND QUARTER(o.orderdate) = QUARTER(DATE_SUB(CURDATE(), INTERVAL 9 MONTH)) AND YEAR(o.orderdate) = YEAR(DATE_SUB(CURDATE(), INTERVAL 9 MONTH))) AS three_quarters_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 120 DAY)) AS last_120_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given FROM clients c HAVING current_quarter_spending > 0 OR previous_quarter_spending > 0 OR two_quarters_ago_spending > 0 OR three_quarters_ago_spending > 0 ORDER BY (COALESCE(current_quarter_spending, 0) + COALESCE(previous_quarter_spending, 0) + COALESCE(two_quarters_ago_spending, 0) + COALESCE(three_quarters_ago_spending, 0)) DESC; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 14 DAY)) AS last_two_weeks_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating >= 4) AS positive_ratings_count, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating <= 2) AS negative_ratings_count, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS all_time_cart_additions, (SELECT COUNT(DISTINCT client_id) FROM cart WHERE product_id = p.id) AS unique_customers_in_cart, (SELECT COUNT(DISTINCT client_id) FROM favorites WHERE product_id = p.id) AS unique_customers_favorited FROM products p WHERE p.quantity > 0 AND p.price > 1 ORDER BY inventory_value DESC, last_two_weeks_cart_additions DESC LIMIT 400; 
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_in_role, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, STDDEV_SAMP((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS std_dev_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_added, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_added_products, MAX((SELECT MAX(p.price) FROM products p WHERE p.admin_id = a.id)) AS max_price_of_added_products, MIN((SELECT MIN(p.price) FROM products p WHERE p.admin_id = a.id)) AS min_price_of_added_products, SUM((SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id)) AS total_promotions_created, SUM((SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS delivered_orders_managed, SUM((SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id)) AS claims_handled, SUM((SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id)) AS returns_processed, SUM((SELECT COUNT(*) FROM inbox i WHERE i.admin_id = a.id)) AS total_messages_sent, AVG((SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS average_delivery_time_managed FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_added DESC; 
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers, (SELECT SUM(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_value, (SELECT COUNT(DISTINCT ca2.id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_additions, (SELECT COUNT(DISTINCT p2.category) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_categories_shopped, (SELECT COUNT(DISTINCT p2.brand) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_brands_shopped FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 0 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour; 
 SELECT c.id, c.firstname, c.lastname, c.email, w.name AS client_wilaya, w.delivery_price, COUNT(DISTINCT o.id) AS total_lifetime_orders, SUM(o.price) AS total_lifetime_spending, AVG(o.price) AS average_lifetime_order_value, MIN(o.orderdate) AS first_order_date, MAX(o.orderdate) AS last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) AS days_since_last_order, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 45 DAY)) AS last_45_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorite_items, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given, (SELECT COUNT(*) FROM claims cl WHERE cl.client_id = c.id) AS total_claims_filed, (SELECT COUNT(*) FROM returns rt WHERE rt.client_id = c.id) AS total_returns_requested, (SELECT COUNT(DISTINCT p.category) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p ON ca2.product_id = p.id WHERE o2.client_id = c.id) AS distinct_categories_purchased, (SELECT COUNT(DISTINCT p.brand) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p ON ca2.product_id = p.id WHERE o2.client_id = c.id) AS distinct_brands_purchased, (SELECT SUM(o2.price) FROM orders o2 WHERE o2.client_id = c.id AND o2.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS last_year_spending FROM clients c LEFT JOIN orders o ON c.id = o.client_id AND o.status = 'delivered' LEFT JOIN wilayas w ON c.wilaya = w.id GROUP BY c.id, c.firstname, c.lastname, c.email, w.name, w.delivery_price HAVING total_lifetime_orders > 0 ORDER BY total_lifetime_spending DESC LIMIT 600; 
 SELECT DATE(o.orderdate) AS order_date, HOUR(o.orderdate) AS order_hour, COUNT(o.id) AS orders_per_hour, SUM(o.price) AS revenue_per_hour, AVG(o.price) AS average_order_value_per_hour, COUNT(DISTINCT o.client_id) AS unique_customers_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate)) AS historical_hourly_average_value, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_orders_per_hour, (SELECT SUM(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_revenue_per_hour, (SELECT COUNT(DISTINCT client_id) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_unique_customers_per_hour, (SELECT COUNT(*) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'pending') AS pending_orders_per_hour, (SELECT AVG(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS delivered_average_order_value_per_hour, (SELECT MIN(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered' AND price > 0) AS min_delivered_order_value_per_hour, (SELECT MAX(price) FROM orders WHERE DATE(orderdate) = DATE(o.orderdate) AND HOUR(orderdate) = HOUR(o.orderdate) AND status = 'delivered') AS max_delivered_order_value_per_hour FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 730 DAY) GROUP BY DATE(o.orderdate), HOUR(o.orderdate) HAVING orders_per_hour > 0 ORDER BY order_date DESC, order_hour; 
 SELECT p.brand, COUNT(DISTINCT o.client_id) AS customers, SUM(o.price) AS revenue FROM products p JOIN cart ca ON p.id = ca.product_id JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') GROUP BY p.brand ORDER BY revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT a.username, a.role, (SELECT COUNT(DISTINCT p.category) FROM products p WHERE p.admin_id = a.id) AS distinct_categories_managed, (SELECT COUNT(DISTINCT p.brand) FROM products p WHERE p.admin_id = a.id) AS distinct_brands_managed, (SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id) AS total_inventory_value_added, (SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id AND pr.enddate >= CURDATE()) AS active_promotions_count, (SELECT COUNT(*) FROM offers of WHERE of.admin_id = a.id AND of.enddate >= CURDATE()) AS active_offers_count, (SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS delivered_orders_managed, (SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id) AS claims_handled, (SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id) AS returns_processed, (SELECT COUNT(*) FROM inbox i WHERE i.admin_id = a.id AND i.status = 'unread') AS unread_messages, (SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS average_delivery_time_managed, (SELECT COUNT(DISTINCT o.client_id) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS unique_customers_served, (SELECT AVG(o.price) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered') AS average_order_value_managed FROM admin a ORDER BY total_inventory_value_added DESC; 
 SELECT p.category, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity * p.price) as potential_revenue, COALESCE(SUM(o.price), 0) as actual_revenue, COUNT(DISTINCT o.id) as sales_count, COALESCE(SUM(w.delivery_price), 0) as total_delivery_costs, COALESCE(SUM(pr.percentage * p.price / 100), 0) as total_discounts_given, COALESCE(SUM(o.price) - COALESCE(SUM(w.delivery_price), 0) - COALESCE(SUM(pr.percentage * p.price / 100), 0), 0) as net_revenue, ROUND(COALESCE(SUM(o.price), 0) * 100.0 / NULLIF(SUM(p.quantity * p.price), 0), 2) as inventory_turnover_rate, ROUND(COALESCE(COUNT(DISTINCT o.id), 0) * 100.0 / NULLIF(COUNT(DISTINCT p.id), 0), 2) as sales_penetration_rate FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN wilayas w ON w.id = o.wilaya_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate GROUP BY p.category HAVING product_count > 0 ORDER BY net_revenue DESC;                            
 SELECT w.name AS wilaya, w.delivery_price, (SELECT AVG(DATEDIFF(CURDATE(), c.birthday)/365) FROM clients c WHERE c.wilaya = w.id) AS average_client_age, (SELECT COUNT(DISTINCT c.id) FROM clients c WHERE c.wilaya = w.id AND c.id IN (SELECT client_id FROM orders WHERE status = 'delivered')) AS active_buyers_count, (SELECT SUM(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_revenue, (SELECT AVG(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS average_yearly_order_value, (SELECT MAX(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered') AS highest_order_value, (SELECT MIN(o.price) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.price > 0) AS lowest_positive_order_value, (SELECT COUNT(*) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_30_days_orders, (SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY)) AS average_delivery_time_90_days, (SELECT COUNT(DISTINCT o.client_id) FROM orders o WHERE o.wilaya_id = w.id AND o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY)) AS yearly_unique_customers FROM wilayas w ORDER BY yearly_revenue DESC; 
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') AS sales_month, p.category, COUNT(DISTINCT o.id) AS monthly_category_orders, SUM(o.price) AS monthly_category_revenue, AVG(o.price) AS average_category_order_value, COUNT(DISTINCT o.client_id) AS monthly_category_unique_customers, (SELECT SUM(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_revenue_monthly, (SELECT COUNT(DISTINCT o2.client_id) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_category_unique_customers_monthly, (SELECT COUNT(*) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'pending') AS pending_category_orders_monthly, (SELECT AVG(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered') AS delivered_average_order_value_monthly, (SELECT COUNT(DISTINCT p2.brand) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')) AS monthly_brands_purchased, (SELECT MIN(o2.price) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p2 ON ca2.product_id = p2.id WHERE p2.category = p.category AND DATE_FORMAT(o2.orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m') AND o2.status = 'delivered' AND o2.price > 0) AS min_delivered_order_value_monthly FROM orders o JOIN cart ca ON o.cart_id = ca.id JOIN products p ON ca.product_id = p.id WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_category_orders > 0 ORDER BY sales_month DESC, monthly_category_revenue DESC; 
 SELECT c.id, c.firstname, c.lastname, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE())) AS current_year_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE()) - 1) AS previous_year_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE()) - 2) AS two_years_ago_spending, (SELECT SUM(o.price) FROM orders o WHERE o.client_id = c.id AND YEAR(o.orderdate) = YEAR(CURDATE()) - 3) AS three_years_ago_spending, (SELECT COUNT(*) FROM cart ca WHERE ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 180 DAY)) AS last_180_days_cart_activity, (SELECT COUNT(*) FROM favorites f WHERE f.client_id = c.id) AS total_favorites_count, (SELECT COUNT(*) FROM comments cm WHERE cm.client_id = c.id) AS total_comments_left, (SELECT AVG(r.rating) FROM rating r WHERE r.client_id = c.id) AS average_rating_given, (SELECT COUNT(DISTINCT p.category) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p ON ca2.product_id = p.id WHERE o2.client_id = c.id) AS distinct_categories_purchased, (SELECT COUNT(DISTINCT p.brand) FROM orders o2 JOIN cart ca2 ON o2.cart_id = ca2.id JOIN products p ON ca2.product_id = p.id WHERE o2.client_id = c.id) AS distinct_brands_purchased FROM clients c HAVING current_year_spending > 0 OR previous_year_spending > 0 OR two_years_ago_spending > 0 OR three_years_ago_spending > 0 ORDER BY (COALESCE(current_year_spending, 0) + COALESCE(previous_year_spending, 0) + COALESCE(two_years_ago_spending, 0) + COALESCE(three_years_ago_spending, 0)) DESC; 
 SELECT p.name, p.category, p.brand, p.price, p.quantity, (p.price * p.quantity) AS inventory_value, (SELECT COUNT(*) FROM cart WHERE product_id = p.id AND date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)) AS last_30_days_cart_additions, (SELECT COUNT(*) FROM favorites WHERE product_id = p.id) AS total_favorites, (SELECT AVG(rating) FROM rating WHERE product_id = p.id) AS product_average_rating, (SELECT COUNT(*) FROM comments WHERE product_id = p.id) AS total_comments, (SELECT COUNT(*) FROM promotions WHERE product_id = p.id AND enddate >= CURDATE()) AS active_promotions, (SELECT COUNT(*) FROM offers WHERE product_id LIKE CONCAT('%,', p.id, ',%') OR product_id LIKE CONCAT(p.id, ',%') OR product_id LIKE CONCAT('%,', p.id) OR product_id = p.id) AS included_in_offers, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating >= 4) AS positive_ratings_count, (SELECT COUNT(*) FROM rating WHERE product_id = p.id AND rating <= 2) AS negative_ratings_count, (SELECT COUNT(*) FROM cart WHERE product_id = p.id) AS all_time_cart_additions, (SELECT COUNT(DISTINCT client_id) FROM cart WHERE product_id = p.id) AS unique_customers_in_cart, (SELECT COUNT(DISTINCT client_id) FROM favorites WHERE product_id = p.id) AS unique_customers_favorited, (SELECT COUNT(DISTINCT client_id) FROM rating WHERE product_id = p.id) AS unique_customers_rated, (SELECT COUNT(DISTINCT client_id) FROM comments WHERE product_id = p.id) AS unique_customers_commented FROM products p WHERE p.quantity > 0 AND p.price > 0 ORDER BY inventory_value DESC, last_30_days_cart_additions DESC LIMIT 500; 
 SELECT a.role, COUNT(DISTINCT a.id) AS admins_in_role, SUM((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS total_products_added, AVG((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS average_products_per_admin, STDDEV_SAMP((SELECT COUNT(*) FROM products p WHERE p.admin_id = a.id)) AS std_dev_products_per_admin, SUM((SELECT SUM(p.quantity * p.price) FROM products p WHERE p.admin_id = a.id)) AS total_inventory_value_added, AVG((SELECT AVG(p.price) FROM products p WHERE p.admin_id = a.id)) AS average_price_of_added_products, MAX((SELECT MAX(p.price) FROM products p WHERE p.admin_id = a.id)) AS max_price_of_added_products, MIN((SELECT MIN(p.price) FROM products p WHERE p.admin_id = a.id)) AS min_price_of_added_products, SUM((SELECT COUNT(*) FROM promotions pr WHERE pr.admin_id = a.id)) AS total_promotions_created, SUM((SELECT COUNT(*) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS delivered_orders_managed, SUM((SELECT COUNT(*) FROM claims cl WHERE cl.admin_id = a.id)) AS claims_handled, SUM((SELECT COUNT(*) FROM returns rt WHERE rt.admin_id = a.id)) AS returns_processed, SUM((SELECT COUNT(*) FROM inbox i WHERE i.admin_id = a.id)) AS total_messages_sent, AVG((SELECT AVG(DATEDIFF(o.deliveredDate, o.orderdate)) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS average_delivery_time_managed, SUM((SELECT COUNT(DISTINCT o.client_id) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS unique_customers_served, AVG((SELECT AVG(o.price) FROM orders o WHERE o.admin_id = a.id AND o.status = 'delivered')) AS average_order_value_managed FROM admin a GROUP BY a.role HAVING total_products_added > 0 ORDER BY total_inventory_value_added DESC; 
 SELECT c.id, c.firstname, c.lastname, c.email, c.wilaya, TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) as age, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT cm.id) as reviews_written, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT f.id) as favorites_count, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) as discounted_items_purchased, AVG(CASE WHEN pr.id IS NOT NULL THEN pr.percentage ELSE 0 END) as avg_discount_used, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 0 ELSE COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id) END as discount_usage_rate FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya, c.birthday HAVING order_count > 0 ORDER BY total_spent DESC; SELECT p.category, COUNT(ca.id) AS cart_additions, COUNT(o.id) AS conversions, (COUNT(o.id) / COUNT(ca.id) * 100) AS conversion_rate FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON o.cart_id LIKE CONCAT('%', ca.id, '%') GROUP BY p.category ORDER BY conversion_rate DESC; 
 SELECT c.wilaya, COUNT(DISTINCT ca.product_id) AS products, AVG(ca.initial_price) AS avg_cart_price FROM clients c JOIN cart ca ON c.id = ca.client_id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY c.wilaya ORDER BY products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT pr.id, p.name, COUNT(r.id) AS ratings, AVG(r.rating) AS avg_rating FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN rating r ON pr.id = r.promotion_id GROUP BY pr.id ORDER BY ratings DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT YEAR(ca.date_cart) AS cart_year, MONTH(ca.date_cart) AS cart_month, DAY(ca.date_cart) AS cart_day, HOUR(ca.date_cart) AS cart_hour, COUNT(DISTINCT ca.id) AS hourly_cart_additions, COUNT(DISTINCT ca.client_id) AS hourly_unique_shoppers, AVG(p.price) AS average_product_price_in_cart, SUM(p.price) AS total_cart_value_hourly, (SELECT AVG(price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_avg_cart_value, (SELECT COUNT(DISTINCT ca2.client_id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_unique_shoppers, (SELECT SUM(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_value, (SELECT COUNT(DISTINCT ca2.id) FROM cart ca2 WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_total_cart_additions, (SELECT COUNT(DISTINCT p2.category) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_categories_shopped, (SELECT COUNT(DISTINCT p2.brand) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS daily_brands_shopped, (SELECT MAX(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart)) AS max_product_price_daily, (SELECT MIN(p2.price) FROM cart ca2 JOIN products p2 ON ca2.product_id = p2.id WHERE YEAR(ca2.date_cart) = YEAR(ca.date_cart) AND MONTH(ca2.date_cart) = MONTH(ca.date_cart) AND DAY(ca2.date_cart) = DAY(ca.date_cart) AND p2.price > 0) AS min_positive_product_price_daily FROM cart ca JOIN products p ON ca.product_id = p.id WHERE ca.date_cart >= '2024-01-01' GROUP BY YEAR(ca.date_cart), MONTH(ca.date_cart), DAY(ca.date_cart), HOUR(ca.date_cart) HAVING hourly_cart_additions > 0 ORDER BY cart_year DESC, cart_month DESC, cart_day DESC, cart_hour; 
 SELECT c.id, c.firstname, MIN(o.orderdate) AS first_order, MAX(o.orderdate) AS last_order, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) AS customer_lifespan FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id HAVING DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) > 180 ORDER BY customer_lifespan DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT QUARTER(o.orderdate) AS quarter, YEAR(o.orderdate) AS year, AVG(o.price) AS avg_order_value FROM orders o JOIN clients c ON c.id = o.client_id WHERE c.wilaya IN (1, 16, 31) GROUP BY YEAR(o.orderdate), QUARTER(o.orderdate) ORDER BY year DESC, quarter DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.name, COUNT(ca.id) AS weekend_cart_adds FROM products p JOIN cart ca ON p.id = ca.product_id WHERE DAYOFWEEK(ca.date_cart) IN (1, 7) GROUP BY p.name ORDER BY weekend_cart_adds DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT c.username, TIMESTAMPDIFF(DAY, MAX(o.orderdate), CURDATE()) AS days_since_last_order FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.username HAVING TIMESTAMPDIFF(DAY, MAX(o.orderdate), CURDATE()) > 90 ORDER BY days_since_last_order DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT c.wilaya, DAYNAME(o.orderdate) AS day, COUNT(o.id) AS orders FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.wilaya, DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate) ORDER BY orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT c.id, MIN(ca.date_cart) AS first_cart, MAX(ca.date_cart) AS last_cart, COUNT(ca.id) AS total_items FROM clients c JOIN cart ca ON c.id = ca.client_id GROUP BY c.id HAVING DATEDIFF(MAX(ca.date_cart), MIN(ca.date_cart)) < 7 ORDER BY total_items DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT c.id, YEAR(c.birthday) AS birth_year, COUNT(o.id) AS orders, AVG(o.price) AS avg_order FROM clients c JOIN orders o ON c.id = o.client_id GROUP BY c.id, YEAR(c.birthday) ORDER BY orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.name, DATEDIFF(CURDATE(), MAX(ca.date_cart)) AS days_since_last_cart FROM products p JOIN cart ca ON p.id = ca.product_id GROUP BY p.name ORDER BY days_since_last_cart ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) as sales_last_30_days, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) as sales_30_60_days_ago, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 60 DAY) THEN 1 ELSE 0 END), 0) as sales_60_90_days_ago, COALESCE(AVG(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.price END), 0) as avg_price_last_30_days, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN ca.id END) as cart_additions_last_7_days, COUNT(DISTINCT CASE WHEN f.id IS NOT NULL THEN f.id END) as current_favorites, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL AND CURDATE() BETWEEN pr.startdate AND pr.enddate THEN pr.id END) as active_promotions, CASE WHEN p.quantity = 0 THEN 'Out of Stock' WHEN p.quantity < COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) THEN 'Stock < Monthly Demand' WHEN p.quantity < COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) * 2 THEN 'Stock < 2x Monthly Demand' ELSE 'Adequate Stock' END as stock_forecast_status, ROUND(COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) * 1.1, 0) as predicted_next_30_days_sales FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN promotions pr ON pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING sales_last_30_days > 0 ORDER BY predicted_next_30_days_sales DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, COALESCE(pr.price, p.price) current_price, COALESCE(pr.percentage, 0) discount_percentage, COUNT(DISTINCT ca.id) cart_additions, COUNT(DISTINCT f.id) favorite_additions, COUNT(DISTINCT cm.id) comment_count FROM products p LEFT JOIN promotions pr ON pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN cart ca ON ca.product_id = p.id OR ca.promotion_id = pr.id LEFT JOIN favorites f ON f.product_id = p.id OR f.promotion_id = pr.id LEFT JOIN comments cm ON cm.product_id = p.id OR cm.promotion_id = pr.id WHERE p.quantity > 0 AND (p.price > 200 OR (pr.percentage IS NOT NULL AND pr.percentage > 10)) GROUP BY p.id HAVING cart_additions > 1 OR favorite_additions > 2 OR comment_count > 0 ORDER BY current_price DESC, cart_additions DESC LIMIT 90;                                                                                                                                                                                                         
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) order_count, COUNT(DISTINCT ct.id) cart_count, COUNT(DISTINCT cm.id) comment_count, COUNT(DISTINCT f.id) favorite_count, COUNT(DISTINCT rt.id) rating_count, MAX(o.orderdate) last_order_date FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ct ON ct.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN rating rt ON rt.client_id = c.id WHERE c.wilaya IN (1, 2, 3, 4, 5, 6, 7, 8, 9, 10) AND YEAR(c.birthday) BETWEEN 1985 AND 2005 GROUP BY c.id HAVING order_count > 0 AND (cart_count > 2 OR comment_count > 1 OR favorite_count > 0 OR rating_count > 0) ORDER BY last_order_date DESC, order_count DESC LIMIT 100;                                                                                                                                                                                                                                                                          
 SELECT o.id as order_id, o.orderdate, o.price as order_total, o.status, c.firstname, c.lastname, c.wilaya, w.name as wilaya_name, w.delivery_price, COUNT(DISTINCT ca.product_id) as product_count, GROUP_CONCAT(DISTINCT p.category SEPARATOR ', ') as categories, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN ca.id END) as discounted_items_count, SUM(CASE WHEN pr.id IS NOT NULL THEN pr.percentage * p.price / 100 ELSE 0 END) as total_discount_value, AVG(p.price) as avg_product_price, MAX(p.price) as max_product_price, MIN(p.price) as min_product_price, CASE WHEN o.price > 1000 THEN 'Large Order' WHEN o.price > 500 THEN 'Medium Order' ELSE 'Small Order' END as order_size_category, DATEDIFF(o.deliveredDate, o.orderdate) as delivery_days, CASE WHEN DATEDIFF(o.deliveredDate, o.orderdate) > 7 THEN 'Late Delivery' WHEN DATEDIFF(o.deliveredDate, o.orderdate) <= 3 THEN 'Fast Delivery' ELSE 'Normal Delivery' END as delivery_performance FROM orders o JOIN clients c ON c.id = o.client_id JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id WHERE o.orderdate >= '2024-01-01' GROUP BY o.id, o.orderdate, o.price, o.status, c.firstname, c.lastname, c.wilaya, w.name, w.delivery_price, o.deliveredDate HAVING product_count > 1 ORDER BY o.orderdate DESC, o.price DESC; 
 SELECT p.category, COUNT(DISTINCT p.id) as product_count, AVG(p.price) as avg_price, MAX(p.price) as max_price, MIN(p.price) as min_price FROM products p LEFT JOIN cart c ON p.id = c.product_id WHERE p.quantity > 0 GROUP BY p.category HAVING product_count > 2 ORDER BY avg_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT w.name, COUNT(DISTINCT c.id) as client_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue FROM wilayas w LEFT JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id WHERE w.delivery_price > 250 GROUP BY w.id HAVING client_count > 1 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.brand, COUNT(DISTINCT p.id) as product_count, SUM(p.quantity) as total_stock, AVG(p.price) as avg_price, MIN(p.price) as min_price, MAX(p.price) as max_price, COUNT(DISTINCT pr.id) as active_promotions, COUNT(DISTINCT ca.client_id) as unique_cart_additions, COUNT(DISTINCT f.client_id) as unique_favorites, COUNT(DISTINCT cm.id) as total_reviews, AVG(r.rating) as avg_rating, COUNT(DISTINCT o.id) as total_sales, SUM(o.price) as total_revenue, COUNT(DISTINCT c.id) as unique_customers, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT p.id), 0), 2) as revenue_per_product, ROUND(COUNT(DISTINCT o.id) / NULLIF(COUNT(DISTINCT p.id), 0), 2) as sales_per_product, ROUND(AVG(r.rating), 2) as customer_satisfaction_score FROM products p LEFT JOIN promotions pr ON pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN cart ca2 ON ca2.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca2.id, o.cart_id) LEFT JOIN clients c ON c.id = o.client_id WHERE p.brand IS NOT NULL AND p.brand != '' GROUP BY p.brand HAVING product_count > 0 AND total_revenue > 0 ORDER BY total_revenue DESC, avg_rating DESC; 
 SELECT c.id, c.firstname, c.lastname, c.email, TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) as age, c.wilaya, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders_count, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_usage_percentage, AVG(CASE WHEN pr.id IS NOT NULL THEN pr.percentage ELSE 0 END) as avg_discount_used, COUNT(DISTINCT cm.id) as reviews_written, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT f.id) as favorites_count, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'Active' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) BETWEEN 31 AND 90 THEN 'At Risk' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) > 90 THEN 'Inactive' ELSE 'Unknown' END as current_status, ROUND(SUM(o.price) / NULLIF(DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)), 1), 2) as daily_spending_rate FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id WHERE c.birthday IS NOT NULL GROUP BY c.id, c.firstname, c.lastname, c.email, c.birthday, c.wilaya HAVING total_orders > 0 ORDER BY total_spent DESC; 
 SELECT p.id, p.name, COUNT(DISTINCT cm.id) as comments, COUNT(DISTINCT r.id) as ratings, AVG(r.rating) as avg_rating FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id WHERE p.price > 100 GROUP BY p.id HAVING comments > 0 OR ratings > 0 ORDER BY avg_rating DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) as sales_last_30_days, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) as sales_30_60_days_ago, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 60 DAY) THEN 1 ELSE 0 END), 0) as sales_60_90_days_ago, COALESCE(AVG(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.price END), p.price) as avg_selling_price, COUNT(DISTINCT ca.id) as current_cart_additions, COUNT(DISTINCT f.id) as favorite_count, COUNT(DISTINCT cm.id) as review_count, AVG(r.rating) as avg_rating, CASE WHEN p.quantity = 0 THEN 'Out of Stock - Urgent' WHEN p.quantity < COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) THEN 'Critical - Restock Needed' WHEN p.quantity < COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) * 2 THEN 'Low - Monitor Closely' WHEN p.quantity > COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) * 4 THEN 'Overstock - Consider Promotion' ELSE 'Optimal' END as stock_status, ROUND(COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) * 1.2, 0) as suggested_reorder_quantity, ROUND(p.quantity / NULLIF(COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0), 0), 1) as months_of_stock_remaining FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id WHERE p.quantity >= 0 GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity HAVING sales_last_30_days > 0 OR current_cart_additions > 0 ORDER BY CASE WHEN p.quantity = 0 THEN 1 WHEN p.quantity < COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END), 0) THEN 2 ELSE 3 END, sales_last_30_days DESC; 
 SELECT segment, COUNT(DISTINCT client_id) as client_count, AVG(total_orders) as avg_orders_per_client, AVG(total_spent) as avg_spent_per_client, AVG(avg_order_value) as avg_order_value, AVG(days_since_last_order) as avg_days_since_last_order, SUM(total_spent) as segment_total_spent, SUM(total_orders) as segment_total_orders, AVG(categories_purchased) as avg_categories_per_client, AVG(brands_purchased) as avg_brands_per_client, AVG(reviews_written) as avg_reviews_per_client, AVG(favorites_count) as avg_favorites_per_client, ROUND(SUM(total_spent) * 100.0 / (SELECT SUM(price) FROM orders), 2) as revenue_share_percentage FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_count, CASE WHEN SUM(o.price) > 5000 THEN 'VIP' WHEN SUM(o.price) > 2000 THEN 'Gold' WHEN SUM(o.price) > 500 THEN 'Silver' WHEN SUM(o.price) > 0 THEN 'Bronze' ELSE 'Prospect' END as segment FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id GROUP BY c.id ) as client_segments GROUP BY segment ORDER BY segment_total_spent DESC; 
 SELECT p.category, COUNT(DISTINCT p.id) as products, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT f.id) as favorites FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.price BETWEEN 50 AND 500 GROUP BY p.category HAVING products > 1 ORDER BY cart_additions DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as month, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as monthly_revenue, COUNT(DISTINCT o.client_id) as unique_customers, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.id) as unique_products_sold, SUM(p.quantity) as total_quantity_sold, AVG(w.delivery_price) as avg_delivery_cost, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_rate, LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) as prev_month_orders, LAG(SUM(o.price), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')) as prev_month_revenue, ROUND((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2) as order_growth_rate, ROUND((SUM(o.price) - LAG(SUM(o.price), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(SUM(o.price), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2) as revenue_growth_rate FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id JOIN wilayas w ON w.id = o.wilaya_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.orderdate >= '2023-01-01' GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING monthly_revenue > 0 ORDER BY month DESC, monthly_revenue DESC; 
 SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT pr.id) as promotions_created, COUNT(DISTINCT o.id) as orders_handled, COUNT(DISTINCT cl.id) as claims_resolved, COUNT(DISTINCT rt.id) as returns_processed, COUNT(DISTINCT ib.id) as messages_sent, SUM(o.price) as total_revenue_managed, AVG(o.price) as avg_order_value_handled, COUNT(DISTINCT o.client_id) as unique_customers_served, MIN(o.orderdate) as first_activity_date, MAX(o.orderdate) as last_activity_date, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as activity_period_days, ROUND(COUNT(DISTINCT o.id) * 1.0 / NULLIF(DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)), 1), 2) as avg_orders_per_day, ROUND(SUM(o.price) / NULLIF(DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)), 1), 2) as avg_revenue_per_day, CASE WHEN a.role = '1' THEN 'Admin' WHEN a.role = '2' THEN 'Client Service' WHEN a.role = '3' THEN 'Marketing' ELSE 'Other' END as role_description FROM admin a LEFT JOIN products p ON p.admin_id = a.id LEFT JOIN promotions pr ON pr.admin_id = a.id LEFT JOIN orders o ON o.admin_id = a.id LEFT JOIN claims cl ON cl.admin_id = a.id LEFT JOIN returns rt ON rt.admin_id = a.id LEFT JOIN inbox ib ON ib.admin_id = a.id GROUP BY a.id, a.username, a.role HAVING orders_handled > 0 OR products_managed > 0 ORDER BY total_revenue_managed DESC; 
 SELECT p.id, p.name, COUNT(DISTINCT cm.id) as comments, COUNT(DISTINCT r.id) as ratings, AVG(r.rating) as avg_rating FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id WHERE p.price < 500 GROUP BY p.id HAVING comments > 0 ORDER BY avg_rating DESC; SELECT a.id, a.username, COUNT(DISTINCT cl.id) as claims, COUNT(DISTINCT r.id) as returns, COUNT(DISTINCT i.id) as messages FROM admin a LEFT JOIN claims cl ON a.id = cl.admin_id LEFT JOIN returns r ON a.id = r.admin_id LEFT JOIN inbox i ON a.id = i.admin_id WHERE a.role IN ('2','3') GROUP BY a.id HAVING claims > 0 OR returns > 0 ORDER BY claims DESC; SELECT source, COUNT(DISTINCT client_id) as total_clients, SUM(total_orders) as total_orders, SUM(total_spent) as total_revenue, AVG(total_spent) as avg_client_value, AVG(total_orders) as avg_orders_per_client, AVG(avg_order_value) as avg_order_value, AVG(days_since_last_order) as avg_recency, SUM(CASE WHEN total_orders = 1 THEN 1 ELSE 0 END) as one_time_buyers, SUM(CASE WHEN total_orders > 1 THEN 1 ELSE 0 END) as repeat_buyers, ROUND(SUM(CASE WHEN total_orders > 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(DISTINCT client_id), 2) as repeat_rate, AVG(categories_purchased) as avg_categories_per_client, AVG(brands_purchased) as avg_brands_per_client FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, CASE WHEN c.email LIKE '%@gmail.com%' THEN 'Gmail Users' WHEN c.email LIKE '%@yahoo.com%' THEN 'Yahoo Users' WHEN c.email LIKE '%@hotmail.com%' THEN 'Hotmail Users' WHEN c.wilaya IN (16, 31, 9) THEN 'Major Cities' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 25 THEN 'Young Adults' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 25 AND 40 THEN 'Adults' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) > 40 THEN 'Mature Adults' ELSE 'Other' END as source FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id GROUP BY c.id, c.email, c.wilaya, c.birthday ) as client_analysis GROUP BY source HAVING total_clients > 0 ORDER BY total_revenue DESC; 
 SELECT a.id, a.username, a.role, COUNT(DISTINCT p.id) as products, COUNT(DISTINCT pr.id) as promotions, COUNT(DISTINCT of.id) as offers FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN promotions pr ON a.id = pr.admin_id LEFT JOIN offers of ON a.id = of.admin_id GROUP BY a.id HAVING products > 0 OR promotions > 0 OR offers > 0 ORDER BY a.role, products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT ofr.id as offer_id, ofr.name as offer_name, ofr.price as offer_price, ofr.startdate, ofr.enddate, a.username as created_by, COUNT(DISTINCT ca.id) as times_added_to_cart, COUNT(DISTINCT o.id) as orders_with_offer, SUM(o.price) as revenue_from_offer, COUNT(DISTINCT o.client_id) as unique_customers_using_offer, AVG(o.price) as avg_order_value_with_offer, DATEDIFF(ofr.enddate, ofr.startdate) as offer_duration_days, CASE WHEN CURDATE() BETWEEN ofr.startdate AND ofr.enddate THEN 'Active' WHEN CURDATE() > ofr.enddate THEN 'Expired' ELSE 'Upcoming' END as offer_status, GROUP_CONCAT(DISTINCT p.name SEPARATOR '; ') as included_products, COUNT(DISTINCT p.id) as product_count_in_offer, AVG(p.price) as avg_original_product_price, ROUND(ofr.price * 100.0 / NULLIF(AVG(p.price), 0), 2) as discount_percentage_vs_individual FROM offers ofr JOIN admin a ON a.id = ofr.admin_id LEFT JOIN cart ca ON ca.offer_id = ofr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON FIND_IN_SET(p.id, REPLACE(ofr.product_id, ',', '')) WHERE ofr.startdate >= '2024-01-01' GROUP BY ofr.id, ofr.name, ofr.price, ofr.startdate, ofr.enddate, a.username HAVING orders_with_offer > 0 ORDER BY revenue_from_offer DESC; 
 SELECT metric, value, percentage_change, trend FROM ( SELECT 'Total Customers' as metric, COUNT(DISTINCT c.id) as value, ROUND((COUNT(DISTINCT c.id) - LAG(COUNT(DISTINCT c.id)) OVER (ORDER BY MIN(c.id))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT c.id)) OVER (ORDER BY MIN(c.id)), 0), 2) as percentage_change, CASE WHEN COUNT(DISTINCT c.id) > LAG(COUNT(DISTINCT c.id)) OVER (ORDER BY MIN(c.id)) THEN '?' WHEN COUNT(DISTINCT c.id) < LAG(COUNT(DISTINCT c.id)) OVER (ORDER BY MIN(c.id)) THEN '?' ELSE '?' END as trend FROM clients c UNION ALL SELECT 'Total Orders' as metric, COUNT(DISTINCT o.id) as value, ROUND((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id)) OVER (ORDER BY MIN(o.id))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id)) OVER (ORDER BY MIN(o.id)), 0), 2) as percentage_change, CASE WHEN COUNT(DISTINCT o.id) > LAG(COUNT(DISTINCT o.id)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN COUNT(DISTINCT o.id) < LAG(COUNT(DISTINCT o.id)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o UNION ALL SELECT 'Total Revenue' as metric, ROUND(SUM(o.price), 2) as value, ROUND((SUM(o.price) - LAG(SUM(o.price)) OVER (ORDER BY MIN(o.id))) * 100.0 / NULLIF(LAG(SUM(o.price)) OVER (ORDER BY MIN(o.id)), 0), 2) as percentage_change, CASE WHEN SUM(o.price) > LAG(SUM(o.price)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN SUM(o.price) < LAG(SUM(o.price)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o UNION ALL SELECT 'Average Order Value' as metric, ROUND(AVG(o.price), 2) as value, ROUND((AVG(o.price) - LAG(AVG(o.price)) OVER (ORDER BY MIN(o.id))) * 100.0 / NULLIF(LAG(AVG(o.price)) OVER (ORDER BY MIN(o.id)), 0), 2) as percentage_change, CASE WHEN AVG(o.price) > LAG(AVG(o.price)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN AVG(o.price) < LAG(AVG(o.price)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o UNION ALL SELECT 'Total Products' as metric, COUNT(DISTINCT p.id) as value, ROUND((COUNT(DISTINCT p.id) - LAG(COUNT(DISTINCT p.id)) OVER (ORDER BY MIN(p.id))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT p.id)) OVER (ORDER BY MIN(p.id)), 0), 2) as percentage_change, CASE WHEN COUNT(DISTINCT p.id) > LAG(COUNT(DISTINCT p.id)) OVER (ORDER BY MIN(p.id)) THEN '?' WHEN COUNT(DISTINCT p.id) < LAG(COUNT(DISTINCT p.id)) OVER (ORDER BY MIN(p.id)) THEN '?' ELSE '?' END as trend FROM products p UNION ALL SELECT 'Active Promotions' as metric, COUNT(DISTINCT pr.id) as value, ROUND((COUNT(DISTINCT pr.id) - LAG(COUNT(DISTINCT pr.id)) OVER (ORDER BY MIN(pr.id))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT pr.id)) OVER (ORDER BY MIN(pr.id)), 0), 2) as percentage_change, CASE WHEN COUNT(DISTINCT pr.id) > LAG(COUNT(DISTINCT pr.id)) OVER (ORDER BY MIN(pr.id)) THEN '?' WHEN COUNT(DISTINCT pr.id) < LAG(COUNT(DISTINCT pr.id)) OVER (ORDER BY MIN(pr.id)) THEN '?' ELSE '?' END as trend FROM promotions pr WHERE CURDATE() BETWEEN pr.startdate AND pr.enddate UNION ALL SELECT 'Customer Satisfaction' as metric, ROUND(AVG(r.rating), 2) as value, ROUND((AVG(r.rating) - LAG(AVG(r.rating)) OVER (ORDER BY MIN(r.id))) * 100.0 / NULLIF(LAG(AVG(r.rating)) OVER (ORDER BY MIN(r.id)), 0), 2) as percentage_change, CASE WHEN AVG(r.rating) > LAG(AVG(r.rating)) OVER (ORDER BY MIN(r.id)) THEN '?' WHEN AVG(r.rating) < LAG(AVG(r.rating)) OVER (ORDER BY MIN(r.id)) THEN '?' ELSE '?' END as trend FROM rating r UNION ALL SELECT 'Return Rate' as metric, ROUND(COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), 2) as value, ROUND( ((COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) - LAG(COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) OVER (ORDER BY MIN(o.id))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) OVER (ORDER BY MIN(o.id)), 0), 2 ) as percentage_change, CASE WHEN COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0) > LAG(COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0) < LAG(COUNT(DISTINCT rt.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o LEFT JOIN returns rt ON rt.order_id = o.id ) as metrics ORDER BY CASE metric WHEN 'Total Revenue' THEN 1 WHEN 'Total Customers' THEN 2 WHEN 'Total Orders' THEN 3 WHEN 'Average Order Value' THEN 4 WHEN 'Customer Satisfaction' THEN 5 WHEN 'Return Rate' THEN 6 WHEN 'Total Products' THEN 7 WHEN 'Active Promotions' THEN 8 ELSE 9 END; 
 SELECT CASE WHEN MONTH(o.orderdate) IN (12, 1, 2) THEN 'Winter' WHEN MONTH(o.orderdate) IN (3, 4, 5) THEN 'Spring' WHEN MONTH(o.orderdate) IN (6, 7, 8) THEN 'Summer' WHEN MONTH(o.orderdate) IN (9, 10, 11) THEN 'Fall' END as season, YEAR(o.orderdate) as year, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_purchased, AVG(w.delivery_price) as avg_delivery_cost, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_rate, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.client_id), 0), 2) as revenue_per_customer, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0), 2) as revenue_per_order FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id JOIN wilayas w ON w.id = o.wilaya_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.orderdate >= '2023-01-01' GROUP BY CASE WHEN MONTH(o.orderdate) IN (12, 1, 2) THEN 'Winter' WHEN MONTH(o.orderdate) IN (3, 4, 5) THEN 'Spring' WHEN MONTH(o.orderdate) IN (6, 7, 8) THEN 'Summer' WHEN MONTH(o.orderdate) IN (9, 10, 11) THEN 'Fall' END, YEAR(o.orderdate) HAVING total_revenue > 0 ORDER BY year DESC, CASE season WHEN 'Winter' THEN 1 WHEN 'Spring' THEN 2 WHEN 'Summer' THEN 3 WHEN 'Fall' THEN 4 END; 
 SELECT p.id, p.name, COUNT(DISTINCT cm.id) as comments, COUNT(DISTINCT r.id) as ratings, COUNT(DISTINCT f.id) as favorites FROM products p LEFT JOIN comments cm ON p.id = cm.product_id LEFT JOIN rating r ON p.id = r.product_id LEFT JOIN favorites f ON p.id = f.product_id WHERE p.quantity > 0 GROUP BY p.id HAVING comments > 0 OR ratings > 0 OR favorites > 0 ORDER BY favorites DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.price, COALESCE(pr.percentage, 0) as discount_percentage, COUNT(DISTINCT ca.id) as cart_adds FROM products p LEFT JOIN promotions pr ON p.id = pr.product_id AND CURDATE() BETWEEN pr.startdate AND pr.enddate LEFT JOIN cart ca ON p.id = ca.product_id WHERE p.quantity BETWEEN 5 AND 100 GROUP BY p.id HAVING cart_adds > 0 ORDER BY discount_percentage DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT HOUR(o.orderdate) as hour_of_day, DAYNAME(o.orderdate) as day_of_week, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_ordered, AVG(w.delivery_price) as avg_delivery_cost, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_rate, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0), 2) as revenue_per_order, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as popularity_rank_by_orders, RANK() OVER (ORDER BY SUM(o.price) DESC) as popularity_rank_by_revenue FROM orders o JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY HOUR(o.orderdate), DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate) HAVING order_count > 0 ORDER BY DAYOFWEEK(o.orderdate), hour_of_day; 
 SELECT c.id, c.firstname, c.lastname, c.email, c.wilaya, TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) as age, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_tenure_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT cm.id) as reviews_written, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) as orders_last_30_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) THEN o.id END) as orders_last_90_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) THEN o.id END) as orders_last_180_days, CASE WHEN COUNT(DISTINCT o.id) >= 10 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'VIP Loyal' WHEN COUNT(DISTINCT o.id) >= 5 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 60 THEN 'Loyal' WHEN COUNT(DISTINCT o.id) >= 3 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'Regular' WHEN COUNT(DISTINCT o.id) >= 1 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 180 THEN 'Occasional' ELSE 'Inactive' END as loyalty_status, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0), 2) as lifetime_value_per_order, ROUND(SUM(o.price) / NULLIF(DATEDIFF(CURDATE(), MIN(o.orderdate)), 1), 2) as daily_spending_rate, CASE WHEN COUNT(DISTINCT DAYOFWEEK(o.orderdate)) >= 5 THEN 'Varied Purchase Days' WHEN COUNT(DISTINCT DAYOFWEEK(o.orderdate)) >= 3 THEN 'Moderate Purchase Days' ELSE 'Limited Purchase Days' END as purchase_pattern FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id WHERE o.id IS NOT NULL GROUP BY c.id, c.firstname, c.lastname, c.email, c.wilaya, c.birthday HAVING total_orders > 0 ORDER BY total_spent DESC; 
 SELECT a.role, COUNT(DISTINCT a.id) as admins, COUNT(DISTINCT p.id) as products, COUNT(DISTINCT o.id) as orders, COUNT(DISTINCT cl.id) as claims FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id GROUP BY a.role HAVING admins > 0 ORDER BY products DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT cost_category, total_cost, percentage_of_revenue, cost_per_order, cost_per_customer, trend FROM ( SELECT 'Delivery Costs' as cost_category, SUM(w.delivery_price) as total_cost, ROUND(SUM(w.delivery_price) * 100.0 / (SELECT SUM(price) FROM orders), 2) as percentage_of_revenue, ROUND(SUM(w.delivery_price) / COUNT(DISTINCT o.id), 2) as cost_per_order, ROUND(SUM(w.delivery_price) / COUNT(DISTINCT o.client_id), 2) as cost_per_customer, CASE WHEN SUM(w.delivery_price) > LAG(SUM(w.delivery_price)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN SUM(w.delivery_price) < LAG(SUM(w.delivery_price)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o JOIN wilayas w ON w.id = o.wilaya_id UNION ALL SELECT 'Discount Costs' as cost_category, COALESCE(SUM(pr.percentage * p.price / 100), 0) as total_cost, ROUND(COALESCE(SUM(pr.percentage * p.price / 100), 0) * 100.0 / (SELECT SUM(price) FROM orders), 2) as percentage_of_revenue, ROUND(COALESCE(SUM(pr.percentage * p.price / 100), 0) / COUNT(DISTINCT o.id), 2) as cost_per_order, ROUND(COALESCE(SUM(pr.percentage * p.price / 100), 0) / COUNT(DISTINCT o.client_id), 2) as cost_per_customer, CASE WHEN COALESCE(SUM(pr.percentage * p.price / 100), 0) > LAG(COALESCE(SUM(pr.percentage * p.price / 100), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN COALESCE(SUM(pr.percentage * p.price / 100), 0) < LAG(COALESCE(SUM(pr.percentage * p.price / 100), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate UNION ALL SELECT 'Return Costs' as cost_category, COALESCE(SUM(o.price * 0.1), 0) as total_cost, ROUND(COALESCE(SUM(o.price * 0.1), 0) * 100.0 / (SELECT SUM(price) FROM orders), 2) as percentage_of_revenue, ROUND(COALESCE(SUM(o.price * 0.1), 0) / COUNT(DISTINCT o.id), 2) as cost_per_order, ROUND(COALESCE(SUM(o.price * 0.1), 0) / COUNT(DISTINCT o.client_id), 2) as cost_per_customer, CASE WHEN COALESCE(SUM(o.price * 0.1), 0) > LAG(COALESCE(SUM(o.price * 0.1), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN COALESCE(SUM(o.price * 0.1), 0) < LAG(COALESCE(SUM(o.price * 0.1), 0)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o JOIN returns rt ON rt.order_id = o.id UNION ALL SELECT 'Claim Processing Costs' as cost_category, COALESCE(COUNT(DISTINCT cl.id) * 50, 0) as total_cost, ROUND(COALESCE(COUNT(DISTINCT cl.id) * 50, 0) * 100.0 / (SELECT SUM(price) FROM orders), 2) as percentage_of_revenue, ROUND(COALESCE(COUNT(DISTINCT cl.id) * 50, 0) / COUNT(DISTINCT o.id), 2) as cost_per_order, ROUND(COALESCE(COUNT(DISTINCT cl.id) * 50, 0) / COUNT(DISTINCT o.client_id), 2) as cost_per_customer, CASE WHEN COALESCE(COUNT(DISTINCT cl.id) * 50, 0) > LAG(COALESCE(COUNT(DISTINCT cl.id) * 50, 0)) OVER (ORDER BY MIN(o.id)) THEN '?' WHEN COALESCE(COUNT(DISTINCT cl.id) * 50, 0) < LAG(COALESCE(COUNT(DISTINCT cl.id) * 50, 0)) OVER (ORDER BY MIN(o.id)) THEN '?' ELSE '?' END as trend FROM orders o LEFT JOIN claims cl ON cl.order_id = o.id ) as cost_analysis GROUP BY cost_category, total_cost, percentage_of_revenue, cost_per_order, cost_per_customer, trend ORDER BY total_cost DESC; 
 SELECT DAYNAME(o.orderdate) as day_of_week, DAYOFWEEK(o.orderdate) as day_number, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.category) as categories_sold, AVG(w.delivery_price) as avg_delivery_cost, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_rate, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0), 2) as revenue_per_order, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.client_id), 0), 2) as revenue_per_customer, RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as rank_by_orders, RANK() OVER (ORDER BY SUM(o.price) DESC) as rank_by_revenue, LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DAYOFWEEK(o.orderdate)) as prev_day_orders, ROUND((COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DAYOFWEEK(o.orderdate))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (ORDER BY DAYOFWEEK(o.orderdate)), 0), 2) as order_growth_vs_prev_day FROM orders o JOIN wilayas w ON w.id = o.wilaya_id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY DAYNAME(o.orderdate), DAYOFWEEK(o.orderdate) HAVING order_count > 0 ORDER BY day_number; 
 SELECT sales_cycle_length, COUNT(DISTINCT order_id) as order_count, SUM(order_value) as total_revenue, AVG(order_value) as avg_order_value, COUNT(DISTINCT client_id) as unique_clients, AVG(product_count) as avg_products_per_order, AVG(category_count) as avg_categories_per_order, AVG(discount_percentage) as avg_discount_used, AVG(customer_tenure_days) as avg_customer_tenure FROM ( SELECT o.id as order_id, o.client_id, o.price as order_value, COUNT(DISTINCT ca.product_id) as product_count, COUNT(DISTINCT p.category) as category_count, AVG(CASE WHEN pr.id IS NOT NULL THEN pr.percentage ELSE 0 END) as discount_percentage, DATEDIFF(o.orderdate, MIN(o2.orderdate)) as customer_tenure_days, CASE WHEN DATEDIFF(o.orderdate, MIN(o2.orderdate)) = 0 THEN 'First Order' WHEN DATEDIFF(o.orderdate, MIN(o2.orderdate)) <= 7 THEN 'Quick Repeat (<7 days)' WHEN DATEDIFF(o.orderdate, MIN(o2.orderdate)) <= 30 THEN 'Monthly Repeat (8-30 days)' WHEN DATEDIFF(o.orderdate, MIN(o2.orderdate)) <= 90 THEN 'Quarterly Repeat (31-90 days)' WHEN DATEDIFF(o.orderdate, MIN(o2.orderdate)) <= 180 THEN 'Bi-annual Repeat (91-180 days)' ELSE 'Annual Repeat (>180 days)' END as sales_cycle_length FROM orders o JOIN orders o2 ON o2.client_id = o.client_id AND o2.orderdate <= o.orderdate JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY o.id, o.client_id, o.price, o.orderdate ) as sales_cycles GROUP BY sales_cycle_length ORDER BY CASE sales_cycle_length WHEN 'First Order' THEN 1 WHEN 'Quick Repeat (<7 days)' THEN 2 WHEN 'Monthly Repeat (8-30 days)' THEN 3 WHEN 'Quarterly Repeat (31-90 days)' THEN 4 WHEN 'Bi-annual Repeat (91-180 days)' THEN 5 WHEN 'Annual Repeat (>180 days)' THEN 6 ELSE 7 END; 
 SELECT trend_period, category, order_count, total_revenue, avg_order_value, unique_customers, growth_rate, market_share, rank_within_period FROM ( SELECT DATE_FORMAT(o.orderdate, '%Y-%m') as trend_period, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, ROUND( (COUNT(DISTINCT o.id) - LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT o.id), 1) OVER (PARTITION BY p.category ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2 ) as growth_rate, ROUND(COUNT(DISTINCT o.id) * 100.0 / SUM(COUNT(DISTINCT o.id)) OVER (PARTITION BY DATE_FORMAT(o.orderdate, '%Y-%m')), 2) as market_share, RANK() OVER (PARTITION BY DATE_FORMAT(o.orderdate, '%Y-%m') ORDER BY COUNT(DISTINCT o.id) DESC) as rank_within_period FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m'), p.category HAVING order_count > 0 ) as trend_data WHERE trend_period >= DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 6 MONTH), '%Y-%m') ORDER BY trend_period DESC, rank_within_period; 
 SELECT loyalty_tier, COUNT(DISTINCT client_id) as client_count, SUM(total_orders) as total_orders, SUM(total_spent) as total_spent, AVG(total_spent) as avg_spent_per_client, AVG(avg_order_value) as avg_order_value, AVG(customer_tenure_days) as avg_customer_tenure, AVG(days_since_last_order) as avg_days_since_last_order, AVG(repeat_purchase_rate) as avg_repeat_purchase_rate, AVG(discount_usage_rate) as avg_discount_usage_rate, AVG(categories_purchased) as avg_categories_per_client, AVG(brands_purchased) as avg_brands_per_client, AVG(reviews_written) as avg_reviews_per_client, AVG(favorites_added) as avg_favorites_per_client, SUM(potential_value) as total_potential_value, AVG(potential_value) as avg_potential_value_per_client FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MIN(o.orderdate)) as customer_tenure_days, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT o2.id) as repeat_purchases, ROUND(COUNT(DISTINCT o2.id) * 100.0 / COUNT(DISTINCT o.id), 2) as repeat_purchase_rate, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_usage_rate, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_added, CASE WHEN COUNT(DISTINCT o.id) >= 10 AND SUM(o.price) >= 5000 THEN 'Platinum' WHEN COUNT(DISTINCT o.id) >= 5 AND SUM(o.price) >= 2000 THEN 'Gold' WHEN COUNT(DISTINCT o.id) >= 3 AND SUM(o.price) >= 500 THEN 'Silver' WHEN COUNT(DISTINCT o.id) >= 1 THEN 'Bronze' ELSE 'Prospect' END as loyalty_tier, SUM(o.price) * CASE WHEN COUNT(DISTINCT o.id) >= 10 THEN 1.5 WHEN COUNT(DISTINCT o.id) >= 5 THEN 1.3 WHEN COUNT(DISTINCT o.id) >= 3 THEN 1.2 WHEN COUNT(DISTINCT o.id) >= 1 THEN 1.1 ELSE 1.0 END as potential_value FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id HAVING total_orders > 0 ) as loyalty_analysis GROUP BY loyalty_tier ORDER BY CASE loyalty_tier WHEN 'Platinum' THEN 1 WHEN 'Gold' THEN 2 WHEN 'Silver' THEN 3 WHEN 'Bronze' THEN 4 WHEN 'Prospect' THEN 5 ELSE 6 END; 
 SELECT campaign_type, campaign_id, campaign_name, duration_days, total_orders, total_revenue, avg_order_value, unique_customers, new_customers, returning_customers, customer_acquisition_cost, return_on_investment, effectiveness_score FROM ( SELECT 'Promotion' as campaign_type, pr.id as campaign_id, CONCAT('Promo: ', p.name, ' - ', pr.percentage, '% off') as campaign_name, DATEDIFF(pr.enddate, pr.startdate) as duration_days, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT CASE WHEN o.client_id NOT IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE o2.orderdate < pr.startdate ) THEN o.client_id END) as new_customers, COUNT(DISTINCT CASE WHEN o.client_id IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE o2.orderdate < pr.startdate ) THEN o.client_id END) as returning_customers, COALESCE(SUM(pr.percentage * p.price / 100), 0) as total_discount_cost, COALESCE(SUM(pr.percentage * p.price / 100) / NULLIF(COUNT(DISTINCT o.client_id), 0), 0) as customer_acquisition_cost, ROUND((SUM(o.price) - COALESCE(SUM(pr.percentage * p.price / 100), 0)) * 100.0 / NULLIF(COALESCE(SUM(pr.percentage * p.price / 100), 0), 0), 2) as return_on_investment, ROUND(COUNT(DISTINCT o.id) * 1.0 / DATEDIFF(pr.enddate, pr.startdate), 2) as effectiveness_score FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY pr.id, p.name, pr.percentage, pr.startdate, pr.enddate UNION ALL SELECT 'Offer' as campaign_type, ofr.id as campaign_id, CONCAT('Offer: ', ofr.name) as campaign_name, DATEDIFF(ofr.enddate, ofr.startdate) as duration_days, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT CASE WHEN o.client_id NOT IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE o2.orderdate < ofr.startdate ) THEN o.client_id END) as new_customers, COUNT(DISTINCT CASE WHEN o.client_id IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE o2.orderdate < ofr.startdate ) THEN o.client_id END) as returning_customers, 0 as total_discount_cost, 0 as customer_acquisition_cost, ROUND(SUM(o.price) * 100.0 / NULLIF(COUNT(DISTINCT o.client_id), 0), 2) as return_on_investment, ROUND(COUNT(DISTINCT o.id) * 1.0 / DATEDIFF(ofr.enddate, ofr.startdate), 2) as effectiveness_score FROM offers ofr LEFT JOIN cart ca ON ca.offer_id = ofr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY ofr.id, ofr.name, ofr.startdate, ofr.enddate ) as campaign_analysis WHERE total_orders > 0 ORDER BY effectiveness_score DESC; 
 SELECT p.id, p.name, p.category, p.brand, p.price, p.quantity as current_stock, COALESCE(sales_last_30_days, 0) as sales_last_30_days, COALESCE(sales_last_60_days, 0) as sales_last_60_days, COALESCE(sales_last_90_days, 0) as sales_last_90_days, COALESCE(avg_daily_sales, 0) as avg_daily_sales, COALESCE(sales_trend, 0) as sales_trend, COALESCE(demand_forecast_30_days, 0) as demand_forecast_30_days, COALESCE(stock_cover_days, 999) as stock_cover_days, COALESCE(reorder_point, 0) as reorder_point, COALESCE(suggested_reorder_quantity, 0) as suggested_reorder_quantity, CASE WHEN p.quantity = 0 THEN 'Out of Stock - Urgent' WHEN stock_cover_days <= 7 THEN 'Critical Stock (<7 days)' WHEN stock_cover_days <= 14 THEN 'Low Stock (8-14 days)' WHEN stock_cover_days <= 30 THEN 'Adequate Stock (15-30 days)' WHEN stock_cover_days <= 60 THEN 'Good Stock (31-60 days)' WHEN stock_cover_days > 60 THEN 'Excess Stock (>60 days)' ELSE 'No Sales History' END as stock_status, COALESCE(cart_additions_last_7_days, 0) as cart_additions_last_7_days, COALESCE(favorite_count, 0) as favorite_count, COALESCE(has_active_promotion, 0) as has_active_promotion FROM products p LEFT JOIN ( SELECT p2.id as product_id, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) as sales_last_30_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) THEN o.id END) as sales_last_60_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) THEN o.id END) as sales_last_90_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 as avg_daily_sales, (COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) - COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END)) * 100.0 / NULLIF(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) AND o.orderdate < DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END), 0) as sales_trend, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) * 1.1 as demand_forecast_30_days, p2.quantity / NULLIF(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0, 0) as stock_cover_days, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 * 14 as reorder_point, GREATEST(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) * 1.1 - p2.quantity, 0) as suggested_reorder_quantity FROM products p2 LEFT JOIN cart ca ON ca.product_id = p2.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY p2.id, p2.quantity ) as sales_data ON sales_data.product_id = p.id LEFT JOIN ( SELECT p3.id as product_id, COUNT(DISTINCT CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN ca.id END) as cart_additions_last_7_days FROM products p3 LEFT JOIN cart ca ON ca.product_id = p3.id GROUP BY p3.id ) as cart_data ON cart_data.product_id = p.id LEFT JOIN ( SELECT p4.id as product_id, COUNT(DISTINCT f.id) as favorite_count FROM products p4 LEFT JOIN favorites f ON f.product_id = p4.id GROUP BY p4.id ) as favorite_data ON favorite_data.product_id = p.id LEFT JOIN ( SELECT p5.id as product_id, CASE WHEN COUNT(DISTINCT pr.id) > 0 THEN 1 ELSE 0 END as has_active_promotion FROM products p5 LEFT JOIN promotions pr ON pr.product_id = p5.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate GROUP BY p5.id ) as promotion_data ON promotion_data.product_id = p.id WHERE p.quantity >= 0 ORDER BY CASE WHEN p.quantity = 0 THEN 1 WHEN stock_cover_days <= 7 THEN 2 WHEN stock_cover_days <= 14 THEN 3 ELSE 4 END, demand_forecast_30_days DESC; 
 SELECT navigation_pattern, COUNT(DISTINCT session_id) as session_count, AVG(session_duration_minutes) as avg_session_duration, AVG(page_views_per_session) as avg_page_views, AVG(products_viewed_per_session) as avg_products_viewed, AVG(categories_viewed_per_session) as avg_categories_viewed, AVG(brands_viewed_per_session) as avg_brands_viewed, AVG(cart_additions_per_session) as avg_cart_additions, AVG(favorites_added_per_session) as avg_favorites_added, AVG(conversion_rate) as avg_conversion_rate, AVG(bounce_rate) as avg_bounce_rate FROM ( SELECT ca.client_id  '_'  DATE(ca.date_cart) as session_id, c.id as client_id, COUNT(DISTINCT ca.id) as page_views_per_session, COUNT(DISTINCT ca.product_id) as products_viewed_per_session, COUNT(DISTINCT p.category) as categories_viewed_per_session, COUNT(DISTINCT p.brand) as brands_viewed_per_session, COUNT(DISTINCT CASE WHEN ca.id IN (SELECT id FROM cart WHERE client_id = c.id AND date_cart = DATE(ca.date_cart)) THEN ca.id END) as cart_additions_per_session, COUNT(DISTINCT CASE WHEN f.id IS NOT NULL THEN f.id END) as favorites_added_per_session, MAX(TIME_TO_SEC(ca.date_cart)) - MIN(TIME_TO_SEC(ca.date_cart)) as session_duration_seconds, (MAX(TIME_TO_SEC(ca.date_cart)) - MIN(TIME_TO_SEC(ca.date_cart))) / 60.0 as session_duration_minutes, CASE WHEN COUNT(DISTINCT o.id) > 0 THEN 1 ELSE 0 END as converted, CASE WHEN COUNT(DISTINCT ca.id) = 1 THEN 1 ELSE 0 END as bounced, CASE WHEN COUNT(DISTINCT o.id) > 0 THEN 1.0 ELSE 0.0 END as conversion_rate, CASE WHEN COUNT(DISTINCT ca.id) = 1 THEN 1.0 ELSE 0.0 END as bounce_rate, CASE WHEN COUNT(DISTINCT p.category) = 1 AND COUNT(DISTINCT ca.product_id) <= 3 THEN 'Focused Browsing' WHEN COUNT(DISTINCT p.category) > 3 AND COUNT(DISTINCT ca.product_id) > 10 THEN 'Exploratory Browsing' WHEN COUNT(DISTINCT ca.product_id) BETWEEN 4 AND 10 THEN 'Moderate Browsing' WHEN COUNT(DISTINCT f.id) > COUNT(DISTINCT ca.product_id) / 2 THEN 'Favorite Collector' WHEN COUNT(DISTINCT o.id) > 0 THEN 'Converting Browser' ELSE 'Casual Browser' END as navigation_pattern FROM clients c LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN favorites f ON f.client_id = c.id AND f.product_id = ca.product_id LEFT JOIN orders o ON o.client_id = c.id AND DATE(o.orderdate) = DATE(ca.date_cart) WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY ca.client_id, DATE(ca.date_cart), c.id HAVING page_views_per_session > 0 ) as navigation_analysis GROUP BY navigation_pattern ORDER BY session_count DESC; 
 SELECT season, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT p.id) as unique_products_sold, AVG(r.rating) as avg_rating, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) as discounted_orders, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_rate, ROUND(SUM(o.price) / NULLIF(COUNT(DISTINCT o.id), 0), 2) as revenue_per_order, RANK() OVER (PARTITION BY season ORDER BY SUM(o.price) DESC) as revenue_rank_in_season, ROUND((SUM(o.price) - LAG(SUM(o.price)) OVER (PARTITION BY p.category ORDER BY CASE season WHEN 'Winter' THEN 1 WHEN 'Spring' THEN 2 WHEN 'Summer' THEN 3 WHEN 'Fall' THEN 4 END)) * 100.0 / NULLIF(LAG(SUM(o.price)) OVER (PARTITION BY p.category ORDER BY CASE season WHEN 'Winter' THEN 1 WHEN 'Spring' THEN 2 WHEN 'Summer' THEN 3 WHEN 'Fall' THEN 4 END), 0), 2) as seasonal_growth_rate FROM ( SELECT o.*, CASE WHEN MONTH(o.orderdate) IN (12, 1, 2) THEN 'Winter' WHEN MONTH(o.orderdate) IN (3, 4, 5) THEN 'Spring' WHEN MONTH(o.orderdate) IN (6, 7, 8) THEN 'Summer' WHEN MONTH(o.orderdate) IN (9, 10, 11) THEN 'Fall' END as season FROM orders o WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 2 YEAR) ) as o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate GROUP BY season, p.category HAVING order_count > 0 ORDER BY CASE season WHEN 'Winter' THEN 1 WHEN 'Spring' THEN 2 WHEN 'Summer' THEN 3 WHEN 'Fall' THEN 4 END, total_revenue DESC; 
 SELECT repurchase_behavior, COUNT(DISTINCT client_id) as client_count, AVG(days_between_purchases) as avg_days_between_purchases, AVG(total_purchases) as avg_total_purchases, AVG(total_spent) as avg_total_spent, AVG(avg_order_value) as avg_order_value, AVG(categories_purchased) as avg_categories_purchased, AVG(brands_purchased) as avg_brands_purchased, AVG(repeat_purchase_rate) as avg_repeat_purchase_rate, AVG(discount_sensitivity) as avg_discount_sensitivity, AVG(customer_tenure_days) as avg_customer_tenure FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_purchases, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT o2.id) as repeat_purchases, ROUND(COUNT(DISTINCT o2.id) * 100.0 / COUNT(DISTINCT o.id), 2) as repeat_purchase_rate, AVG(DATEDIFF(o2.orderdate, o.orderdate)) as days_between_purchases, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_sensitivity, DATEDIFF(CURDATE(), MIN(o.orderdate)) as customer_tenure_days, CASE WHEN COUNT(DISTINCT o.id) >= 10 AND AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 30 THEN 'Frequent Loyal Buyer' WHEN COUNT(DISTINCT o.id) >= 5 AND AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 60 THEN 'Regular Buyer' WHEN COUNT(DISTINCT o.id) >= 3 AND AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 90 THEN 'Occasional Buyer' WHEN COUNT(DISTINCT o.id) >= 2 AND AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 180 THEN 'Seasonal Buyer' WHEN COUNT(DISTINCT o.id) = 1 THEN 'One-Time Buyer' ELSE 'Inactive Buyer' END as repurchase_behavior FROM clients c JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id HAVING total_purchases > 0 ) as repurchase_analysis GROUP BY repurchase_behavior ORDER BY client_count DESC; 
 SELECT region_type, region_name, total_clients, total_orders, total_revenue, avg_order_value, avg_delivery_cost, delivery_cost_percentage, avg_customer_satisfaction, most_popular_category, most_popular_brand, client_acquisition_rate, client_retention_rate FROM ( SELECT CASE WHEN w.id IN (16, 31, 9) THEN 'Major Cities' WHEN w.delivery_price <= 200 THEN 'Low Cost Regions' WHEN w.delivery_price <= 500 THEN 'Medium Cost Regions' ELSE 'High Cost Regions' END as region_type, w.name as region_name, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, AVG(w.delivery_price) as avg_delivery_cost, ROUND(SUM(w.delivery_price) * 100.0 / SUM(o.price), 2) as delivery_cost_percentage, AVG(r.rating) as avg_customer_satisfaction, (SELECT p2.category FROM products p2 JOIN cart ca2 ON ca2.product_id = p2.id JOIN orders o2 ON FIND_IN_SET(ca2.id, o2.cart_id) WHERE o2.wilaya_id = w.id GROUP BY p2.category ORDER BY COUNT(DISTINCT o2.id) DESC LIMIT 1) as most_popular_category, (SELECT p2.brand FROM products p2 JOIN cart ca2 ON ca2.product_id = p2.id JOIN orders o2 ON FIND_IN_SET(ca2.id, o2.cart_id) WHERE o2.wilaya_id = w.id GROUP BY p2.brand ORDER BY COUNT(DISTINCT o2.id) DESC LIMIT 1) as most_popular_brand, ROUND(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND o.client_id NOT IN (SELECT DISTINCT client_id FROM orders WHERE orderdate < DATE_SUB(CURDATE(), INTERVAL 30 DAY) AND wilaya_id = w.id) THEN o.client_id END) * 100.0 / NULLIF(COUNT(DISTINCT c.id), 0), 2) as client_acquisition_rate, ROUND(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND o.client_id IN (SELECT DISTINCT client_id FROM orders WHERE orderdate < DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND wilaya_id = w.id) THEN o.client_id END) * 100.0 / NULLIF(COUNT(DISTINCT CASE WHEN o.orderdate < DATE_SUB(CURDATE(), INTERVAL 90 DAY) AND wilaya_id = w.id THEN o.client_id END), 0), 2) as client_retention_rate FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.wilaya_id = w.id LEFT JOIN rating r ON r.client_id = c.id GROUP BY w.id, w.name, w.delivery_price HAVING total_orders > 0 ) as regional_analysis ORDER BY total_revenue DESC; 
 SELECT consumption_pattern, COUNT(DISTINCT client_id) as client_count, AVG(total_orders) as avg_orders_per_client, AVG(total_spent) as avg_spent_per_client, AVG(avg_order_value) as avg_order_value, AVG(order_frequency_days) as avg_order_frequency, AVG(categories_purchased) as avg_categories_per_client, AVG(brands_purchased) as avg_brands_per_client, AVG(discount_usage_rate) as avg_discount_usage, AVG(customer_tenure_days) as avg_customer_tenure, AVG(repeat_purchase_rate) as avg_repeat_purchase_rate FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, AVG(DATEDIFF(o2.orderdate, o.orderdate)) as order_frequency_days, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_usage_rate, DATEDIFF(CURDATE(), MIN(o.orderdate)) as customer_tenure_days, ROUND(COUNT(DISTINCT o2.id) * 100.0 / COUNT(DISTINCT o.id), 2) as repeat_purchase_rate, CASE WHEN AVG(o.price) > 1000 AND COUNT(DISTINCT o.id) >= 3 THEN 'Premium Frequent Buyer' WHEN AVG(o.price) > 500 AND COUNT(DISTINCT o.id) >= 5 THEN 'High Value Frequent Buyer' WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 30 AND COUNT(DISTINCT o.id) >= 3 THEN 'Frequent Low Value Buyer' WHEN COUNT(DISTINCT p.category) >= 5 THEN 'Variety Seeker' WHEN COUNT(DISTINCT p.brand) = 1 THEN 'Brand Loyalist' WHEN COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id) > 50 THEN 'Discount Hunter' WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) > 180 THEN 'Occasional Buyer' ELSE 'General Consumer' END as consumption_pattern FROM clients c JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id HAVING total_orders > 0 ) as consumption_analysis GROUP BY consumption_pattern ORDER BY client_count DESC; 
 SELECT time_of_day, COUNT(DISTINCT order_id) as order_count, SUM(order_value) as total_revenue, AVG(order_value) as avg_order_value, COUNT(DISTINCT client_id) as unique_customers, AVG(delivery_time_days) as avg_delivery_time, AVG(customer_satisfaction) as avg_customer_satisfaction, SUM(CASE WHEN has_promotion = 1 THEN 1 ELSE 0 END) as orders_with_promotions, ROUND(SUM(CASE WHEN has_promotion = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(DISTINCT order_id), 2) as promotion_usage_rate, AVG(items_per_order) as avg_items_per_order, AVG(categories_per_order) as avg_categories_per_order FROM ( SELECT o.id as order_id, o.client_id, o.price as order_value, HOUR(o.orderdate) as order_hour, CASE WHEN HOUR(o.orderdate) BETWEEN 0 AND 5 THEN 'Late Night (0-5)' WHEN HOUR(o.orderdate) BETWEEN 6 AND 11 THEN 'Morning (6-11)' WHEN HOUR(o.orderdate) BETWEEN 12 AND 17 THEN 'Afternoon (12-17)' WHEN HOUR(o.orderdate) BETWEEN 18 AND 23 THEN 'Evening (18-23)' END as time_of_day, DATEDIFF(o.deliveredDate, o.orderdate) as delivery_time_days, AVG(r.rating) as customer_satisfaction, CASE WHEN COUNT(DISTINCT pr.id) > 0 THEN 1 ELSE 0 END as has_promotion, COUNT(DISTINCT ca.product_id) as items_per_order, COUNT(DISTINCT p.category) as categories_per_order FROM orders o LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.client_id = o.client_id LEFT JOIN promotions pr ON pr.id = ca.promotion_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY o.id, o.client_id, o.price, HOUR(o.orderdate), o.deliveredDate, o.orderdate ) as time_analysis GROUP BY time_of_day ORDER BY CASE time_of_day WHEN 'Late Night (0-5)' THEN 1 WHEN 'Morning (6-11)' THEN 2 WHEN 'Afternoon (12-17)' THEN 3 WHEN 'Evening (18-23)' THEN 4 END; 
 SELECT loyalty_program_tier, COUNT(DISTINCT client_id) as client_count, SUM(total_orders) as total_orders, SUM(total_spent) as total_spent, AVG(total_spent) as avg_spent_per_client, AVG(avg_order_value) as avg_order_value, AVG(customer_tenure_days) as avg_customer_tenure, AVG(days_since_last_order) as avg_days_since_last_order, AVG(repeat_purchase_rate) as avg_repeat_purchase_rate, AVG(discount_usage_rate) as avg_discount_usage_rate, AVG(categories_purchased) as avg_categories_per_client, AVG(brands_purchased) as avg_brands_per_client, AVG(reviews_written) as avg_reviews_per_client, AVG(favorites_added) as avg_favorites_per_client, SUM(potential_lifetime_value) as total_potential_lifetime_value, AVG(potential_lifetime_value) as avg_potential_lifetime_value_per_client FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, DATEDIFF(CURDATE(), MIN(o.orderdate)) as customer_tenure_days, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT o2.id) as repeat_purchases, ROUND(COUNT(DISTINCT o2.id) * 100.0 / COUNT(DISTINCT o.id), 2) as repeat_purchase_rate, ROUND(COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN o.id END) * 100.0 / COUNT(DISTINCT o.id), 2) as discount_usage_rate, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT p.brand) as brands_purchased, COUNT(DISTINCT cm.id) as reviews_written, COUNT(DISTINCT f.id) as favorites_added, CASE WHEN COUNT(DISTINCT o.id) >= 20 AND SUM(o.price) >= 10000 THEN 'Diamond' WHEN COUNT(DISTINCT o.id) >= 10 AND SUM(o.price) >= 5000 THEN 'Platinum' WHEN COUNT(DISTINCT o.id) >= 5 AND SUM(o.price) >= 2000 THEN 'Gold' WHEN COUNT(DISTINCT o.id) >= 3 AND SUM(o.price) >= 500 THEN 'Silver' WHEN COUNT(DISTINCT o.id) >= 1 THEN 'Bronze' ELSE 'Prospect' END as loyalty_program_tier, SUM(o.price) * CASE WHEN COUNT(DISTINCT o.id) >= 20 THEN 2.0 WHEN COUNT(DISTINCT o.id) >= 10 THEN 1.8 WHEN COUNT(DISTINCT o.id) >= 5 THEN 1.5 WHEN COUNT(DISTINCT o.id) >= 3 THEN 1.3 WHEN COUNT(DISTINCT o.id) >= 1 THEN 1.1 ELSE 1.0 END as potential_lifetime_value FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id HAVING total_orders > 0 ) as loyalty_program_analysis GROUP BY loyalty_program_tier ORDER BY CASE loyalty_program_tier WHEN 'Diamond' THEN 1 WHEN 'Platinum' THEN 2 WHEN 'Gold' THEN 3 WHEN 'Silver' THEN 4 WHEN 'Bronze' THEN 5 WHEN 'Prospect' THEN 6 ELSE 7 END; 
 SELECT market_trend, period, category_count, brand_count, product_count, order_count, total_revenue, avg_order_value, unique_customers, new_customers, returning_customers, growth_rate, market_share, competitive_intensity FROM ( SELECT 'Category Expansion' as market_trend, DATE_FORMAT(o.orderdate, '%Y-%m') as period, COUNT(DISTINCT p.category) as category_count, COUNT(DISTINCT p.brand) as brand_count, COUNT(DISTINCT p.id) as product_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT CASE WHEN o.client_id NOT IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as new_customers, COUNT(DISTINCT CASE WHEN o.client_id IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as returning_customers, ROUND((COUNT(DISTINCT p.category) - LAG(COUNT(DISTINCT p.category)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT p.category)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2) as growth_rate, ROUND(COUNT(DISTINCT p.category) * 100.0 / (SELECT COUNT(DISTINCT category) FROM products), 2) as market_share, ROUND(COUNT(DISTINCT p.brand) * 1.0 / NULLIF(COUNT(DISTINCT p.category), 0), 2) as competitive_intensity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') UNION ALL SELECT 'Brand Diversity' as market_trend, DATE_FORMAT(o.orderdate, '%Y-%m') as period, COUNT(DISTINCT p.category) as category_count, COUNT(DISTINCT p.brand) as brand_count, COUNT(DISTINCT p.id) as product_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT CASE WHEN o.client_id NOT IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as new_customers, COUNT(DISTINCT CASE WHEN o.client_id IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as returning_customers, ROUND((COUNT(DISTINCT p.brand) - LAG(COUNT(DISTINCT p.brand)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(COUNT(DISTINCT p.brand)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2) as growth_rate, ROUND(COUNT(DISTINCT p.brand) * 100.0 / (SELECT COUNT(DISTINCT brand) FROM products), 2) as market_share, ROUND(COUNT(DISTINCT p.id) * 1.0 / NULLIF(COUNT(DISTINCT p.brand), 0), 2) as competitive_intensity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') UNION ALL SELECT 'Price Segment Evolution' as market_trend, DATE_FORMAT(o.orderdate, '%Y-%m') as period, COUNT(DISTINCT CASE WHEN p.price <= 100 THEN 'Budget' WHEN p.price <= 500 THEN 'Mid-Range' WHEN p.price <= 1000 THEN 'Premium' ELSE 'Luxury' END) as category_count, COUNT(DISTINCT p.brand) as brand_count, COUNT(DISTINCT p.id) as product_count, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, COUNT(DISTINCT CASE WHEN o.client_id NOT IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as new_customers, COUNT(DISTINCT CASE WHEN o.client_id IN ( SELECT DISTINCT o2.client_id FROM orders o2 WHERE DATE_FORMAT(o2.orderdate, '%Y-%m') < DATE_FORMAT(o.orderdate, '%Y-%m') ) THEN o.client_id END) as returning_customers, ROUND((AVG(p.price) - LAG(AVG(p.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m'))) * 100.0 / NULLIF(LAG(AVG(p.price)) OVER (ORDER BY DATE_FORMAT(o.orderdate, '%Y-%m')), 0), 2) as growth_rate, ROUND(SUM(o.price) * 100.0 / (SELECT SUM(price) FROM orders WHERE DATE_FORMAT(orderdate, '%Y-%m') = DATE_FORMAT(o.orderdate, '%Y-%m')), 2) as market_share, ROUND(STDDEV(p.price) / NULLIF(AVG(p.price), 0), 2) as competitive_intensity FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH) GROUP BY DATE_FORMAT(o.orderdate, '%Y-%m') ) as market_trends WHERE period >= DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 6 MONTH), '%Y-%m') ORDER BY market_trend, period DESC; 
 SELECT search_strategy, COUNT(DISTINCT client_id) as client_count, AVG(search_sessions) as avg_search_sessions, AVG(products_viewed) as avg_products_viewed, AVG(categories_explored) as avg_categories_explored, AVG(brands_explored) as avg_brands_explored, AVG(price_range_explored) as avg_price_range_explored, AVG(time_spent_minutes) as avg_time_spent_minutes, AVG(cart_additions) as avg_cart_additions, AVG(favorites_added) as avg_favorites_added, AVG(purchase_rate) as avg_purchase_rate, AVG(conversion_rate) as avg_conversion_rate FROM ( SELECT c.id as client_id, COUNT(DISTINCT DATE(ca.date_cart)) as search_sessions, COUNT(DISTINCT ca.product_id) as products_viewed, COUNT(DISTINCT p.category) as categories_explored, COUNT(DISTINCT p.brand) as brands_explored, MAX(p.price) - MIN(p.price) as price_range_explored, (MAX(TIME_TO_SEC(ca.date_cart)) - MIN(TIME_TO_SEC(ca.date_cart))) / 60.0 as time_spent_minutes, COUNT(DISTINCT CASE WHEN ca.id IN (SELECT id FROM cart WHERE client_id = c.id) THEN ca.id END) as cart_additions, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT o.id) as purchases_made, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.product_id), 2) as purchase_rate, CASE WHEN COUNT(DISTINCT o.id) > 0 THEN 1.0 ELSE 0.0 END as conversion_rate, CASE WHEN COUNT(DISTINCT p.category) = 1 AND COUNT(DISTINCT p.brand) = 1 THEN 'Focused Search' WHEN COUNT(DISTINCT p.category) >= 3 AND COUNT(DISTINCT p.brand) >= 3 THEN 'Exploratory Search' WHEN COUNT(DISTINCT ca.product_id) >= 10 AND (MAX(p.price) - MIN(p.price)) > 500 THEN 'Price Comparison' WHEN COUNT(DISTINCT f.id) > COUNT(DISTINCT ca.product_id) / 2 THEN 'Favorite-Based Search' WHEN COUNT(DISTINCT DATE(ca.date_cart)) >= 5 THEN 'Extended Research' ELSE 'Casual Browsing' END as search_strategy FROM clients c LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN favorites f ON f.client_id = c.id AND f.product_id = ca.product_id LEFT JOIN orders o ON o.client_id = c.id WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY c.id HAVING products_viewed > 0 ) as search_behavior GROUP BY search_strategy ORDER BY client_count DESC; 
 SELECT product_type, COUNT(DISTINCT product_id) as product_count, SUM(current_stock) as total_stock, AVG(price) as avg_price, SUM(sales_last_30_days) as total_sales_30_days, SUM(revenue_last_30_days) as total_revenue_30_days, AVG(sales_velocity) as avg_sales_velocity, AVG(stock_cover_days) as avg_stock_cover_days, SUM(cart_additions) as total_cart_additions, SUM(favorites) as total_favorites, AVG(rating) as avg_rating, SUM(reviews) as total_reviews, AVG(profit_margin) as avg_profit_margin, SUM(profit_potential) as total_profit_potential FROM ( SELECT p.id as product_id, p.name as product_name, p.category, p.brand, p.price, p.quantity as current_stock, COALESCE(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END), 0) as sales_last_30_days, COALESCE(SUM(CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.price END), 0) as revenue_last_30_days, COALESCE(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0, 0) as sales_velocity, CASE WHEN COALESCE(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0, 0) > 0 THEN p.quantity / (COALESCE(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0, 0)) ELSE 999 END as stock_cover_days, COALESCE(COUNT(DISTINCT ca.id), 0) as cart_additions, COALESCE(COUNT(DISTINCT f.id), 0) as favorites, COALESCE(AVG(r.rating), 0) as rating, COALESCE(COUNT(DISTINCT cm.id), 0) as reviews, CASE WHEN p.price > 0 THEN ROUND((p.price * 0.7) / p.price * 100, 2) ELSE 0 END as profit_margin, p.quantity * p.price * 0.7 as profit_potential, CASE WHEN p.price <= 100 THEN 'Budget' WHEN p.price <= 500 THEN 'Mid-Range' WHEN p.price <= 1000 THEN 'Premium' ELSE 'Luxury' END as product_type FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id GROUP BY p.id, p.name, p.category, p.brand, p.price, p.quantity ) as product_performance GROUP BY product_type ORDER BY total_revenue_30_days DESC; 
 SELECT purchase_cycle, COUNT(DISTINCT client_id) as client_count, AVG(cycle_length_days) as avg_cycle_length, AVG(orders_per_cycle) as avg_orders_per_cycle, AVG(spent_per_cycle) as avg_spent_per_cycle, AVG(avg_order_value) as avg_order_value, AVG(products_per_cycle) as avg_products_per_cycle, AVG(categories_per_cycle) as avg_categories_per_cycle, AVG(consistency_score) as avg_consistency_score, SUM(total_cycles) as total_cycles_observed, AVG(cycle_variation) as avg_cycle_variation FROM ( SELECT c.id as client_id, COUNT(DISTINCT o.id) as total_orders, AVG(DATEDIFF(o2.orderdate, o.orderdate)) as avg_days_between_orders, STDDEV(DATEDIFF(o2.orderdate, o.orderdate)) as std_days_between_orders, CASE WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 7 THEN 'Weekly' WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 30 THEN 'Monthly' WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 90 THEN 'Quarterly' WHEN AVG(DATEDIFF(o2.orderdate, o.orderdate)) <= 180 THEN 'Bi-Annual' ELSE 'Annual' END as purchase_cycle, AVG(DATEDIFF(o2.orderdate, o.orderdate)) as cycle_length_days, COUNT(DISTINCT o.id) / NULLIF(COUNT(DISTINCT DATE_FORMAT(o.orderdate, '%Y-%m')), 1) as orders_per_cycle, SUM(o.price) / NULLIF(COUNT(DISTINCT DATE_FORMAT(o.orderdate, '%Y-%m')), 1) as spent_per_cycle, AVG(o.price) as avg_order_value, COUNT(DISTINCT ca.product_id) / NULLIF(COUNT(DISTINCT DATE_FORMAT(o.orderdate, '%Y-%m')), 1) as products_per_cycle, COUNT(DISTINCT p.category) / NULLIF(COUNT(DISTINCT DATE_FORMAT(o.orderdate, '%Y-%m')), 1) as categories_per_cycle, CASE WHEN STDDEV(DATEDIFF(o2.orderdate, o.orderdate)) / NULLIF(AVG(DATEDIFF(o2.orderdate, o.orderdate)), 0) <= 0.3 THEN 100 WHEN STDDEV(DATEDIFF(o2.orderdate, o.orderdate)) / NULLIF(AVG(DATEDIFF(o2.orderdate, o.orderdate)), 0) <= 0.5 THEN 80 WHEN STDDEV(DATEDIFF(o2.orderdate, o.orderdate)) / NULLIF(AVG(DATEDIFF(o2.orderdate, o.orderdate)), 0) <= 0.7 THEN 60 ELSE 40 END as consistency_score, COUNT(DISTINCT DATE_FORMAT(o.orderdate, '%Y-%m')) as total_cycles, STDDEV(DATEDIFF(o2.orderdate, o.orderdate)) / NULLIF(AVG(DATEDIFF(o2.orderdate, o.orderdate)), 0) as cycle_variation FROM clients c JOIN orders o ON o.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.orderdate > o.orderdate JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 365 DAY) GROUP BY c.id HAVING total_orders > 1 AND avg_days_between_orders IS NOT NULL ) as cycle_analysis GROUP BY purchase_cycle ORDER BY CASE purchase_cycle WHEN 'Weekly' THEN 1 WHEN 'Monthly' THEN 2 WHEN 'Quarterly' THEN 3 WHEN 'Bi-Annual' THEN 4 WHEN 'Annual' THEN 5 ELSE 6 END; 
 SELECT 'Product' as data_type, COUNT(DISTINCT p.id) as total_records, AVG(LENGTH(p.name)) as avg_name_length, AVG(LENGTH(p.description)) as avg_description_length, AVG(LENGTH(p.more_details)) as avg_details_length, COUNT(DISTINCT p.images) as unique_images, COUNT(DISTINCT p.category) as unique_categories, COUNT(DISTINCT p.brand) as unique_brands, SUM(CASE WHEN p.description IS NOT NULL AND p.description != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as description_completeness, SUM(CASE WHEN p.images IS NOT NULL AND p.images != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as images_completeness FROM products p UNION ALL SELECT 'Client' as data_type, COUNT(DISTINCT c.id) as total_records, AVG(LENGTH(CONCAT(c.firstname, ' ', c.lastname))) as avg_name_length, NULL as avg_description_length, NULL as avg_details_length, NULL as unique_images, COUNT(DISTINCT c.wilaya) as unique_wilayas, NULL as unique_brands, SUM(CASE WHEN c.email IS NOT NULL AND c.email LIKE '%@%.%' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as email_completeness, SUM(CASE WHEN c.phone_number IS NOT NULL AND c.phone_number != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as phone_completeness FROM clients c UNION ALL SELECT 'Order' as data_type, COUNT(DISTINCT o.id) as total_records, NULL as avg_name_length, AVG(LENGTH(o.full_address)) as avg_address_length, NULL as avg_details_length, NULL as unique_images, COUNT(DISTINCT o.wilaya_id) as unique_wilayas, NULL as unique_brands, SUM(CASE WHEN o.full_address IS NOT NULL AND o.full_address != '' THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as address_completeness, SUM(CASE WHEN o.code IS NOT NULL AND LENGTH(o.code) = 6 THEN 1 ELSE 0 END) * 100.0 / COUNT(*) as code_completeness FROM orders o; 
 SELECT p.brand, p.category, COUNT(DISTINCT p.id) AS product_count, AVG(p.price) AS avg_price, SUM(p.quantity) AS total_stock, COUNT(DISTINCT f.client_id) AS unique_favoriters, AVG(r.rating) AS avg_rating FROM products p LEFT JOIN favorites f ON p.id = f.product_id LEFT JOIN rating r ON p.id = r.product_id GROUP BY p.brand, p.category HAVING COUNT(DISTINCT p.id) > 2 ORDER BY product_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 25 THEN '18-24' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 25 AND 34 THEN '25-34' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 35 AND 44 THEN '35-44' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 45 AND 54 THEN '45-54' ELSE '55+' END AS age_group, COUNT(DISTINCT c.id) AS customer_count, COUNT(DISTINCT o.id) AS order_count, SUM(o.price) AS total_spent, AVG(o.price) AS avg_order_value, COUNT(DISTINCT p.category) AS categories_purchased FROM clients c LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON ca.product_id = p.id WHERE c.birthday IS NOT NULL GROUP BY age_group ORDER BY total_spent DESC;                                                                                                                                                                                                                                                                                   
 SELECT a.role, COUNT(DISTINCT a.id) AS admin_count, COUNT(DISTINCT p.id) AS total_products_managed, COUNT(DISTINCT o.id) AS total_orders_processed, AVG(SUM(o.price)) OVER(PARTITION BY a.role) AS avg_revenue_per_admin, COUNT(DISTINCT cl.id) AS total_claims_resolved FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id LEFT JOIN claims cl ON a.id = cl.admin_id GROUP BY a.role, a.id ORDER BY a.role;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT HOUR(o.orderdate) as hour_of_day, DAYNAME(o.orderdate) as day_name, CASE WHEN MONTH(o.orderdate) BETWEEN 1 AND 3 THEN 'Q1' WHEN MONTH(o.orderdate) BETWEEN 4 AND 6 THEN 'Q2' WHEN MONTH(o.orderdate) BETWEEN 7 AND 9 THEN 'Q3' WHEN MONTH(o.orderdate) BETWEEN 10 AND 12 THEN 'Q4' END as quarter, p.category, COUNT(DISTINCT o.id) as order_count, AVG(o.price) as avg_order_value, SUM(o.price) as total_revenue, PERCENT_RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_percentile FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= '2023-01-01' AND o.status = 'delivered' GROUP BY HOUR(o.orderdate), DAYNAME(o.orderdate), CASE WHEN MONTH(o.orderdate) BETWEEN 1 AND 3 THEN 'Q1' WHEN MONTH(o.orderdate) BETWEEN 4 AND 6 THEN 'Q2' WHEN MONTH(o.orderdate) BETWEEN 7 AND 9 THEN 'Q3' WHEN MONTH(o.orderdate) BETWEEN 10 AND 12 THEN 'Q4' END, p.category HAVING COUNT(DISTINCT o.id) > 5 ORDER BY hour_of_day, FIELD(day_name, 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'); 
 SELECT p.category, SUM(p.quantity) AS total_inventory, SUM(p.price * p.quantity) AS inventory_value, COUNT(DISTINCT p.id) AS sku_count, COUNT(DISTINCT p.brand) AS brand_count, AVG(p.price) AS avg_price_per_unit, MIN(p.quantity) AS min_stock_level, MAX(p.quantity) AS max_stock_level, AVG(p.quantity) AS avg_stock_level FROM products p GROUP BY p.category ORDER BY inventory_value DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.category, CASE WHEN MONTH(pr.startdate) IN (12,1,2) THEN 'Winter' WHEN MONTH(pr.startdate) IN (3,4,5) THEN 'Spring' WHEN MONTH(pr.startdate) IN (6,7,8) THEN 'Summer' WHEN MONTH(pr.startdate) IN (9,10,11) THEN 'Fall' END as season, COUNT(DISTINCT pr.id) as promotion_count, AVG(pr.percentage) as avg_discount, SUM(CASE WHEN ca.id IS NOT NULL THEN 1 ELSE 0 END) as cart_additions, SUM(CASE WHEN o.id IS NOT NULL THEN o.price ELSE 0 END) as sales_revenue FROM promotions pr LEFT JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE pr.startdate >= '2023-01-01' GROUP BY p.category, CASE WHEN MONTH(pr.startdate) IN (12,1,2) THEN 'Winter' WHEN MONTH(pr.startdate) IN (3,4,5) THEN 'Spring' WHEN MONTH(pr.startdate) IN (6,7,8) THEN 'Summer' WHEN MONTH(pr.startdate) IN (9,10,11) THEN 'Fall' END ORDER BY p.category, season;                                                                                                         
 SELECT CASE WHEN HOUR(ca.date_cart) BETWEEN 0 AND 5 THEN 'Late Night (0-5)' WHEN HOUR(ca.date_cart) BETWEEN 6 AND 11 THEN 'Morning (6-11)' WHEN HOUR(ca.date_cart) BETWEEN 12 AND 17 THEN 'Afternoon (12-17)' WHEN HOUR(ca.date_cart) BETWEEN 18 AND 23 THEN 'Evening (18-23)' END AS browsing_time_slot, p.category, COUNT(DISTINCT ca.id) AS cart_additions, COUNT(DISTINCT ca.client_id) AS unique_browsers, AVG(ca.initial_price) AS avg_browsed_price, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) AS converted_carts, (COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) * 100.0 / COUNT(DISTINCT ca.id)) AS conversion_rate, AVG(DATEDIFF(o.orderdate, ca.date_cart)) AS avg_days_to_conversion FROM cart ca LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON ca.client_id = o.client_id AND o.orderdate >= ca.date_cart AND DATEDIFF(o.orderdate, ca.date_cart) <= 7 WHERE ca.product_id IS NOT NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY browsing_time_slot, p.category HAVING COUNT(DISTINCT ca.id) > 10 ORDER BY browsing_time_slot, cart_additions DESC; 
 SELECT p.id, p.name, p.category, p.price as selling_price, COUNT(DISTINCT o.id) as times_sold, SUM(o.price) as total_revenue, AVG(o.price) as avg_sale_price, (p.price * 0.7) as estimated_cost, (p.price - (p.price * 0.7)) as estimated_margin_per_unit, ((p.price - (p.price * 0.7)) * COUNT(DISTINCT o.id)) as total_estimated_profit, ROUND(((p.price - (p.price * 0.7)) * 100.0 / p.price), 2) as margin_percentage, COUNT(DISTINCT f.id) as favorite_count, AVG(r.rating) as avg_rating FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price HAVING times_sold > 0 ORDER BY total_estimated_profit DESC LIMIT 50;                                                                                                                                                                                          
 SELECT p.id, p.name, p.category, p.price, COUNT(DISTINCT ca.id) as abandoned_in_carts, COUNT(DISTINCT o.id) as purchased_from_carts, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate, AVG(DATEDIFF(CURDATE(), ca.date_cart)) as avg_days_since_abandoned, COUNT(DISTINCT ca.client_id) as unique_clients_abandoned, AVG(p.price) as avg_price_abandoned, SUM(CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN 1 ELSE 0 END) as abandoned_last_7_days, SUM(CASE WHEN ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN 1 ELSE 0 END) as abandoned_last_30_days FROM products p JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.id IS NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) GROUP BY p.id, p.name, p.category, p.price HAVING abandoned_in_carts > 5 ORDER BY abandoned_in_carts DESC, conversion_rate;                                                                                                        
 SELECT p.name, p.category, CASE WHEN MONTH(o.orderdate) IN (12,1,2) THEN 'Winter' WHEN MONTH(o.orderdate) IN (3,4,5) THEN 'Spring' WHEN MONTH(o.orderdate) IN (6,7,8) THEN 'Summer' ELSE 'Fall' END as season, COUNT(DISTINCT o.id) as sales_count, SUM(o.price) as total_revenue FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY p.name, p.category, season HAVING sales_count > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT w.name as region, p.category, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, COUNT(DISTINCT o.client_id) as unique_customers FROM orders o JOIN clients c ON c.id = o.client_id JOIN wilayas w ON w.id = c.wilaya JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY w.name, p.category HAVING order_count > 0 ORDER BY region, total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT p1.name as product_a, p2.name as product_b, COUNT(DISTINCT ca1.client_id) as co_occurrence, ROUND(COUNT(DISTINCT ca1.client_id) * 100.0 / (SELECT COUNT(DISTINCT client_id) FROM cart WHERE product_id = p1.id), 2) as affinity_score FROM cart ca1 JOIN cart ca2 ON ca1.client_id = ca2.client_id AND ca1.product_id != ca2.product_id JOIN products p1 ON p1.id = ca1.product_id JOIN products p2 ON p2.id = ca2.product_id WHERE p1.category = p2.category GROUP BY p1.name, p2.name HAVING co_occurrence > 2 ORDER BY affinity_score DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 25 THEN '18-24' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 35 THEN '25-34' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 45 THEN '35-44' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 55 THEN '45-54' ELSE '55+' END as age_group, p.category, COUNT(DISTINCT o.id) as order_count, AVG(o.price) as avg_order_value FROM clients c JOIN orders o ON o.client_id = c.id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE c.birthday IS NOT NULL AND o.status = 'delivered' GROUP BY age_group, p.category HAVING order_count > 0 ORDER BY age_group, order_count DESC;                                                                                                                                                                                                                                                                                                                                                               
 SELECT w.name AS wilaya, CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 20 THEN 'Moins de 20 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 20 AND 29 THEN '20-29 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 30 AND 39 THEN '30-39 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 40 AND 49 THEN '40-49 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) >= 50 THEN '50 ans et plus' ELSE 'ge inconnu' END AS tranche_age, COUNT(DISTINCT c.id) AS nombre_clients, COUNT(DISTINCT o.id) AS nombre_commandes, SUM(o.price) AS chiffre_affaires, AVG(o.price) AS panier_moyen, COUNT(DISTINCT p.category) AS categories_achetees, AVG(r.rating) AS note_moyenne_donnee, COUNT(DISTINCT cm.id) AS commentaires_rediges, (COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id)) AS taux_activation FROM wilayas w JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id WHERE o.status = 'delivered' OR o.id IS NULL GROUP BY w.name, tranche_age ORDER BY w.name, CASE tranche_age WHEN 'Moins de 20 ans' THEN 1 WHEN '20-29 ans' THEN 2 WHEN '30-39 ans' THEN 3 WHEN '40-49 ans' THEN 4 WHEN '50 ans et plus' THEN 5 ELSE 6 END; 
 SELECT w.name AS wilaya, p.category AS categorie, COUNT(DISTINCT ca.id) AS ajouts_panier, COUNT(DISTINCT o.id) AS conversions, COUNT(DISTINCT CASE WHEN o.id IS NULL THEN ca.id END) AS abandons, (COUNT(DISTINCT CASE WHEN o.id IS NULL THEN ca.id END) * 100.0 / COUNT(DISTINCT ca.id)) AS taux_abandon, AVG(ca.initial_price) AS prix_moyen_abandonne, COUNT(DISTINCT ca.client_id) AS clients_abandonneurs, MIN(ca.date_cart) AS premier_abandon, MAX(ca.date_cart) AS dernier_abandon FROM wilayas w JOIN clients c ON w.id = c.wilaya JOIN cart ca ON c.id = ca.client_id JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate >= ca.date_cart AND DATEDIFF(o.orderdate, ca.date_cart) <= 3 WHERE ca.product_id IS NOT NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY w.name, p.category HAVING COUNT(DISTINCT ca.id) > 10 ORDER BY taux_abandon DESC;                                                                                                                                 
 SELECT w.name AS wilaya, COUNT(DISTINCT ca.id) AS consultations_produits, COUNT(DISTINCT ca.client_id) AS visiteurs_uniques, AVG(ca.initial_price) AS prix_moyen_consulte, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) AS consultations_promotions, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) AS consultations_offres, COUNT(DISTINCT p.category) AS categories_consultees, COUNT(DISTINCT p.brand) AS marques_consultees, MIN(ca.date_cart) AS premiere_consultation, MAX(ca.date_cart) AS derniere_consultation, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) AS consultations_converties, (COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) * 100.0 / COUNT(DISTINCT ca.id)) AS taux_conversion_navigation FROM wilayas w JOIN clients c ON w.id = c.wilaya JOIN cart ca ON c.id = ca.client_id JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate >= ca.date_cart AND DATEDIFF(o.orderdate, ca.date_cart) <= 7 WHERE ca.product_id IS NOT NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY w.name HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY consultations_produits DESC; 
 SELECT w.name AS wilaya, COUNT(DISTINCT ca.id) AS consultations_produits_region, COUNT(DISTINCT ca.client_id) AS visiteurs_uniques_region, AVG(ca.initial_price) AS prix_moyen_consulte_region, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) AS consultations_promotions_region, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) AS consultations_offres_region, COUNT(DISTINCT p.category) AS categories_consultees_region, COUNT(DISTINCT p.brand) AS marques_consultees_region, MIN(ca.date_cart) AS premiere_consultation_region, MAX(ca.date_cart) AS derniere_consultation_region, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) AS consultations_converties_region, (COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) * 100.0 / COUNT(DISTINCT ca.id)) AS taux_conversion_navigation_region FROM wilayas w JOIN clients c ON w.id = c.wilaya JOIN cart ca ON c.id = ca.client_id JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate >= ca.date_cart AND DATEDIFF(o.orderdate, ca.date_cart) <= 7 WHERE ca.product_id IS NOT NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY w.name HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY consultations_produits_region DESC; 
 SELECT w.name AS wilaya, COUNT(DISTINCT ca.id) AS consultations_produits_region_final, COUNT(DISTINCT ca.client_id) AS visiteurs_uniques_region_final, AVG(ca.initial_price) AS prix_moyen_consulte_region_final, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) AS consultations_promotions_region_final, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) AS consultations_offres_region_final, COUNT(DISTINCT p.category) AS categories_consultees_region_final, COUNT(DISTINCT p.brand) AS marques_consultees_region_final, MIN(ca.date_cart) AS premiere_consultation_region_final, MAX(ca.date_cart) AS derniere_consultation_region_final, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) AS consultations_converties_region_final, (COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) * 100.0 / COUNT(DISTINCT ca.id)) AS taux_conversion_navigation_region_final FROM wilayas w JOIN clients c ON w.id = c.wilaya JOIN cart ca ON c.id = ca.client_id JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate >= ca.date_cart AND DATEDIFF(o.orderdate, ca.date_cart) <= 7 WHERE ca.product_id IS NOT NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY w.name HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY consultations_produits_region_final DESC; 
 SELECT w.name AS wilaya, CASE WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) < 25 THEN '15-24 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 25 AND 34 THEN '25-34 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 35 AND 44 THEN '35-44 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) BETWEEN 45 AND 54 THEN '45-54 ans' WHEN TIMESTAMPDIFF(YEAR, c.birthday, CURDATE()) >= 55 THEN '55+ ans' ELSE 'ge inconnu' END AS tranche_age, COUNT(DISTINCT c.id) AS clients_age_region_perf_final, COUNT(DISTINCT o.id) AS commandes_age_region_perf_final, SUM(o.price) AS ca_age_region_perf_final, AVG(o.price) AS panier_moyen_age_region_perf_final, COUNT(DISTINCT p.category) AS categories_age_region_perf_final, AVG(r.rating) AS note_moyenne_age_region_perf_final, COUNT(DISTINCT cm.id) AS commentaires_age_region_perf_final, (COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id)) AS taux_activation_age_region_perf_final, (SUM(o.price) * 100.0 / SUM(SUM(o.price)) OVER(PARTITION BY w.name)) AS part_ca_age_region_perf_final FROM wilayas w JOIN clients c ON w.id = c.wilaya LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id WHERE o.status = 'delivered' OR o.id IS NULL GROUP BY w.name, tranche_age HAVING COUNT(DISTINCT o.id) > 0 OR COUNT(DISTINCT c.id) > 0 ORDER BY w.name, CASE tranche_age WHEN '15-24 ans' THEN 1 WHEN '25-34 ans' THEN 2 WHEN '35-44 ans' THEN 3 WHEN '45-54 ans' THEN 4 WHEN '55+ ans' THEN 5 ELSE 6 END; 
 SELECT 'ANALYSE COMPLTE DE LA BASE DE DONNES' AS titre_rapport, CURDATE() AS date_rapport, (SELECT COUNT(DISTINCT id) FROM clients) AS total_clients, (SELECT COUNT(DISTINCT id) FROM products) AS total_produits, (SELECT COUNT(DISTINCT id) FROM orders WHERE status = 'delivered') AS total_commandes_livrees, (SELECT SUM(price) FROM orders WHERE status = 'delivered') AS chiffre_affaires_total, (SELECT AVG(price) FROM orders WHERE status = 'delivered') AS panier_moyen, (SELECT COUNT(DISTINCT client_id) FROM orders) AS clients_actifs, (SELECT COUNT(DISTINCT id) FROM admin) AS total_administrateurs, (SELECT COUNT(DISTINCT id) FROM wilayas) AS total_wilayas, (SELECT COUNT(DISTINCT id) FROM comments) AS total_commentaires, (SELECT AVG(rating) FROM rating) AS note_moyenne_produits, (SELECT COUNT(DISTINCT id) FROM promotions WHERE CURDATE() BETWEEN startdate AND enddate) AS promotions_actives, (SELECT COUNT(DISTINCT id) FROM offers WHERE CURDATE() BETWEEN startdate AND enddate) AS offres_actives, (SELECT COUNT(DISTINCT id) FROM returns WHERE MONTH(date) = MONTH(CURDATE())) AS retours_mois_courant, (SELECT COUNT(DISTINCT id) FROM claims WHERE response IS NULL) AS reclamations_en_attente, (SELECT COUNT(DISTINCT id) FROM inbox WHERE status = 'unread') AS messages_non_lus, (SELECT COUNT(DISTINCT id) FROM favorites) AS total_favoris, (SELECT SUM(quantity) FROM products) AS total_stock, (SELECT SUM(price * quantity) FROM products) AS valeur_stock_total, (SELECT AVG(DATEDIFF(deliveredDate, orderdate)) FROM orders WHERE status = 'delivered') AS delai_livraison_moyen, (SELECT COUNT(DISTINCT category) FROM products) AS categories_produits, (SELECT COUNT(DISTINCT brand) FROM products) AS marques_produits FROM dual; 
 SELECT p.name, p.quantity as current_stock, AVG(daily_sales) as avg_daily_sales, ROUND(p.quantity / NULLIF(AVG(daily_sales), 0), 1) as days_of_stock FROM products p LEFT JOIN ( SELECT p.id, COUNT(DISTINCT o.id) / 30.0 as daily_sales FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY p.id ) as sales ON sales.id = p.id WHERE p.quantity > 0 GROUP BY p.name, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_of_stock;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT c.id AS client_id, c.firstname, c.lastname, COUNT(DISTINCT ca.id) AS total_cart_views, COUNT(DISTINCT ca.product_id) AS unique_products_viewed, COUNT(DISTINCT p.category) AS unique_categories_viewed, COUNT(DISTINCT p.brand) AS unique_brands_viewed, AVG(ca.initial_price) AS avg_viewed_price, MIN(ca.date_cart) AS first_view_date, MAX(ca.date_cart) AS last_view_date, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) AS promotional_views, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) AS offer_views, COUNT(DISTINCT o.id) AS completed_orders, SUM(o.price) AS total_spent, AVG(o.price) AS avg_order_value, (COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id)) AS cart_to_order_conversion_rate, COUNT(DISTINCT f.id) AS favorites_added, COUNT(DISTINCT r.id) AS ratings_given, COUNT(DISTINCT cm.id) AS comments_written, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'Window Shopper' WHEN COUNT(DISTINCT o.id) = 1 THEN 'One-time Buyer' WHEN COUNT(DISTINCT o.id) BETWEEN 2 AND 5 THEN 'Repeat Buyer' ELSE 'Loyal Customer' END AS customer_type FROM clients c LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id LEFT JOIN favorites f ON c.id = f.client_id LEFT JOIN rating r ON c.id = r.client_id LEFT JOIN comments cm ON c.id = cm.client_id WHERE ca.id IS NOT NULL OR o.id IS NOT NULL GROUP BY c.id HAVING COUNT(DISTINCT ca.id) > 0 OR COUNT(DISTINCT o.id) > 0 ORDER BY total_cart_views DESC; 
 SELECT p.id as product_id, p.name as product_name, p.category, p.price, COUNT(DISTINCT r.id) as rating_count, AVG(r.rating) as avg_rating, COUNT(DISTINCT c.id) as comment_count, COUNT(DISTINCT f.id) as favorite_count, COUNT(DISTINCT cl.id) as claim_count, COUNT(DISTINCT ret.id) as return_count, (AVG(r.rating) * 0.4 + (COUNT(DISTINCT c.id) * 0.2 / GREATEST(COUNT(DISTINCT o.id), 1)) + (COUNT(DISTINCT f.id) * 0.2 / GREATEST(COUNT(DISTINCT ca.id), 1)) - ((COUNT(DISTINCT cl.id) + COUNT(DISTINCT ret.id)) * 0.2)) as satisfaction_score FROM products p LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments c ON c.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN claims cl ON cl.product_id = p.id LEFT JOIN returns ret ON ret.order_id IN (SELECT id FROM orders WHERE FIND_IN_SET(ca.id, cart_id) > 0) WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price HAVING rating_count > 0 ORDER BY satisfaction_score DESC LIMIT 50; 
 SELECT p.name, pr.percentage, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as converted_orders, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id), 2) as promotion_conversion_rate FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE pr.enddate >= CURDATE() GROUP BY p.name, pr.percentage HAVING cart_additions > 0 ORDER BY promotion_conversion_rate DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT p.id, p.name, p.category, AVG(weekly_sales) as avg_weekly_sales, STDDEV(weekly_sales) as sales_volatility, AVG(weekly_sales) * 4 as predicted_monthly_sales, ROUND(p.quantity / NULLIF(AVG(weekly_sales), 0), 1) as weeks_of_stock FROM products p LEFT JOIN ( SELECT p.id, WEEK(o.orderdate) as week_num, COUNT(DISTINCT o.id) as weekly_sales FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 12 WEEK) GROUP BY p.id, WEEK(o.orderdate) ) as weekly ON weekly.id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category HAVING avg_weekly_sales > 0 ORDER BY weeks_of_stock;                                                                                                                                                                                                                                                                                                                                
 SELECT w.id as wilaya_id, w.name as wilaya_name, w.delivery_price, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.id) as unique_products_ordered, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id), 2) as conversion_rate, ROUND(SUM(w.delivery_price) * 100.0 / SUM(o.price), 2) as delivery_cost_percentage, DENSE_RANK() OVER (ORDER BY SUM(o.price) DESC) as revenue_rank, DENSE_RANK() OVER (ORDER BY COUNT(DISTINCT o.id) DESC) as volume_rank FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.client_id = c.id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id GROUP BY w.id, w.name, w.delivery_price HAVING total_orders > 0 ORDER BY total_revenue DESC;                                                                                                                                                          
 SELECT w.name as region, p.category, p.name, COUNT(DISTINCT o.id) as sales_count, SUM(o.price) as total_revenue, COUNT(DISTINCT c.id) as unique_customers, AVG(r.rating) as avg_rating, ROUND(SUM(o.price) / COUNT(DISTINCT c.id), 2) as revenue_per_customer FROM wilayas w JOIN clients c ON c.wilaya = w.id JOIN orders o ON o.client_id = c.id JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.product_id = p.id WHERE o.status = 'delivered' GROUP BY w.name, p.category, p.name HAVING sales_count > 0 ORDER BY region, total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.category, MONTH(o.orderdate) as month, MONTHNAME(o.orderdate) as month_name, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as promoted_products_count, SUM(CASE WHEN pr.id IS NOT NULL THEN o.price ELSE 0 END) as promoted_products_revenue, ROUND(SUM(CASE WHEN pr.id IS NOT NULL THEN o.price ELSE 0 END) * 100.0 / NULLIF(SUM(o.price), 0), 2) as promotion_revenue_percentage FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.orderdate >= '2023-01-01' GROUP BY p.category, MONTH(o.orderdate), MONTHNAME(o.orderdate) HAVING order_count > 0 ORDER BY p.category, month;                                                                                                     
 SELECT p.name, p.category, DATEDIFF(CURDATE(), MIN(o.orderdate)) as days_since_first_sale, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_sale, COUNT(DISTINCT o.id) as total_sales, SUM(o.price) as total_revenue, AVG(o.price) as avg_sale_price, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 THEN 'Growth' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 90 THEN 'Mature' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 180 THEN 'Decline' ELSE 'End of Life' END as product_lifecycle_stage FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.status = 'delivered' GROUP BY p.name, p.category HAVING total_sales > 0 ORDER BY days_since_last_sale;                                                                                                                                                                                                                                                                                                             
 SELECT DATEDIFF(MAX(o.orderdate), MIN(o.orderdate)) as customer_lifetime_days, COUNT(DISTINCT o.id) as total_orders, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, COUNT(DISTINCT cl.id) as claims_filed FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN claims cl ON cl.client_id = c.id WHERE o.status = 'delivered' GROUP BY c.id HAVING total_orders > 0 ORDER BY customer_lifetime_days DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT w.name as wilaya, p.category, AVG(p.price) as avg_category_price, COUNT(DISTINCT o.id) as order_count, COUNT(DISTINCT c.id) as customer_count, SUM(o.price) as total_revenue, ROUND(SUM(o.price) / COUNT(DISTINCT c.id), 2) as revenue_per_customer FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY w.name, p.category HAVING order_count > 0 ORDER BY w.name, total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, c.lastname, AVG(o.price) as avg_historical_order_value, MAX(o.orderdate) as last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, CASE WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) <= 30 AND AVG(o.price) < 10000 THEN 'Upsell Opportunity' WHEN DATEDIFF(CURDATE(), MAX(o.orderdate)) BETWEEN 31 AND 90 THEN 'Re-engagement Opportunity' WHEN COUNT(DISTINCT p.category) = 1 THEN 'Cross-sell Opportunity' ELSE 'Maintenance' END as opportunity_type FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname HAVING COUNT(DISTINCT o.id) > 0 ORDER BY days_since_last_order;                                                                                                                                                                                                   
 SELECT p.name, p.category, p.price, COUNT(DISTINCT o.id) as times_sold, SUM(o.price) as total_revenue, (p.price * COUNT(DISTINCT o.id)) as estimated_cost, (SUM(o.price) - (p.price * COUNT(DISTINCT o.id))) as estimated_profit, ROUND((SUM(o.price) - (p.price * COUNT(DISTINCT o.id))) * 100.0 / SUM(o.price), 2) as profit_margin FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.status = 'delivered' GROUP BY p.name, p.category, p.price HAVING times_sold > 0 ORDER BY estimated_profit DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.category, COUNT(DISTINCT ca.id) as abandoned_carts, COUNT(DISTINCT o.id) as converted_carts, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id), 2) as conversion_rate, AVG(ca.initial_price) as avg_abandoned_value, AVG(DATEDIFF(CURDATE(), ca.date_cart)) as avg_days_abandoned FROM cart ca JOIN products p ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.id IS NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY p.category HAVING abandoned_carts > 0 ORDER BY conversion_rate;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.name, p.category, AVG(r.rating) as avg_rating, COUNT(DISTINCT r.id) as rating_count, COUNT(DISTINCT cm.id) as comment_count, COUNT(DISTINCT f.id) as favorite_count, COUNT(DISTINCT cl.id) as claim_count, ROUND(AVG(r.rating) * 20 - COUNT(DISTINCT cl.id) * 5, 2) as satisfaction_score FROM products p LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN claims cl ON cl.product_id = p.id GROUP BY p.name, p.category HAVING rating_count > 0 ORDER BY satisfaction_score DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.category, COUNT(DISTINCT p.id) as products_in_category, AVG(r.rating) as avg_category_rating, COUNT(DISTINCT r.id) as total_ratings, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT f.id) as total_favorites, COUNT(DISTINCT cl.id) as total_claims, COUNT(DISTINCT ret.id) as total_returns, ROUND(AVG(r.rating) * 20, 2) as satisfaction_score_out_of_100, ROUND(COUNT(DISTINCT cl.id) * 100.0 / NULLIF(COUNT(DISTINCT o.id), 0), 2) as claim_rate_percentage, ROUND(COUNT(DISTINCT f.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as favorite_rate_percentage FROM products p LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN claims cl ON cl.product_id = p.id LEFT JOIN returns ret ON ret.order_id IN (SELECT id FROM orders WHERE FIND_IN_SET(ca.id, cart_id) > 0) WHERE p.quantity > 0 GROUP BY p.category HAVING total_ratings > 0 ORDER BY satisfaction_score_out_of_100 DESC, total_ratings DESC; 
 SELECT p.category, YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, AVG(p.price) as avg_category_price, MIN(p.price) as min_price, MAX(p.price) as max_price, COUNT(DISTINCT o.id) as sales_count, AVG(o.price) as avg_order_value FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING sales_count > 0 ORDER BY year DESC, month DESC, avg_category_price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT w.name as wilaya, COUNT(DISTINCT c.id) as total_clients, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id), 2) as client_conversion_rate FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY w.name HAVING total_orders > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT p.id, p.name, p.category, p.quantity, AVG(daily_sales) as avg_daily_sales, ROUND(p.quantity / NULLIF(AVG(daily_sales), 0), 1) as days_until_out_of_stock, CASE WHEN ROUND(p.quantity / NULLIF(AVG(daily_sales), 0), 1) <= 7 THEN 'Critical' WHEN ROUND(p.quantity / NULLIF(AVG(daily_sales), 0), 1) <= 14 THEN 'Warning' WHEN ROUND(p.quantity / NULLIF(AVG(daily_sales), 0), 1) <= 30 THEN 'Monitor' ELSE 'Safe' END as stock_status, AVG(daily_sales) * 30 as predicted_monthly_sales FROM products p LEFT JOIN ( SELECT p.id, DATE(o.orderdate) as sale_date, COUNT(DISTINCT o.id) as daily_sales FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) GROUP BY p.id, DATE(o.orderdate) ) as daily ON daily.id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.quantity HAVING avg_daily_sales > 0 ORDER BY days_until_out_of_stock;                                                          
 SELECT ofr.id as offer_id, ofr.name as offer_name, ofr.price as offer_price, COUNT(DISTINCT ca.client_id) as clients_targeted, COUNT(DISTINCT o.id) as orders_with_offer, SUM(o.price) as revenue_generated, AVG(o.price) as avg_order_value_with_offer, COUNT(DISTINCT o2.id) as orders_without_offer, SUM(o2.price) as revenue_without_offer, AVG(o2.price) as avg_order_value_without_offer, ROUND((AVG(o.price) - AVG(o2.price)) * 100.0 / AVG(o2.price), 2) as uplift_percentage, DATEDIFF(ofr.enddate, ofr.startdate) as offer_duration_days, COUNT(DISTINCT CASE WHEN o.orderdate BETWEEN ofr.startdate AND ofr.enddate THEN o.id END) * 100.0 / DATEDIFF(ofr.enddate, ofr.startdate) as orders_per_day FROM offers ofr LEFT JOIN cart ca ON ca.offer_id = ofr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN orders o2 ON o2.client_id = o.client_id AND o2.orderdate BETWEEN DATE_SUB(o.orderdate, INTERVAL 30 DAY) AND DATE_SUB(o.orderdate, INTERVAL 1 DAY) WHERE ofr.enddate >= CURDATE() GROUP BY ofr.id, ofr.name, ofr.price, ofr.startdate, ofr.enddate HAVING orders_with_offer > 0 ORDER BY uplift_percentage DESC; 
 SELECT age_group, COUNT(DISTINCT c.id) as clients_in_group, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as unique_categories_purchased, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT cm.id) as total_comments, COUNT(DISTINCT f.id) as total_favorites, ROUND(COUNT(DISTINCT o.id) * 1.0 / COUNT(DISTINCT c.id), 2) as avg_orders_per_client, ROUND(SUM(o.price) * 1.0 / COUNT(DISTINCT c.id), 2) as avg_spent_per_client FROM ( SELECT c.*, FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) as age, CASE WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 18 THEN 'Under 18' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 18 AND 25 THEN '18-25' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 26 AND 35 THEN '26-35' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 36 AND 45 THEN '36-45' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 46 AND 55 THEN '46-55' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 56 AND 65 THEN '56-65' ELSE '65+' END as age_group FROM clients c ) as c LEFT JOIN orders o ON o.client_id = c.id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id WHERE age IS NOT NULL GROUP BY age_group ORDER BY FIELD(age_group, 'Under 18', '18-25', '26-35', '36-45', '46-55', '56-65', '65+'); 
 SELECT c.id as client_id, COUNT(DISTINCT ca.id) as cart_sessions, COUNT(DISTINCT p.id) as unique_products_viewed, COUNT(DISTINCT f.id) as products_favorited, COUNT(DISTINCT cm.id) as comments_made, COUNT(DISTINCT r.id) as ratings_given, COUNT(DISTINCT o.id) as orders_placed, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as cart_to_order_rate, AVG(DATEDIFF(o.orderdate, ca.date_cart)) as avg_days_to_purchase, SUM(CASE WHEN pr.id IS NOT NULL THEN 1 ELSE 0 END) as discounted_purchases, COUNT(DISTINCT p.category) as categories_explored FROM clients c LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN promotions pr ON pr.id = ca.promotion_id GROUP BY c.id HAVING cart_sessions > 0 ORDER BY orders_placed DESC, cart_to_order_rate DESC;                                             
 SELECT c.id, c.firstname, c.lastname, COUNT(DISTINCT o.id) as total_orders, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as unique_categories, AVG(DATEDIFF(o2.orderdate, o1.orderdate)) as avg_days_between_orders, COUNT(DISTINCT f.id) as favorites_count, COUNT(DISTINCT r.id) as ratings_count, CASE WHEN COUNT(DISTINCT o.id) >= 10 THEN 'VIP' WHEN COUNT(DISTINCT o.id) >= 5 THEN 'Loyal' WHEN COUNT(DISTINCT o.id) >= 2 THEN 'Regular' ELSE 'New' END as customer_tier FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN orders o1 ON o1.client_id = c.id LEFT JOIN orders o2 ON o2.client_id = c.id AND o2.id > o1.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname HAVING total_orders > 0 ORDER BY customer_tier, total_orders DESC;                                                                    
 SELECT p.name, p.category, p.price, p.quantity as current_stock, COUNT(DISTINCT ca.id) as cart_additions_last_30_days, COUNT(DISTINCT o.id) as sales_last_30_days, COUNT(DISTINCT f.id) as favorites_last_30_days, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_sale, CASE WHEN COUNT(DISTINCT o.id) = 0 AND p.quantity > 0 THEN 'No Sales - Clearance' WHEN COUNT(DISTINCT o.id) <= 2 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) > 60 THEN 'Slow Moving' WHEN COUNT(DISTINCT ca.id) > 5 AND COUNT(DISTINCT o.id) = 0 THEN 'High Interest, No Sales' ELSE 'Normal' END as performance_status FROM products p LEFT JOIN cart ca ON ca.product_id = p.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN favorites f ON f.product_id = p.id WHERE p.quantity > 0 GROUP BY p.name, p.category, p.price, p.quantity HAVING sales_last_30_days < 3 OR days_since_last_sale > 30 ORDER BY days_since_last_sale DESC;     
 SELECT c.id as client_id, COUNT(DISTINCT ca.id) as cart_interactions, COUNT(DISTINCT o.id) as order_interactions, COUNT(DISTINCT f.id) as favorite_interactions, COUNT(DISTINCT cm.id) as comment_interactions, COUNT(DISTINCT r.id) as rating_interactions, COUNT(DISTINCT cl.id) as claim_interactions, COUNT(DISTINCT ret.id) as return_interactions, COUNT(DISTINCT i.id) as inbox_interactions, COUNT(DISTINCT CASE WHEN ca.date_cart IS NOT NULL THEN 'cart' END) as has_cart, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN 'order' END) as has_order, COUNT(DISTINCT CASE WHEN f.id IS NOT NULL THEN 'favorite' END) as has_favorite, COUNT(DISTINCT CASE WHEN cm.id IS NOT NULL THEN 'comment' END) as has_comment, COUNT(DISTINCT CASE WHEN r.id IS NOT NULL THEN 'rating' END) as has_rating, COUNT(DISTINCT CASE WHEN cl.id IS NOT NULL THEN 'claim' END) as has_claim, COUNT(DISTINCT CASE WHEN ret.id IS NOT NULL THEN 'return' END) as has_return, COUNT(DISTINCT CASE WHEN i.id IS NOT NULL THEN 'inbox' END) as has_inbox, (COUNT(DISTINCT ca.id) + COUNT(DISTINCT o.id) + COUNT(DISTINCT f.id) + COUNT(DISTINCT cm.id) + COUNT(DISTINCT r.id)) as total_interactions, ROUND((COUNT(DISTINCT o.id) * 100.0) / NULLIF( COUNT(DISTINCT ca.id) + COUNT(DISTINCT f.id) + COUNT(DISTINCT cm.id) + COUNT(DISTINCT r.id), 0), 2) as conversion_efficiency FROM clients c LEFT JOIN cart ca ON ca.client_id = c.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN claims cl ON cl.client_id = c.id LEFT JOIN returns ret ON ret.client_id = c.id LEFT JOIN inbox i ON i.client_id = c.id GROUP BY c.id HAVING total_interactions > 0 ORDER BY total_interactions DESC, conversion_efficiency DESC; 
 SELECT YEAR(pr.startdate) as year, MONTH(pr.startdate) as month, MONTHNAME(pr.startdate) as month_name, COUNT(DISTINCT pr.id) as total_promotions, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as converted_orders, SUM(o.price) as total_revenue_from_promotions, AVG(o.price) as avg_order_value_with_promotion, COUNT(DISTINCT ca.client_id) as unique_customers_used, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate, ROUND(AVG(pr.percentage) * 100.0 / AVG(p.price), 2) as discount_depth_percentage FROM promotions pr LEFT JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE pr.startdate >= '2023-01-01' GROUP BY YEAR(pr.startdate), MONTH(pr.startdate), MONTHNAME(pr.startdate) HAVING total_promotions > 0 ORDER BY year DESC, month DESC;                                                                                          
 SELECT w.id as wilaya_id, w.name as wilaya_name, p.category as top_category, COUNT(DISTINCT o.id) as order_count_in_category, SUM(o.price) as revenue_in_category, ROUND(COUNT(DISTINCT o.id) * 100.0 / total_orders.total, 2) as category_percentage, AVG(p.price) as avg_price_in_category, COUNT(DISTINCT c.id) as customers_in_category FROM wilayas w JOIN clients c ON c.wilaya = w.id JOIN orders o ON o.client_id = c.id AND o.status = 'delivered' JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id JOIN ( SELECT wilaya_id, COUNT(*) as total FROM orders WHERE status = 'delivered' GROUP BY wilaya_id ) as total_orders ON total_orders.wilaya_id = w.id WHERE o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 180 DAY) GROUP BY w.id, w.name, p.category, total_orders.total HAVING order_count_in_category > 0 ORDER BY w.name, revenue_in_category DESC;                                                                                                                                                     
 SELECT p1.name as product_a, p2.name as product_b, p1.category as category_a, p2.category as category_b, COUNT(DISTINCT ca1.client_id) as co_purchase_count, COUNT(DISTINCT ca1.client_id) * 100.0 / (SELECT COUNT(DISTINCT client_id) FROM cart WHERE product_id = p1.id) as affinity_score, AVG(p1.price + p2.price) as avg_combined_price, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca1.client_id END) as co_purchase_converted, ROUND(COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca1.client_id END) * 100.0 / COUNT(DISTINCT ca1.client_id), 2) as co_purchase_conversion_rate FROM cart ca1 JOIN cart ca2 ON ca1.client_id = ca2.client_id AND ca1.product_id != ca2.product_id AND DATE(ca1.date_cart) = DATE(ca2.date_cart) JOIN products p1 ON p1.id = ca1.product_id JOIN products p2 ON p2.id = ca2.product_id LEFT JOIN orders o ON (FIND_IN_SET(ca1.id, o.cart_id) > 0 AND FIND_IN_SET(ca2.id, o.cart_id) > 0) WHERE p1.category != p2.category GROUP BY p1.name, p2.name, p1.category, p2.category HAVING co_purchase_count > 2 ORDER BY co_purchase_count DESC, affinity_score DESC LIMIT 30; 
 SELECT pr.id, p.name, pr.percentage, pr.startdate, pr.enddate, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as orders_placed, SUM(o.price) as revenue_generated, AVG(o.price) as avg_order_value, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.id), 2) as conversion_rate FROM promotions pr JOIN products p ON p.id = pr.product_id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE pr.enddate >= CURDATE() GROUP BY pr.id, p.name, pr.percentage, pr.startdate, pr.enddate HAVING cart_additions > 0 ORDER BY conversion_rate DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT w.name as wilaya, COUNT(DISTINCT c.id) as total_customers, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_purchased, AVG(w.delivery_price) as avg_delivery_cost, ROUND(SUM(o.price) / COUNT(DISTINCT c.id), 2) as revenue_per_customer FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY w.name HAVING total_orders > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT c.id, c.firstname, c.lastname, c.email, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, MIN(o.orderdate) as first_order_date, MAX(o.orderdate) as last_order_date, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_order, COUNT(DISTINCT p.category) as categories_purchased, AVG(r.rating) as avg_rating_given, CASE WHEN SUM(o.price) >= 100000 THEN 'VIP' WHEN SUM(o.price) >= 50000 THEN 'Gold' WHEN SUM(o.price) >= 20000 THEN 'Silver' ELSE 'Bronze' END as value_tier FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.client_id = c.id WHERE o.status = 'delivered' GROUP BY c.id, c.firstname, c.lastname, c.email HAVING total_spent >= 20000 ORDER BY total_spent DESC;                                                                                                                                                                        
 SELECT p.id, p.name, p.category, p.quantity, COUNT(DISTINCT ca.id) as cart_additions_last_7_days, COUNT(DISTINCT f.id) as favorites_last_7_days, COUNT(DISTINCT o.id) as sales_last_7_days, AVG(r.rating) as avg_rating, COUNT(DISTINCT cm.id) as total_comments, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate_last_7_days, CASE WHEN COUNT(DISTINCT ca.id) >= 10 AND COUNT(DISTINCT o.id) >= 5 THEN 'High Demand' WHEN COUNT(DISTINCT ca.id) >= 5 AND COUNT(DISTINCT o.id) >= 2 THEN 'Medium Demand' WHEN COUNT(DISTINCT ca.id) >= 3 AND COUNT(DISTINCT o.id) = 0 THEN 'High Interest, No Sales' ELSE 'Low Demand' END as demand_status FROM products p LEFT JOIN cart ca ON ca.product_id = p.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.quantity ORDER BY cart_additions_last_7_days DESC; 
 SELECT p.id, p.name, p.category, p.price, p.quantity as current_stock, COUNT(DISTINCT ca.id) as cart_additions_last_90_days, COUNT(DISTINCT o.id) as sales_last_90_days, COUNT(DISTINCT f.id) as favorites_last_90_days, AVG(r.rating) as avg_rating, COUNT(DISTINCT cm.id) as comment_count, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_sale, CASE WHEN COUNT(DISTINCT o.id) = 0 AND p.quantity > 10 THEN 'Dead Stock' WHEN COUNT(DISTINCT o.id) <= 2 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) > 60 THEN 'Slow Moving' WHEN COUNT(DISTINCT ca.id) > 10 AND COUNT(DISTINCT o.id) = 0 THEN 'High Interest, No Sales' WHEN AVG(r.rating) < 2.5 THEN 'Low Rated' WHEN p.quantity > 50 AND COUNT(DISTINCT o.id) < 5 THEN 'Overstocked' ELSE 'Normal' END as performance_status FROM products p LEFT JOIN cart ca ON ca.product_id = p.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 90 DAY) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN comments cm ON cm.product_id = p.id WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.price, p.quantity HAVING sales_last_90_days < 5 OR days_since_last_sale > 30 OR conversion_rate < 10 ORDER BY days_since_last_sale DESC, conversion_rate; 
 SELECT primary_product_id, primary_product_name, cross_sell_product_id, cross_sell_product_name, co_purchase_count, cross_sell_affinity_score, avg_days_between_purchases FROM ( SELECT p1.id as primary_product_id, p1.name as primary_product_name, p2.id as cross_sell_product_id, p2.name as cross_sell_product_name, COUNT(DISTINCT c.id) as co_purchase_count, ROUND(COUNT(DISTINCT c.id) * 100.0 / (SELECT COUNT(DISTINCT client_id) FROM cart WHERE product_id = p1.id), 2) as cross_sell_affinity_score, AVG(DATEDIFF(o2.orderdate, o1.orderdate)) as avg_days_between_purchases, ROW_NUMBER() OVER (PARTITION BY p1.id ORDER BY COUNT(DISTINCT c.id) DESC) as rank_within_product FROM clients c JOIN orders o1 ON o1.client_id = c.id JOIN cart ca1 ON FIND_IN_SET(ca1.id, o1.cart_id) > 0 JOIN products p1 ON p1.id = ca1.product_id JOIN orders o2 ON o2.client_id = c.id AND o2.id > o1.id JOIN cart ca2 ON FIND_IN_SET(ca2.id, o2.cart_id) > 0 JOIN products p2 ON p2.id = ca2.product_id WHERE p1.id != p2.id AND DATEDIFF(o2.orderdate, o1.orderdate) <= 30 GROUP BY p1.id, p1.name, p2.id, p2.name HAVING co_purchase_count >= 2 ) as cross_sell_analysis WHERE rank_within_product <= 3 ORDER BY co_purchase_count DESC; 
 SELECT p.category, YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, AVG(p.price) as avg_product_price, MIN(p.price) as min_price, MAX(p.price) as max_price, COUNT(DISTINCT o.id) as sales_count, SUM(o.price) as total_revenue, LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as prev_month_avg_price, ROUND((AVG(p.price) - LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate))) * 100.0 / LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 2) as price_change_percentage FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING sales_count > 0 ORDER BY p.category, year DESC, month DESC;                                                                                                                                                              
 SELECT w.name as wilaya, COUNT(DISTINCT c.id) as total_customers, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as categories_ordered, ROUND(COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT c.id), 2) as customer_conversion_rate, ROUND(SUM(o.price) / COUNT(DISTINCT c.id), 2) as revenue_per_customer, AVG(w.delivery_price) as avg_delivery_cost, ROUND(AVG(w.delivery_price) * 100.0 / AVG(o.price), 2) as delivery_cost_percentage FROM wilayas w LEFT JOIN clients c ON c.wilaya = w.id LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY w.name HAVING total_orders > 0 ORDER BY total_revenue DESC;                                                                                                                                                                                                                                  
 SELECT p.name, p.category, p.price, p.quantity as current_stock, COUNT(DISTINCT ca.id) as cart_additions_last_30_days, COUNT(DISTINCT o.id) as sales_last_30_days, COUNT(DISTINCT f.id) as favorites_last_30_days, DATEDIFF(CURDATE(), MAX(o.orderdate)) as days_since_last_sale, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate_last_30_days, CASE WHEN COUNT(DISTINCT o.id) = 0 AND p.quantity > 0 THEN 'No Sales - Consider Clearance' WHEN COUNT(DISTINCT o.id) <= 2 AND DATEDIFF(CURDATE(), MAX(o.orderdate)) > 60 THEN 'Slow Moving' WHEN COUNT(DISTINCT ca.id) > 10 AND COUNT(DISTINCT o.id) = 0 THEN 'High Interest, No Sales' WHEN AVG(r.rating) < 2.5 THEN 'Low Rated' WHEN p.quantity > 50 AND COUNT(DISTINCT o.id) < 5 THEN 'Overstocked' ELSE 'Normal Performance' END as performance_status FROM products p LEFT JOIN cart ca ON ca.product_id = p.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN favorites f ON f.product_id = p.id LEFT JOIN rating r ON r.product_id = p.id WHERE p.quantity > 0 GROUP BY p.name, p.category, p.price, p.quantity HAVING sales_last_30_days < 3 OR days_since_last_sale > 30 OR conversion_rate_last_30_days < 10 ORDER BY days_since_last_sale DESC, conversion_rate_last_30_days; 
 SELECT p.*, a.username as admin_name, COUNT(DISTINCT ca.client_id) as unique_buyers, AVG(r.rating) as avg_rating, (SELECT COUNT(*) FROM favorites f WHERE f.product_id = p.id) as favorite_count FROM products p LEFT JOIN promotions pr ON pr.product_id = p.id LEFT JOIN cart ca ON ca.product_id = p.id OR ca.promotion_id = pr.id LEFT JOIN rating r ON r.product_id = p.id OR r.promotion_id = pr.id LEFT JOIN admin a ON a.id = p.admin_id WHERE p.price > 100 AND p.quantity > 0 AND (pr.id IS NULL OR (pr.startdate <= CURDATE() AND pr.enddate >= CURDATE())) GROUP BY p.id, a.username HAVING AVG(r.rating) > 3.5 ORDER BY p.price DESC, avg_rating DESC;                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT client_id, 'Order' as type, orderdate as date, price as amount FROM orders WHERE price > 500 AND status IN ('pending', 'processing') UNION ALL SELECT c.client_id, 'Cart' as type, c.date_cart as date, c.initial_price as amount FROM cart c LEFT JOIN products p ON p.id = c.product_id WHERE p.price > 300 UNION ALL SELECT f.client_id, 'Favorite' as type, CURDATE() as date, 0 as amount FROM favorites f LEFT JOIN products p ON p.id = f.product_id WHERE p.category = 'Electronics' ORDER BY client_id, date DESC, amount DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT COALESCE(c.id, o.client_id) as client_id, COUNT(DISTINCT o.id) as order_count, COUNT(DISTINCT ca.id) as cart_count, COUNT(DISTINCT f.id) as favorite_count FROM clients c LEFT JOIN orders o ON o.client_id = c.id AND YEAR(o.orderdate) = 2024 LEFT JOIN cart ca ON ca.client_id = c.id AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) LEFT JOIN favorites f ON f.client_id = c.id RIGHT JOIN (SELECT DISTINCT client_id FROM orders WHERE price > 100) o2 ON o2.client_id = c.id WHERE (c.birthday IS NOT NULL OR o.id IS NOT NULL) GROUP BY COALESCE(c.id, o.client_id) HAVING order_count > 0 OR cart_count > 0 ORDER BY order_count DESC, favorite_count DESC;                                                                                                                                                                                                                                                                                                                                                                             
 SELECT price_range, COUNT(DISTINCT p.id) as products_in_range, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as orders, SUM(o.price) as total_revenue, COUNT(DISTINCT ca.client_id) as unique_customers, AVG(r.rating) as avg_rating, COUNT(DISTINCT f.id) as favorites, ROUND(COUNT(DISTINCT o.id) * 100.0 / NULLIF(COUNT(DISTINCT ca.id), 0), 2) as conversion_rate, AVG(DATEDIFF(o.orderdate, ca.date_cart)) as avg_days_to_purchase FROM ( SELECT p.*, CASE WHEN p.price < 1000 THEN 'Low (<1000)' WHEN p.price BETWEEN 1000 AND 5000 THEN 'Medium (1000-5000)' WHEN p.price BETWEEN 5001 AND 15000 THEN 'High (5001-15000)' ELSE 'Premium (>15000)' END as price_range FROM products p ) as p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN rating r ON r.product_id = p.id LEFT JOIN favorites f ON f.product_id = p.id GROUP BY price_range ORDER BY FIELD(price_range, 'Low (<1000)', 'Medium (1000-5000)', 'High (5001-15000)', 'Premium (>15000)');                      
 SELECT p.id, p.name, p.category, p.brand, p.quantity AS current_stock, p.price AS unit_price, COUNT(DISTINCT o.id) AS total_sales, COUNT(DISTINCT ca.id) AS times_in_cart, DATEDIFF(CURDATE(), MIN(o.orderdate)) AS days_since_first_sale, (p.quantity * p.price) AS current_stock_value, CASE WHEN COUNT(DISTINCT o.id) = 0 THEN 'No Sales' WHEN COUNT(DISTINCT o.id) < 5 THEN 'Slow Moving' WHEN COUNT(DISTINCT o.id) BETWEEN 5 AND 20 THEN 'Medium Moving' ELSE 'Fast Moving' END AS movement_category FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON ca.client_id = o.client_id GROUP BY p.id HAVING COUNT(DISTINCT o.id) < 3 OR (COUNT(DISTINCT o.id) = 0 AND p.quantity > 10) ORDER BY current_stock_value DESC;                                                                                                                                                                                                                                                                                                          
 SELECT YEAR(o.orderdate) AS year, MONTH(o.orderdate) AS month, p.category, COUNT(DISTINCT o.id) AS order_count, SUM(o.price) AS monthly_revenue, COUNT(DISTINCT o.client_id) AS unique_customers, AVG(o.price) AS avg_order_value, LAG(SUM(o.price), 12) OVER(PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) AS revenue_same_month_last_year, ((SUM(o.price) - LAG(SUM(o.price), 12) OVER(PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate))) / LAG(SUM(o.price), 12) OVER(PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate))) * 100 AS yoy_growth FROM orders o JOIN cart ca ON ca.client_id = o.client_id JOIN products p ON ca.product_id = p.id WHERE o.status = 'delivered' GROUP BY YEAR(o.orderdate), MONTH(o.orderdate), p.category ORDER BY year DESC, month DESC, monthly_revenue DESC; SELECT order_size_category, COUNT(*) as order_count, SUM(price) as total_revenue, AVG(price) as avg_order_value, COUNT(DISTINCT client_id) as unique_customers, AVG(items_per_order) as avg_items_per_order, SUM(items_per_order) as total_items_sold, ROUND(COUNT(*) * 100.0 / (SELECT COUNT(*) FROM orders WHERE status = 'delivered'), 2) as percentage_of_orders, ROUND(SUM(price) * 100.0 / (SELECT SUM(price) FROM orders WHERE status = 'delivered'), 2) as percentage_of_revenue FROM ( SELECT o.id, o.client_id, o.price, COUNT(DISTINCT ca.product_id) as items_per_order, CASE WHEN o.price < 5000 THEN 'Small (<5000)' WHEN o.price BETWEEN 5000 AND 15000 THEN 'Medium (5000-15000)' WHEN o.price BETWEEN 15001 AND 30000 THEN 'Large (15001-30000)' ELSE 'Extra Large (>30000)' END as order_size_category FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.status = 'delivered' GROUP BY o.id, o.client_id, o.price ) as order_sizes GROUP BY order_size_category ORDER BY FIELD(order_size_category, 'Small (<5000)', 'Medium (5000-15000)', 'Large (15001-30000)', 'Extra Large (>30000)'); 
 SELECT p.category, YEAR(o.orderdate) as year, MONTH(o.orderdate) as month, AVG(p.price) as avg_product_price, AVG(o.price) as avg_order_value, AVG(pr.percentage) as avg_discount_percentage, COUNT(DISTINCT o.id) as order_count, SUM(o.price) as total_revenue, LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)) as prev_month_avg_price, ROUND((AVG(p.price) - LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate))) * 100.0 / LAG(AVG(p.price)) OVER (PARTITION BY p.category ORDER BY YEAR(o.orderdate), MONTH(o.orderdate)), 2) as price_change_percentage FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id LEFT JOIN promotions pr ON pr.product_id = p.id AND o.orderdate BETWEEN pr.startdate AND pr.enddate WHERE o.status = 'delivered' AND o.orderdate >= '2023-01-01' GROUP BY p.category, YEAR(o.orderdate), MONTH(o.orderdate) HAVING order_count > 0 ORDER BY p.category, year DESC, month DESC; 
 SELECT c.id AS client_id, COUNT(DISTINCT ca.date_cart) AS cart_sessions, COUNT(DISTINCT ca.product_id) AS unique_products_viewed, COUNT(DISTINCT p.category) AS categories_viewed, COUNT(DISTINCT p.brand) AS brands_viewed, AVG(ca.initial_price) AS avg_cart_item_price, MIN(ca.date_cart) AS first_cart_activity, MAX(ca.date_cart) AS last_cart_activity, DATEDIFF(MAX(ca.date_cart), MIN(ca.date_cart)) AS cart_activity_span_days, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.id END) AS promotional_items_viewed, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.id END) AS offer_items_viewed FROM clients c LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id GROUP BY c.id HAVING COUNT(DISTINCT ca.id) > 0 ORDER BY cart_sessions DESC;                                                                                                                                                                                                                                               
 SELECT search_pattern, COUNT(*) as occurrence_count, AVG(product_price) as avg_price_searched, AVG(product_rating) as avg_rating_searched, COUNT(DISTINCT client_id) as unique_searchers, SUM(CASE WHEN purchased = 1 THEN 1 ELSE 0 END) as conversions, ROUND(SUM(CASE WHEN purchased = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as conversion_rate, AVG(days_to_purchase) as avg_days_to_purchase FROM ( SELECT CASE WHEN p.category LIKE '%elec%' THEN 'Electronics' WHEN p.category LIKE '%cloth%' THEN 'Clothing' WHEN p.category LIKE '%home%' THEN 'Home Goods' WHEN p.price < 1000 THEN 'Budget Items' WHEN p.price > 5000 THEN 'Premium Items' ELSE 'Other Categories' END as search_pattern, p.price as product_price, COALESCE(r.avg_rating, 0) as product_rating, ca.client_id, CASE WHEN o.id IS NOT NULL THEN 1 ELSE 0 END as purchased, DATEDIFF(o.orderdate, ca.date_cart) as days_to_purchase FROM cart ca JOIN products p ON p.id = ca.product_id LEFT JOIN ( SELECT product_id, AVG(rating) as avg_rating FROM rating GROUP BY product_id ) as r ON r.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 60 DAY) ) as search_behavior GROUP BY search_pattern HAVING occurrence_count > 5 ORDER BY conversion_rate DESC; 
 SELECT c.id AS client_id, c.firstname, c.lastname, COUNT(DISTINCT ca.id) AS cart_items_without_order, COUNT(DISTINCT o.id) AS completed_orders, AVG(ca.initial_price) AS avg_abandoned_item_price, MIN(ca.date_cart) AS first_abandoned_cart_date, MAX(ca.date_cart) AS last_abandoned_cart_date, GROUP_CONCAT(DISTINCT p.category) AS abandoned_categories, COUNT(DISTINCT CASE WHEN pr.id IS NOT NULL THEN ca.id END) AS abandoned_promotional_items, (COUNT(DISTINCT ca.id) * 100.0 / (COUNT(DISTINCT ca.id) + COUNT(DISTINCT o.id))) AS abandonment_rate FROM clients c LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate > ca.date_cart LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN promotions pr ON ca.promotion_id = pr.id WHERE ca.id IS NOT NULL AND o.id IS NULL GROUP BY c.id HAVING COUNT(DISTINCT ca.id) > 2 ORDER BY abandonment_rate DESC;                                                                                                                                             
 SELECT complexity_level, COUNT(*) as order_count, AVG(order_value) as avg_order_value, AVG(item_count) as avg_items_per_order, AVG(category_count) as avg_categories_per_order, SUM(order_value) as total_revenue, AVG(processing_time_days) as avg_processing_time, COUNT(DISTINCT client_id) as unique_customers FROM ( SELECT o.id, o.client_id, o.price as order_value, COUNT(DISTINCT ca.product_id) as item_count, COUNT(DISTINCT p.category) as category_count, DATEDIFF(o.deliveredDate, o.orderdate) as processing_time_days, CASE WHEN COUNT(DISTINCT ca.product_id) = 1 THEN 'Single Item' WHEN COUNT(DISTINCT ca.product_id) BETWEEN 2 AND 3 THEN 'Small Basket' WHEN COUNT(DISTINCT ca.product_id) BETWEEN 4 AND 6 THEN 'Medium Basket' WHEN COUNT(DISTINCT p.category) >= 3 THEN 'Multi-Category' ELSE 'Complex Order' END as complexity_level FROM orders o JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 JOIN products p ON p.id = ca.product_id WHERE o.status = 'delivered' GROUP BY o.id, o.client_id, o.price, o.deliveredDate, o.orderdate ) as order_complexity GROUP BY complexity_level ORDER BY FIELD(complexity_level, 'Single Item', 'Small Basket', 'Medium Basket', 'Multi-Category', 'Complex Order'); 
 SELECT c.id AS client_id, COUNT(DISTINCT ca.date_cart) AS cart_sessions, COUNT(DISTINCT ca.product_id) AS products_viewed, COUNT(DISTINCT p.category) AS categories_viewed, COUNT(DISTINCT p.brand) AS brands_viewed, AVG(ca.initial_price) AS avg_viewed_price, MIN(ca.date_cart) AS first_view_date, MAX(ca.date_cart) AS last_view_date, COUNT(DISTINCT CASE WHEN ca.promotion_id IS NOT NULL THEN ca.product_id END) AS promotional_products_viewed, COUNT(DISTINCT CASE WHEN ca.offer_id IS NOT NULL THEN ca.product_id END) AS offer_products_viewed, (COUNT(DISTINCT o.id) * 100.0 / COUNT(DISTINCT ca.date_cart)) AS cart_to_order_conversion_rate FROM clients c LEFT JOIN cart ca ON c.id = ca.client_id LEFT JOIN products p ON ca.product_id = p.id LEFT JOIN orders o ON c.id = o.client_id AND o.orderdate >= ca.date_cart GROUP BY c.id HAVING COUNT(DISTINCT ca.date_cart) > 0 ORDER BY cart_sessions DESC;                                                                                                                                      
 SELECT client_id, current_avg_order_value, client_segment, recommended_upsell_products, potential_value_increase, upsell_probability_score FROM ( SELECT c.id as client_id, AVG(o.price) as current_avg_order_value, CASE WHEN AVG(o.price) < 5000 THEN 'Low Spender' WHEN AVG(o.price) BETWEEN 5000 AND 15000 THEN 'Medium Spender' ELSE 'High Spender' END as client_segment, GROUP_CONCAT(DISTINCT CASE WHEN p.category NOT IN (SELECT DISTINCT p2.category FROM orders o2 JOIN cart ca2 ON FIND_IN_SET(ca2.id, o2.cart_id) > 0 JOIN products p2 ON p2.id = ca2.product_id WHERE o2.client_id = c.id) THEN p.name END SEPARATOR ', ') as recommended_upsell_products, (SELECT AVG(price) FROM products WHERE category NOT IN ( SELECT DISTINCT p2.category FROM orders o2 JOIN cart ca2 ON FIND_IN_SET(ca2.id, o2.cart_id) > 0 JOIN products p2 ON p2.id = ca2.product_id WHERE o2.client_id = c.id )) as potential_value_increase, ROUND( (COUNT(DISTINCT o.id) * 0.3) + (DATEDIFF(CURDATE(), MIN(o.orderdate)) / 365 * 0.2) + (AVG(r.rating) * 0.5), 2 ) as upsell_probability_score FROM clients c LEFT JOIN orders o ON o.client_id = c.id LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.client_id = c.id WHERE o.status = 'delivered' GROUP BY c.id HAVING COUNT(DISTINCT o.id) >= 1 ) as upselling_opportunities WHERE recommended_upsell_products IS NOT NULL AND upsell_probability_score > 0.5 ORDER BY upsell_probability_score DESC, potential_value_increase DESC LIMIT 50; 
 SELECT abandonment_reason_category, COUNT(*) as abandonment_count, AVG(cart_value) as avg_abandoned_cart_value, AVG(items_in_cart) as avg_items_abandoned, COUNT(DISTINCT client_id) as unique_clients_abandoning, AVG(days_since_abandonment) as avg_days_abandoned, SUM(CASE WHEN later_converted = 1 THEN 1 ELSE 0 END) as later_conversions, ROUND(SUM(CASE WHEN later_converted = 1 THEN 1 ELSE 0 END) * 100.0 / COUNT(*), 2) as later_conversion_rate FROM ( SELECT ca.id as cart_id, ca.client_id, ca.initial_price as cart_value, COUNT(DISTINCT ca.product_id) as items_in_cart, DATEDIFF(CURDATE(), ca.date_cart) as days_since_abandonment, CASE WHEN o.id IS NOT NULL THEN 1 ELSE 0 END as later_converted, CASE WHEN ca.initial_price > 50000 THEN 'High Value Cart' WHEN DATEDIFF(CURDATE(), ca.date_cart) <= 1 THEN 'Recent Abandonment' WHEN COUNT(DISTINCT ca.product_id) >= 5 THEN 'Large Cart' WHEN EXISTS (SELECT 1 FROM cart ca2 WHERE ca2.client_id = ca.client_id AND ca2.date_cart > ca.date_cart) THEN 'Cart Comparison' ELSE 'Standard Abandonment' END as abandonment_reason_category FROM cart ca LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 WHERE o.id IS NULL AND ca.date_cart >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) GROUP BY ca.id, ca.client_id, ca.initial_price, ca.date_cart ) as abandonment_analysis GROUP BY abandonment_reason_category ORDER BY abandonment_count DESC; 
 SELECT age_group, gender_category, COUNT(DISTINCT c.id) as client_count, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_spent, AVG(o.price) as avg_order_value, COUNT(DISTINCT p.category) as unique_categories_purchased, AVG(r.rating) as avg_rating_given, COUNT(DISTINCT f.id) as favorites_added, COUNT(DISTINCT cm.id) as comments_made, ROUND(COUNT(DISTINCT o.id) * 1.0 / COUNT(DISTINCT c.id), 2) as avg_orders_per_client, ROUND(SUM(o.price) * 1.0 / COUNT(DISTINCT c.id), 2) as avg_spent_per_client FROM ( SELECT c.*, FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) as age, CASE WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) < 18 THEN 'Under 18' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 18 AND 25 THEN '18-25' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 26 AND 35 THEN '26-35' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 36 AND 45 THEN '36-45' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 46 AND 55 THEN '46-55' WHEN FLOOR(DATEDIFF(CURDATE(), c.birthday) / 365.25) BETWEEN 56 AND 65 THEN '56-65' ELSE '65+' END as age_group, CASE WHEN MOD(c.id, 2) = 0 THEN 'Female' ELSE 'Male' END as gender_category FROM clients c ) as c LEFT JOIN orders o ON o.client_id = c.id AND o.status = 'delivered' LEFT JOIN cart ca ON FIND_IN_SET(ca.id, o.cart_id) > 0 LEFT JOIN products p ON p.id = ca.product_id LEFT JOIN rating r ON r.client_id = c.id LEFT JOIN comments cm ON cm.client_id = c.id LEFT JOIN favorites f ON f.client_id = c.id WHERE age IS NOT NULL GROUP BY age_group, gender_category HAVING client_count > 0 ORDER BY FIELD(age_group, 'Under 18', '18-25', '26-35', '36-45', '46-55', '56-65', '65+'), gender_category; 
 SELECT product_id, product_name, category, current_stock, daily_sales_rate_last_7_days, daily_sales_rate_last_30_days, predicted_demand_next_7_days, predicted_demand_next_30_days, stock_cover_days, reorder_recommendation, confidence_level FROM ( SELECT p.id as product_id, p.name as product_name, p.category, p.quantity as current_stock, ROUND(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0, 2) as daily_sales_rate_last_7_days, ROUND(COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0, 2) as daily_sales_rate_last_30_days, ROUND( (COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0) * 7 * CASE WHEN DAYNAME(CURDATE()) IN ('Friday', 'Saturday') THEN 1.2 WHEN MONTH(CURDATE()) IN (12,1,6,7) THEN 1.15 ELSE 1.0 END, 0 ) as predicted_demand_next_7_days, ROUND( (COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0) * 30 * CASE WHEN MONTH(CURDATE()) IN (12,1,6,7) THEN 1.25 WHEN MONTH(CURDATE()) IN (3,4,9,10) THEN 1.1 ELSE 1.0 END, 0 ) as predicted_demand_next_30_days, ROUND( p.quantity / NULLIF( GREATEST( COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 ), 0 ), 1 ) as stock_cover_days, CASE WHEN ROUND( p.quantity / NULLIF( GREATEST( COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 ), 0 ), 1 ) <= 7 THEN 'Reorder Immediately' WHEN ROUND( p.quantity / NULLIF( GREATEST( COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 ), 0 ), 1 ) <= 14 THEN 'Reorder Soon' WHEN ROUND( p.quantity / NULLIF( GREATEST( COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) / 7.0, COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) / 30.0 ), 0 ), 1 ) <= 30 THEN 'Monitor Closely' ELSE 'Sufficient Stock' END as reorder_recommendation, CASE WHEN COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 7 DAY) THEN o.id END) >= 5 THEN 'High Confidence' WHEN COUNT(DISTINCT CASE WHEN o.orderdate >= DATE_SUB(CURDATE(), INTERVAL 30 DAY) THEN o.id END) >= 10 THEN 'Medium Confidence' ELSE 'Low Confidence' END as confidence_level FROM products p LEFT JOIN cart ca ON ca.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) > 0 AND o.status = 'delivered' WHERE p.quantity > 0 GROUP BY p.id, p.name, p.category, p.quantity ) as short_term_demand_forecast WHERE daily_sales_rate_last_7_days > 0 OR daily_sales_rate_last_30_days > 0 ORDER BY stock_cover_days, predicted_demand_next_7_days DESC; 
 SELECT * FROM products WHERE name LIKE '%phone%' AND category = 'Electronics';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE category = 'Electronics' ORDER BY RAND() LIMIT 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.id, p.name, p.price FROM products p WHERE p.quantity > 0 AND p.category = 'Electronics' UNION ALL SELECT pr.product_id, p2.name, pr.price FROM promotions pr JOIN products p2 ON pr.product_id = p2.id WHERE pr.price < 1000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products WHERE category IN ( 'Electronics', 'Clothing', 'Home', 'Kitchen', 'Books', 'Sports', 'Toys', 'Beauty', 'Health', 'Automotive', 'Garden', 'Office', 'Pet Supplies', 'Baby', 'Jewelry' );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE JSON_EXTRACT(more_details, '$.warranty_years') > 2 AND JSON_EXTRACT(more_details, '$.color') = 'black';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products WHERE name LIKE '%pro%' OR brand LIKE '%max%' OR description LIKE '%premium%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE category = 'Electronics' ORDER BY price * quantity DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE description LIKE '%a%b%c%d%e%f%g%' OR description LIKE '%phone%case%charger%wireless%' OR description REGEXP '.*(.)\\1{3,}.*' OR SOUNDEX(description) = SOUNDEX('abcdefghijklmnopqrstuvwxyz');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT *, REPEAT('0', 32 - LENGTH(REPLACE(BIN(ASCII(SUBSTRING(name, 1, 1))), '0', '')))  REPLACE(BIN(ASCII(SUBSTRING(name, 1, 1))), '0', '') as binary_encoded, MD5(CONCAT(name, description, more_details)) as hash_all FROM products WHERE SHA2(CONCAT(name, price, quantity), 256) LIKE 'a%' AND CRC32(name) % 1000 = 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT o1.*, (SELECT SQRT( POWER(o1.price - o2.price, 2) + POWER(o1.wilaya_id - o2.wilaya_id, 2) + POWER(o1.client_id - o2.client_id, 2) ) FROM orders o2 WHERE o2.id != o1.id ORDER BY 1 ASC LIMIT 1) as nearest_neighbor_distance FROM orders o1 WHERE o1.price > 1000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT *, CASE WHEN price > 1000 AND quantity < 10 THEN 'Premium-LowStock' WHEN price < 100 AND quantity > 100 THEN 'Cheap-HighStock' WHEN category = 'Electronics' AND price BETWEEN 500 AND 1000 THEN 'MidRange-Electronics' WHEN price * quantity > 10000 THEN 'HighValue' ELSE 'Other' END as rule_result, (SELECT COUNT(*) FROM products p2 WHERE p2.category = p1.category AND p2.price BETWEEN p1.price * 0.9 AND p1.price * 1.1 AND p2.id != p1.id) as similar_products_count FROM products p1 WHERE (price > 1000 AND quantity < 10) OR (price < 100 AND quantity > 100) OR (category = 'Electronics' AND price BETWEEN 500 AND 1000) OR (price * quantity > 10000);                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p1.id as p1, p2.id as p2, p3.id as p3, p1.price + p2.price + p3.price as total_price, CONCAT(p1.category, '', p2.category, '', p3.category) as categories FROM products p1 CROSS JOIN products p2 CROSS JOIN products p3 WHERE p1.id < p2.id AND p2.id < p3.id AND p1.category != p2.category AND p2.category != p3.category AND p1.category != p3.category AND p1.price + p2.price + p3.price BETWEEN 1000 AND 2000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM orders ORDER BY DATEDIFF(deliveredDate, orderdate) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM orders ORDER BY DAYOFYEAR(orderdate) * price;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products ORDER BY price * quantity DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products ORDER BY SQRT(price) * LOG(quantity);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE ABS(price - 100) < price * 0.1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products ORDER BY CEIL(price / 100) * RAND();                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE name LIKE '%'  brand  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE description LIKE CONCAT('%', name, '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE name LIKE REVERSE(brand)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE name LIKE '%'  UPPER(category)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products ORDER BY price + quantity DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products WHERE description LIKE '%'  SUBSTRING(name, 1, 5)  '%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products WHERE price > 1000 OR quantity < 5 OR category LIKE '%E%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT * FROM products WHERE (name LIKE '%pro%' AND price > 500) OR brand = 'Apple';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products WHERE category IN ('A','B') OR price BETWEEN 100 AND 200 OR quantity = 0;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE name LIKE CONCAT(brand, '%', category);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products WHERE name LIKE CONCAT('%', LEFT(brand, 3), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT * FROM products WHERE description LIKE CONCAT('%', REPLACE(name, ' ', '%'), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT * FROM products WHERE name LIKE CONCAT('%', REVERSE(category), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE UPPER(name) LIKE CONCAT('%', UPPER(brand), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE LOWER(name) LIKE CONCAT('%', LOWER(category), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE name LIKE CONCAT('%', TRIM(brand), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE name LIKE '%a%b%c%d%e%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE name LIKE '%pro%max%ultra%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE name LIKE '%2023%2024%2025%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE name LIKE '%[0-9][0-9][0-9]%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE name LIKE CONCAT(SUBSTRING(name, 1, 3), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE description LIKE CONCAT('%', SUBSTRING(name, -3), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products ORDER BY price - quantity ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE name LIKE CONCAT(LEFT(brand, 2), '%', RIGHT(category, 2));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE name LIKE CONCAT('%', brand, '%') OR description LIKE CONCAT('%', category, '%') OR more_details LIKE CONCAT('%', name, '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE name LIKE CONCAT('%', (SELECT SUBSTRING(name, 1, 3) FROM products LIMIT 1), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE CASE WHEN price > 1000 THEN name LIKE '%premium%' ELSE name LIKE '%basic%' END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE name LIKE '%pro%' AND name REGEXP '[0-9]{3,}' AND description LIKE '%feature%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE name LIKE CONCAT('%', CAST(price AS CHAR), '%') OR description LIKE CONCAT('%', CAST(quantity AS CHAR), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE CONCAT(name, ' ', brand) LIKE '%phone%' OR CONCAT(category, ' ', description) LIKE '%wireless%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products ORDER BY price * (quantity + 1) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE name LIKE '%a%' OR brand LIKE '%b%' OR category LIKE '%c%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT * FROM products WHERE price BETWEEN 100 AND 200 OR quantity BETWEEN 10 AND 20;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE (name LIKE '%pro%' AND price > 500) OR (brand = 'Samsung' AND quantity < 20);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE LENGTH(name) > 10 OR LENGTH(description) > 100 OR LENGTH(brand) > 5;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT * FROM products WHERE price > (SELECT AVG(price) FROM products) OR quantity < (SELECT AVG(quantity) FROM products) OR category IN (SELECT DISTINCT category FROM products WHERE price > 1000);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE price * quantity > 10000 OR price / quantity < 10 OR (price + 100) * 0.9 > 500;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products p WHERE p.price > 1000 OR p.id IN (SELECT product_id FROM promotions WHERE percentage > 20) OR p.id IN (SELECT product_id FROM favorites GROUP BY product_id HAVING COUNT(*) > 10);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE price > 1000 OR (id % 100 = 0 AND quantity > 50) OR (LEFT(name, 1) = 'A' AND price < 100);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE CASE WHEN category = 'Electronics' THEN price > 500 WHEN category = 'Clothing' THEN quantity > 100 ELSE price > 100 END OR brand = 'Premium';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE name LIKE '%pro%' OR price * quantity > 5000 OR (brand LIKE '%a%' AND quantity < 10);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products ORDER BY (price * 0.8) + (quantity * 10) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE (price * 1.1) > 1000 OR description LIKE '%discount%' OR (category LIKE '%E%' AND quantity > 50);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE UPPER(name) LIKE '%PHONE%' OR LOWER(brand) = 'apple' OR CONCAT(category, brand) LIKE '%ElectronicsApple%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products p WHERE p.price > (SELECT AVG(price) FROM products) OR p.name LIKE CONCAT('%', (SELECT brand FROM products ORDER BY price DESC LIMIT 1), '%') OR p.id IN (SELECT product_id FROM favorites);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products WHERE (price > 1000 AND (name LIKE '%pro%' OR brand = 'Premium')) OR (quantity < 5 AND (category LIKE '%Clearance%' OR description LIKE '%last%')) OR (price BETWEEN 100 AND 500 AND quantity BETWEEN 20 AND 100);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE name REGEXP '^[A-Z][a-z]+ [0-9]+' OR description LIKE '%wireless%bluetooth%' OR (price * quantity > 10000 AND brand LIKE '%S%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE CASE WHEN category = 'Electronics' THEN price > 1000 WHEN category = 'Books' THEN price < 50 ELSE price BETWEEN 100 AND 500 END OR quantity < 10;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE name LIKE '%a%b%c%d%e%f%g%' OR description LIKE '%'  REPEAT('test', 3)  '%' OR brand LIKE CONCAT('%', CHAR(65 + (id % 26)), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products WHERE name REGEXP '[0-9]{4}' OR description REGEXP '\\b(freediscountsale)\\b' OR brand REGEXP '^[AS]';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT * FROM products WHERE (price * (quantity + 1)) > (SELECT AVG(price * quantity) FROM products) OR name LIKE CONCAT('%', CAST((price * 0.1) AS CHAR), '%') OR (brand IN ('A','B','C') AND category LIKE '%'  LEFT(name, 2)  '%') OR (id % 7 = 0 AND description LIKE '%'  REVERSE(brand)  '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products ORDER BY price % 50 DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE name LIKE CONCAT('%', CASE WHEN price > 1000 THEN 'premium' ELSE 'basic' END, '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products ORDER BY price * 1.19 DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products ORDER BY price / 1.19 ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT * FROM products ORDER BY price + 10 - 5 DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products ORDER BY (price - 50) * 1.1 DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT * FROM products ORDER BY EXP(price * 0.001) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT o.*, c.firstname, c.lastname, w.name FROM orders o INNER JOIN clients c ON o.client_id = c.id INNER JOIN wilayas w ON o.wilaya_id = w.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products ORDER BY LOG10(price + 1) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products p1 WHERE EXISTS ( SELECT 1 FROM products p2 WHERE p1.name LIKE CONCAT('%', p2.brand, '%') OR p2.description LIKE CONCAT('%', p1.name, '%') ); SELECT p.* FROM products p WHERE p.id IN ( SELECT product_id FROM favorites WHERE client_id = 100 );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.*, pr.price as promo_price FROM products p INNER JOIN promotions pr ON p.id = pr.product_id WHERE p.category = 'Electronics';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products WHERE name LIKE CONCAT('%', CAST(FLOOR(SQRT(price)) AS CHAR), '%') OR description LIKE CONCAT('%', CAST(CEIL(price/100) AS CHAR), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT p.* FROM products p WHERE EXISTS ( SELECT 1 FROM promotions pr WHERE pr.product_id = p.id AND pr.enddate > NOW() );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE price BETWEEN 100 AND 500;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT category, COUNT(*), AVG(price) FROM products WHERE quantity > 0 GROUP BY category;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE category = 'Electronics' ORDER BY price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products ORDER BY POWER(price, 1.5) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT client_id, status, COUNT(*), SUM(price) FROM orders GROUP BY client_id, status;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products WHERE name LIKE CONCAT('%', CAST(YEAR(CURDATE()) AS CHAR), '%') OR description LIKE CONCAT('%', CAST(MONTH(CURDATE()) AS CHAR), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
 SELECT * FROM products WHERE category IN ('Electronics', 'Clothing', 'Home');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE name LIKE CONCAT('%', SUBSTRING(MD5(name), 1, 3), '%') OR description LIKE CONCAT('%', SUBSTRING(SHA1(brand), -3), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products WHERE name LIKE CONCAT( SUBSTRING(name, 1, 1), '%', SUBSTRING(name, LENGTH(name), 1) );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE name LIKE CONCAT('%', (SELECT SUBSTRING(name, 1, 1) FROM products GROUP BY SUBSTRING(name, 1, 1) ORDER BY COUNT(*) DESC LIMIT 1), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT o.*, c.firstname, w.name FROM orders o INNER JOIN clients c ON o.client_id = c.id INNER JOIN wilayas w ON o.wilaya_id = w.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products p1 WHERE p1.name LIKE CONCAT('%', (SELECT LEFT(brand, 3) FROM products p2 WHERE p2.id = p1.id + 1), '%');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
 SELECT * FROM products WHERE name LIKE CONCAT( REPEAT('_', LENGTH(name) / 2), '%', REPEAT('_', LENGTH(name) / 4) );                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products ORDER BY SIN(price * 0.01) DESC; SELECT * FROM products WHERE CASE WHEN LENGTH(name) > 10 THEN name LIKE '%'  SUBSTRING(name, 5, 3)  '%' WHEN price > 500 THEN name LIKE '%'  LEFT(brand, 2)  '%' ELSE name LIKE '%'  RIGHT(category, 2)  '%' END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT * FROM products ORDER BY COS(price * 0.02) ASC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT * FROM products ORDER BY TAN(price * 0.005) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT * FROM products ORDER BY price / (SELECT AVG(price) FROM products) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT * FROM products ORDER BY (price - (SELECT AVG(price) FROM products)) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT * FROM products ORDER BY price * LOG(quantity + 1) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT * FROM products ORDER BY CASE WHEN price > 1000 THEN price * 0.9 ELSE price * 0.95 END DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products ORDER BY CASE WHEN quantity > 50 THEN price * 0.85 WHEN quantity > 20 THEN price * 0.90 ELSE price END DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products ORDER BY price DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE id BETWEEN 10 AND 500 LIMIT 500;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT p.category, GROUP_CONCAT(DISTINCT p.brand ORDER BY p.brand SEPARATOR ', ') as brands_in_category, COUNT(DISTINCT p.id) as product_count FROM products p GROUP BY p.category ORDER BY product_count DESC; /usr/sbin/mysqld, Version: 8.0.44 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT * FROM products WHERE id BETWEEN 10 AND 500 LIMIT 3000; /usr/sbin/mysqld, Version: 8.0.44 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT p.category, p.brand, COUNT(DISTINCT o.id) as total_orders, SUM(o.price) as total_revenue, AVG(o.price) as avg_order_value, COUNT(DISTINCT o.client_id) as unique_customers, GROUP_CONCAT(DISTINCT pr.price ORDER BY pr.enddate DESC) as recent_promo_prices FROM products p LEFT JOIN orders o ON EXISTS ( SELECT 1 FROM cart ct WHERE ct.product_id = p.id AND ct.client_id = o.client_id AND ct.date_cart = o.orderdate ) LEFT JOIN promotions pr ON pr.product_id = p.id AND CURDATE() BETWEEN pr.startdate AND pr.enddate WHERE p.quantity > 0 AND p.price > 100 GROUP BY p.category, p.brand HAVING total_orders > 0 ORDER BY total_revenue DESC; /usr/sbin/mysqld, Version: 8.0.44 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                          
 SELECT * FROM products WHERE id = 1;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT *, price * quantity as inventory_value FROM products WHERE price * quantity > 10000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT category, name, price, RANK() OVER (PARTITION BY category ORDER BY price DESC) as price_rank FROM products; /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE id < 1000 LIMIT 3000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT p.id, p.name, pr.price FROM products p JOIN promotions pr ON pr.product_id = p.id;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT category, name, price, RANK() OVER (PARTITION BY category ORDER BY price DESC) as price_rank FROM products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products WHERE id BETWEEN 10 AND 500 LIMIT 3000;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM dataset_ml LIMIT 10; /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT * FROM products WHERE name LIKE '%pro%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT p.name, pr.percentage, COUNT(DISTINCT ca.id) as cart_additions, COUNT(DISTINCT o.id) as purchases FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY p.name, pr.percentage;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
 SELECT DATE(date_cart) as cart_date, COUNT(*) as carts_created, COUNT(DISTINCT CASE WHEN o.id IS NOT NULL THEN ca.id END) as carts_converted FROM cart ca LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY DATE(date_cart) ORDER BY cart_date DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
 SELECT a.username, a.role, COUNT(DISTINCT p.id) as products_managed, COUNT(DISTINCT o.id) as orders_processed, SUM(o.price) as revenue_managed FROM admin a LEFT JOIN products p ON a.id = p.admin_id LEFT JOIN orders o ON a.id = o.admin_id GROUP BY a.username, a.role ORDER BY revenue_managed DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
 SELECT DATE(pr.startdate) as promo_start, p.name, pr.percentage, COUNT(DISTINCT ca.id) as times_used, SUM(o.price) as revenue_generated FROM promotions pr JOIN products p ON pr.product_id = p.id LEFT JOIN cart ca ON ca.promotion_id = pr.id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY DATE(pr.startdate), p.name, pr.percentage ORDER BY promo_start DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.category, SUM(p.quantity * p.price) as inventory_value, COUNT(DISTINCT o.id) as units_sold, SUM(o.price) as revenue, ROUND(SUM(o.price) / NULLIF(SUM(p.quantity * p.price), 0), 2) as turnover_ratio FROM products p LEFT JOIN cart ca ON p.id = ca.product_id LEFT JOIN orders o ON FIND_IN_SET(ca.id, o.cart_id) GROUP BY p.category ORDER BY turnover_ratio DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
 SELECT * FROM products WHERE name LIKE '%plus%' OR name LIKE '%pro%' OR name LIKE '%max%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE name REGEXP 'promaxultra';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT p.name, p.price, COUNT(ca.id) as cart_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id WHERE p.name LIKE '%pro%' GROUP BY p.name, p.price ORDER BY cart_count DESC; /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE id < 1000 LIMIT 3000; /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                      
 SELECT * FROM products WHERE name LIKE 'pro%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE name LIKE '%pro%' OR description LIKE '%pro%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 SELECT * FROM products WHERE name LIKE '%pro%' AND category LIKE '%elec%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE name LIKE '%hd%' OR name LIKE '%4k%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
 SELECT * FROM products WHERE CONCAT(name, ' ', brand) LIKE '%apple%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
 SELECT p.* FROM products p WHERE (p.name LIKE '%pro%' OR p.brand LIKE '%sam%') AND p.price > 500 AND p.category LIKE '%elec%';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
 SELECT * FROM products WHERE name REGEXP 'iphone [0-9]+';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE description REGEXP 'wireless.*bluetooth';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
 SELECT p.name, p.price, COUNT(ca.id) as cart_count FROM products p LEFT JOIN cart ca ON p.id = ca.product_id WHERE p.name LIKE '%pro%' GROUP BY p.name, p.price ORDER BY cart_count DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE id BETWEEN 10 AND 500 LIMIT 3000; /usr/sbin/mysqld, Version: 8.0.45 (MySQL Community Server - GPL). started with: Tcp port: 3306  Unix socket: /var/run/mysqld/mysqld.sock Time                 Id Command    Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
 SELECT * FROM products WHERE category NOT IN ('Electronics', 'Clothing');                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 SELECT * FROM products WHERE name REGEXP '^iPhone [0-9]+';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
 SELECT * FROM products WHERE images IS NOT NULL AND images != '';                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.category, p.brand, AVG(p.price) as avg_price, COUNT(DISTINCT o.id) as orders FROM products p LEFT JOIN cart c ON p.id = c.product_id LEFT JOIN orders o ON FIND_IN_SET(c.id, o.cart_id) > 0 GROUP BY p.category, p.brand ORDER BY orders DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 SELECT c.client_id, COUNT(c.id) as cart_items, MAX(c.date_cart) as last_cart_date FROM cart c LEFT JOIN orders o ON FIND_IN_SET(c.id, o.cart_id) > 0 WHERE o.id IS NULL GROUP BY c.client_id HAVING COUNT(c.id) > 2 ORDER BY last_cart_date DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT p.category, COUNT(c.id) as abandoned_carts FROM cart c JOIN products p ON c.product_id = p.id LEFT JOIN orders o ON FIND_IN_SET(c.id, o.cart_id) > 0 WHERE o.id IS NULL GROUP BY p.category ORDER BY abandoned_carts DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 SELECT category, SUM(quantity) as total_stock, AVG(price) as avg_price FROM products GROUP BY category ORDER BY total_stock DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
 select * from products;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
 select * from products where brand = "samsung" order by price;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   